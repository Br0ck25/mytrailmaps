function R_(w,S){for(var M=0;M<S.length;M++){const D=S[M];if(typeof D!="string"&&!Array.isArray(D)){for(const B in D)if(B!=="default"&&!(B in w)){const U=Object.getOwnPropertyDescriptor(D,B);U&&Object.defineProperty(w,B,U.get?U:{enumerable:!0,get:()=>D[B]})}}}return Object.freeze(Object.defineProperty(w,Symbol.toStringTag,{value:"Module"}))}(function(){const S=document.createElement("link").relList;if(S&&S.supports&&S.supports("modulepreload"))return;for(const B of document.querySelectorAll('link[rel="modulepreload"]'))D(B);new MutationObserver(B=>{for(const U of B)if(U.type==="childList")for(const I of U.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&D(I)}).observe(document,{childList:!0,subtree:!0});function M(B){const U={};return B.integrity&&(U.integrity=B.integrity),B.referrerPolicy&&(U.referrerPolicy=B.referrerPolicy),B.crossOrigin==="use-credentials"?U.credentials="include":B.crossOrigin==="anonymous"?U.credentials="omit":U.credentials="same-origin",U}function D(B){if(B.ep)return;B.ep=!0;const U=M(B);fetch(B.href,U)}})();var em=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vp(w){return w&&w.__esModule&&Object.prototype.hasOwnProperty.call(w,"default")?w.default:w}var Lm={exports:{}},op={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mg;function z_(){if(mg)return op;mg=1;var w=Symbol.for("react.transitional.element"),S=Symbol.for("react.fragment");function M(D,B,U){var I=null;if(U!==void 0&&(I=""+U),B.key!==void 0&&(I=""+B.key),"key"in B){U={};for(var c in B)c!=="key"&&(U[c]=B[c])}else U=B;return B=U.ref,{$$typeof:w,type:D,key:I,ref:B!==void 0?B:null,props:U}}return op.Fragment=S,op.jsx=M,op.jsxs=M,op}var gg;function L_(){return gg||(gg=1,Lm.exports=z_()),Lm.exports}var ge=L_(),km={exports:{}},Yr={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _g;function k_(){if(_g)return Yr;_g=1;var w=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),D=Symbol.for("react.strict_mode"),B=Symbol.for("react.profiler"),U=Symbol.for("react.consumer"),I=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),J=Symbol.for("react.suspense"),K=Symbol.for("react.memo"),oe=Symbol.for("react.lazy"),X=Symbol.iterator;function _e(ue){return ue===null||typeof ue!="object"?null:(ue=X&&ue[X]||ue["@@iterator"],typeof ue=="function"?ue:null)}var se={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Me=Object.assign,qe={};function at(ue,Ye,Mt){this.props=ue,this.context=Ye,this.refs=qe,this.updater=Mt||se}at.prototype.isReactComponent={},at.prototype.setState=function(ue,Ye){if(typeof ue!="object"&&typeof ue!="function"&&ue!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ue,Ye,"setState")},at.prototype.forceUpdate=function(ue){this.updater.enqueueForceUpdate(this,ue,"forceUpdate")};function ft(){}ft.prototype=at.prototype;function pt(ue,Ye,Mt){this.props=ue,this.context=Ye,this.refs=qe,this.updater=Mt||se}var zt=pt.prototype=new ft;zt.constructor=pt,Me(zt,at.prototype),zt.isPureReactComponent=!0;var Rt=Array.isArray,Ge={H:null,A:null,T:null,S:null,V:null},Pe=Object.prototype.hasOwnProperty;function gt(ue,Ye,Mt,yt,vt,It){return Mt=It.ref,{$$typeof:w,type:ue,key:Ye,ref:Mt!==void 0?Mt:null,props:It}}function bt(ue,Ye){return gt(ue.type,Ye,void 0,void 0,void 0,ue.props)}function Yt(ue){return typeof ue=="object"&&ue!==null&&ue.$$typeof===w}function nr(ue){var Ye={"=":"=0",":":"=2"};return"$"+ue.replace(/[=:]/g,function(Mt){return Ye[Mt]})}var lr=/\/+/g;function dr(ue,Ye){return typeof ue=="object"&&ue!==null&&ue.key!=null?nr(""+ue.key):Ye.toString(36)}function Kt(){}function xr(ue){switch(ue.status){case"fulfilled":return ue.value;case"rejected":throw ue.reason;default:switch(typeof ue.status=="string"?ue.then(Kt,Kt):(ue.status="pending",ue.then(function(Ye){ue.status==="pending"&&(ue.status="fulfilled",ue.value=Ye)},function(Ye){ue.status==="pending"&&(ue.status="rejected",ue.reason=Ye)})),ue.status){case"fulfilled":return ue.value;case"rejected":throw ue.reason}}throw ue}function tt(ue,Ye,Mt,yt,vt){var It=typeof ue;(It==="undefined"||It==="boolean")&&(ue=null);var Ot=!1;if(ue===null)Ot=!0;else switch(It){case"bigint":case"string":case"number":Ot=!0;break;case"object":switch(ue.$$typeof){case w:case S:Ot=!0;break;case oe:return Ot=ue._init,tt(Ot(ue._payload),Ye,Mt,yt,vt)}}if(Ot)return vt=vt(ue),Ot=yt===""?"."+dr(ue,0):yt,Rt(vt)?(Mt="",Ot!=null&&(Mt=Ot.replace(lr,"$&/")+"/"),tt(vt,Ye,Mt,"",function(hi){return hi})):vt!=null&&(Yt(vt)&&(vt=bt(vt,Mt+(vt.key==null||ue&&ue.key===vt.key?"":(""+vt.key).replace(lr,"$&/")+"/")+Ot)),Ye.push(vt)),1;Ot=0;var Xt=yt===""?".":yt+":";if(Rt(ue))for(var mr=0;mr<ue.length;mr++)yt=ue[mr],It=Xt+dr(yt,mr),Ot+=tt(yt,Ye,Mt,It,vt);else if(mr=_e(ue),typeof mr=="function")for(ue=mr.call(ue),mr=0;!(yt=ue.next()).done;)yt=yt.value,It=Xt+dr(yt,mr++),Ot+=tt(yt,Ye,Mt,It,vt);else if(It==="object"){if(typeof ue.then=="function")return tt(xr(ue),Ye,Mt,yt,vt);throw Ye=String(ue),Error("Objects are not valid as a React child (found: "+(Ye==="[object Object]"?"object with keys {"+Object.keys(ue).join(", ")+"}":Ye)+"). If you meant to render a collection of children, use an array instead.")}return Ot}function Re(ue,Ye,Mt){if(ue==null)return ue;var yt=[],vt=0;return tt(ue,yt,"","",function(It){return Ye.call(Mt,It,vt++)}),yt}function st(ue){if(ue._status===-1){var Ye=ue._result;Ye=Ye(),Ye.then(function(Mt){(ue._status===0||ue._status===-1)&&(ue._status=1,ue._result=Mt)},function(Mt){(ue._status===0||ue._status===-1)&&(ue._status=2,ue._result=Mt)}),ue._status===-1&&(ue._status=0,ue._result=Ye)}if(ue._status===1)return ue._result.default;throw ue._result}var ot=typeof reportError=="function"?reportError:function(ue){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ye=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ue=="object"&&ue!==null&&typeof ue.message=="string"?String(ue.message):String(ue),error:ue});if(!window.dispatchEvent(Ye))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ue);return}console.error(ue)};function jt(){}return Yr.Children={map:Re,forEach:function(ue,Ye,Mt){Re(ue,function(){Ye.apply(this,arguments)},Mt)},count:function(ue){var Ye=0;return Re(ue,function(){Ye++}),Ye},toArray:function(ue){return Re(ue,function(Ye){return Ye})||[]},only:function(ue){if(!Yt(ue))throw Error("React.Children.only expected to receive a single React element child.");return ue}},Yr.Component=at,Yr.Fragment=M,Yr.Profiler=B,Yr.PureComponent=pt,Yr.StrictMode=D,Yr.Suspense=J,Yr.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ge,Yr.__COMPILER_RUNTIME={__proto__:null,c:function(ue){return Ge.H.useMemoCache(ue)}},Yr.cache=function(ue){return function(){return ue.apply(null,arguments)}},Yr.cloneElement=function(ue,Ye,Mt){if(ue==null)throw Error("The argument must be a React element, but you passed "+ue+".");var yt=Me({},ue.props),vt=ue.key,It=void 0;if(Ye!=null)for(Ot in Ye.ref!==void 0&&(It=void 0),Ye.key!==void 0&&(vt=""+Ye.key),Ye)!Pe.call(Ye,Ot)||Ot==="key"||Ot==="__self"||Ot==="__source"||Ot==="ref"&&Ye.ref===void 0||(yt[Ot]=Ye[Ot]);var Ot=arguments.length-2;if(Ot===1)yt.children=Mt;else if(1<Ot){for(var Xt=Array(Ot),mr=0;mr<Ot;mr++)Xt[mr]=arguments[mr+2];yt.children=Xt}return gt(ue.type,vt,void 0,void 0,It,yt)},Yr.createContext=function(ue){return ue={$$typeof:I,_currentValue:ue,_currentValue2:ue,_threadCount:0,Provider:null,Consumer:null},ue.Provider=ue,ue.Consumer={$$typeof:U,_context:ue},ue},Yr.createElement=function(ue,Ye,Mt){var yt,vt={},It=null;if(Ye!=null)for(yt in Ye.key!==void 0&&(It=""+Ye.key),Ye)Pe.call(Ye,yt)&&yt!=="key"&&yt!=="__self"&&yt!=="__source"&&(vt[yt]=Ye[yt]);var Ot=arguments.length-2;if(Ot===1)vt.children=Mt;else if(1<Ot){for(var Xt=Array(Ot),mr=0;mr<Ot;mr++)Xt[mr]=arguments[mr+2];vt.children=Xt}if(ue&&ue.defaultProps)for(yt in Ot=ue.defaultProps,Ot)vt[yt]===void 0&&(vt[yt]=Ot[yt]);return gt(ue,It,void 0,void 0,null,vt)},Yr.createRef=function(){return{current:null}},Yr.forwardRef=function(ue){return{$$typeof:c,render:ue}},Yr.isValidElement=Yt,Yr.lazy=function(ue){return{$$typeof:oe,_payload:{_status:-1,_result:ue},_init:st}},Yr.memo=function(ue,Ye){return{$$typeof:K,type:ue,compare:Ye===void 0?null:Ye}},Yr.startTransition=function(ue){var Ye=Ge.T,Mt={};Ge.T=Mt;try{var yt=ue(),vt=Ge.S;vt!==null&&vt(Mt,yt),typeof yt=="object"&&yt!==null&&typeof yt.then=="function"&&yt.then(jt,ot)}catch(It){ot(It)}finally{Ge.T=Ye}},Yr.unstable_useCacheRefresh=function(){return Ge.H.useCacheRefresh()},Yr.use=function(ue){return Ge.H.use(ue)},Yr.useActionState=function(ue,Ye,Mt){return Ge.H.useActionState(ue,Ye,Mt)},Yr.useCallback=function(ue,Ye){return Ge.H.useCallback(ue,Ye)},Yr.useContext=function(ue){return Ge.H.useContext(ue)},Yr.useDebugValue=function(){},Yr.useDeferredValue=function(ue,Ye){return Ge.H.useDeferredValue(ue,Ye)},Yr.useEffect=function(ue,Ye,Mt){var yt=Ge.H;if(typeof Mt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return yt.useEffect(ue,Ye)},Yr.useId=function(){return Ge.H.useId()},Yr.useImperativeHandle=function(ue,Ye,Mt){return Ge.H.useImperativeHandle(ue,Ye,Mt)},Yr.useInsertionEffect=function(ue,Ye){return Ge.H.useInsertionEffect(ue,Ye)},Yr.useLayoutEffect=function(ue,Ye){return Ge.H.useLayoutEffect(ue,Ye)},Yr.useMemo=function(ue,Ye){return Ge.H.useMemo(ue,Ye)},Yr.useOptimistic=function(ue,Ye){return Ge.H.useOptimistic(ue,Ye)},Yr.useReducer=function(ue,Ye,Mt){return Ge.H.useReducer(ue,Ye,Mt)},Yr.useRef=function(ue){return Ge.H.useRef(ue)},Yr.useState=function(ue){return Ge.H.useState(ue)},Yr.useSyncExternalStore=function(ue,Ye,Mt){return Ge.H.useSyncExternalStore(ue,Ye,Mt)},Yr.useTransition=function(){return Ge.H.useTransition()},Yr.version="19.1.0",Yr}var yg;function Jm(){return yg||(yg=1,km.exports=k_()),km.exports}var xt=Jm();const Xu=vp(xt),B_=R_({__proto__:null,default:Xu},[xt]);var Bm={exports:{}},lp={},Om={exports:{}},Nm={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vg;function O_(){return vg||(vg=1,function(w){function S(Re,st){var ot=Re.length;Re.push(st);e:for(;0<ot;){var jt=ot-1>>>1,ue=Re[jt];if(0<B(ue,st))Re[jt]=st,Re[ot]=ue,ot=jt;else break e}}function M(Re){return Re.length===0?null:Re[0]}function D(Re){if(Re.length===0)return null;var st=Re[0],ot=Re.pop();if(ot!==st){Re[0]=ot;e:for(var jt=0,ue=Re.length,Ye=ue>>>1;jt<Ye;){var Mt=2*(jt+1)-1,yt=Re[Mt],vt=Mt+1,It=Re[vt];if(0>B(yt,ot))vt<ue&&0>B(It,yt)?(Re[jt]=It,Re[vt]=ot,jt=vt):(Re[jt]=yt,Re[Mt]=ot,jt=Mt);else if(vt<ue&&0>B(It,ot))Re[jt]=It,Re[vt]=ot,jt=vt;else break e}}return st}function B(Re,st){var ot=Re.sortIndex-st.sortIndex;return ot!==0?ot:Re.id-st.id}if(w.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var U=performance;w.unstable_now=function(){return U.now()}}else{var I=Date,c=I.now();w.unstable_now=function(){return I.now()-c}}var J=[],K=[],oe=1,X=null,_e=3,se=!1,Me=!1,qe=!1,at=!1,ft=typeof setTimeout=="function"?setTimeout:null,pt=typeof clearTimeout=="function"?clearTimeout:null,zt=typeof setImmediate<"u"?setImmediate:null;function Rt(Re){for(var st=M(K);st!==null;){if(st.callback===null)D(K);else if(st.startTime<=Re)D(K),st.sortIndex=st.expirationTime,S(J,st);else break;st=M(K)}}function Ge(Re){if(qe=!1,Rt(Re),!Me)if(M(J)!==null)Me=!0,Pe||(Pe=!0,dr());else{var st=M(K);st!==null&&tt(Ge,st.startTime-Re)}}var Pe=!1,gt=-1,bt=5,Yt=-1;function nr(){return at?!0:!(w.unstable_now()-Yt<bt)}function lr(){if(at=!1,Pe){var Re=w.unstable_now();Yt=Re;var st=!0;try{e:{Me=!1,qe&&(qe=!1,pt(gt),gt=-1),se=!0;var ot=_e;try{t:{for(Rt(Re),X=M(J);X!==null&&!(X.expirationTime>Re&&nr());){var jt=X.callback;if(typeof jt=="function"){X.callback=null,_e=X.priorityLevel;var ue=jt(X.expirationTime<=Re);if(Re=w.unstable_now(),typeof ue=="function"){X.callback=ue,Rt(Re),st=!0;break t}X===M(J)&&D(J),Rt(Re)}else D(J);X=M(J)}if(X!==null)st=!0;else{var Ye=M(K);Ye!==null&&tt(Ge,Ye.startTime-Re),st=!1}}break e}finally{X=null,_e=ot,se=!1}st=void 0}}finally{st?dr():Pe=!1}}}var dr;if(typeof zt=="function")dr=function(){zt(lr)};else if(typeof MessageChannel<"u"){var Kt=new MessageChannel,xr=Kt.port2;Kt.port1.onmessage=lr,dr=function(){xr.postMessage(null)}}else dr=function(){ft(lr,0)};function tt(Re,st){gt=ft(function(){Re(w.unstable_now())},st)}w.unstable_IdlePriority=5,w.unstable_ImmediatePriority=1,w.unstable_LowPriority=4,w.unstable_NormalPriority=3,w.unstable_Profiling=null,w.unstable_UserBlockingPriority=2,w.unstable_cancelCallback=function(Re){Re.callback=null},w.unstable_forceFrameRate=function(Re){0>Re||125<Re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):bt=0<Re?Math.floor(1e3/Re):5},w.unstable_getCurrentPriorityLevel=function(){return _e},w.unstable_next=function(Re){switch(_e){case 1:case 2:case 3:var st=3;break;default:st=_e}var ot=_e;_e=st;try{return Re()}finally{_e=ot}},w.unstable_requestPaint=function(){at=!0},w.unstable_runWithPriority=function(Re,st){switch(Re){case 1:case 2:case 3:case 4:case 5:break;default:Re=3}var ot=_e;_e=Re;try{return st()}finally{_e=ot}},w.unstable_scheduleCallback=function(Re,st,ot){var jt=w.unstable_now();switch(typeof ot=="object"&&ot!==null?(ot=ot.delay,ot=typeof ot=="number"&&0<ot?jt+ot:jt):ot=jt,Re){case 1:var ue=-1;break;case 2:ue=250;break;case 5:ue=1073741823;break;case 4:ue=1e4;break;default:ue=5e3}return ue=ot+ue,Re={id:oe++,callback:st,priorityLevel:Re,startTime:ot,expirationTime:ue,sortIndex:-1},ot>jt?(Re.sortIndex=ot,S(K,Re),M(J)===null&&Re===M(K)&&(qe?(pt(gt),gt=-1):qe=!0,tt(Ge,ot-jt))):(Re.sortIndex=ue,S(J,Re),Me||se||(Me=!0,Pe||(Pe=!0,dr()))),Re},w.unstable_shouldYield=nr,w.unstable_wrapCallback=function(Re){var st=_e;return function(){var ot=_e;_e=st;try{return Re.apply(this,arguments)}finally{_e=ot}}}}(Nm)),Nm}var xg;function N_(){return xg||(xg=1,Om.exports=O_()),Om.exports}var Fm={exports:{}},Ka={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bg;function F_(){if(bg)return Ka;bg=1;var w=Jm();function S(J){var K="https://react.dev/errors/"+J;if(1<arguments.length){K+="?args[]="+encodeURIComponent(arguments[1]);for(var oe=2;oe<arguments.length;oe++)K+="&args[]="+encodeURIComponent(arguments[oe])}return"Minified React error #"+J+"; visit "+K+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function M(){}var D={d:{f:M,r:function(){throw Error(S(522))},D:M,C:M,L:M,m:M,X:M,S:M,M},p:0,findDOMNode:null},B=Symbol.for("react.portal");function U(J,K,oe){var X=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:B,key:X==null?null:""+X,children:J,containerInfo:K,implementation:oe}}var I=w.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(J,K){if(J==="font")return"";if(typeof K=="string")return K==="use-credentials"?K:""}return Ka.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,Ka.createPortal=function(J,K){var oe=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!K||K.nodeType!==1&&K.nodeType!==9&&K.nodeType!==11)throw Error(S(299));return U(J,K,null,oe)},Ka.flushSync=function(J){var K=I.T,oe=D.p;try{if(I.T=null,D.p=2,J)return J()}finally{I.T=K,D.p=oe,D.d.f()}},Ka.preconnect=function(J,K){typeof J=="string"&&(K?(K=K.crossOrigin,K=typeof K=="string"?K==="use-credentials"?K:"":void 0):K=null,D.d.C(J,K))},Ka.prefetchDNS=function(J){typeof J=="string"&&D.d.D(J)},Ka.preinit=function(J,K){if(typeof J=="string"&&K&&typeof K.as=="string"){var oe=K.as,X=c(oe,K.crossOrigin),_e=typeof K.integrity=="string"?K.integrity:void 0,se=typeof K.fetchPriority=="string"?K.fetchPriority:void 0;oe==="style"?D.d.S(J,typeof K.precedence=="string"?K.precedence:void 0,{crossOrigin:X,integrity:_e,fetchPriority:se}):oe==="script"&&D.d.X(J,{crossOrigin:X,integrity:_e,fetchPriority:se,nonce:typeof K.nonce=="string"?K.nonce:void 0})}},Ka.preinitModule=function(J,K){if(typeof J=="string")if(typeof K=="object"&&K!==null){if(K.as==null||K.as==="script"){var oe=c(K.as,K.crossOrigin);D.d.M(J,{crossOrigin:oe,integrity:typeof K.integrity=="string"?K.integrity:void 0,nonce:typeof K.nonce=="string"?K.nonce:void 0})}}else K==null&&D.d.M(J)},Ka.preload=function(J,K){if(typeof J=="string"&&typeof K=="object"&&K!==null&&typeof K.as=="string"){var oe=K.as,X=c(oe,K.crossOrigin);D.d.L(J,oe,{crossOrigin:X,integrity:typeof K.integrity=="string"?K.integrity:void 0,nonce:typeof K.nonce=="string"?K.nonce:void 0,type:typeof K.type=="string"?K.type:void 0,fetchPriority:typeof K.fetchPriority=="string"?K.fetchPriority:void 0,referrerPolicy:typeof K.referrerPolicy=="string"?K.referrerPolicy:void 0,imageSrcSet:typeof K.imageSrcSet=="string"?K.imageSrcSet:void 0,imageSizes:typeof K.imageSizes=="string"?K.imageSizes:void 0,media:typeof K.media=="string"?K.media:void 0})}},Ka.preloadModule=function(J,K){if(typeof J=="string")if(K){var oe=c(K.as,K.crossOrigin);D.d.m(J,{as:typeof K.as=="string"&&K.as!=="script"?K.as:void 0,crossOrigin:oe,integrity:typeof K.integrity=="string"?K.integrity:void 0})}else D.d.m(J)},Ka.requestFormReset=function(J){D.d.r(J)},Ka.unstable_batchedUpdates=function(J,K){return J(K)},Ka.useFormState=function(J,K,oe){return I.H.useFormState(J,K,oe)},Ka.useFormStatus=function(){return I.H.useHostTransitionStatus()},Ka.version="19.1.0",Ka}var wg;function a_(){if(wg)return Fm.exports;wg=1;function w(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(w)}catch(S){console.error(S)}}return w(),Fm.exports=F_(),Fm.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tg;function j_(){if(Tg)return lp;Tg=1;var w=N_(),S=Jm(),M=a_();function D(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)s+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function B(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function U(r){var s=r,u=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,(s.flags&4098)!==0&&(u=s.return),r=s.return;while(r)}return s.tag===3?u:null}function I(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function c(r){if(U(r)!==r)throw Error(D(188))}function J(r){var s=r.alternate;if(!s){if(s=U(r),s===null)throw Error(D(188));return s!==r?null:r}for(var u=r,p=s;;){var x=u.return;if(x===null)break;var A=x.alternate;if(A===null){if(p=x.return,p!==null){u=p;continue}break}if(x.child===A.child){for(A=x.child;A;){if(A===u)return c(x),r;if(A===p)return c(x),s;A=A.sibling}throw Error(D(188))}if(u.return!==p.return)u=x,p=A;else{for(var G=!1,ee=x.child;ee;){if(ee===u){G=!0,u=x,p=A;break}if(ee===p){G=!0,p=x,u=A;break}ee=ee.sibling}if(!G){for(ee=A.child;ee;){if(ee===u){G=!0,u=A,p=x;break}if(ee===p){G=!0,p=A,u=x;break}ee=ee.sibling}if(!G)throw Error(D(189))}}if(u.alternate!==p)throw Error(D(190))}if(u.tag!==3)throw Error(D(188));return u.stateNode.current===u?r:s}function K(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=K(r),s!==null)return s;r=r.sibling}return null}var oe=Object.assign,X=Symbol.for("react.element"),_e=Symbol.for("react.transitional.element"),se=Symbol.for("react.portal"),Me=Symbol.for("react.fragment"),qe=Symbol.for("react.strict_mode"),at=Symbol.for("react.profiler"),ft=Symbol.for("react.provider"),pt=Symbol.for("react.consumer"),zt=Symbol.for("react.context"),Rt=Symbol.for("react.forward_ref"),Ge=Symbol.for("react.suspense"),Pe=Symbol.for("react.suspense_list"),gt=Symbol.for("react.memo"),bt=Symbol.for("react.lazy"),Yt=Symbol.for("react.activity"),nr=Symbol.for("react.memo_cache_sentinel"),lr=Symbol.iterator;function dr(r){return r===null||typeof r!="object"?null:(r=lr&&r[lr]||r["@@iterator"],typeof r=="function"?r:null)}var Kt=Symbol.for("react.client.reference");function xr(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===Kt?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Me:return"Fragment";case at:return"Profiler";case qe:return"StrictMode";case Ge:return"Suspense";case Pe:return"SuspenseList";case Yt:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case se:return"Portal";case zt:return(r.displayName||"Context")+".Provider";case pt:return(r._context.displayName||"Context")+".Consumer";case Rt:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case gt:return s=r.displayName||null,s!==null?s:xr(r.type)||"Memo";case bt:s=r._payload,r=r._init;try{return xr(r(s))}catch{}}return null}var tt=Array.isArray,Re=S.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,st=M.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ot={pending:!1,data:null,method:null,action:null},jt=[],ue=-1;function Ye(r){return{current:r}}function Mt(r){0>ue||(r.current=jt[ue],jt[ue]=null,ue--)}function yt(r,s){ue++,jt[ue]=r.current,r.current=s}var vt=Ye(null),It=Ye(null),Ot=Ye(null),Xt=Ye(null);function mr(r,s){switch(yt(Ot,s),yt(It,r),yt(vt,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?tp(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=tp(s),r=rp(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}Mt(vt),yt(vt,r)}function hi(){Mt(vt),Mt(It),Mt(Ot)}function Si(r){r.memoizedState!==null&&yt(Xt,r);var s=vt.current,u=rp(s,r.type);s!==u&&(yt(It,r),yt(vt,u))}function jr(r){It.current===r&&(Mt(vt),Mt(It)),Xt.current===r&&(Mt(Xt),ve._currentValue=ot)}var rr=Object.prototype.hasOwnProperty,mi=w.unstable_scheduleCallback,Dr=w.unstable_cancelCallback,kr=w.unstable_shouldYield,Ui=w.unstable_requestPaint,_r=w.unstable_now,xi=w.unstable_getCurrentPriorityLevel,sn=w.unstable_ImmediatePriority,gi=w.unstable_UserBlockingPriority,oi=w.unstable_NormalPriority,Ai=w.unstable_LowPriority,Nr=w.unstable_IdlePriority,Yi=w.log,_i=w.unstable_setDisableYieldValue,Vi=null,ri=null;function ei(r){if(typeof Yi=="function"&&_i(r),ri&&typeof ri.setStrictMode=="function")try{ri.setStrictMode(Vi,r)}catch{}}var ii=Math.clz32?Math.clz32:Zr,yr=Math.log,Ar=Math.LN2;function Zr(r){return r>>>=0,r===0?32:31-(yr(r)/Ar|0)|0}var Ur=256,li=4194304;function Ne(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function W(r,s,u){var p=r.pendingLanes;if(p===0)return 0;var x=0,A=r.suspendedLanes,G=r.pingedLanes;r=r.warmLanes;var ee=p&134217727;return ee!==0?(p=ee&~A,p!==0?x=Ne(p):(G&=ee,G!==0?x=Ne(G):u||(u=ee&~r,u!==0&&(x=Ne(u))))):(ee=p&~A,ee!==0?x=Ne(ee):G!==0?x=Ne(G):u||(u=p&~r,u!==0&&(x=Ne(u)))),x===0?0:s!==0&&s!==x&&(s&A)===0&&(A=x&-x,u=s&-s,A>=u||A===32&&(u&4194048)!==0)?s:x}function Q(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function ae(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ye(){var r=Ur;return Ur<<=1,(Ur&4194048)===0&&(Ur=256),r}function Ee(){var r=li;return li<<=1,(li&62914560)===0&&(li=4194304),r}function re(r){for(var s=[],u=0;31>u;u++)s.push(r);return s}function Ze(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function Be(r,s,u,p,x,A){var G=r.pendingLanes;r.pendingLanes=u,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=u,r.entangledLanes&=u,r.errorRecoveryDisabledLanes&=u,r.shellSuspendCounter=0;var ee=r.entanglements,Se=r.expirationTimes,et=r.hiddenUpdates;for(u=G&~u;0<u;){var Et=31-ii(u),Ct=1<<Et;ee[Et]=0,Se[Et]=-1;var lt=et[Et];if(lt!==null)for(et[Et]=null,Et=0;Et<lt.length;Et++){var ct=lt[Et];ct!==null&&(ct.lane&=-536870913)}u&=~Ct}p!==0&&Oe(r,p,0),A!==0&&x===0&&r.tag!==0&&(r.suspendedLanes|=A&~(G&~s))}function Oe(r,s,u){r.pendingLanes|=s,r.suspendedLanes&=~s;var p=31-ii(s);r.entangledLanes|=s,r.entanglements[p]=r.entanglements[p]|1073741824|u&4194090}function He(r,s){var u=r.entangledLanes|=s;for(r=r.entanglements;u;){var p=31-ii(u),x=1<<p;x&s|r[p]&s&&(r[p]|=s),u&=~x}}function je(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function _t(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Ut(){var r=st.p;return r!==0?r:(r=window.event,r===void 0?32:or(r.type))}function Gt(r,s){var u=st.p;try{return st.p=r,s()}finally{st.p=u}}var tr=Math.random().toString(36).slice(2),ir="__reactFiber$"+tr,k="__reactProps$"+tr,O="__reactContainer$"+tr,me="__reactEvents$"+tr,de="__reactListeners$"+tr,ze="__reactHandles$"+tr,We="__reactResources$"+tr,Le="__reactMarker$"+tr;function wt(r){delete r[ir],delete r[k],delete r[me],delete r[de],delete r[ze]}function Nt(r){var s=r[ir];if(s)return s;for(var u=r.parentNode;u;){if(s=u[O]||u[ir]){if(u=s.alternate,s.child!==null||u!==null&&u.child!==null)for(r=Sl(r);r!==null;){if(u=r[ir])return u;r=Sl(r)}return s}r=u,u=r.parentNode}return null}function Jt(r){if(r=r[ir]||r[O]){var s=r.tag;if(s===5||s===6||s===13||s===26||s===27||s===3)return r}return null}function ar(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(D(33))}function Hr(r){var s=r[We];return s||(s=r[We]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Qt(r){r[Le]=!0}var Pi=new Set,_n={};function ui(r,s){ti(r,s),ti(r+"Capture",s)}function ti(r,s){for(_n[r]=s,r=0;r<s.length;r++)Pi.add(s[r])}var bi=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ln={},Sr={};function Cn(r){return rr.call(Sr,r)?!0:rr.call(Ln,r)?!1:bi.test(r)?Sr[r]=!0:(Ln[r]=!0,!1)}function Br(r,s,u){if(Cn(s))if(u===null)r.removeAttribute(s);else{switch(typeof u){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var p=s.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+u)}}function ms(r,s,u){if(u===null)r.removeAttribute(s);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+u)}}function Mn(r,s,u,p){if(p===null)r.removeAttribute(u);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(u);return}r.setAttributeNS(s,u,""+p)}}var js,gs;function Yn(r){if(js===void 0)try{throw Error()}catch(u){var s=u.stack.trim().match(/\n( *(at )?)/);js=s&&s[1]||"",gs=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+js+r+gs}var vo=!1;function Vo(r,s){if(!r||vo)return"";vo=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(s){var Ct=function(){throw Error()};if(Object.defineProperty(Ct.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ct,[])}catch(ct){var lt=ct}Reflect.construct(r,[],Ct)}else{try{Ct.call()}catch(ct){lt=ct}r.call(Ct.prototype)}}else{try{throw Error()}catch(ct){lt=ct}(Ct=r())&&typeof Ct.catch=="function"&&Ct.catch(function(){})}}catch(ct){if(ct&&lt&&typeof ct.stack=="string")return[ct.stack,lt.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var x=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");x&&x.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var A=p.DetermineComponentFrameRoot(),G=A[0],ee=A[1];if(G&&ee){var Se=G.split(`
`),et=ee.split(`
`);for(x=p=0;p<Se.length&&!Se[p].includes("DetermineComponentFrameRoot");)p++;for(;x<et.length&&!et[x].includes("DetermineComponentFrameRoot");)x++;if(p===Se.length||x===et.length)for(p=Se.length-1,x=et.length-1;1<=p&&0<=x&&Se[p]!==et[x];)x--;for(;1<=p&&0<=x;p--,x--)if(Se[p]!==et[x]){if(p!==1||x!==1)do if(p--,x--,0>x||Se[p]!==et[x]){var Et=`
`+Se[p].replace(" at new "," at ");return r.displayName&&Et.includes("<anonymous>")&&(Et=Et.replace("<anonymous>",r.displayName)),Et}while(1<=p&&0<=x);break}}}finally{vo=!1,Error.prepareStackTrace=u}return(u=r?r.displayName||r.name:"")?Yn(u):""}function Yu(r){switch(r.tag){case 26:case 27:case 5:return Yn(r.type);case 16:return Yn("Lazy");case 13:return Yn("Suspense");case 19:return Yn("SuspenseList");case 0:case 15:return Vo(r.type,!1);case 11:return Vo(r.type.render,!1);case 1:return Vo(r.type,!0);case 31:return Yn("Activity");default:return""}}function ie(r){try{var s="";do s+=Yu(r),r=r.return;while(r);return s}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function Ce(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function pe(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Ve(r){var s=pe(r)?"checked":"value",u=Object.getOwnPropertyDescriptor(r.constructor.prototype,s),p=""+r[s];if(!r.hasOwnProperty(s)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var x=u.get,A=u.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return x.call(this)},set:function(G){p=""+G,A.call(this,G)}}),Object.defineProperty(r,s,{enumerable:u.enumerable}),{getValue:function(){return p},setValue:function(G){p=""+G},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function $e(r){r._valueTracker||(r._valueTracker=Ve(r))}function Ue(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var u=s.getValue(),p="";return r&&(p=pe(r)?r.checked?"true":"false":r.value),r=p,r!==u?(s.setValue(r),!0):!1}function Tt(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var kt=/[\n"\\]/g;function Bt(r){return r.replace(kt,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function qt(r,s,u,p,x,A,G,ee){r.name="",G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"?r.type=G:r.removeAttribute("type"),s!=null?G==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+Ce(s)):r.value!==""+Ce(s)&&(r.value=""+Ce(s)):G!=="submit"&&G!=="reset"||r.removeAttribute("value"),s!=null?ur(r,G,Ce(s)):u!=null?ur(r,G,Ce(u)):p!=null&&r.removeAttribute("value"),x==null&&A!=null&&(r.defaultChecked=!!A),x!=null&&(r.checked=x&&typeof x!="function"&&typeof x!="symbol"),ee!=null&&typeof ee!="function"&&typeof ee!="symbol"&&typeof ee!="boolean"?r.name=""+Ce(ee):r.removeAttribute("name")}function Ht(r,s,u,p,x,A,G,ee){if(A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"&&(r.type=A),s!=null||u!=null){if(!(A!=="submit"&&A!=="reset"||s!=null))return;u=u!=null?""+Ce(u):"",s=s!=null?""+Ce(s):u,ee||s===r.value||(r.value=s),r.defaultValue=s}p=p??x,p=typeof p!="function"&&typeof p!="symbol"&&!!p,r.checked=ee?r.checked:!!p,r.defaultChecked=!!p,G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"&&(r.name=G)}function ur(r,s,u){s==="number"&&Tt(r.ownerDocument)===r||r.defaultValue===""+u||(r.defaultValue=""+u)}function Ir(r,s,u,p){if(r=r.options,s){s={};for(var x=0;x<u.length;x++)s["$"+u[x]]=!0;for(u=0;u<r.length;u++)x=s.hasOwnProperty("$"+r[u].value),r[u].selected!==x&&(r[u].selected=x),x&&p&&(r[u].defaultSelected=!0)}else{for(u=""+Ce(u),s=null,x=0;x<r.length;x++){if(r[x].value===u){r[x].selected=!0,p&&(r[x].defaultSelected=!0);return}s!==null||r[x].disabled||(s=r[x])}s!==null&&(s.selected=!0)}}function $r(r,s,u){if(s!=null&&(s=""+Ce(s),s!==r.value&&(r.value=s),u==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=u!=null?""+Ce(u):""}function Qr(r,s,u,p){if(s==null){if(p!=null){if(u!=null)throw Error(D(92));if(tt(p)){if(1<p.length)throw Error(D(93));p=p[0]}u=p}u==null&&(u=""),s=u}u=Ce(s),r.defaultValue=u,p=r.textContent,p===u&&p!==""&&p!==null&&(r.value=p)}function wi(r,s){if(s){var u=r.firstChild;if(u&&u===r.lastChild&&u.nodeType===3){u.nodeValue=s;return}}r.textContent=s}var Xr=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function wr(r,s,u){var p=s.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?p?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":p?r.setProperty(s,u):typeof u!="number"||u===0||Xr.has(s)?s==="float"?r.cssFloat=u:r[s]=(""+u).trim():r[s]=u+"px"}function Sa(r,s,u){if(s!=null&&typeof s!="object")throw Error(D(62));if(r=r.style,u!=null){for(var p in u)!u.hasOwnProperty(p)||s!=null&&s.hasOwnProperty(p)||(p.indexOf("--")===0?r.setProperty(p,""):p==="float"?r.cssFloat="":r[p]="");for(var x in s)p=s[x],s.hasOwnProperty(x)&&u[x]!==p&&wr(r,x,p)}else for(var A in s)s.hasOwnProperty(A)&&wr(r,A,s[A])}function yn(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Us=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Or=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Vs(r){return Or.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}var qs=null;function _s(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var on=null,ln=null;function un(r){var s=Jt(r);if(s&&(r=s.stateNode)){var u=r[k]||null;e:switch(r=s.stateNode,s.type){case"input":if(qt(r,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),s=u.name,u.type==="radio"&&s!=null){for(u=r;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+Bt(""+s)+'"][type="radio"]'),s=0;s<u.length;s++){var p=u[s];if(p!==r&&p.form===r.form){var x=p[k]||null;if(!x)throw Error(D(90));qt(p,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name)}}for(s=0;s<u.length;s++)p=u[s],p.form===r.form&&Ue(p)}break e;case"textarea":$r(r,u.value,u.defaultValue);break e;case"select":s=u.value,s!=null&&Ir(r,!!u.multiple,s,!1)}}}var Dn=!1;function Ri(r,s,u){if(Dn)return r(s,u);Dn=!0;try{var p=r(s);return p}finally{if(Dn=!1,(on!==null||ln!==null)&&(sa(),on&&(s=on,r=ln,ln=on=null,un(s),r)))for(s=0;s<r.length;s++)un(r[s])}}function ys(r,s){var u=r.stateNode;if(u===null)return null;var p=u[k]||null;if(p===null)return null;u=p[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(r=r.type,p=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!p;break e;default:r=!1}if(r)return null;if(u&&typeof u!="function")throw Error(D(231,s,typeof u));return u}var en=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ua=!1;if(en)try{var kn={};Object.defineProperty(kn,"passive",{get:function(){ua=!0}}),window.addEventListener("test",kn,kn),window.removeEventListener("test",kn,kn)}catch{ua=!1}var Ua=null,fi=null,Oi=null;function Vr(){if(Oi)return Oi;var r,s=fi,u=s.length,p,x="value"in Ua?Ua.value:Ua.textContent,A=x.length;for(r=0;r<u&&s[r]===x[r];r++);var G=u-r;for(p=1;p<=G&&s[u-p]===x[A-p];p++);return Oi=x.slice(r,1<p?1-p:void 0)}function br(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function Gs(){return!0}function Pr(){return!1}function qn(r){function s(u,p,x,A,G){this._reactName=u,this._targetInst=x,this.type=p,this.nativeEvent=A,this.target=G,this.currentTarget=null;for(var ee in r)r.hasOwnProperty(ee)&&(u=r[ee],this[ee]=u?u(A):A[ee]);return this.isDefaultPrevented=(A.defaultPrevented!=null?A.defaultPrevented:A.returnValue===!1)?Gs:Pr,this.isPropagationStopped=Pr,this}return oe(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Gs)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Gs)},persist:function(){},isPersistent:Gs}),s}var cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Cl=qn(cn),qo=oe({},cn,{view:0,detail:0}),fu=qn(qo),xo,Go,Zo,Ho=oe({},qo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Qo,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Zo&&(Zo&&r.type==="mousemove"?(xo=r.screenX-Zo.screenX,Go=r.screenY-Zo.screenY):Go=xo=0,Zo=r),xo)},movementY:function(r){return"movementY"in r?r.movementY:Go}}),Ml=qn(Ho),$o=oe({},Ho,{dataTransfer:0}),Bn=qn($o),Xo=oe({},qo,{relatedTarget:0}),Yo=qn(Xo),bo=oe({},cn,{animationName:0,elapsedTime:0,pseudoElement:0}),On=qn(bo),Wu=oe({},cn,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Qu=qn(Wu),$h=oe({},cn,{data:0}),Xh=qn($h),Wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},du={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vs={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Wo(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=vs[r])?!!s[r]:!1}function Qo(){return Wo}var Va=oe({},qo,{key:function(r){if(r.key){var s=Wn[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=br(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?du[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Qo,charCode:function(r){return r.type==="keypress"?br(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?br(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Ko=qn(Va),Ku=oe({},Ho,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Yh=qn(Ku),Kc=oe({},qo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Qo}),dd=qn(Kc),pd=oe({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0}),md=qn(pd),Ju=oe({},Ho,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),Dl=qn(Ju),ec=oe({},cn,{newState:0,oldState:0}),tc=qn(ec),rc=[9,13,27,32],qa=en&&"CompositionEvent"in window,Il=null;en&&"documentMode"in document&&(Il=document.documentMode);var Jc=en&&"TextEvent"in window&&!Il,Pl=en&&(!qa||Il&&8<Il&&11>=Il),Rl=" ",Wh=!1;function pu(r,s){switch(r){case"keyup":return rc.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function eh(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Ga=!1;function Qh(r,s){switch(r){case"compositionend":return eh(s);case"keypress":return s.which!==32?null:(Wh=!0,Rl);case"textInput":return r=s.data,r===Rl&&Wh?null:r;default:return null}}function Kh(r,s){if(Ga)return r==="compositionend"||!qa&&pu(r,s)?(r=Vr(),Oi=fi=Ua=null,Ga=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Pl&&s.locale!=="ko"?null:s.data;default:return null}}var gd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function th(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!gd[r.type]:s==="textarea"}function zl(r,s,u,p){on?ln?ln.push(p):ln=[p]:on=p,s=ou(s,"onChange"),0<s.length&&(u=new Cl("onChange","change",null,u,p),r.push({event:u,listeners:s}))}var Ll=null,kl=null;function Jh(r){Tl(r,0)}function Bl(r){var s=ar(r);if(Ue(s))return r}function Zs(r,s){if(r==="change")return s}var rh=!1;if(en){var ic;if(en){var wo="oninput"in document;if(!wo){var ih=document.createElement("div");ih.setAttribute("oninput","return;"),wo=typeof ih.oninput=="function"}ic=wo}else ic=!1;rh=ic&&(!document.documentMode||9<document.documentMode)}function mu(){Ll&&(Ll.detachEvent("onpropertychange",ef),kl=Ll=null)}function ef(r){if(r.propertyName==="value"&&Bl(kl)){var s=[];zl(s,kl,r,_s(r)),Ri(Jh,s)}}function _d(r,s,u){r==="focusin"?(mu(),Ll=s,kl=u,Ll.attachEvent("onpropertychange",ef)):r==="focusout"&&mu()}function nh(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Bl(kl)}function tf(r,s){if(r==="click")return Bl(s)}function rf(r,s){if(r==="input"||r==="change")return Bl(s)}function ah(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var ya=typeof Object.is=="function"?Object.is:ah;function qr(r,s){if(ya(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var u=Object.keys(r),p=Object.keys(s);if(u.length!==p.length)return!1;for(p=0;p<u.length;p++){var x=u[p];if(!rr.call(s,x)||!ya(r[x],s[x]))return!1}return!0}function xs(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function nc(r,s){var u=xs(r);r=0;for(var p;u;){if(u.nodeType===3){if(p=r+u.textContent.length,r<=s&&p>=s)return{node:u,offset:s-r};r=p}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=xs(u)}}function ac(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?ac(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function sc(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=Tt(r.document);s instanceof r.HTMLIFrameElement;){try{var u=typeof s.contentWindow.location.href=="string"}catch{u=!1}if(u)r=s.contentWindow;else break;s=Tt(r.document)}return s}function oc(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var sh=en&&"documentMode"in document&&11>=document.documentMode,Za=null,gu=null,_u=null,oh=!1;function nf(r,s,u){var p=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;oh||Za==null||Za!==Tt(p)||(p=Za,"selectionStart"in p&&oc(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),_u&&qr(_u,p)||(_u=p,p=ou(gu,"onSelect"),0<p.length&&(s=new Cl("onSelect","select",null,s,u),r.push({event:s,listeners:p}),s.target=Za)))}function Jo(r,s){var u={};return u[r.toLowerCase()]=s.toLowerCase(),u["Webkit"+r]="webkit"+s,u["Moz"+r]="moz"+s,u}var el={animationend:Jo("Animation","AnimationEnd"),animationiteration:Jo("Animation","AnimationIteration"),animationstart:Jo("Animation","AnimationStart"),transitionrun:Jo("Transition","TransitionRun"),transitionstart:Jo("Transition","TransitionStart"),transitioncancel:Jo("Transition","TransitionCancel"),transitionend:Jo("Transition","TransitionEnd")},lh={},uh={};en&&(uh=document.createElement("div").style,"AnimationEvent"in window||(delete el.animationend.animation,delete el.animationiteration.animation,delete el.animationstart.animation),"TransitionEvent"in window||delete el.transitionend.transition);function bs(r){if(lh[r])return lh[r];if(!el[r])return r;var s=el[r],u;for(u in s)if(s.hasOwnProperty(u)&&u in uh)return lh[r]=s[u];return r}var yu=bs("animationend"),vu=bs("animationiteration"),lc=bs("animationstart"),tl=bs("transitionrun"),uc=bs("transitionstart"),Ol=bs("transitioncancel"),Aa=bs("transitionend"),ch=new Map,cc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");cc.push("scrollEnd");function Ca(r,s){ch.set(r,s),ui(s,[r])}var To=new WeakMap;function ca(r,s){if(typeof r=="object"&&r!==null){var u=To.get(r);return u!==void 0?u:(s={value:r,source:s,stack:ie(s)},To.set(r,s),s)}return{value:r,source:s,stack:ie(s)}}var ha=[],ws=0,Nl=0;function rl(){for(var r=ws,s=Nl=ws=0;s<r;){var u=ha[s];ha[s++]=null;var p=ha[s];ha[s++]=null;var x=ha[s];ha[s++]=null;var A=ha[s];if(ha[s++]=null,p!==null&&x!==null){var G=p.pending;G===null?x.next=x:(x.next=G.next,G.next=x),p.pending=x}A!==0&&xu(u,x,A)}}function Hs(r,s,u,p){ha[ws++]=r,ha[ws++]=s,ha[ws++]=u,ha[ws++]=p,Nl|=p,r.lanes|=p,r=r.alternate,r!==null&&(r.lanes|=p)}function Eo(r,s,u,p){return Hs(r,s,u,p),Lr(r)}function il(r,s){return Hs(r,null,null,s),Lr(r)}function xu(r,s,u){r.lanes|=u;var p=r.alternate;p!==null&&(p.lanes|=u);for(var x=!1,A=r.return;A!==null;)A.childLanes|=u,p=A.alternate,p!==null&&(p.childLanes|=u),A.tag===22&&(r=A.stateNode,r===null||r._visibility&1||(x=!0)),r=A,A=A.return;return r.tag===3?(A=r.stateNode,x&&s!==null&&(x=31-ii(u),r=A.hiddenUpdates,p=r[x],p===null?r[x]=[s]:p.push(s),s.lane=u|536870912),A):null}function Lr(r){if(50<Ch)throw Ch=0,Df=null,Error(D(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var $s={};function hc(r,s,u,p){this.tag=r,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fa(r,s,u,p){return new hc(r,s,u,p)}function nl(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Xs(r,s){var u=r.alternate;return u===null?(u=fa(r.tag,s,r.key,r.mode),u.elementType=r.elementType,u.type=r.type,u.stateNode=r.stateNode,u.alternate=r,r.alternate=u):(u.pendingProps=s,u.type=r.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=r.flags&65011712,u.childLanes=r.childLanes,u.lanes=r.lanes,u.child=r.child,u.memoizedProps=r.memoizedProps,u.memoizedState=r.memoizedState,u.updateQueue=r.updateQueue,s=r.dependencies,u.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},u.sibling=r.sibling,u.index=r.index,u.ref=r.ref,u.refCleanup=r.refCleanup,u}function af(r,s){r.flags&=65011714;var u=r.alternate;return u===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=u.childLanes,r.lanes=u.lanes,r.child=u.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=u.memoizedProps,r.memoizedState=u.memoizedState,r.updateQueue=u.updateQueue,r.type=u.type,s=u.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function bu(r,s,u,p,x,A){var G=0;if(p=r,typeof r=="function")nl(r)&&(G=1);else if(typeof r=="string")G=C(r,u,vt.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case Yt:return r=fa(31,u,s,x),r.elementType=Yt,r.lanes=A,r;case Me:return al(u.children,x,A,s);case qe:G=8,x|=24;break;case at:return r=fa(12,u,s,x|2),r.elementType=at,r.lanes=A,r;case Ge:return r=fa(13,u,s,x),r.elementType=Ge,r.lanes=A,r;case Pe:return r=fa(19,u,s,x),r.elementType=Pe,r.lanes=A,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case ft:case zt:G=10;break e;case pt:G=9;break e;case Rt:G=11;break e;case gt:G=14;break e;case bt:G=16,p=null;break e}G=29,u=Error(D(130,r===null?"null":typeof r,"")),p=null}return s=fa(G,u,s,x),s.elementType=r,s.type=p,s.lanes=A,s}function al(r,s,u,p){return r=fa(7,r,p,s),r.lanes=u,r}function Fl(r,s,u){return r=fa(6,r,null,s),r.lanes=u,r}function sl(r,s,u){return s=fa(4,r.children!==null?r.children:[],r.key,s),s.lanes=u,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var Ys=[],So=0,ol=null,jl=0,Qn=[],Kn=0,Ja=null,es=1,Ma="";function Ts(r,s){Ys[So++]=jl,Ys[So++]=ol,ol=r,jl=s}function hh(r,s,u){Qn[Kn++]=es,Qn[Kn++]=Ma,Qn[Kn++]=Ja,Ja=r;var p=es;r=Ma;var x=32-ii(p)-1;p&=~(1<<x),u+=1;var A=32-ii(s)+x;if(30<A){var G=x-x%5;A=(p&(1<<G)-1).toString(32),p>>=G,x-=G,es=1<<32-ii(s)+x|u<<x|p,Ma=A+r}else es=1<<A|u<<x|p,Ma=r}function Ul(r){r.return!==null&&(Ts(r,1),hh(r,1,0))}function wu(r){for(;r===ol;)ol=Ys[--So],Ys[So]=null,jl=Ys[--So],Ys[So]=null;for(;r===Ja;)Ja=Qn[--Kn],Qn[Kn]=null,Ma=Qn[--Kn],Qn[Kn]=null,es=Qn[--Kn],Qn[Kn]=null}var Jn=null,tn=null,ni=!1,Es=null,ts=!1,ll=Error(D(519));function Ci(r){var s=Error(D(418,""));throw xa(ca(s,r)),ll}function Ws(r){var s=r.stateNode,u=r.type,p=r.memoizedProps;switch(s[ir]=r,s[k]=p,u){case"dialog":Jr("cancel",s),Jr("close",s);break;case"iframe":case"object":case"embed":Jr("load",s);break;case"video":case"audio":for(u=0;u<Rh.length;u++)Jr(Rh[u],s);break;case"source":Jr("error",s);break;case"img":case"image":case"link":Jr("error",s),Jr("load",s);break;case"details":Jr("toggle",s);break;case"input":Jr("invalid",s),Ht(s,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),$e(s);break;case"select":Jr("invalid",s);break;case"textarea":Jr("invalid",s),Qr(s,p.value,p.defaultValue,p.children),$e(s)}u=p.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||s.textContent===""+u||p.suppressHydrationWarning===!0||Jd(s.textContent,u)?(p.popover!=null&&(Jr("beforetoggle",s),Jr("toggle",s)),p.onScroll!=null&&Jr("scroll",s),p.onScrollEnd!=null&&Jr("scrollend",s),p.onClick!=null&&(s.onclick=kh),s=!0):s=!1,s||Ci(r)}function va(r){for(Jn=r.return;Jn;)switch(Jn.tag){case 5:case 13:ts=!1;return;case 27:case 3:ts=!0;return;default:Jn=Jn.return}}function ul(r){if(r!==Jn)return!1;if(!ni)return va(r),ni=!0,!1;var s=r.tag,u;if((u=s!==3&&s!==27)&&((u=s===5)&&(u=r.type,u=!(u!=="form"&&u!=="button")||Gf(r.type,r.memoizedProps)),u=!u),u&&tn&&Ci(r),va(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(D(317));e:{for(r=r.nextSibling,s=0;r;){if(r.nodeType===8)if(u=r.data,u==="/$"){if(s===0){tn=wa(r.nextSibling);break e}s--}else u!=="$"&&u!=="$!"&&u!=="$?"||s++;r=r.nextSibling}tn=null}}else s===27?(s=tn,El(r.type)?(r=Un,Un=null,tn=r):tn=s):tn=Jn?wa(r.stateNode.nextSibling):null;return!0}function Qs(){tn=Jn=null,ni=!1}function fc(){var r=Es;return r!==null&&(Ba===null?Ba=r:Ba.push.apply(Ba,r),Es=null),r}function xa(r){Es===null?Es=[r]:Es.push(r)}var Tu=Ye(null),rs=null,is=null;function Ks(r,s,u){yt(Tu,s._currentValue),s._currentValue=u}function Ss(r){r._currentValue=Tu.current,Mt(Tu)}function dc(r,s,u){for(;r!==null;){var p=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,p!==null&&(p.childLanes|=s)):p!==null&&(p.childLanes&s)!==s&&(p.childLanes|=s),r===u)break;r=r.return}}function Ao(r,s,u,p){var x=r.child;for(x!==null&&(x.return=r);x!==null;){var A=x.dependencies;if(A!==null){var G=x.child;A=A.firstContext;e:for(;A!==null;){var ee=A;A=x;for(var Se=0;Se<s.length;Se++)if(ee.context===s[Se]){A.lanes|=u,ee=A.alternate,ee!==null&&(ee.lanes|=u),dc(A.return,u,r),p||(G=null);break e}A=ee.next}}else if(x.tag===18){if(G=x.return,G===null)throw Error(D(341));G.lanes|=u,A=G.alternate,A!==null&&(A.lanes|=u),dc(G,u,r),G=null}else G=x.child;if(G!==null)G.return=x;else for(G=x;G!==null;){if(G===r){G=null;break}if(x=G.sibling,x!==null){x.return=G.return,G=x;break}G=G.return}x=G}}function As(r,s,u,p){r=null;for(var x=s,A=!1;x!==null;){if(!A){if((x.flags&524288)!==0)A=!0;else if((x.flags&262144)!==0)break}if(x.tag===10){var G=x.alternate;if(G===null)throw Error(D(387));if(G=G.memoizedProps,G!==null){var ee=x.type;ya(x.pendingProps.value,G.value)||(r!==null?r.push(ee):r=[ee])}}else if(x===Xt.current){if(G=x.alternate,G===null)throw Error(D(387));G.memoizedState.memoizedState!==x.memoizedState.memoizedState&&(r!==null?r.push(ve):r=[ve])}x=x.return}r!==null&&Ao(s,r,u,p),s.flags|=262144}function hn(r){for(r=r.firstContext;r!==null;){if(!ya(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Ha(r){rs=r,is=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Nn(r){return fh(rs,r)}function Eu(r,s){return rs===null&&Ha(r),fh(r,s)}function fh(r,s){var u=s._currentValue;if(s={context:s,memoizedValue:u,next:null},is===null){if(r===null)throw Error(D(308));is=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else is=is.next=s;return u}var Vl=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(u,p){r.push(p)}};this.abort=function(){s.aborted=!0,r.forEach(function(u){return u()})}},dh=w.unstable_scheduleCallback,pc=w.unstable_NormalPriority,Sn={$$typeof:zt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Co(){return{controller:new Vl,data:new Map,refCount:0}}function ql(r){r.refCount--,r.refCount===0&&dh(pc,function(){r.controller.abort()})}var An=null,Da=0,ns=0,ea=null;function Gl(r,s){if(An===null){var u=An=[];Da=0,ns=Nf(),ea={status:"pending",value:void 0,then:function(p){u.push(p)}}}return Da++,s.then(Su,Su),s}function Su(){if(--Da===0&&An!==null){ea!==null&&(ea.status="fulfilled");var r=An;An=null,ns=0,ea=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function yd(r,s){var u=[],p={status:"pending",value:null,reason:null,then:function(x){u.push(x)}};return r.then(function(){p.status="fulfilled",p.value=s;for(var x=0;x<u.length;x++)(0,u[x])(s)},function(x){for(p.status="rejected",p.reason=x,x=0;x<u.length;x++)(0,u[x])(void 0)}),p}var mc=Re.S;Re.S=function(r,s){typeof s=="object"&&s!==null&&typeof s.then=="function"&&Gl(r,s),mc!==null&&mc(r,s)};var Cs=Ye(null);function Au(){var r=Cs.current;return r!==null?r:Di.pooledCache}function Js(r,s){s===null?yt(Cs,Cs.current):yt(Cs,s.pool)}function as(){var r=Au();return r===null?null:{parent:Sn._currentValue,pool:r}}var Wt=Error(D(460)),Cu=Error(D(474)),cl=Error(D(542)),gc={then:function(){}};function hl(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Mo(){}function _c(r,s,u){switch(u=r[u],u===void 0?r.push(s):u!==s&&(s.then(Mo,Mo),s=u),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,sf(r),r;default:if(typeof s.status=="string")s.then(Mo,Mo);else{if(r=Di,r!==null&&100<r.shellSuspendCounter)throw Error(D(482));r=s,r.status="pending",r.then(function(p){if(s.status==="pending"){var x=s;x.status="fulfilled",x.value=p}},function(p){if(s.status==="pending"){var x=s;x.status="rejected",x.reason=p}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,sf(r),r}throw zr=s,Wt}}var zr=null;function Mu(){if(zr===null)throw Error(D(459));var r=zr;return zr=null,r}function sf(r){if(r===Wt||r===cl)throw Error(D(483))}var Ms=!1;function yc(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function vc(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Ds(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function ss(r,s,u){var p=r.updateQueue;if(p===null)return null;if(p=p.shared,(Li&2)!==0){var x=p.pending;return x===null?s.next=s:(s.next=x.next,x.next=s),p.pending=s,s=Lr(r),xu(r,null,u),s}return Hs(r,p,s,u),Lr(r)}function eo(r,s,u){if(s=s.updateQueue,s!==null&&(s=s.shared,(u&4194048)!==0)){var p=s.lanes;p&=r.pendingLanes,u|=p,s.lanes=u,He(r,u)}}function ph(r,s){var u=r.updateQueue,p=r.alternate;if(p!==null&&(p=p.updateQueue,u===p)){var x=null,A=null;if(u=u.firstBaseUpdate,u!==null){do{var G={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};A===null?x=A=G:A=A.next=G,u=u.next}while(u!==null);A===null?x=A=s:A=A.next=s}else x=A=s;u={baseState:p.baseState,firstBaseUpdate:x,lastBaseUpdate:A,shared:p.shared,callbacks:p.callbacks},r.updateQueue=u;return}r=u.lastBaseUpdate,r===null?u.firstBaseUpdate=s:r.next=s,u.lastBaseUpdate=s}var Zl=!1;function Du(){if(Zl){var r=ea;if(r!==null)throw r}}function Iu(r,s,u,p){Zl=!1;var x=r.updateQueue;Ms=!1;var A=x.firstBaseUpdate,G=x.lastBaseUpdate,ee=x.shared.pending;if(ee!==null){x.shared.pending=null;var Se=ee,et=Se.next;Se.next=null,G===null?A=et:G.next=et,G=Se;var Et=r.alternate;Et!==null&&(Et=Et.updateQueue,ee=Et.lastBaseUpdate,ee!==G&&(ee===null?Et.firstBaseUpdate=et:ee.next=et,Et.lastBaseUpdate=Se))}if(A!==null){var Ct=x.baseState;G=0,Et=et=Se=null,ee=A;do{var lt=ee.lane&-536870913,ct=lt!==ee.lane;if(ct?(ci&lt)===lt:(p&lt)===lt){lt!==0&&lt===ns&&(Zl=!0),Et!==null&&(Et=Et.next={lane:0,tag:ee.tag,payload:ee.payload,callback:null,next:null});e:{var Cr=r,Tr=ee;lt=s;var ji=u;switch(Tr.tag){case 1:if(Cr=Tr.payload,typeof Cr=="function"){Ct=Cr.call(ji,Ct,lt);break e}Ct=Cr;break e;case 3:Cr.flags=Cr.flags&-65537|128;case 0:if(Cr=Tr.payload,lt=typeof Cr=="function"?Cr.call(ji,Ct,lt):Cr,lt==null)break e;Ct=oe({},Ct,lt);break e;case 2:Ms=!0}}lt=ee.callback,lt!==null&&(r.flags|=64,ct&&(r.flags|=8192),ct=x.callbacks,ct===null?x.callbacks=[lt]:ct.push(lt))}else ct={lane:lt,tag:ee.tag,payload:ee.payload,callback:ee.callback,next:null},Et===null?(et=Et=ct,Se=Ct):Et=Et.next=ct,G|=lt;if(ee=ee.next,ee===null){if(ee=x.shared.pending,ee===null)break;ct=ee,ee=ct.next,ct.next=null,x.lastBaseUpdate=ct,x.shared.pending=null}}while(!0);Et===null&&(Se=Ct),x.baseState=Se,x.firstBaseUpdate=et,x.lastBaseUpdate=Et,A===null&&(x.shared.lanes=0),vl|=G,r.lanes=G,r.memoizedState=Ct}}function Is(r,s){if(typeof r!="function")throw Error(D(191,r));r.call(s)}function zi(r,s){var u=r.callbacks;if(u!==null)for(r.callbacks=null,r=0;r<u.length;r++)Is(u[r],s)}var Ps=Ye(null),Hl=Ye(0);function mh(r,s){r=Oo,yt(Hl,r),yt(Ps,s),Oo=r|s.baseLanes}function xc(){yt(Hl,Oo),yt(Ps,Ps.current)}function bc(){Oo=Hl.current,Mt(Ps),Mt(Hl)}var Do=0,vr=null,di=null,$t=null,pr=!1,Rs=!1,to=!1,$l=0,Wi=0,Io=null,$a=0;function fn(){throw Error(D(321))}function ro(r,s){if(s===null)return!1;for(var u=0;u<s.length&&u<r.length;u++)if(!ya(r[u],s[u]))return!1;return!0}function qi(r,s,u,p,x,A){return Do=A,vr=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Re.H=r===null||r.memoizedState===null?Lu:gh,to=!1,A=u(p,x),to=!1,Rs&&(A=fl(s,u,p,x)),Gi(r),A}function Gi(r){Re.H=Ei;var s=di!==null&&di.next!==null;if(Do=0,$t=di=vr=null,pr=!1,Wi=0,Io=null,s)throw Error(D(300));r===null||Gn||(r=r.dependencies,r!==null&&hn(r)&&(Gn=!0))}function fl(r,s,u,p){vr=r;var x=0;do{if(Rs&&(Io=null),Wi=0,Rs=!1,25<=x)throw Error(D(301));if(x+=1,$t=di=null,r.updateQueue!=null){var A=r.updateQueue;A.lastEffect=null,A.events=null,A.stores=null,A.memoCache!=null&&(A.memoCache.index=0)}Re.H=of,A=s(u,p)}while(Rs);return A}function Pu(){var r=Re.H,s=r.useState()[0];return s=typeof s.then=="function"?d(s):s,r=r.useState()[0],(di!==null?di.memoizedState:null)!==r&&(vr.flags|=1024),s}function dl(){var r=$l!==0;return $l=0,r}function io(r,s,u){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~u}function Ru(r){if(pr){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}pr=!1}Do=0,$t=di=vr=null,Rs=!1,Wi=$l=0,Io=null}function ta(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $t===null?vr.memoizedState=$t=r:$t=$t.next=r,$t}function Zi(){if(di===null){var r=vr.alternate;r=r!==null?r.memoizedState:null}else r=di.next;var s=$t===null?vr.memoizedState:$t.next;if(s!==null)$t=s,di=r;else{if(r===null)throw vr.alternate===null?Error(D(467)):Error(D(310));di=r,r={memoizedState:di.memoizedState,baseState:di.baseState,baseQueue:di.baseQueue,queue:di.queue,next:null},$t===null?vr.memoizedState=$t=r:$t=$t.next=r}return $t}function zu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function d(r){var s=Wi;return Wi+=1,Io===null&&(Io=[]),r=_c(Io,r,s),s=vr,($t===null?s.memoizedState:$t.next)===null&&(s=s.alternate,Re.H=s===null||s.memoizedState===null?Lu:gh),r}function e(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return d(r);if(r.$$typeof===zt)return Nn(r)}throw Error(D(438,String(r)))}function i(r){var s=null,u=vr.updateQueue;if(u!==null&&(s=u.memoCache),s==null){var p=vr.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(s={data:p.data.map(function(x){return x.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),u===null&&(u=zu(),vr.updateQueue=u),u.memoCache=s,u=s.data[s.index],u===void 0)for(u=s.data[s.index]=Array(r),p=0;p<r;p++)u[p]=nr;return s.index++,u}function l(r,s){return typeof s=="function"?s(r):s}function h(r){var s=Zi();return m(s,di,r)}function m(r,s,u){var p=r.queue;if(p===null)throw Error(D(311));p.lastRenderedReducer=u;var x=r.baseQueue,A=p.pending;if(A!==null){if(x!==null){var G=x.next;x.next=A.next,A.next=G}s.baseQueue=x=A,p.pending=null}if(A=r.baseState,x===null)r.memoizedState=A;else{s=x.next;var ee=G=null,Se=null,et=s,Et=!1;do{var Ct=et.lane&-536870913;if(Ct!==et.lane?(ci&Ct)===Ct:(Do&Ct)===Ct){var lt=et.revertLane;if(lt===0)Se!==null&&(Se=Se.next={lane:0,revertLane:0,action:et.action,hasEagerState:et.hasEagerState,eagerState:et.eagerState,next:null}),Ct===ns&&(Et=!0);else if((Do&lt)===lt){et=et.next,lt===ns&&(Et=!0);continue}else Ct={lane:0,revertLane:et.revertLane,action:et.action,hasEagerState:et.hasEagerState,eagerState:et.eagerState,next:null},Se===null?(ee=Se=Ct,G=A):Se=Se.next=Ct,vr.lanes|=lt,vl|=lt;Ct=et.action,to&&u(A,Ct),A=et.hasEagerState?et.eagerState:u(A,Ct)}else lt={lane:Ct,revertLane:et.revertLane,action:et.action,hasEagerState:et.hasEagerState,eagerState:et.eagerState,next:null},Se===null?(ee=Se=lt,G=A):Se=Se.next=lt,vr.lanes|=Ct,vl|=Ct;et=et.next}while(et!==null&&et!==s);if(Se===null?G=A:Se.next=ee,!ya(A,r.memoizedState)&&(Gn=!0,Et&&(u=ea,u!==null)))throw u;r.memoizedState=A,r.baseState=G,r.baseQueue=Se,p.lastRenderedState=A}return x===null&&(p.lanes=0),[r.memoizedState,p.dispatch]}function y(r){var s=Zi(),u=s.queue;if(u===null)throw Error(D(311));u.lastRenderedReducer=r;var p=u.dispatch,x=u.pending,A=s.memoizedState;if(x!==null){u.pending=null;var G=x=x.next;do A=r(A,G.action),G=G.next;while(G!==x);ya(A,s.memoizedState)||(Gn=!0),s.memoizedState=A,s.baseQueue===null&&(s.baseState=A),u.lastRenderedState=A}return[A,p]}function b(r,s,u){var p=vr,x=Zi(),A=ni;if(A){if(u===void 0)throw Error(D(407));u=u()}else u=s();var G=!ya((di||x).memoizedState,u);G&&(x.memoizedState=u,Gn=!0),x=x.queue;var ee=z.bind(null,p,x,r);if(St(2048,8,ee,[r]),x.getSnapshot!==s||G||$t!==null&&$t.memoizedState.tag&1){if(p.flags|=2048,it(9,ut(),P.bind(null,p,x,u,s),null),Di===null)throw Error(D(349));A||(Do&124)!==0||E(p,s,u)}return u}function E(r,s,u){r.flags|=16384,r={getSnapshot:s,value:u},s=vr.updateQueue,s===null?(s=zu(),vr.updateQueue=s,s.stores=[r]):(u=s.stores,u===null?s.stores=[r]:u.push(r))}function P(r,s,u,p){s.value=u,s.getSnapshot=p,F(s)&&N(r)}function z(r,s,u){return u(function(){F(s)&&N(r)})}function F(r){var s=r.getSnapshot;r=r.value;try{var u=s();return!ya(r,u)}catch{return!0}}function N(r){var s=il(r,2);s!==null&&hs(s,r,2)}function H(r){var s=ta();if(typeof r=="function"){var u=r;if(r=u(),to){ei(!0);try{u()}finally{ei(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:r},s}function $(r,s,u,p){return r.baseState=u,m(r,di,typeof p=="function"?p:l)}function ce(r,s,u,p,x){if(rn(r))throw Error(D(485));if(r=s.action,r!==null){var A={payload:x,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(G){A.listeners.push(G)}};Re.T!==null?u(!0):A.isTransition=!1,p(A),u=s.pending,u===null?(A.next=s.pending=A,le(s,A)):(A.next=u.next,s.pending=u.next=A)}}function le(r,s){var u=s.action,p=s.payload,x=r.state;if(s.isTransition){var A=Re.T,G={};Re.T=G;try{var ee=u(x,p),Se=Re.S;Se!==null&&Se(G,ee),he(r,s,ee)}catch(et){Te(r,s,et)}finally{Re.T=A}}else try{A=u(x,p),he(r,s,A)}catch(et){Te(r,s,et)}}function he(r,s,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(p){xe(r,s,p)},function(p){return Te(r,s,p)}):xe(r,s,u)}function xe(r,s,u){s.status="fulfilled",s.value=u,we(s),r.state=u,s=r.pending,s!==null&&(u=s.next,u===s?r.pending=null:(u=u.next,s.next=u,le(r,u)))}function Te(r,s,u){var p=r.pending;if(r.pending=null,p!==null){p=p.next;do s.status="rejected",s.reason=u,we(s),s=s.next;while(s!==p)}r.action=null}function we(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function Ae(r,s){return s}function ke(r,s){if(ni){var u=Di.formState;if(u!==null){e:{var p=vr;if(ni){if(tn){t:{for(var x=tn,A=ts;x.nodeType!==8;){if(!A){x=null;break t}if(x=wa(x.nextSibling),x===null){x=null;break t}}A=x.data,x=A==="F!"||A==="F"?x:null}if(x){tn=wa(x.nextSibling),p=x.data==="F!";break e}}Ci(p)}p=!1}p&&(s=u[0])}}return u=ta(),u.memoizedState=u.baseState=s,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ae,lastRenderedState:s},u.queue=p,u=oo.bind(null,vr,p),p.dispatch=u,p=H(!1),A=Ls.bind(null,vr,!1,p.queue),p=ta(),x={state:s,dispatch:null,action:r,pending:null},p.queue=x,u=ce.bind(null,vr,x,A,u),x.dispatch=u,p.memoizedState=r,[s,u,!1]}function De(r){var s=Zi();return Qe(s,di,r)}function Qe(r,s,u){if(s=m(r,s,Ae)[0],r=h(l)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var p=d(s)}catch(G){throw G===Wt?cl:G}else p=s;s=Zi();var x=s.queue,A=x.dispatch;return u!==s.memoizedState&&(vr.flags|=2048,it(9,ut(),dt.bind(null,x,u),null)),[p,A,r]}function dt(r,s){r.action=s}function nt(r){var s=Zi(),u=di;if(u!==null)return Qe(s,u,r);Zi(),s=s.memoizedState,u=Zi();var p=u.queue.dispatch;return u.memoizedState=r,[s,p,!1]}function it(r,s,u,p){return r={tag:r,create:u,deps:p,inst:s,next:null},s=vr.updateQueue,s===null&&(s=zu(),vr.updateQueue=s),u=s.lastEffect,u===null?s.lastEffect=r.next=r:(p=u.next,u.next=r,r.next=p,s.lastEffect=r),r}function ut(){return{destroy:void 0,resource:void 0}}function Zt(){return Zi().memoizedState}function Vt(r,s,u,p){var x=ta();p=p===void 0?null:p,vr.flags|=r,x.memoizedState=it(1|s,ut(),u,p)}function St(r,s,u,p){var x=Zi();p=p===void 0?null:p;var A=x.memoizedState.inst;di!==null&&p!==null&&ro(p,di.memoizedState.deps)?x.memoizedState=it(s,A,u,p):(vr.flags|=r,x.memoizedState=it(1|s,A,u,p))}function sr(r,s){Vt(8390656,8,r,s)}function Rr(r,s){St(2048,8,r,s)}function Gr(r,s){return St(4,2,r,s)}function Hi(r,s){return St(4,4,r,s)}function Ti(r,s){if(typeof s=="function"){r=r();var u=s(r);return function(){typeof u=="function"?u():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function $i(r,s,u){u=u!=null?u.concat([r]):null,St(4,4,Ti.bind(null,s,r),u)}function Ni(){}function Mi(r,s){var u=Zi();s=s===void 0?null:s;var p=u.memoizedState;return s!==null&&ro(s,p[1])?p[0]:(u.memoizedState=[r,s],r)}function ai(r,s){var u=Zi();s=s===void 0?null:s;var p=u.memoizedState;if(s!==null&&ro(s,p[1]))return p[0];if(p=r(),to){ei(!0);try{r()}finally{ei(!1)}}return u.memoizedState=[p,s],p}function vn(r,s,u){return u===void 0||(Do&1073741824)!==0?r.memoizedState=s:(r.memoizedState=u,r=If(),vr.lanes|=r,vl|=r,u)}function In(r,s,u,p){return ya(u,s)?u:Ps.current!==null?(r=vn(r,u,p),ya(r,s)||(Gn=!0),r):(Do&42)===0?(Gn=!0,r.memoizedState=u):(r=If(),vr.lanes|=r,vl|=r,s)}function Fn(r,s,u,p,x){var A=st.p;st.p=A!==0&&8>A?A:8;var G=Re.T,ee={};Re.T=ee,Ls(r,!1,s,u);try{var Se=x(),et=Re.S;if(et!==null&&et(ee,Se),Se!==null&&typeof Se=="object"&&typeof Se.then=="function"){var Et=yd(Se,p);Pa(r,s,Et,Oa(r))}else Pa(r,s,p,Oa(r))}catch(Ct){Pa(r,s,{then:function(){},status:"rejected",reason:Ct},Oa())}finally{st.p=A,Re.T=G}}function si(){}function zs(r,s,u,p){if(r.tag!==5)throw Error(D(476));var x=os(r).queue;Fn(r,x,s,ot,u===null?si:function(){return no(r),u(p)})}function os(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:ot,baseState:ot,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:ot},next:null};var u={};return s.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:u},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function no(r){var s=os(r).next.queue;Pa(r,s,{},Oa())}function ao(){return Nn(ve)}function Xl(){return Zi().memoizedState}function so(){return Zi().memoizedState}function pl(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var u=Oa();r=Ds(u);var p=ss(s,r,u);p!==null&&(hs(p,s,u),eo(p,s,u)),s={cache:Co()},r.payload=s;return}s=s.return}}function Ia(r,s,u){var p=Oa();u={lane:p,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},rn(r)?xn(s,u):(u=Eo(r,s,u,p),u!==null&&(hs(u,r,p),ra(u,s,p)))}function oo(r,s,u){var p=Oa();Pa(r,s,u,p)}function Pa(r,s,u,p){var x={lane:p,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(rn(r))xn(s,x);else{var A=r.alternate;if(r.lanes===0&&(A===null||A.lanes===0)&&(A=s.lastRenderedReducer,A!==null))try{var G=s.lastRenderedState,ee=A(G,u);if(x.hasEagerState=!0,x.eagerState=ee,ya(ee,G))return Hs(r,s,x,0),Di===null&&rl(),!1}catch{}finally{}if(u=Eo(r,s,x,p),u!==null)return hs(u,r,p),ra(u,s,p),!0}return!1}function Ls(r,s,u,p){if(p={lane:2,revertLane:Nf(),action:p,hasEagerState:!1,eagerState:null,next:null},rn(r)){if(s)throw Error(D(479))}else s=Eo(r,u,p,2),s!==null&&hs(s,r,2)}function rn(r){var s=r.alternate;return r===vr||s!==null&&s===vr}function xn(r,s){Rs=pr=!0;var u=r.pending;u===null?s.next=s:(s.next=u.next,u.next=s),r.pending=s}function ra(r,s,u){if((u&4194048)!==0){var p=s.lanes;p&=r.pendingLanes,u|=p,s.lanes=u,He(r,u)}}var Ei={readContext:Nn,use:e,useCallback:fn,useContext:fn,useEffect:fn,useImperativeHandle:fn,useLayoutEffect:fn,useInsertionEffect:fn,useMemo:fn,useReducer:fn,useRef:fn,useState:fn,useDebugValue:fn,useDeferredValue:fn,useTransition:fn,useSyncExternalStore:fn,useId:fn,useHostTransitionStatus:fn,useFormState:fn,useActionState:fn,useOptimistic:fn,useMemoCache:fn,useCacheRefresh:fn},Lu={readContext:Nn,use:e,useCallback:function(r,s){return ta().memoizedState=[r,s===void 0?null:s],r},useContext:Nn,useEffect:sr,useImperativeHandle:function(r,s,u){u=u!=null?u.concat([r]):null,Vt(4194308,4,Ti.bind(null,s,r),u)},useLayoutEffect:function(r,s){return Vt(4194308,4,r,s)},useInsertionEffect:function(r,s){Vt(4,2,r,s)},useMemo:function(r,s){var u=ta();s=s===void 0?null:s;var p=r();if(to){ei(!0);try{r()}finally{ei(!1)}}return u.memoizedState=[p,s],p},useReducer:function(r,s,u){var p=ta();if(u!==void 0){var x=u(s);if(to){ei(!0);try{u(s)}finally{ei(!1)}}}else x=s;return p.memoizedState=p.baseState=x,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:x},p.queue=r,r=r.dispatch=Ia.bind(null,vr,r),[p.memoizedState,r]},useRef:function(r){var s=ta();return r={current:r},s.memoizedState=r},useState:function(r){r=H(r);var s=r.queue,u=oo.bind(null,vr,s);return s.dispatch=u,[r.memoizedState,u]},useDebugValue:Ni,useDeferredValue:function(r,s){var u=ta();return vn(u,r,s)},useTransition:function(){var r=H(!1);return r=Fn.bind(null,vr,r.queue,!0,!1),ta().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,u){var p=vr,x=ta();if(ni){if(u===void 0)throw Error(D(407));u=u()}else{if(u=s(),Di===null)throw Error(D(349));(ci&124)!==0||E(p,s,u)}x.memoizedState=u;var A={value:u,getSnapshot:s};return x.queue=A,sr(z.bind(null,p,A,r),[r]),p.flags|=2048,it(9,ut(),P.bind(null,p,A,u,s),null),u},useId:function(){var r=ta(),s=Di.identifierPrefix;if(ni){var u=Ma,p=es;u=(p&~(1<<32-ii(p)-1)).toString(32)+u,s=""+s+"R"+u,u=$l++,0<u&&(s+="H"+u.toString(32)),s+=""}else u=$a++,s=""+s+"r"+u.toString(32)+"";return r.memoizedState=s},useHostTransitionStatus:ao,useFormState:ke,useActionState:ke,useOptimistic:function(r){var s=ta();s.memoizedState=s.baseState=r;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=u,s=Ls.bind(null,vr,!0,u),u.dispatch=s,[r,s]},useMemoCache:i,useCacheRefresh:function(){return ta().memoizedState=pl.bind(null,vr)}},gh={readContext:Nn,use:e,useCallback:Mi,useContext:Nn,useEffect:Rr,useImperativeHandle:$i,useInsertionEffect:Gr,useLayoutEffect:Hi,useMemo:ai,useReducer:h,useRef:Zt,useState:function(){return h(l)},useDebugValue:Ni,useDeferredValue:function(r,s){var u=Zi();return In(u,di.memoizedState,r,s)},useTransition:function(){var r=h(l)[0],s=Zi().memoizedState;return[typeof r=="boolean"?r:d(r),s]},useSyncExternalStore:b,useId:Xl,useHostTransitionStatus:ao,useFormState:De,useActionState:De,useOptimistic:function(r,s){var u=Zi();return $(u,di,r,s)},useMemoCache:i,useCacheRefresh:so},of={readContext:Nn,use:e,useCallback:Mi,useContext:Nn,useEffect:Rr,useImperativeHandle:$i,useInsertionEffect:Gr,useLayoutEffect:Hi,useMemo:ai,useReducer:y,useRef:Zt,useState:function(){return y(l)},useDebugValue:Ni,useDeferredValue:function(r,s){var u=Zi();return di===null?vn(u,r,s):In(u,di.memoizedState,r,s)},useTransition:function(){var r=y(l)[0],s=Zi().memoizedState;return[typeof r=="boolean"?r:d(r),s]},useSyncExternalStore:b,useId:Xl,useHostTransitionStatus:ao,useFormState:nt,useActionState:nt,useOptimistic:function(r,s){var u=Zi();return di!==null?$(u,di,r,s):(u.baseState=r,[r,u.queue.dispatch])},useMemoCache:i,useCacheRefresh:so},Yl=null,ml=0;function Po(r){var s=ml;return ml+=1,Yl===null&&(Yl=[]),_c(Yl,r,s)}function ia(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function Ra(r,s){throw s.$$typeof===X?Error(D(525)):(r=Object.prototype.toString.call(s),Error(D(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function za(r){var s=r._init;return s(r._payload)}function ks(r){function s(Xe,Fe){if(r){var Je=Xe.deletions;Je===null?(Xe.deletions=[Fe],Xe.flags|=16):Je.push(Fe)}}function u(Xe,Fe){if(!r)return null;for(;Fe!==null;)s(Xe,Fe),Fe=Fe.sibling;return null}function p(Xe){for(var Fe=new Map;Xe!==null;)Xe.key!==null?Fe.set(Xe.key,Xe):Fe.set(Xe.index,Xe),Xe=Xe.sibling;return Fe}function x(Xe,Fe){return Xe=Xs(Xe,Fe),Xe.index=0,Xe.sibling=null,Xe}function A(Xe,Fe,Je){return Xe.index=Je,r?(Je=Xe.alternate,Je!==null?(Je=Je.index,Je<Fe?(Xe.flags|=67108866,Fe):Je):(Xe.flags|=67108866,Fe)):(Xe.flags|=1048576,Fe)}function G(Xe){return r&&Xe.alternate===null&&(Xe.flags|=67108866),Xe}function ee(Xe,Fe,Je,Pt){return Fe===null||Fe.tag!==6?(Fe=Fl(Je,Xe.mode,Pt),Fe.return=Xe,Fe):(Fe=x(Fe,Je),Fe.return=Xe,Fe)}function Se(Xe,Fe,Je,Pt){var fr=Je.type;return fr===Me?Et(Xe,Fe,Je.props.children,Pt,Je.key):Fe!==null&&(Fe.elementType===fr||typeof fr=="object"&&fr!==null&&fr.$$typeof===bt&&za(fr)===Fe.type)?(Fe=x(Fe,Je.props),ia(Fe,Je),Fe.return=Xe,Fe):(Fe=bu(Je.type,Je.key,Je.props,null,Xe.mode,Pt),ia(Fe,Je),Fe.return=Xe,Fe)}function et(Xe,Fe,Je,Pt){return Fe===null||Fe.tag!==4||Fe.stateNode.containerInfo!==Je.containerInfo||Fe.stateNode.implementation!==Je.implementation?(Fe=sl(Je,Xe.mode,Pt),Fe.return=Xe,Fe):(Fe=x(Fe,Je.children||[]),Fe.return=Xe,Fe)}function Et(Xe,Fe,Je,Pt,fr){return Fe===null||Fe.tag!==7?(Fe=al(Je,Xe.mode,Pt,fr),Fe.return=Xe,Fe):(Fe=x(Fe,Je),Fe.return=Xe,Fe)}function Ct(Xe,Fe,Je){if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number"||typeof Fe=="bigint")return Fe=Fl(""+Fe,Xe.mode,Je),Fe.return=Xe,Fe;if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case _e:return Je=bu(Fe.type,Fe.key,Fe.props,null,Xe.mode,Je),ia(Je,Fe),Je.return=Xe,Je;case se:return Fe=sl(Fe,Xe.mode,Je),Fe.return=Xe,Fe;case bt:var Pt=Fe._init;return Fe=Pt(Fe._payload),Ct(Xe,Fe,Je)}if(tt(Fe)||dr(Fe))return Fe=al(Fe,Xe.mode,Je,null),Fe.return=Xe,Fe;if(typeof Fe.then=="function")return Ct(Xe,Po(Fe),Je);if(Fe.$$typeof===zt)return Ct(Xe,Eu(Xe,Fe),Je);Ra(Xe,Fe)}return null}function lt(Xe,Fe,Je,Pt){var fr=Fe!==null?Fe.key:null;if(typeof Je=="string"&&Je!==""||typeof Je=="number"||typeof Je=="bigint")return fr!==null?null:ee(Xe,Fe,""+Je,Pt);if(typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case _e:return Je.key===fr?Se(Xe,Fe,Je,Pt):null;case se:return Je.key===fr?et(Xe,Fe,Je,Pt):null;case bt:return fr=Je._init,Je=fr(Je._payload),lt(Xe,Fe,Je,Pt)}if(tt(Je)||dr(Je))return fr!==null?null:Et(Xe,Fe,Je,Pt,null);if(typeof Je.then=="function")return lt(Xe,Fe,Po(Je),Pt);if(Je.$$typeof===zt)return lt(Xe,Fe,Eu(Xe,Je),Pt);Ra(Xe,Je)}return null}function ct(Xe,Fe,Je,Pt,fr){if(typeof Pt=="string"&&Pt!==""||typeof Pt=="number"||typeof Pt=="bigint")return Xe=Xe.get(Je)||null,ee(Fe,Xe,""+Pt,fr);if(typeof Pt=="object"&&Pt!==null){switch(Pt.$$typeof){case _e:return Xe=Xe.get(Pt.key===null?Je:Pt.key)||null,Se(Fe,Xe,Pt,fr);case se:return Xe=Xe.get(Pt.key===null?Je:Pt.key)||null,et(Fe,Xe,Pt,fr);case bt:var Mr=Pt._init;return Pt=Mr(Pt._payload),ct(Xe,Fe,Je,Pt,fr)}if(tt(Pt)||dr(Pt))return Xe=Xe.get(Je)||null,Et(Fe,Xe,Pt,fr,null);if(typeof Pt.then=="function")return ct(Xe,Fe,Je,Po(Pt),fr);if(Pt.$$typeof===zt)return ct(Xe,Fe,Je,Eu(Fe,Pt),fr);Ra(Fe,Pt)}return null}function Cr(Xe,Fe,Je,Pt){for(var fr=null,Mr=null,gr=Fe,Er=Fe=0,la=null;gr!==null&&Er<Je.length;Er++){gr.index>Er?(la=gr,gr=null):la=gr.sibling;var vi=lt(Xe,gr,Je[Er],Pt);if(vi===null){gr===null&&(gr=la);break}r&&gr&&vi.alternate===null&&s(Xe,gr),Fe=A(vi,Fe,Er),Mr===null?fr=vi:Mr.sibling=vi,Mr=vi,gr=la}if(Er===Je.length)return u(Xe,gr),ni&&Ts(Xe,Er),fr;if(gr===null){for(;Er<Je.length;Er++)gr=Ct(Xe,Je[Er],Pt),gr!==null&&(Fe=A(gr,Fe,Er),Mr===null?fr=gr:Mr.sibling=gr,Mr=gr);return ni&&Ts(Xe,Er),fr}for(gr=p(gr);Er<Je.length;Er++)la=ct(gr,Xe,Er,Je[Er],Pt),la!==null&&(r&&la.alternate!==null&&gr.delete(la.key===null?Er:la.key),Fe=A(la,Fe,Er),Mr===null?fr=la:Mr.sibling=la,Mr=la);return r&&gr.forEach(function(uu){return s(Xe,uu)}),ni&&Ts(Xe,Er),fr}function Tr(Xe,Fe,Je,Pt){if(Je==null)throw Error(D(151));for(var fr=null,Mr=null,gr=Fe,Er=Fe=0,la=null,vi=Je.next();gr!==null&&!vi.done;Er++,vi=Je.next()){gr.index>Er?(la=gr,gr=null):la=gr.sibling;var uu=lt(Xe,gr,vi.value,Pt);if(uu===null){gr===null&&(gr=la);break}r&&gr&&uu.alternate===null&&s(Xe,gr),Fe=A(uu,Fe,Er),Mr===null?fr=uu:Mr.sibling=uu,Mr=uu,gr=la}if(vi.done)return u(Xe,gr),ni&&Ts(Xe,Er),fr;if(gr===null){for(;!vi.done;Er++,vi=Je.next())vi=Ct(Xe,vi.value,Pt),vi!==null&&(Fe=A(vi,Fe,Er),Mr===null?fr=vi:Mr.sibling=vi,Mr=vi);return ni&&Ts(Xe,Er),fr}for(gr=p(gr);!vi.done;Er++,vi=Je.next())vi=ct(gr,Xe,Er,vi.value,Pt),vi!==null&&(r&&vi.alternate!==null&&gr.delete(vi.key===null?Er:vi.key),Fe=A(vi,Fe,Er),Mr===null?fr=vi:Mr.sibling=vi,Mr=vi);return r&&gr.forEach(function(_a){return s(Xe,_a)}),ni&&Ts(Xe,Er),fr}function ji(Xe,Fe,Je,Pt){if(typeof Je=="object"&&Je!==null&&Je.type===Me&&Je.key===null&&(Je=Je.props.children),typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case _e:e:{for(var fr=Je.key;Fe!==null;){if(Fe.key===fr){if(fr=Je.type,fr===Me){if(Fe.tag===7){u(Xe,Fe.sibling),Pt=x(Fe,Je.props.children),Pt.return=Xe,Xe=Pt;break e}}else if(Fe.elementType===fr||typeof fr=="object"&&fr!==null&&fr.$$typeof===bt&&za(fr)===Fe.type){u(Xe,Fe.sibling),Pt=x(Fe,Je.props),ia(Pt,Je),Pt.return=Xe,Xe=Pt;break e}u(Xe,Fe);break}else s(Xe,Fe);Fe=Fe.sibling}Je.type===Me?(Pt=al(Je.props.children,Xe.mode,Pt,Je.key),Pt.return=Xe,Xe=Pt):(Pt=bu(Je.type,Je.key,Je.props,null,Xe.mode,Pt),ia(Pt,Je),Pt.return=Xe,Xe=Pt)}return G(Xe);case se:e:{for(fr=Je.key;Fe!==null;){if(Fe.key===fr)if(Fe.tag===4&&Fe.stateNode.containerInfo===Je.containerInfo&&Fe.stateNode.implementation===Je.implementation){u(Xe,Fe.sibling),Pt=x(Fe,Je.children||[]),Pt.return=Xe,Xe=Pt;break e}else{u(Xe,Fe);break}else s(Xe,Fe);Fe=Fe.sibling}Pt=sl(Je,Xe.mode,Pt),Pt.return=Xe,Xe=Pt}return G(Xe);case bt:return fr=Je._init,Je=fr(Je._payload),ji(Xe,Fe,Je,Pt)}if(tt(Je))return Cr(Xe,Fe,Je,Pt);if(dr(Je)){if(fr=dr(Je),typeof fr!="function")throw Error(D(150));return Je=fr.call(Je),Tr(Xe,Fe,Je,Pt)}if(typeof Je.then=="function")return ji(Xe,Fe,Po(Je),Pt);if(Je.$$typeof===zt)return ji(Xe,Fe,Eu(Xe,Je),Pt);Ra(Xe,Je)}return typeof Je=="string"&&Je!==""||typeof Je=="number"||typeof Je=="bigint"?(Je=""+Je,Fe!==null&&Fe.tag===6?(u(Xe,Fe.sibling),Pt=x(Fe,Je),Pt.return=Xe,Xe=Pt):(u(Xe,Fe),Pt=Fl(Je,Xe.mode,Pt),Pt.return=Xe,Xe=Pt),G(Xe)):u(Xe,Fe)}return function(Xe,Fe,Je,Pt){try{ml=0;var fr=ji(Xe,Fe,Je,Pt);return Yl=null,fr}catch(gr){if(gr===Wt||gr===cl)throw gr;var Mr=fa(29,gr,null,Xe.mode);return Mr.lanes=Pt,Mr.return=Xe,Mr}finally{}}}var lo=ks(!0),uo=ks(!1),ba=Ye(null),co=null;function Ro(r){var s=r.alternate;yt(jn,jn.current&1),yt(ba,r),co===null&&(s===null||Ps.current!==null||s.memoizedState!==null)&&(co=r)}function vd(r){if(r.tag===22){if(yt(jn,jn.current),yt(ba,r),co===null){var s=r.alternate;s!==null&&s.memoizedState!==null&&(co=r)}}else Xa()}function Xa(){yt(jn,jn.current),yt(ba,ba.current)}function La(r){Mt(ba),co===r&&(co=null),Mt(jn)}var jn=Ye(0);function lf(r){for(var s=r;s!==null;){if(s.tag===13){var u=s.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||ip(u)))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}function _h(r,s,u,p){s=r.memoizedState,u=u(p,s),u=u==null?s:oe({},s,u),r.memoizedState=u,r.lanes===0&&(r.updateQueue.baseState=u)}var uf={enqueueSetState:function(r,s,u){r=r._reactInternals;var p=Oa(),x=Ds(p);x.payload=s,u!=null&&(x.callback=u),s=ss(r,x,p),s!==null&&(hs(s,r,p),eo(s,r,p))},enqueueReplaceState:function(r,s,u){r=r._reactInternals;var p=Oa(),x=Ds(p);x.tag=1,x.payload=s,u!=null&&(x.callback=u),s=ss(r,x,p),s!==null&&(hs(s,r,p),eo(s,r,p))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var u=Oa(),p=Ds(u);p.tag=2,s!=null&&(p.callback=s),s=ss(r,p,u),s!==null&&(hs(s,r,u),eo(s,r,u))}};function bp(r,s,u,p,x,A,G){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(p,A,G):s.prototype&&s.prototype.isPureReactComponent?!qr(u,p)||!qr(x,A):!0}function xd(r,s,u,p){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(u,p),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(u,p),s.state!==r&&uf.enqueueReplaceState(s,s.state,null)}function ku(r,s){var u=s;if("ref"in s){u={};for(var p in s)p!=="ref"&&(u[p]=s[p])}if(r=r.defaultProps){u===s&&(u=oe({},u));for(var x in r)u[x]===void 0&&(u[x]=r[x])}return u}var wc=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)};function wp(r){wc(r)}function cf(r){console.error(r)}function bd(r){wc(r)}function yh(r,s){try{var u=r.onUncaughtError;u(s.value,{componentStack:s.stack})}catch(p){setTimeout(function(){throw p})}}function Wl(r,s,u){try{var p=r.onCaughtError;p(u.value,{componentStack:u.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(x){setTimeout(function(){throw x})}}function wd(r,s,u){return u=Ds(u),u.tag=3,u.payload={element:null},u.callback=function(){yh(r,s)},u}function Tc(r){return r=Ds(r),r.tag=3,r}function vh(r,s,u,p){var x=u.type.getDerivedStateFromError;if(typeof x=="function"){var A=p.value;r.payload=function(){return x(A)},r.callback=function(){Wl(s,u,p)}}var G=u.stateNode;G!==null&&typeof G.componentDidCatch=="function"&&(r.callback=function(){Wl(s,u,p),typeof x!="function"&&(iu===null?iu=new Set([this]):iu.add(this));var ee=p.stack;this.componentDidCatch(p.value,{componentStack:ee!==null?ee:""})})}function hf(r,s,u,p,x){if(u.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(s=u.alternate,s!==null&&As(s,u,x,!0),u=ba.current,u!==null){switch(u.tag){case 13:return co===null?au():u.alternate===null&&mn===0&&(mn=3),u.flags&=-257,u.flags|=65536,u.lanes=x,p===gc?u.flags|=16384:(s=u.updateQueue,s===null?u.updateQueue=new Set([p]):s.add(p),kf(r,p,x)),!1;case 22:return u.flags|=65536,p===gc?u.flags|=16384:(s=u.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([p])},u.updateQueue=s):(u=s.retryQueue,u===null?s.retryQueue=new Set([p]):u.add(p)),kf(r,p,x)),!1}throw Error(D(435,u.tag))}return kf(r,p,x),au(),!1}if(ni)return s=ba.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=x,p!==ll&&(r=Error(D(422),{cause:p}),xa(ca(r,u)))):(p!==ll&&(s=Error(D(423),{cause:p}),xa(ca(s,u))),r=r.current.alternate,r.flags|=65536,x&=-x,r.lanes|=x,p=ca(p,u),x=wd(r.stateNode,p,x),ph(r,x),mn!==4&&(mn=2)),!1;var A=Error(D(520),{cause:p});if(A=ca(A,u),Sh===null?Sh=[A]:Sh.push(A),mn!==4&&(mn=2),s===null)return!0;p=ca(p,u),u=s;do{switch(u.tag){case 3:return u.flags|=65536,r=x&-x,u.lanes|=r,r=wd(u.stateNode,p,r),ph(u,r),!1;case 1:if(s=u.type,A=u.stateNode,(u.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||A!==null&&typeof A.componentDidCatch=="function"&&(iu===null||!iu.has(A))))return u.flags|=65536,x&=-x,u.lanes|=x,x=Tc(x),vh(x,r,u,p),ph(u,x),!1}u=u.return}while(u!==null);return!1}var Td=Error(D(461)),Gn=!1;function da(r,s,u,p){s.child=r===null?uo(s,null,u,p):lo(s,r.child,u,p)}function Tp(r,s,u,p,x){u=u.render;var A=s.ref;if("ref"in p){var G={};for(var ee in p)ee!=="ref"&&(G[ee]=p[ee])}else G=p;return Ha(s),p=qi(r,s,u,G,A,x),ee=dl(),r!==null&&!Gn?(io(r,s,x),zo(r,s,x)):(ni&&ee&&Ul(s),s.flags|=1,da(r,s,p,x),s.child)}function Ed(r,s,u,p,x){if(r===null){var A=u.type;return typeof A=="function"&&!nl(A)&&A.defaultProps===void 0&&u.compare===null?(s.tag=15,s.type=A,Sd(r,s,A,p,x)):(r=bu(u.type,null,p,s,s.mode,x),r.ref=s.ref,r.return=s,s.child=r)}if(A=r.child,!gl(r,x)){var G=A.memoizedProps;if(u=u.compare,u=u!==null?u:qr,u(G,p)&&r.ref===s.ref)return zo(r,s,x)}return s.flags|=1,r=Xs(A,p),r.ref=s.ref,r.return=s,s.child=r}function Sd(r,s,u,p,x){if(r!==null){var A=r.memoizedProps;if(qr(A,p)&&r.ref===s.ref)if(Gn=!1,s.pendingProps=p=A,gl(r,x))(r.flags&131072)!==0&&(Gn=!0);else return s.lanes=r.lanes,zo(r,s,x)}return ff(r,s,u,p,x)}function Ad(r,s,u){var p=s.pendingProps,x=p.children,A=r!==null?r.memoizedState:null;if(p.mode==="hidden"){if((s.flags&128)!==0){if(p=A!==null?A.baseLanes|u:u,r!==null){for(x=s.child=r.child,A=0;x!==null;)A=A|x.lanes|x.childLanes,x=x.sibling;s.childLanes=A&~p}else s.childLanes=0,s.child=null;return Ep(r,s,p,u)}if((u&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&Js(s,A!==null?A.cachePool:null),A!==null?mh(s,A):xc(),vd(s);else return s.lanes=s.childLanes=536870912,Ep(r,s,A!==null?A.baseLanes|u:u,u)}else A!==null?(Js(s,A.cachePool),mh(s,A),Xa(),s.memoizedState=null):(r!==null&&Js(s,null),xc(),Xa());return da(r,s,x,u),s.child}function Ep(r,s,u,p){var x=Au();return x=x===null?null:{parent:Sn._currentValue,pool:x},s.memoizedState={baseLanes:u,cachePool:x},r!==null&&Js(s,null),xc(),vd(s),r!==null&&As(r,s,p,!0),null}function Ec(r,s){var u=s.ref;if(u===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(D(284));(r===null||r.ref!==u)&&(s.flags|=4194816)}}function ff(r,s,u,p,x){return Ha(s),u=qi(r,s,u,p,void 0,x),p=dl(),r!==null&&!Gn?(io(r,s,x),zo(r,s,x)):(ni&&p&&Ul(s),s.flags|=1,da(r,s,u,x),s.child)}function df(r,s,u,p,x,A){return Ha(s),s.updateQueue=null,u=fl(s,p,u,x),Gi(r),p=dl(),r!==null&&!Gn?(io(r,s,A),zo(r,s,A)):(ni&&p&&Ul(s),s.flags|=1,da(r,s,u,A),s.child)}function Sc(r,s,u,p,x){if(Ha(s),s.stateNode===null){var A=$s,G=u.contextType;typeof G=="object"&&G!==null&&(A=Nn(G)),A=new u(p,A),s.memoizedState=A.state!==null&&A.state!==void 0?A.state:null,A.updater=uf,s.stateNode=A,A._reactInternals=s,A=s.stateNode,A.props=p,A.state=s.memoizedState,A.refs={},yc(s),G=u.contextType,A.context=typeof G=="object"&&G!==null?Nn(G):$s,A.state=s.memoizedState,G=u.getDerivedStateFromProps,typeof G=="function"&&(_h(s,u,G,p),A.state=s.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof A.getSnapshotBeforeUpdate=="function"||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(G=A.state,typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount(),G!==A.state&&uf.enqueueReplaceState(A,A.state,null),Iu(s,p,A,x),Du(),A.state=s.memoizedState),typeof A.componentDidMount=="function"&&(s.flags|=4194308),p=!0}else if(r===null){A=s.stateNode;var ee=s.memoizedProps,Se=ku(u,ee);A.props=Se;var et=A.context,Et=u.contextType;G=$s,typeof Et=="object"&&Et!==null&&(G=Nn(Et));var Ct=u.getDerivedStateFromProps;Et=typeof Ct=="function"||typeof A.getSnapshotBeforeUpdate=="function",ee=s.pendingProps!==ee,Et||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(ee||et!==G)&&xd(s,A,p,G),Ms=!1;var lt=s.memoizedState;A.state=lt,Iu(s,p,A,x),Du(),et=s.memoizedState,ee||lt!==et||Ms?(typeof Ct=="function"&&(_h(s,u,Ct,p),et=s.memoizedState),(Se=Ms||bp(s,u,Se,p,lt,et,G))?(Et||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount()),typeof A.componentDidMount=="function"&&(s.flags|=4194308)):(typeof A.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=p,s.memoizedState=et),A.props=p,A.state=et,A.context=G,p=Se):(typeof A.componentDidMount=="function"&&(s.flags|=4194308),p=!1)}else{A=s.stateNode,vc(r,s),G=s.memoizedProps,Et=ku(u,G),A.props=Et,Ct=s.pendingProps,lt=A.context,et=u.contextType,Se=$s,typeof et=="object"&&et!==null&&(Se=Nn(et)),ee=u.getDerivedStateFromProps,(et=typeof ee=="function"||typeof A.getSnapshotBeforeUpdate=="function")||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(G!==Ct||lt!==Se)&&xd(s,A,p,Se),Ms=!1,lt=s.memoizedState,A.state=lt,Iu(s,p,A,x),Du();var ct=s.memoizedState;G!==Ct||lt!==ct||Ms||r!==null&&r.dependencies!==null&&hn(r.dependencies)?(typeof ee=="function"&&(_h(s,u,ee,p),ct=s.memoizedState),(Et=Ms||bp(s,u,Et,p,lt,ct,Se)||r!==null&&r.dependencies!==null&&hn(r.dependencies))?(et||typeof A.UNSAFE_componentWillUpdate!="function"&&typeof A.componentWillUpdate!="function"||(typeof A.componentWillUpdate=="function"&&A.componentWillUpdate(p,ct,Se),typeof A.UNSAFE_componentWillUpdate=="function"&&A.UNSAFE_componentWillUpdate(p,ct,Se)),typeof A.componentDidUpdate=="function"&&(s.flags|=4),typeof A.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof A.componentDidUpdate!="function"||G===r.memoizedProps&&lt===r.memoizedState||(s.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||G===r.memoizedProps&&lt===r.memoizedState||(s.flags|=1024),s.memoizedProps=p,s.memoizedState=ct),A.props=p,A.state=ct,A.context=Se,p=Et):(typeof A.componentDidUpdate!="function"||G===r.memoizedProps&&lt===r.memoizedState||(s.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||G===r.memoizedProps&&lt===r.memoizedState||(s.flags|=1024),p=!1)}return A=p,Ec(r,s),p=(s.flags&128)!==0,A||p?(A=s.stateNode,u=p&&typeof u.getDerivedStateFromError!="function"?null:A.render(),s.flags|=1,r!==null&&p?(s.child=lo(s,r.child,null,x),s.child=lo(s,null,u,x)):da(r,s,u,x),s.memoizedState=A.state,r=s.child):r=zo(r,s,x),r}function Ya(r,s,u,p){return Qs(),s.flags|=256,da(r,s,u,p),s.child}var pf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function xh(r){return{baseLanes:r,cachePool:as()}}function Cd(r,s,u){return r=r!==null?r.childLanes&~u:0,s&&(r|=Os),r}function Md(r,s,u){var p=s.pendingProps,x=!1,A=(s.flags&128)!==0,G;if((G=A)||(G=r!==null&&r.memoizedState===null?!1:(jn.current&2)!==0),G&&(x=!0,s.flags&=-129),G=(s.flags&32)!==0,s.flags&=-33,r===null){if(ni){if(x?Ro(s):Xa(),ni){var ee=tn,Se;if(Se=ee){e:{for(Se=ee,ee=ts;Se.nodeType!==8;){if(!ee){ee=null;break e}if(Se=wa(Se.nextSibling),Se===null){ee=null;break e}}ee=Se}ee!==null?(s.memoizedState={dehydrated:ee,treeContext:Ja!==null?{id:es,overflow:Ma}:null,retryLane:536870912,hydrationErrors:null},Se=fa(18,null,null,0),Se.stateNode=ee,Se.return=s,s.child=Se,Jn=s,tn=null,Se=!0):Se=!1}Se||Ci(s)}if(ee=s.memoizedState,ee!==null&&(ee=ee.dehydrated,ee!==null))return ip(ee)?s.lanes=32:s.lanes=536870912,null;La(s)}return ee=p.children,p=p.fallback,x?(Xa(),x=s.mode,ee=mf({mode:"hidden",children:ee},x),p=al(p,x,u,null),ee.return=s,p.return=s,ee.sibling=p,s.child=ee,x=s.child,x.memoizedState=xh(u),x.childLanes=Cd(r,G,u),s.memoizedState=pf,p):(Ro(s),Dd(s,ee))}if(Se=r.memoizedState,Se!==null&&(ee=Se.dehydrated,ee!==null)){if(A)s.flags&256?(Ro(s),s.flags&=-257,s=Id(r,s,u)):s.memoizedState!==null?(Xa(),s.child=r.child,s.flags|=128,s=null):(Xa(),x=p.fallback,ee=s.mode,p=mf({mode:"visible",children:p.children},ee),x=al(x,ee,u,null),x.flags|=2,p.return=s,x.return=s,p.sibling=x,s.child=p,lo(s,r.child,null,u),p=s.child,p.memoizedState=xh(u),p.childLanes=Cd(r,G,u),s.memoizedState=pf,s=x);else if(Ro(s),ip(ee)){if(G=ee.nextSibling&&ee.nextSibling.dataset,G)var et=G.dgst;G=et,p=Error(D(419)),p.stack="",p.digest=G,xa({value:p,source:null,stack:null}),s=Id(r,s,u)}else if(Gn||As(r,s,u,!1),G=(u&r.childLanes)!==0,Gn||G){if(G=Di,G!==null&&(p=u&-u,p=(p&42)!==0?1:je(p),p=(p&(G.suspendedLanes|u))!==0?0:p,p!==0&&p!==Se.retryLane))throw Se.retryLane=p,il(r,p),hs(G,r,p),Td;ee.data==="$?"||au(),s=Id(r,s,u)}else ee.data==="$?"?(s.flags|=192,s.child=r.child,s=null):(r=Se.treeContext,tn=wa(ee.nextSibling),Jn=s,ni=!0,Es=null,ts=!1,r!==null&&(Qn[Kn++]=es,Qn[Kn++]=Ma,Qn[Kn++]=Ja,es=r.id,Ma=r.overflow,Ja=s),s=Dd(s,p.children),s.flags|=4096);return s}return x?(Xa(),x=p.fallback,ee=s.mode,Se=r.child,et=Se.sibling,p=Xs(Se,{mode:"hidden",children:p.children}),p.subtreeFlags=Se.subtreeFlags&65011712,et!==null?x=Xs(et,x):(x=al(x,ee,u,null),x.flags|=2),x.return=s,p.return=s,p.sibling=x,s.child=p,p=x,x=s.child,ee=r.child.memoizedState,ee===null?ee=xh(u):(Se=ee.cachePool,Se!==null?(et=Sn._currentValue,Se=Se.parent!==et?{parent:et,pool:et}:Se):Se=as(),ee={baseLanes:ee.baseLanes|u,cachePool:Se}),x.memoizedState=ee,x.childLanes=Cd(r,G,u),s.memoizedState=pf,p):(Ro(s),u=r.child,r=u.sibling,u=Xs(u,{mode:"visible",children:p.children}),u.return=s,u.sibling=null,r!==null&&(G=s.deletions,G===null?(s.deletions=[r],s.flags|=16):G.push(r)),s.child=u,s.memoizedState=null,u)}function Dd(r,s){return s=mf({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function mf(r,s){return r=fa(22,r,null,s),r.lanes=0,r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},r}function Id(r,s,u){return lo(s,r.child,null,u),r=Dd(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function Sp(r,s,u){r.lanes|=s;var p=r.alternate;p!==null&&(p.lanes|=s),dc(r.return,s,u)}function bh(r,s,u,p,x){var A=r.memoizedState;A===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:p,tail:u,tailMode:x}:(A.isBackwards=s,A.rendering=null,A.renderingStartTime=0,A.last=p,A.tail=u,A.tailMode=x)}function gf(r,s,u){var p=s.pendingProps,x=p.revealOrder,A=p.tail;if(da(r,s,p.children,u),p=jn.current,(p&2)!==0)p=p&1|2,s.flags|=128;else{if(r!==null&&(r.flags&128)!==0)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Sp(r,u,s);else if(r.tag===19)Sp(r,u,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}p&=1}switch(yt(jn,p),x){case"forwards":for(u=s.child,x=null;u!==null;)r=u.alternate,r!==null&&lf(r)===null&&(x=u),u=u.sibling;u=x,u===null?(x=s.child,s.child=null):(x=u.sibling,u.sibling=null),bh(s,!1,x,u,A);break;case"backwards":for(u=null,x=s.child,s.child=null;x!==null;){if(r=x.alternate,r!==null&&lf(r)===null){s.child=x;break}r=x.sibling,x.sibling=u,u=x,x=r}bh(s,!0,u,null,A);break;case"together":bh(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function zo(r,s,u){if(r!==null&&(s.dependencies=r.dependencies),vl|=s.lanes,(u&s.childLanes)===0)if(r!==null){if(As(r,s,u,!1),(u&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(D(153));if(s.child!==null){for(r=s.child,u=Xs(r,r.pendingProps),s.child=u,u.return=s;r.sibling!==null;)r=r.sibling,u=u.sibling=Xs(r,r.pendingProps),u.return=s;u.sibling=null}return s.child}function gl(r,s){return(r.lanes&s)!==0?!0:(r=r.dependencies,!!(r!==null&&hn(r)))}function wh(r,s,u){switch(s.tag){case 3:mr(s,s.stateNode.containerInfo),Ks(s,Sn,r.memoizedState.cache),Qs();break;case 27:case 5:Si(s);break;case 4:mr(s,s.stateNode.containerInfo);break;case 10:Ks(s,s.type,s.memoizedProps.value);break;case 13:var p=s.memoizedState;if(p!==null)return p.dehydrated!==null?(Ro(s),s.flags|=128,null):(u&s.child.childLanes)!==0?Md(r,s,u):(Ro(s),r=zo(r,s,u),r!==null?r.sibling:null);Ro(s);break;case 19:var x=(r.flags&128)!==0;if(p=(u&s.childLanes)!==0,p||(As(r,s,u,!1),p=(u&s.childLanes)!==0),x){if(p)return gf(r,s,u);s.flags|=128}if(x=s.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),yt(jn,jn.current),p)break;return null;case 22:case 23:return s.lanes=0,Ad(r,s,u);case 24:Ks(s,Sn,r.memoizedState.cache)}return zo(r,s,u)}function Ap(r,s,u){if(r!==null)if(r.memoizedProps!==s.pendingProps)Gn=!0;else{if(!gl(r,u)&&(s.flags&128)===0)return Gn=!1,wh(r,s,u);Gn=(r.flags&131072)!==0}else Gn=!1,ni&&(s.flags&1048576)!==0&&hh(s,jl,s.index);switch(s.lanes=0,s.tag){case 16:e:{r=s.pendingProps;var p=s.elementType,x=p._init;if(p=x(p._payload),s.type=p,typeof p=="function")nl(p)?(r=ku(p,r),s.tag=1,s=Sc(null,s,p,r,u)):(s.tag=0,s=ff(null,s,p,r,u));else{if(p!=null){if(x=p.$$typeof,x===Rt){s.tag=11,s=Tp(null,s,p,r,u);break e}else if(x===gt){s.tag=14,s=Ed(null,s,p,r,u);break e}}throw s=xr(p)||p,Error(D(306,s,""))}}return s;case 0:return ff(r,s,s.type,s.pendingProps,u);case 1:return p=s.type,x=ku(p,s.pendingProps),Sc(r,s,p,x,u);case 3:e:{if(mr(s,s.stateNode.containerInfo),r===null)throw Error(D(387));p=s.pendingProps;var A=s.memoizedState;x=A.element,vc(r,s),Iu(s,p,null,u);var G=s.memoizedState;if(p=G.cache,Ks(s,Sn,p),p!==A.cache&&Ao(s,[Sn],u,!0),Du(),p=G.element,A.isDehydrated)if(A={element:p,isDehydrated:!1,cache:G.cache},s.updateQueue.baseState=A,s.memoizedState=A,s.flags&256){s=Ya(r,s,p,u);break e}else if(p!==x){x=ca(Error(D(424)),s),xa(x),s=Ya(r,s,p,u);break e}else{switch(r=s.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(tn=wa(r.firstChild),Jn=s,ni=!0,Es=null,ts=!0,u=uo(s,null,p,u),s.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Qs(),p===x){s=zo(r,s,u);break e}da(r,s,p,u)}s=s.child}return s;case 26:return Ec(r,s),r===null?(u=Zc(s.type,null,s.pendingProps,null))?s.memoizedState=u:ni||(u=s.type,r=s.pendingProps,p=mo(Ot.current).createElement(u),p[ir]=s,p[k]=r,oa(p,u,r),Qt(p),s.stateNode=p):s.memoizedState=Zc(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return Si(s),r===null&&ni&&(p=s.stateNode=Xf(s.type,s.pendingProps,Ot.current),Jn=s,ts=!0,x=tn,El(s.type)?(Un=x,tn=wa(p.firstChild)):tn=x),da(r,s,s.pendingProps.children,u),Ec(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&ni&&((x=p=tn)&&(p=$f(p,s.type,s.pendingProps,ts),p!==null?(s.stateNode=p,Jn=s,tn=wa(p.firstChild),ts=!1,x=!0):x=!1),x||Ci(s)),Si(s),x=s.type,A=s.pendingProps,G=r!==null?r.memoizedProps:null,p=A.children,Gf(x,A)?p=null:G!==null&&Gf(x,G)&&(s.flags|=32),s.memoizedState!==null&&(x=qi(r,s,Pu,null,null,u),ve._currentValue=x),Ec(r,s),da(r,s,p,u),s.child;case 6:return r===null&&ni&&((r=u=tn)&&(u=Im(u,s.pendingProps,ts),u!==null?(s.stateNode=u,Jn=s,tn=null,r=!0):r=!1),r||Ci(s)),null;case 13:return Md(r,s,u);case 4:return mr(s,s.stateNode.containerInfo),p=s.pendingProps,r===null?s.child=lo(s,null,p,u):da(r,s,p,u),s.child;case 11:return Tp(r,s,s.type,s.pendingProps,u);case 7:return da(r,s,s.pendingProps,u),s.child;case 8:return da(r,s,s.pendingProps.children,u),s.child;case 12:return da(r,s,s.pendingProps.children,u),s.child;case 10:return p=s.pendingProps,Ks(s,s.type,p.value),da(r,s,p.children,u),s.child;case 9:return x=s.type._context,p=s.pendingProps.children,Ha(s),x=Nn(x),p=p(x),s.flags|=1,da(r,s,p,u),s.child;case 14:return Ed(r,s,s.type,s.pendingProps,u);case 15:return Sd(r,s,s.type,s.pendingProps,u);case 19:return gf(r,s,u);case 31:return p=s.pendingProps,u=s.mode,p={mode:p.mode,children:p.children},r===null?(u=mf(p,u),u.ref=s.ref,s.child=u,u.return=s,s=u):(u=Xs(r.child,p),u.ref=s.ref,s.child=u,u.return=s,s=u),s;case 22:return Ad(r,s,u);case 24:return Ha(s),p=Nn(Sn),r===null?(x=Au(),x===null&&(x=Di,A=Co(),x.pooledCache=A,A.refCount++,A!==null&&(x.pooledCacheLanes|=u),x=A),s.memoizedState={parent:p,cache:x},yc(s),Ks(s,Sn,x)):((r.lanes&u)!==0&&(vc(r,s),Iu(s,null,null,u),Du()),x=r.memoizedState,A=s.memoizedState,x.parent!==p?(x={parent:p,cache:p},s.memoizedState=x,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=x),Ks(s,Sn,p)):(p=A.cache,Ks(s,Sn,p),p!==x.cache&&Ao(s,[Sn],u,!0))),da(r,s,s.pendingProps.children,u),s.child;case 29:throw s.pendingProps}throw Error(D(156,s.tag))}function _l(r){r.flags|=4}function Cp(r,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!R(s)){if(s=ba.current,s!==null&&((ci&4194048)===ci?co!==null:(ci&62914560)!==ci&&(ci&536870912)===0||s!==co))throw zr=gc,Cu;r.flags|=8192}}function _f(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?Ee():536870912,r.lanes|=s,xl|=s)}function Th(r,s){if(!ni)switch(r.tailMode){case"hidden":s=r.tail;for(var u=null;s!==null;)s.alternate!==null&&(u=s),s=s.sibling;u===null?r.tail=null:u.sibling=null;break;case"collapsed":u=r.tail;for(var p=null;u!==null;)u.alternate!==null&&(p=u),u=u.sibling;p===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:p.sibling=null}}function bn(r){var s=r.alternate!==null&&r.alternate.child===r.child,u=0,p=0;if(s)for(var x=r.child;x!==null;)u|=x.lanes|x.childLanes,p|=x.subtreeFlags&65011712,p|=x.flags&65011712,x.return=r,x=x.sibling;else for(x=r.child;x!==null;)u|=x.lanes|x.childLanes,p|=x.subtreeFlags,p|=x.flags,x.return=r,x=x.sibling;return r.subtreeFlags|=p,r.childLanes=u,s}function bm(r,s,u){var p=s.pendingProps;switch(wu(s),s.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bn(s),null;case 1:return bn(s),null;case 3:return u=s.stateNode,p=null,r!==null&&(p=r.memoizedState.cache),s.memoizedState.cache!==p&&(s.flags|=2048),Ss(Sn),hi(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(r===null||r.child===null)&&(ul(s)?_l(s):r===null||r.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,fc())),bn(s),null;case 26:return u=s.memoizedState,r===null?(_l(s),u!==null?(bn(s),Cp(s,u)):(bn(s),s.flags&=-16777217)):u?u!==r.memoizedState?(_l(s),bn(s),Cp(s,u)):(bn(s),s.flags&=-16777217):(r.memoizedProps!==p&&_l(s),bn(s),s.flags&=-16777217),null;case 27:jr(s),u=Ot.current;var x=s.type;if(r!==null&&s.stateNode!=null)r.memoizedProps!==p&&_l(s);else{if(!p){if(s.stateNode===null)throw Error(D(166));return bn(s),null}r=vt.current,ul(s)?Ws(s):(r=Xf(x,p,u),s.stateNode=r,_l(s))}return bn(s),null;case 5:if(jr(s),u=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==p&&_l(s);else{if(!p){if(s.stateNode===null)throw Error(D(166));return bn(s),null}if(r=vt.current,ul(s))Ws(s);else{switch(x=mo(Ot.current),r){case 1:r=x.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:r=x.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":r=x.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":r=x.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":r=x.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild);break;case"select":r=typeof p.is=="string"?x.createElement("select",{is:p.is}):x.createElement("select"),p.multiple?r.multiple=!0:p.size&&(r.size=p.size);break;default:r=typeof p.is=="string"?x.createElement(u,{is:p.is}):x.createElement(u)}}r[ir]=s,r[k]=p;e:for(x=s.child;x!==null;){if(x.tag===5||x.tag===6)r.appendChild(x.stateNode);else if(x.tag!==4&&x.tag!==27&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===s)break e;for(;x.sibling===null;){if(x.return===null||x.return===s)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}s.stateNode=r;e:switch(oa(r,u,p),u){case"button":case"input":case"select":case"textarea":r=!!p.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&_l(s)}}return bn(s),s.flags&=-16777217,null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==p&&_l(s);else{if(typeof p!="string"&&s.stateNode===null)throw Error(D(166));if(r=Ot.current,ul(s)){if(r=s.stateNode,u=s.memoizedProps,p=null,x=Jn,x!==null)switch(x.tag){case 27:case 5:p=x.memoizedProps}r[ir]=s,r=!!(r.nodeValue===u||p!==null&&p.suppressHydrationWarning===!0||Jd(r.nodeValue,u)),r||Ci(s)}else r=mo(r).createTextNode(p),r[ir]=s,s.stateNode=r}return bn(s),null;case 13:if(p=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(x=ul(s),p!==null&&p.dehydrated!==null){if(r===null){if(!x)throw Error(D(318));if(x=s.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(D(317));x[ir]=s}else Qs(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;bn(s),x=!1}else x=fc(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=x),x=!0;if(!x)return s.flags&256?(La(s),s):(La(s),null)}if(La(s),(s.flags&128)!==0)return s.lanes=u,s;if(u=p!==null,r=r!==null&&r.memoizedState!==null,u){p=s.child,x=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(x=p.alternate.memoizedState.cachePool.pool);var A=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(A=p.memoizedState.cachePool.pool),A!==x&&(p.flags|=2048)}return u!==r&&u&&(s.child.flags|=8192),_f(s,s.updateQueue),bn(s),null;case 4:return hi(),r===null&&jf(s.stateNode.containerInfo),bn(s),null;case 10:return Ss(s.type),bn(s),null;case 19:if(Mt(jn),x=s.memoizedState,x===null)return bn(s),null;if(p=(s.flags&128)!==0,A=x.rendering,A===null)if(p)Th(x,!1);else{if(mn!==0||r!==null&&(r.flags&128)!==0)for(r=s.child;r!==null;){if(A=lf(r),A!==null){for(s.flags|=128,Th(x,!1),r=A.updateQueue,s.updateQueue=r,_f(s,r),s.subtreeFlags=0,r=u,u=s.child;u!==null;)af(u,r),u=u.sibling;return yt(jn,jn.current&1|2),s.child}r=r.sibling}x.tail!==null&&_r()>Af&&(s.flags|=128,p=!0,Th(x,!1),s.lanes=4194304)}else{if(!p)if(r=lf(A),r!==null){if(s.flags|=128,p=!0,r=r.updateQueue,s.updateQueue=r,_f(s,r),Th(x,!0),x.tail===null&&x.tailMode==="hidden"&&!A.alternate&&!ni)return bn(s),null}else 2*_r()-x.renderingStartTime>Af&&u!==536870912&&(s.flags|=128,p=!0,Th(x,!1),s.lanes=4194304);x.isBackwards?(A.sibling=s.child,s.child=A):(r=x.last,r!==null?r.sibling=A:s.child=A,x.last=A)}return x.tail!==null?(s=x.tail,x.rendering=s,x.tail=s.sibling,x.renderingStartTime=_r(),s.sibling=null,r=jn.current,yt(jn,p?r&1|2:r&1),s):(bn(s),null);case 22:case 23:return La(s),bc(),p=s.memoizedState!==null,r!==null?r.memoizedState!==null!==p&&(s.flags|=8192):p&&(s.flags|=8192),p?(u&536870912)!==0&&(s.flags&128)===0&&(bn(s),s.subtreeFlags&6&&(s.flags|=8192)):bn(s),u=s.updateQueue,u!==null&&_f(s,u.retryQueue),u=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(u=r.memoizedState.cachePool.pool),p=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(p=s.memoizedState.cachePool.pool),p!==u&&(s.flags|=2048),r!==null&&Mt(Cs),null;case 24:return u=null,r!==null&&(u=r.memoizedState.cache),s.memoizedState.cache!==u&&(s.flags|=2048),Ss(Sn),bn(s),null;case 25:return null;case 30:return null}throw Error(D(156,s.tag))}function Pd(r,s){switch(wu(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return Ss(Sn),hi(),r=s.flags,(r&65536)!==0&&(r&128)===0?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return jr(s),null;case 13:if(La(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(D(340));Qs()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return Mt(jn),null;case 4:return hi(),null;case 10:return Ss(s.type),null;case 22:case 23:return La(s),bc(),r!==null&&Mt(Cs),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return Ss(Sn),null;case 25:return null;default:return null}}function Mp(r,s){switch(wu(s),s.tag){case 3:Ss(Sn),hi();break;case 26:case 27:case 5:jr(s);break;case 4:hi();break;case 13:La(s);break;case 19:Mt(jn);break;case 10:Ss(s.type);break;case 22:case 23:La(s),bc(),r!==null&&Mt(Cs);break;case 24:Ss(Sn)}}function Ac(r,s){try{var u=s.updateQueue,p=u!==null?u.lastEffect:null;if(p!==null){var x=p.next;u=x;do{if((u.tag&r)===r){p=void 0;var A=u.create,G=u.inst;p=A(),G.destroy=p}u=u.next}while(u!==x)}}catch(ee){Xi(s,s.return,ee)}}function Bs(r,s,u){try{var p=s.updateQueue,x=p!==null?p.lastEffect:null;if(x!==null){var A=x.next;p=A;do{if((p.tag&r)===r){var G=p.inst,ee=G.destroy;if(ee!==void 0){G.destroy=void 0,x=s;var Se=u,et=ee;try{et()}catch(Et){Xi(x,Se,Et)}}}p=p.next}while(p!==A)}}catch(Et){Xi(s,s.return,Et)}}function Dp(r){var s=r.updateQueue;if(s!==null){var u=r.stateNode;try{zi(s,u)}catch(p){Xi(r,r.return,p)}}}function dn(r,s,u){u.props=ku(r.type,r.memoizedProps),u.state=r.memoizedState;try{u.componentWillUnmount()}catch(p){Xi(r,s,p)}}function Lo(r,s){try{var u=r.ref;if(u!==null){switch(r.tag){case 26:case 27:case 5:var p=r.stateNode;break;case 30:p=r.stateNode;break;default:p=r.stateNode}typeof u=="function"?r.refCleanup=u(p):u.current=p}}catch(x){Xi(r,s,x)}}function ho(r,s){var u=r.ref,p=r.refCleanup;if(u!==null)if(typeof p=="function")try{p()}catch(x){Xi(r,s,x)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(x){Xi(r,s,x)}else u.current=null}function Eh(r){var s=r.type,u=r.memoizedProps,p=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":u.autoFocus&&p.focus();break e;case"img":u.src?p.src=u.src:u.srcSet&&(p.srcset=u.srcSet)}}catch(x){Xi(r,r.return,x)}}function Cc(r,s,u){try{var p=r.stateNode;$p(p,r.type,u,s),p[k]=s}catch(x){Xi(r,r.return,x)}}function Mc(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&El(r.type)||r.tag===4}function yf(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Mc(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&El(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function vf(r,s,u){var p=r.tag;if(p===5||p===6)r=r.stateNode,s?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(r,s):(s=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,s.appendChild(r),u=u._reactRootContainer,u!=null||s.onclick!==null||(s.onclick=kh));else if(p!==4&&(p===27&&El(r.type)&&(u=r.stateNode,s=null),r=r.child,r!==null))for(vf(r,s,u),r=r.sibling;r!==null;)vf(r,s,u),r=r.sibling}function Ql(r,s,u){var p=r.tag;if(p===5||p===6)r=r.stateNode,s?u.insertBefore(r,s):u.appendChild(r);else if(p!==4&&(p===27&&El(r.type)&&(u=r.stateNode),r=r.child,r!==null))for(Ql(r,s,u),r=r.sibling;r!==null;)Ql(r,s,u),r=r.sibling}function xf(r){var s=r.stateNode,u=r.memoizedProps;try{for(var p=r.type,x=s.attributes;x.length;)s.removeAttributeNode(x[0]);oa(s,p,u),s[ir]=r,s[k]=u}catch(A){Xi(r,r.return,A)}}var Wa=!1,pn=!1,Kl=!1,Dc=typeof WeakSet=="function"?WeakSet:Set,na=null;function Ip(r,s){if(r=r.containerInfo,ep=Lt,r=sc(r),oc(r)){if("selectionStart"in r)var u={start:r.selectionStart,end:r.selectionEnd};else e:{u=(u=r.ownerDocument)&&u.defaultView||window;var p=u.getSelection&&u.getSelection();if(p&&p.rangeCount!==0){u=p.anchorNode;var x=p.anchorOffset,A=p.focusNode;p=p.focusOffset;try{u.nodeType,A.nodeType}catch{u=null;break e}var G=0,ee=-1,Se=-1,et=0,Et=0,Ct=r,lt=null;t:for(;;){for(var ct;Ct!==u||x!==0&&Ct.nodeType!==3||(ee=G+x),Ct!==A||p!==0&&Ct.nodeType!==3||(Se=G+p),Ct.nodeType===3&&(G+=Ct.nodeValue.length),(ct=Ct.firstChild)!==null;)lt=Ct,Ct=ct;for(;;){if(Ct===r)break t;if(lt===u&&++et===x&&(ee=G),lt===A&&++Et===p&&(Se=G),(ct=Ct.nextSibling)!==null)break;Ct=lt,lt=Ct.parentNode}Ct=ct}u=ee===-1||Se===-1?null:{start:ee,end:Se}}else u=null}u=u||{start:0,end:0}}else u=null;for(qf={focusedElem:r,selectionRange:u},Lt=!1,na=s;na!==null;)if(s=na,r=s.child,(s.subtreeFlags&1024)!==0&&r!==null)r.return=s,na=r;else for(;na!==null;){switch(s=na,A=s.alternate,r=s.flags,s.tag){case 0:break;case 11:case 15:break;case 1:if((r&1024)!==0&&A!==null){r=void 0,u=s,x=A.memoizedProps,A=A.memoizedState,p=u.stateNode;try{var Cr=ku(u.type,x,u.elementType===u.type);r=p.getSnapshotBeforeUpdate(Cr,A),p.__reactInternalSnapshotBeforeUpdate=r}catch(Tr){Xi(u,u.return,Tr)}}break;case 3:if((r&1024)!==0){if(r=s.stateNode.containerInfo,u=r.nodeType,u===9)qc(r);else if(u===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":qc(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(D(163))}if(r=s.sibling,r!==null){r.return=s.return,na=r;break}na=s.return}}function Jl(r,s,u){var p=u.flags;switch(u.tag){case 0:case 11:case 15:ko(r,u),p&4&&Ac(5,u);break;case 1:if(ko(r,u),p&4)if(r=u.stateNode,s===null)try{r.componentDidMount()}catch(G){Xi(u,u.return,G)}else{var x=ku(u.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(x,s,r.__reactInternalSnapshotBeforeUpdate)}catch(G){Xi(u,u.return,G)}}p&64&&Dp(u),p&512&&Lo(u,u.return);break;case 3:if(ko(r,u),p&64&&(r=u.updateQueue,r!==null)){if(s=null,u.child!==null)switch(u.child.tag){case 27:case 5:s=u.child.stateNode;break;case 1:s=u.child.stateNode}try{zi(r,s)}catch(G){Xi(u,u.return,G)}}break;case 27:s===null&&p&4&&xf(u);case 26:case 5:ko(r,u),s===null&&p&4&&Eh(u),p&512&&Lo(u,u.return);break;case 12:ko(r,u);break;case 13:ko(r,u),p&4&&zd(r,u),p&64&&(r=u.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(u=No.bind(null,u),Pm(r,u))));break;case 22:if(p=u.memoizedState!==null||Wa,!p){s=s!==null&&s.memoizedState!==null||pn,x=Wa;var A=pn;Wa=p,(pn=s)&&!A?Bo(r,u,(u.subtreeFlags&8772)!==0):ko(r,u),Wa=x,pn=A}break;case 30:break;default:ko(r,u)}}function Pp(r){var s=r.alternate;s!==null&&(r.alternate=null,Pp(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&wt(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var nn=null,aa=!1;function fo(r,s,u){for(u=u.child;u!==null;)Rd(r,s,u),u=u.sibling}function Rd(r,s,u){if(ri&&typeof ri.onCommitFiberUnmount=="function")try{ri.onCommitFiberUnmount(Vi,u)}catch{}switch(u.tag){case 26:pn||ho(u,s),fo(r,s,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:pn||ho(u,s);var p=nn,x=aa;El(u.type)&&(nn=u.stateNode,aa=!1),fo(r,s,u),Gc(u.stateNode),nn=p,aa=x;break;case 5:pn||ho(u,s);case 6:if(p=nn,x=aa,nn=null,fo(r,s,u),nn=p,aa=x,nn!==null)if(aa)try{(nn.nodeType===9?nn.body:nn.nodeName==="HTML"?nn.ownerDocument.body:nn).removeChild(u.stateNode)}catch(A){Xi(u,s,A)}else try{nn.removeChild(u.stateNode)}catch(A){Xi(u,s,A)}break;case 18:nn!==null&&(aa?(r=nn,Bh(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,u.stateNode),Ji(r)):Bh(nn,u.stateNode));break;case 4:p=nn,x=aa,nn=u.stateNode.containerInfo,aa=!0,fo(r,s,u),nn=p,aa=x;break;case 0:case 11:case 14:case 15:pn||Bs(2,u,s),pn||Bs(4,u,s),fo(r,s,u);break;case 1:pn||(ho(u,s),p=u.stateNode,typeof p.componentWillUnmount=="function"&&dn(u,s,p)),fo(r,s,u);break;case 21:fo(r,s,u);break;case 22:pn=(p=pn)||u.memoizedState!==null,fo(r,s,u),pn=p;break;default:fo(r,s,u)}}function zd(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Ji(r)}catch(u){Xi(s,s.return,u)}}function wm(r){switch(r.tag){case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new Dc),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new Dc),s;default:throw Error(D(435,r.tag))}}function Ld(r,s){var u=wm(r);s.forEach(function(p){var x=su.bind(null,r,p);u.has(p)||(u.add(p),p.then(x,x))})}function ls(r,s){var u=s.deletions;if(u!==null)for(var p=0;p<u.length;p++){var x=u[p],A=r,G=s,ee=G;e:for(;ee!==null;){switch(ee.tag){case 27:if(El(ee.type)){nn=ee.stateNode,aa=!1;break e}break;case 5:nn=ee.stateNode,aa=!1;break e;case 3:case 4:nn=ee.stateNode.containerInfo,aa=!0;break e}ee=ee.return}if(nn===null)throw Error(D(160));Rd(A,G,x),nn=null,aa=!1,A=x.alternate,A!==null&&(A.return=null),x.return=null}if(s.subtreeFlags&13878)for(s=s.child;s!==null;)Rp(s,r),s=s.sibling}var po=null;function Rp(r,s){var u=r.alternate,p=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:ls(s,r),ka(r),p&4&&(Bs(3,r,r.return),Ac(3,r),Bs(5,r,r.return));break;case 1:ls(s,r),ka(r),p&512&&(pn||u===null||ho(u,u.return)),p&64&&Wa&&(r=r.updateQueue,r!==null&&(p=r.callbacks,p!==null&&(u=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=u===null?p:u.concat(p))));break;case 26:var x=po;if(ls(s,r),ka(r),p&512&&(pn||u===null||ho(u,u.return)),p&4){var A=u!==null?u.memoizedState:null;if(p=r.memoizedState,u===null)if(p===null)if(r.stateNode===null){e:{p=r.type,u=r.memoizedProps,x=x.ownerDocument||x;t:switch(p){case"title":A=x.getElementsByTagName("title")[0],(!A||A[Le]||A[ir]||A.namespaceURI==="http://www.w3.org/2000/svg"||A.hasAttribute("itemprop"))&&(A=x.createElement(p),x.head.insertBefore(A,x.querySelector("head > title"))),oa(A,p,u),A[ir]=r,Qt(A),p=A;break e;case"link":var G=v("link","href",x).get(p+(u.href||""));if(G){for(var ee=0;ee<G.length;ee++)if(A=G[ee],A.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&A.getAttribute("rel")===(u.rel==null?null:u.rel)&&A.getAttribute("title")===(u.title==null?null:u.title)&&A.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){G.splice(ee,1);break t}}A=x.createElement(p),oa(A,p,u),x.head.appendChild(A);break;case"meta":if(G=v("meta","content",x).get(p+(u.content||""))){for(ee=0;ee<G.length;ee++)if(A=G[ee],A.getAttribute("content")===(u.content==null?null:""+u.content)&&A.getAttribute("name")===(u.name==null?null:u.name)&&A.getAttribute("property")===(u.property==null?null:u.property)&&A.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&A.getAttribute("charset")===(u.charSet==null?null:u.charSet)){G.splice(ee,1);break t}}A=x.createElement(p),oa(A,p,u),x.head.appendChild(A);break;default:throw Error(D(468,p))}A[ir]=r,Qt(A),p=A}r.stateNode=p}else T(x,r.type,r.stateNode);else r.stateNode=n(x,p,r.memoizedProps);else A!==p?(A===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):A.count--,p===null?T(x,r.type,r.stateNode):n(x,p,r.memoizedProps)):p===null&&r.stateNode!==null&&Cc(r,r.memoizedProps,u.memoizedProps)}break;case 27:ls(s,r),ka(r),p&512&&(pn||u===null||ho(u,u.return)),u!==null&&p&4&&Cc(r,r.memoizedProps,u.memoizedProps);break;case 5:if(ls(s,r),ka(r),p&512&&(pn||u===null||ho(u,u.return)),r.flags&32){x=r.stateNode;try{wi(x,"")}catch(ct){Xi(r,r.return,ct)}}p&4&&r.stateNode!=null&&(x=r.memoizedProps,Cc(r,x,u!==null?u.memoizedProps:x)),p&1024&&(Kl=!0);break;case 6:if(ls(s,r),ka(r),p&4){if(r.stateNode===null)throw Error(D(162));p=r.memoizedProps,u=r.stateNode;try{u.nodeValue=p}catch(ct){Xi(r,r.return,ct)}}break;case 3:if(_=null,x=po,po=Wf(s.containerInfo),ls(s,r),po=x,ka(r),p&4&&u!==null&&u.memoizedState.isDehydrated)try{Ji(s.containerInfo)}catch(ct){Xi(r,r.return,ct)}Kl&&(Kl=!1,kd(r));break;case 4:p=po,po=Wf(r.stateNode.containerInfo),ls(s,r),ka(r),po=p;break;case 12:ls(s,r),ka(r);break;case 13:ls(s,r),ka(r),r.child.flags&8192&&r.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(jd=_r()),p&4&&(p=r.updateQueue,p!==null&&(r.updateQueue=null,Ld(r,p)));break;case 22:x=r.memoizedState!==null;var Se=u!==null&&u.memoizedState!==null,et=Wa,Et=pn;if(Wa=et||x,pn=Et||Se,ls(s,r),pn=Et,Wa=et,ka(r),p&8192)e:for(s=r.stateNode,s._visibility=x?s._visibility&-2:s._visibility|1,x&&(u===null||Se||Wa||pn||eu(r)),u=null,s=r;;){if(s.tag===5||s.tag===26){if(u===null){Se=u=s;try{if(A=Se.stateNode,x)G=A.style,typeof G.setProperty=="function"?G.setProperty("display","none","important"):G.display="none";else{ee=Se.stateNode;var Ct=Se.memoizedProps.style,lt=Ct!=null&&Ct.hasOwnProperty("display")?Ct.display:null;ee.style.display=lt==null||typeof lt=="boolean"?"":(""+lt).trim()}}catch(ct){Xi(Se,Se.return,ct)}}}else if(s.tag===6){if(u===null){Se=s;try{Se.stateNode.nodeValue=x?"":Se.memoizedProps}catch(ct){Xi(Se,Se.return,ct)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;u===s&&(u=null),s=s.return}u===s&&(u=null),s.sibling.return=s.return,s=s.sibling}p&4&&(p=r.updateQueue,p!==null&&(u=p.retryQueue,u!==null&&(p.retryQueue=null,Ld(r,u))));break;case 19:ls(s,r),ka(r),p&4&&(p=r.updateQueue,p!==null&&(r.updateQueue=null,Ld(r,p)));break;case 30:break;case 21:break;default:ls(s,r),ka(r)}}function ka(r){var s=r.flags;if(s&2){try{for(var u,p=r.return;p!==null;){if(Mc(p)){u=p;break}p=p.return}if(u==null)throw Error(D(160));switch(u.tag){case 27:var x=u.stateNode,A=yf(r);Ql(r,A,x);break;case 5:var G=u.stateNode;u.flags&32&&(wi(G,""),u.flags&=-33);var ee=yf(r);Ql(r,ee,G);break;case 3:case 4:var Se=u.stateNode.containerInfo,et=yf(r);vf(r,et,Se);break;default:throw Error(D(161))}}catch(Et){Xi(r,r.return,Et)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function kd(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;kd(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function ko(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)Jl(r,s.alternate,s),s=s.sibling}function eu(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:Bs(4,s,s.return),eu(s);break;case 1:ho(s,s.return);var u=s.stateNode;typeof u.componentWillUnmount=="function"&&dn(s,s.return,u),eu(s);break;case 27:Gc(s.stateNode);case 26:case 5:ho(s,s.return),eu(s);break;case 22:s.memoizedState===null&&eu(s);break;case 30:eu(s);break;default:eu(s)}r=r.sibling}}function Bo(r,s,u){for(u=u&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var p=s.alternate,x=r,A=s,G=A.flags;switch(A.tag){case 0:case 11:case 15:Bo(x,A,u),Ac(4,A);break;case 1:if(Bo(x,A,u),p=A,x=p.stateNode,typeof x.componentDidMount=="function")try{x.componentDidMount()}catch(et){Xi(p,p.return,et)}if(p=A,x=p.updateQueue,x!==null){var ee=p.stateNode;try{var Se=x.shared.hiddenCallbacks;if(Se!==null)for(x.shared.hiddenCallbacks=null,x=0;x<Se.length;x++)Is(Se[x],ee)}catch(et){Xi(p,p.return,et)}}u&&G&64&&Dp(A),Lo(A,A.return);break;case 27:xf(A);case 26:case 5:Bo(x,A,u),u&&p===null&&G&4&&Eh(A),Lo(A,A.return);break;case 12:Bo(x,A,u);break;case 13:Bo(x,A,u),u&&G&4&&zd(x,A);break;case 22:A.memoizedState===null&&Bo(x,A,u),Lo(A,A.return);break;case 30:break;default:Bo(x,A,u)}s=s.sibling}}function bf(r,s){var u=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(u=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==u&&(r!=null&&r.refCount++,u!=null&&ql(u))}function wf(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&ql(r))}function us(r,s,u,p){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Bd(r,s,u,p),s=s.sibling}function Bd(r,s,u,p){var x=s.flags;switch(s.tag){case 0:case 11:case 15:us(r,s,u,p),x&2048&&Ac(9,s);break;case 1:us(r,s,u,p);break;case 3:us(r,s,u,p),x&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&ql(r)));break;case 12:if(x&2048){us(r,s,u,p),r=s.stateNode;try{var A=s.memoizedProps,G=A.id,ee=A.onPostCommit;typeof ee=="function"&&ee(G,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(Se){Xi(s,s.return,Se)}}else us(r,s,u,p);break;case 13:us(r,s,u,p);break;case 23:break;case 22:A=s.stateNode,G=s.alternate,s.memoizedState!==null?A._visibility&2?us(r,s,u,p):Ic(r,s):A._visibility&2?us(r,s,u,p):(A._visibility|=2,Bu(r,s,u,p,(s.subtreeFlags&10256)!==0)),x&2048&&bf(G,s);break;case 24:us(r,s,u,p),x&2048&&wf(s.alternate,s);break;default:us(r,s,u,p)}}function Bu(r,s,u,p,x){for(x=x&&(s.subtreeFlags&10256)!==0,s=s.child;s!==null;){var A=r,G=s,ee=u,Se=p,et=G.flags;switch(G.tag){case 0:case 11:case 15:Bu(A,G,ee,Se,x),Ac(8,G);break;case 23:break;case 22:var Et=G.stateNode;G.memoizedState!==null?Et._visibility&2?Bu(A,G,ee,Se,x):Ic(A,G):(Et._visibility|=2,Bu(A,G,ee,Se,x)),x&&et&2048&&bf(G.alternate,G);break;case 24:Bu(A,G,ee,Se,x),x&&et&2048&&wf(G.alternate,G);break;default:Bu(A,G,ee,Se,x)}s=s.sibling}}function Ic(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var u=r,p=s,x=p.flags;switch(p.tag){case 22:Ic(u,p),x&2048&&bf(p.alternate,p);break;case 24:Ic(u,p),x&2048&&wf(p.alternate,p);break;default:Ic(u,p)}s=s.sibling}}var yl=8192;function Pc(r){if(r.subtreeFlags&yl)for(r=r.child;r!==null;)Tf(r),r=r.sibling}function Tf(r){switch(r.tag){case 26:Pc(r),r.flags&yl&&r.memoizedState!==null&&q(po,r.memoizedState,r.memoizedProps);break;case 5:Pc(r);break;case 3:case 4:var s=po;po=Wf(r.stateNode.containerInfo),Pc(r),po=s;break;case 22:r.memoizedState===null&&(s=r.alternate,s!==null&&s.memoizedState!==null?(s=yl,yl=16777216,Pc(r),yl=s):Pc(r));break;default:Pc(r)}}function Rc(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function Ou(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var u=0;u<s.length;u++){var p=s[u];na=p,Od(p,r)}Rc(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)zp(r),r=r.sibling}function zp(r){switch(r.tag){case 0:case 11:case 15:Ou(r),r.flags&2048&&Bs(9,r,r.return);break;case 3:Ou(r);break;case 12:Ou(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,Ef(r)):Ou(r);break;default:Ou(r)}}function Ef(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var u=0;u<s.length;u++){var p=s[u];na=p,Od(p,r)}Rc(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:Bs(8,s,s.return),Ef(s);break;case 22:u=s.stateNode,u._visibility&2&&(u._visibility&=-3,Ef(s));break;default:Ef(s)}r=r.sibling}}function Od(r,s){for(;na!==null;){var u=na;switch(u.tag){case 0:case 11:case 15:Bs(8,u,s);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var p=u.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:ql(u.memoizedState.cache)}if(p=u.child,p!==null)p.return=u,na=p;else e:for(u=r;na!==null;){p=na;var x=p.sibling,A=p.return;if(Pp(p),p===u){na=null;break e}if(x!==null){x.return=A,na=x;break e}na=A}}}var Lp={getCacheForType:function(r){var s=Nn(Sn),u=s.data.get(r);return u===void 0&&(u=r(),s.data.set(r,u)),u}},Tm=typeof WeakMap=="function"?WeakMap:Map,Li=0,Di=null,Kr=null,ci=0,ki=0,cs=null,tu=!1,zc=!1,Nd=!1,Oo=0,mn=0,vl=0,ru=0,Sf=0,Os=0,xl=0,Sh=null,Ba=null,Fd=!1,jd=0,Af=1/0,Ah=null,iu=null,pa=0,Ns=null,Nu=null,nu=0,Cf=0,wn=null,Mf=null,Ch=0,Df=null;function Oa(){if((Li&2)!==0&&ci!==0)return ci&-ci;if(Re.T!==null){var r=ns;return r!==0?r:Nf()}return Ut()}function If(){Os===0&&(Os=(ci&536870912)===0||ni?ye():536870912);var r=ba.current;return r!==null&&(r.flags|=32),Os}function hs(r,s,u){(r===Di&&(ki===2||ki===9)||r.cancelPendingCommit!==null)&&(Fu(r,0),bl(r,ci,Os,!1)),Ze(r,u),((Li&2)===0||r!==Di)&&(r===Di&&((Li&2)===0&&(ru|=u),mn===4&&bl(r,ci,Os,!1)),Fs(r))}function kp(r,s,u){if((Li&6)!==0)throw Error(D(327));var p=!u&&(s&124)===0&&(s&r.expiredLanes)===0||Q(r,s),x=p?Sm(r,s):kc(r,s,!0),A=p;do{if(x===0){zc&&!p&&bl(r,s,0,!1);break}else{if(u=r.current.alternate,A&&!Em(u)){x=kc(r,s,!1),A=!1;continue}if(x===2){if(A=s,r.errorRecoveryDisabledLanes&A)var G=0;else G=r.pendingLanes&-536870913,G=G!==0?G:G&536870912?536870912:0;if(G!==0){s=G;e:{var ee=r;x=Sh;var Se=ee.current.memoizedState.isDehydrated;if(Se&&(Fu(ee,G).flags|=256),G=kc(ee,G,!1),G!==2){if(Nd&&!Se){ee.errorRecoveryDisabledLanes|=A,ru|=A,x=4;break e}A=Ba,Ba=x,A!==null&&(Ba===null?Ba=A:Ba.push.apply(Ba,A))}x=G}if(A=!1,x!==2)continue}}if(x===1){Fu(r,0),bl(r,s,0,!0);break}e:{switch(p=r,A=x,A){case 0:case 1:throw Error(D(345));case 4:if((s&4194048)!==s)break;case 6:bl(p,s,Os,!tu);break e;case 2:Ba=null;break;case 3:case 5:break;default:throw Error(D(329))}if((s&62914560)===s&&(x=jd+300-_r(),10<x)){if(bl(p,s,Os,!tu),W(p,0,!0)!==0)break e;p.timeoutHandle=Xp(Bp.bind(null,p,u,Ba,Ah,Fd,s,Os,ru,xl,tu,A,2,-0,0),x);break e}Bp(p,u,Ba,Ah,Fd,s,Os,ru,xl,tu,A,0,-0,0)}}break}while(!0);Fs(r)}function Bp(r,s,u,p,x,A,G,ee,Se,et,Et,Ct,lt,ct){if(r.timeoutHandle=-1,Ct=s.subtreeFlags,(Ct&8192||(Ct&16785408)===16785408)&&(L={stylesheets:null,count:0,unsuspend:j},Tf(s),Ct=Z(),Ct!==null)){r.cancelPendingCommit=Ct(Rf.bind(null,r,s,A,u,p,x,G,ee,Se,Et,1,lt,ct)),bl(r,A,G,!et);return}Rf(r,s,A,u,p,x,G,ee,Se)}function Em(r){for(var s=r;;){var u=s.tag;if((u===0||u===11||u===15)&&s.flags&16384&&(u=s.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var p=0;p<u.length;p++){var x=u[p],A=x.getSnapshot;x=x.value;try{if(!ya(A(),x))return!1}catch{return!1}}if(u=s.child,s.subtreeFlags&16384&&u!==null)u.return=s,s=u;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function bl(r,s,u,p){s&=~Sf,s&=~ru,r.suspendedLanes|=s,r.pingedLanes&=~s,p&&(r.warmLanes|=s),p=r.expirationTimes;for(var x=s;0<x;){var A=31-ii(x),G=1<<A;p[A]=-1,x&=~G}u!==0&&Oe(r,u,s)}function sa(){return(Li&6)===0?(Vu(0),!1):!0}function Mh(){if(Kr!==null){if(ki===0)var r=Kr.return;else r=Kr,is=rs=null,Ru(r),Yl=null,ml=0,r=Kr;for(;r!==null;)Mp(r.alternate,r),r=r.return;Kr=null}}function Fu(r,s){var u=r.timeoutHandle;u!==-1&&(r.timeoutHandle=-1,Yp(u)),u=r.cancelPendingCommit,u!==null&&(r.cancelPendingCommit=null,u()),Mh(),Di=r,Kr=u=Xs(r.current,null),ci=s,ki=0,cs=null,tu=!1,zc=Q(r,s),Nd=!1,xl=Os=Sf=ru=vl=mn=0,Ba=Sh=null,Fd=!1,(s&8)!==0&&(s|=s&32);var p=r.entangledLanes;if(p!==0)for(r=r.entanglements,p&=s;0<p;){var x=31-ii(p),A=1<<x;s|=r[x],p&=~A}return Oo=s,rl(),u}function wl(r,s){vr=null,Re.H=Ei,s===Wt||s===cl?(s=Mu(),ki=3):s===Cu?(s=Mu(),ki=4):ki=s===Td?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,cs=s,Kr===null&&(mn=1,yh(r,ca(s,r.current)))}function Dh(){var r=Re.H;return Re.H=Ei,r===null?Ei:r}function Lc(){var r=Re.A;return Re.A=Lp,r}function au(){mn=4,tu||(ci&4194048)!==ci&&ba.current!==null||(zc=!0),(vl&134217727)===0&&(ru&134217727)===0||Di===null||bl(Di,ci,Os,!1)}function kc(r,s,u){var p=Li;Li|=2;var x=Dh(),A=Lc();(Di!==r||ci!==s)&&(Ah=null,Fu(r,s)),s=!1;var G=mn;e:do try{if(ki!==0&&Kr!==null){var ee=Kr,Se=cs;switch(ki){case 8:Mh(),G=6;break e;case 3:case 2:case 9:case 6:ba.current===null&&(s=!0);var et=ki;if(ki=0,cs=null,Bc(r,ee,Se,et),u&&zc){G=0;break e}break;default:et=ki,ki=0,cs=null,Bc(r,ee,Se,et)}}Pf(),G=mn;break}catch(Et){wl(r,Et)}while(!0);return s&&r.shellSuspendCounter++,is=rs=null,Li=p,Re.H=x,Re.A=A,Kr===null&&(Di=null,ci=0,rl()),G}function Pf(){for(;Kr!==null;)Ud(Kr)}function Sm(r,s){var u=Li;Li|=2;var p=Dh(),x=Lc();Di!==r||ci!==s?(Ah=null,Af=_r()+500,Fu(r,s)):zc=Q(r,s);e:do try{if(ki!==0&&Kr!==null){s=Kr;var A=cs;t:switch(ki){case 1:ki=0,cs=null,Bc(r,s,A,1);break;case 2:case 9:if(hl(A)){ki=0,cs=null,Vd(s);break}s=function(){ki!==2&&ki!==9||Di!==r||(ki=7),Fs(r)},A.then(s,s);break e;case 3:ki=7;break e;case 4:ki=5;break e;case 7:hl(A)?(ki=0,cs=null,Vd(s)):(ki=0,cs=null,Bc(r,s,A,7));break;case 5:var G=null;switch(Kr.tag){case 26:G=Kr.memoizedState;case 5:case 27:var ee=Kr;if(!G||R(G)){ki=0,cs=null;var Se=ee.sibling;if(Se!==null)Kr=Se;else{var et=ee.return;et!==null?(Kr=et,Ih(et)):Kr=null}break t}}ki=0,cs=null,Bc(r,s,A,5);break;case 6:ki=0,cs=null,Bc(r,s,A,6);break;case 8:Mh(),mn=6;break e;default:throw Error(D(462))}}Am();break}catch(Et){wl(r,Et)}while(!0);return is=rs=null,Re.H=p,Re.A=x,Li=u,Kr!==null?0:(Di=null,ci=0,rl(),mn)}function Am(){for(;Kr!==null&&!kr();)Ud(Kr)}function Ud(r){var s=Ap(r.alternate,r,Oo);r.memoizedProps=r.pendingProps,s===null?Ih(r):Kr=s}function Vd(r){var s=r,u=s.alternate;switch(s.tag){case 15:case 0:s=df(u,s,s.pendingProps,s.type,void 0,ci);break;case 11:s=df(u,s,s.pendingProps,s.type.render,s.ref,ci);break;case 5:Ru(s);default:Mp(u,s),s=Kr=af(s,Oo),s=Ap(u,s,Oo)}r.memoizedProps=r.pendingProps,s===null?Ih(r):Kr=s}function Bc(r,s,u,p){is=rs=null,Ru(s),Yl=null,ml=0;var x=s.return;try{if(hf(r,x,s,u,ci)){mn=1,yh(r,ca(u,r.current)),Kr=null;return}}catch(A){if(x!==null)throw Kr=x,A;mn=1,yh(r,ca(u,r.current)),Kr=null;return}s.flags&32768?(ni||p===1?r=!0:zc||(ci&536870912)!==0?r=!1:(tu=r=!0,(p===2||p===9||p===3||p===6)&&(p=ba.current,p!==null&&p.tag===13&&(p.flags|=16384))),qd(s,r)):Ih(s)}function Ih(r){var s=r;do{if((s.flags&32768)!==0){qd(s,tu);return}r=s.return;var u=bm(s.alternate,s,Oo);if(u!==null){Kr=u;return}if(s=s.sibling,s!==null){Kr=s;return}Kr=s=r}while(s!==null);mn===0&&(mn=5)}function qd(r,s){do{var u=Pd(r.alternate,r);if(u!==null){u.flags&=32767,Kr=u;return}if(u=r.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!s&&(r=r.sibling,r!==null)){Kr=r;return}Kr=r=u}while(r!==null);mn=6,Kr=null}function Rf(r,s,u,p,x,A,G,ee,Se){r.cancelPendingCommit=null;do Lf();while(pa!==0);if((Li&6)!==0)throw Error(D(327));if(s!==null){if(s===r.current)throw Error(D(177));if(A=s.lanes|s.childLanes,A|=Nl,Be(r,u,A,G,ee,Se),r===Di&&(Kr=Di=null,ci=0),Nu=s,Ns=r,nu=u,Cf=A,wn=x,Mf=p,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,Vp(oi,function(){return Fp(),null})):(r.callbackNode=null,r.callbackPriority=0),p=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||p){p=Re.T,Re.T=null,x=st.p,st.p=2,G=Li,Li|=4;try{Ip(r,s,u)}finally{Li=G,st.p=x,Re.T=p}}pa=1,zf(),Op(),Gd()}}function zf(){if(pa===1){pa=0;var r=Ns,s=Nu,u=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||u){u=Re.T,Re.T=null;var p=st.p;st.p=2;var x=Li;Li|=4;try{Rp(s,r);var A=qf,G=sc(r.containerInfo),ee=A.focusedElem,Se=A.selectionRange;if(G!==ee&&ee&&ee.ownerDocument&&ac(ee.ownerDocument.documentElement,ee)){if(Se!==null&&oc(ee)){var et=Se.start,Et=Se.end;if(Et===void 0&&(Et=et),"selectionStart"in ee)ee.selectionStart=et,ee.selectionEnd=Math.min(Et,ee.value.length);else{var Ct=ee.ownerDocument||document,lt=Ct&&Ct.defaultView||window;if(lt.getSelection){var ct=lt.getSelection(),Cr=ee.textContent.length,Tr=Math.min(Se.start,Cr),ji=Se.end===void 0?Tr:Math.min(Se.end,Cr);!ct.extend&&Tr>ji&&(G=ji,ji=Tr,Tr=G);var Xe=nc(ee,Tr),Fe=nc(ee,ji);if(Xe&&Fe&&(ct.rangeCount!==1||ct.anchorNode!==Xe.node||ct.anchorOffset!==Xe.offset||ct.focusNode!==Fe.node||ct.focusOffset!==Fe.offset)){var Je=Ct.createRange();Je.setStart(Xe.node,Xe.offset),ct.removeAllRanges(),Tr>ji?(ct.addRange(Je),ct.extend(Fe.node,Fe.offset)):(Je.setEnd(Fe.node,Fe.offset),ct.addRange(Je))}}}}for(Ct=[],ct=ee;ct=ct.parentNode;)ct.nodeType===1&&Ct.push({element:ct,left:ct.scrollLeft,top:ct.scrollTop});for(typeof ee.focus=="function"&&ee.focus(),ee=0;ee<Ct.length;ee++){var Pt=Ct[ee];Pt.element.scrollLeft=Pt.left,Pt.element.scrollTop=Pt.top}}Lt=!!ep,qf=ep=null}finally{Li=x,st.p=p,Re.T=u}}r.current=s,pa=2}}function Op(){if(pa===2){pa=0;var r=Ns,s=Nu,u=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||u){u=Re.T,Re.T=null;var p=st.p;st.p=2;var x=Li;Li|=4;try{Jl(r,s.alternate,s)}finally{Li=x,st.p=p,Re.T=u}}pa=3}}function Gd(){if(pa===4||pa===3){pa=0,Ui();var r=Ns,s=Nu,u=nu,p=Mf;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?pa=5:(pa=0,Nu=Ns=null,Np(r,r.pendingLanes));var x=r.pendingLanes;if(x===0&&(iu=null),_t(u),s=s.stateNode,ri&&typeof ri.onCommitFiberRoot=="function")try{ri.onCommitFiberRoot(Vi,s,void 0,(s.current.flags&128)===128)}catch{}if(p!==null){s=Re.T,x=st.p,st.p=2,Re.T=null;try{for(var A=r.onRecoverableError,G=0;G<p.length;G++){var ee=p[G];A(ee.value,{componentStack:ee.stack})}}finally{Re.T=s,st.p=x}}(nu&3)!==0&&Lf(),Fs(r),x=r.pendingLanes,(u&4194090)!==0&&(x&42)!==0?r===Df?Ch++:(Ch=0,Df=r):Ch=0,Vu(0)}}function Np(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,ql(s)))}function Lf(r){return zf(),Op(),Gd(),Fp()}function Fp(){if(pa!==5)return!1;var r=Ns,s=Cf;Cf=0;var u=_t(nu),p=Re.T,x=st.p;try{st.p=32>u?32:u,Re.T=null,u=wn,wn=null;var A=Ns,G=nu;if(pa=0,Nu=Ns=null,nu=0,(Li&6)!==0)throw Error(D(331));var ee=Li;if(Li|=4,zp(A.current),Bd(A,A.current,G,u),Li=ee,Vu(0,!1),ri&&typeof ri.onPostCommitFiberRoot=="function")try{ri.onPostCommitFiberRoot(Vi,A)}catch{}return!0}finally{st.p=x,Re.T=p,Np(r,s)}}function jp(r,s,u){s=ca(u,s),s=wd(r.stateNode,s,2),r=ss(r,s,2),r!==null&&(Ze(r,2),Fs(r))}function Xi(r,s,u){if(r.tag===3)jp(r,r,u);else for(;s!==null;){if(s.tag===3){jp(s,r,u);break}else if(s.tag===1){var p=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(iu===null||!iu.has(p))){r=ca(u,r),u=Tc(2),p=ss(s,u,2),p!==null&&(vh(u,p,s,r),Ze(p,2),Fs(p));break}}s=s.return}}function kf(r,s,u){var p=r.pingCache;if(p===null){p=r.pingCache=new Tm;var x=new Set;p.set(s,x)}else x=p.get(s),x===void 0&&(x=new Set,p.set(s,x));x.has(u)||(Nd=!0,x.add(u),r=Up.bind(null,r,s,u),s.then(r,r))}function Up(r,s,u){var p=r.pingCache;p!==null&&p.delete(s),r.pingedLanes|=r.suspendedLanes&u,r.warmLanes&=~u,Di===r&&(ci&u)===u&&(mn===4||mn===3&&(ci&62914560)===ci&&300>_r()-jd?(Li&2)===0&&Fu(r,0):Sf|=u,xl===ci&&(xl=0)),Fs(r)}function Oc(r,s){s===0&&(s=Ee()),r=il(r,s),r!==null&&(Ze(r,s),Fs(r))}function No(r){var s=r.memoizedState,u=0;s!==null&&(u=s.retryLane),Oc(r,u)}function su(r,s){var u=0;switch(r.tag){case 13:var p=r.stateNode,x=r.memoizedState;x!==null&&(u=x.retryLane);break;case 19:p=r.stateNode;break;case 22:p=r.stateNode._retryCache;break;default:throw Error(D(314))}p!==null&&p.delete(s),Oc(r,u)}function Vp(r,s){return mi(r,s)}var Nc=null,Fc=null,Zd=!1,ju=!1,Ph=!1,Uu=0;function Fs(r){r!==Fc&&r.next===null&&(Fc===null?Nc=Fc=r:Fc=Fc.next=r),ju=!0,Zd||(Zd=!0,Of())}function Vu(r,s){if(!Ph&&ju){Ph=!0;do for(var u=!1,p=Nc;p!==null;){if(r!==0){var x=p.pendingLanes;if(x===0)var A=0;else{var G=p.suspendedLanes,ee=p.pingedLanes;A=(1<<31-ii(42|r)+1)-1,A&=x&~(G&~ee),A=A&201326741?A&201326741|1:A?A|2:0}A!==0&&(u=!0,Xd(p,A))}else A=ci,A=W(p,p===Di?A:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(A&3)===0||Q(p,A)||(u=!0,Xd(p,A));p=p.next}while(u);Ph=!1}}function jc(){Hd()}function Hd(){ju=Zd=!1;var r=0;Uu!==0&&(Dm()&&(r=Uu),Uu=0);for(var s=_r(),u=null,p=Nc;p!==null;){var x=p.next,A=$d(p,s);A===0?(p.next=null,u===null?Nc=x:u.next=x,x===null&&(Fc=u)):(u=p,(r!==0||(A&3)!==0)&&(ju=!0)),p=x}Vu(r)}function $d(r,s){for(var u=r.suspendedLanes,p=r.pingedLanes,x=r.expirationTimes,A=r.pendingLanes&-62914561;0<A;){var G=31-ii(A),ee=1<<G,Se=x[G];Se===-1?((ee&u)===0||(ee&p)!==0)&&(x[G]=ae(ee,s)):Se<=s&&(r.expiredLanes|=ee),A&=~ee}if(s=Di,u=ci,u=W(r,r===s?u:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),p=r.callbackNode,u===0||r===s&&(ki===2||ki===9)||r.cancelPendingCommit!==null)return p!==null&&p!==null&&Dr(p),r.callbackNode=null,r.callbackPriority=0;if((u&3)===0||Q(r,u)){if(s=u&-u,s===r.callbackPriority)return s;switch(p!==null&&Dr(p),_t(u)){case 2:case 8:u=gi;break;case 32:u=oi;break;case 268435456:u=Nr;break;default:u=oi}return p=Bf.bind(null,r),u=mi(u,p),r.callbackPriority=s,r.callbackNode=u,s}return p!==null&&p!==null&&Dr(p),r.callbackPriority=2,r.callbackNode=null,2}function Bf(r,s){if(pa!==0&&pa!==5)return r.callbackNode=null,r.callbackPriority=0,null;var u=r.callbackNode;if(Lf()&&r.callbackNode!==u)return null;var p=ci;return p=W(r,r===Di?p:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),p===0?null:(kp(r,p,s),$d(r,_r()),r.callbackNode!=null&&r.callbackNode===u?Bf.bind(null,r):null)}function Xd(r,s){if(Lf())return null;kp(r,s,!0)}function Of(){Wp(function(){(Li&6)!==0?mi(sn,jc):Hd()})}function Nf(){return Uu===0&&(Uu=ye()),Uu}function qp(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Vs(""+r)}function Gp(r,s){var u=s.ownerDocument.createElement("input");return u.name=s.name,u.value=s.value,r.id&&u.setAttribute("form",r.id),s.parentNode.insertBefore(u,s),r=new FormData(r),u.parentNode.removeChild(u),r}function Zp(r,s,u,p,x){if(s==="submit"&&u&&u.stateNode===x){var A=qp((x[k]||null).action),G=p.submitter;G&&(s=(s=G[k]||null)?qp(s.formAction):G.getAttribute("formAction"),s!==null&&(A=s,G=null));var ee=new Cl("action","action",null,p,x);r.push({event:ee,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(Uu!==0){var Se=G?Gp(x,G):new FormData(x);zs(u,{pending:!0,data:Se,method:x.method,action:A},null,Se)}}else typeof A=="function"&&(ee.preventDefault(),Se=G?Gp(x,G):new FormData(x),zs(u,{pending:!0,data:Se,method:x.method,action:A},A,Se))},currentTarget:x}]})}}for(var Yd=0;Yd<cc.length;Yd++){var Wd=cc[Yd],Cm=Wd.toLowerCase(),Mm=Wd[0].toUpperCase()+Wd.slice(1);Ca(Cm,"on"+Mm)}Ca(yu,"onAnimationEnd"),Ca(vu,"onAnimationIteration"),Ca(lc,"onAnimationStart"),Ca("dblclick","onDoubleClick"),Ca("focusin","onFocus"),Ca("focusout","onBlur"),Ca(tl,"onTransitionRun"),Ca(uc,"onTransitionStart"),Ca(Ol,"onTransitionCancel"),Ca(Aa,"onTransitionEnd"),ti("onMouseEnter",["mouseout","mouseover"]),ti("onMouseLeave",["mouseout","mouseover"]),ti("onPointerEnter",["pointerout","pointerover"]),ti("onPointerLeave",["pointerout","pointerover"]),ui("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ui("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ui("onBeforeInput",["compositionend","keypress","textInput","paste"]),ui("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ui("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ui("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qd=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Rh));function Tl(r,s){s=(s&4)!==0;for(var u=0;u<r.length;u++){var p=r[u],x=p.event;p=p.listeners;e:{var A=void 0;if(s)for(var G=p.length-1;0<=G;G--){var ee=p[G],Se=ee.instance,et=ee.currentTarget;if(ee=ee.listener,Se!==A&&x.isPropagationStopped())break e;A=ee,x.currentTarget=et;try{A(x)}catch(Et){wc(Et)}x.currentTarget=null,A=Se}else for(G=0;G<p.length;G++){if(ee=p[G],Se=ee.instance,et=ee.currentTarget,ee=ee.listener,Se!==A&&x.isPropagationStopped())break e;A=ee,x.currentTarget=et;try{A(x)}catch(Et){wc(Et)}x.currentTarget=null,A=Se}}}}function Jr(r,s){var u=s[me];u===void 0&&(u=s[me]=new Set);var p=r+"__bubble";u.has(p)||(Kd(s,r,2,!1),u.add(p))}function Ff(r,s,u){var p=0;s&&(p|=4),Kd(u,r,p,s)}var zh="_reactListening"+Math.random().toString(36).slice(2);function jf(r){if(!r[zh]){r[zh]=!0,Pi.forEach(function(u){u!=="selectionchange"&&(Qd.has(u)||Ff(u,!1,r),Ff(u,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[zh]||(s[zh]=!0,Ff("selectionchange",!1,s))}}function Kd(r,s,u,p){switch(or(s)){case 2:var x=Dt;break;case 8:x=Ft;break;default:x=mt}u=x.bind(null,s,u,r),x=void 0,!ua||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(x=!0),p?x!==void 0?r.addEventListener(s,u,{capture:!0,passive:x}):r.addEventListener(s,u,!0):x!==void 0?r.addEventListener(s,u,{passive:x}):r.addEventListener(s,u,!1)}function Lh(r,s,u,p,x){var A=p;if((s&1)===0&&(s&2)===0&&p!==null)e:for(;;){if(p===null)return;var G=p.tag;if(G===3||G===4){var ee=p.stateNode.containerInfo;if(ee===x)break;if(G===4)for(G=p.return;G!==null;){var Se=G.tag;if((Se===3||Se===4)&&G.stateNode.containerInfo===x)return;G=G.return}for(;ee!==null;){if(G=Nt(ee),G===null)return;if(Se=G.tag,Se===5||Se===6||Se===26||Se===27){p=A=G;continue e}ee=ee.parentNode}}p=p.return}Ri(function(){var et=A,Et=_s(u),Ct=[];e:{var lt=ch.get(r);if(lt!==void 0){var ct=Cl,Cr=r;switch(r){case"keypress":if(br(u)===0)break e;case"keydown":case"keyup":ct=Ko;break;case"focusin":Cr="focus",ct=Yo;break;case"focusout":Cr="blur",ct=Yo;break;case"beforeblur":case"afterblur":ct=Yo;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ct=Ml;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ct=Bn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ct=dd;break;case yu:case vu:case lc:ct=On;break;case Aa:ct=md;break;case"scroll":case"scrollend":ct=fu;break;case"wheel":ct=Dl;break;case"copy":case"cut":case"paste":ct=Qu;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ct=Yh;break;case"toggle":case"beforetoggle":ct=tc}var Tr=(s&4)!==0,ji=!Tr&&(r==="scroll"||r==="scrollend"),Xe=Tr?lt!==null?lt+"Capture":null:lt;Tr=[];for(var Fe=et,Je;Fe!==null;){var Pt=Fe;if(Je=Pt.stateNode,Pt=Pt.tag,Pt!==5&&Pt!==26&&Pt!==27||Je===null||Xe===null||(Pt=ys(Fe,Xe),Pt!=null&&Tr.push(Uc(Fe,Pt,Je))),ji)break;Fe=Fe.return}0<Tr.length&&(lt=new ct(lt,Cr,null,u,Et),Ct.push({event:lt,listeners:Tr}))}}if((s&7)===0){e:{if(lt=r==="mouseover"||r==="pointerover",ct=r==="mouseout"||r==="pointerout",lt&&u!==qs&&(Cr=u.relatedTarget||u.fromElement)&&(Nt(Cr)||Cr[O]))break e;if((ct||lt)&&(lt=Et.window===Et?Et:(lt=Et.ownerDocument)?lt.defaultView||lt.parentWindow:window,ct?(Cr=u.relatedTarget||u.toElement,ct=et,Cr=Cr?Nt(Cr):null,Cr!==null&&(ji=U(Cr),Tr=Cr.tag,Cr!==ji||Tr!==5&&Tr!==27&&Tr!==6)&&(Cr=null)):(ct=null,Cr=et),ct!==Cr)){if(Tr=Ml,Pt="onMouseLeave",Xe="onMouseEnter",Fe="mouse",(r==="pointerout"||r==="pointerover")&&(Tr=Yh,Pt="onPointerLeave",Xe="onPointerEnter",Fe="pointer"),ji=ct==null?lt:ar(ct),Je=Cr==null?lt:ar(Cr),lt=new Tr(Pt,Fe+"leave",ct,u,Et),lt.target=ji,lt.relatedTarget=Je,Pt=null,Nt(Et)===et&&(Tr=new Tr(Xe,Fe+"enter",Cr,u,Et),Tr.target=Je,Tr.relatedTarget=ji,Pt=Tr),ji=Pt,ct&&Cr)t:{for(Tr=ct,Xe=Cr,Fe=0,Je=Tr;Je;Je=qu(Je))Fe++;for(Je=0,Pt=Xe;Pt;Pt=qu(Pt))Je++;for(;0<Fe-Je;)Tr=qu(Tr),Fe--;for(;0<Je-Fe;)Xe=qu(Xe),Je--;for(;Fe--;){if(Tr===Xe||Xe!==null&&Tr===Xe.alternate)break t;Tr=qu(Tr),Xe=qu(Xe)}Tr=null}else Tr=null;ct!==null&&Uf(Ct,lt,ct,Tr,!1),Cr!==null&&ji!==null&&Uf(Ct,ji,Cr,Tr,!0)}}e:{if(lt=et?ar(et):window,ct=lt.nodeName&&lt.nodeName.toLowerCase(),ct==="select"||ct==="input"&&lt.type==="file")var fr=Zs;else if(th(lt))if(rh)fr=rf;else{fr=nh;var Mr=_d}else ct=lt.nodeName,!ct||ct.toLowerCase()!=="input"||lt.type!=="checkbox"&&lt.type!=="radio"?et&&yn(et.elementType)&&(fr=Zs):fr=tf;if(fr&&(fr=fr(r,et))){zl(Ct,fr,u,Et);break e}Mr&&Mr(r,lt,et),r==="focusout"&&et&&lt.type==="number"&&et.memoizedProps.value!=null&&ur(lt,"number",lt.value)}switch(Mr=et?ar(et):window,r){case"focusin":(th(Mr)||Mr.contentEditable==="true")&&(Za=Mr,gu=et,_u=null);break;case"focusout":_u=gu=Za=null;break;case"mousedown":oh=!0;break;case"contextmenu":case"mouseup":case"dragend":oh=!1,nf(Ct,u,Et);break;case"selectionchange":if(sh)break;case"keydown":case"keyup":nf(Ct,u,Et)}var gr;if(qa)e:{switch(r){case"compositionstart":var Er="onCompositionStart";break e;case"compositionend":Er="onCompositionEnd";break e;case"compositionupdate":Er="onCompositionUpdate";break e}Er=void 0}else Ga?pu(r,u)&&(Er="onCompositionEnd"):r==="keydown"&&u.keyCode===229&&(Er="onCompositionStart");Er&&(Pl&&u.locale!=="ko"&&(Ga||Er!=="onCompositionStart"?Er==="onCompositionEnd"&&Ga&&(gr=Vr()):(Ua=Et,fi="value"in Ua?Ua.value:Ua.textContent,Ga=!0)),Mr=ou(et,Er),0<Mr.length&&(Er=new Xh(Er,r,null,u,Et),Ct.push({event:Er,listeners:Mr}),gr?Er.data=gr:(gr=eh(u),gr!==null&&(Er.data=gr)))),(gr=Jc?Qh(r,u):Kh(r,u))&&(Er=ou(et,"onBeforeInput"),0<Er.length&&(Mr=new Xh("onBeforeInput","beforeinput",null,u,Et),Ct.push({event:Mr,listeners:Er}),Mr.data=gr)),Zp(Ct,r,et,u,Et)}Tl(Ct,s)})}function Uc(r,s,u){return{instance:r,listener:s,currentTarget:u}}function ou(r,s){for(var u=s+"Capture",p=[];r!==null;){var x=r,A=x.stateNode;if(x=x.tag,x!==5&&x!==26&&x!==27||A===null||(x=ys(r,u),x!=null&&p.unshift(Uc(r,x,A)),x=ys(r,s),x!=null&&p.push(Uc(r,x,A))),r.tag===3)return p;r=r.return}return[]}function qu(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Uf(r,s,u,p,x){for(var A=s._reactName,G=[];u!==null&&u!==p;){var ee=u,Se=ee.alternate,et=ee.stateNode;if(ee=ee.tag,Se!==null&&Se===p)break;ee!==5&&ee!==26&&ee!==27||et===null||(Se=et,x?(et=ys(u,A),et!=null&&G.unshift(Uc(u,et,Se))):x||(et=ys(u,A),et!=null&&G.push(Uc(u,et,Se)))),u=u.return}G.length!==0&&r.push({event:s,listeners:G})}var Hp=/\r\n?/g,fs=/\u0000|\uFFFD/g;function Gu(r){return(typeof r=="string"?r:""+r).replace(Hp,`
`).replace(fs,"")}function Jd(r,s){return s=Gu(s),Gu(r)===s}function kh(){}function Bi(r,s,u,p,x,A){switch(u){case"children":typeof p=="string"?s==="body"||s==="textarea"&&p===""||wi(r,p):(typeof p=="number"||typeof p=="bigint")&&s!=="body"&&wi(r,""+p);break;case"className":ms(r,"class",p);break;case"tabIndex":ms(r,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":ms(r,u,p);break;case"style":Sa(r,p,A);break;case"data":if(s!=="object"){ms(r,"data",p);break}case"src":case"href":if(p===""&&(s!=="a"||u!=="href")){r.removeAttribute(u);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){r.removeAttribute(u);break}p=Vs(""+p),r.setAttribute(u,p);break;case"action":case"formAction":if(typeof p=="function"){r.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof A=="function"&&(u==="formAction"?(s!=="input"&&Bi(r,s,"name",x.name,x,null),Bi(r,s,"formEncType",x.formEncType,x,null),Bi(r,s,"formMethod",x.formMethod,x,null),Bi(r,s,"formTarget",x.formTarget,x,null)):(Bi(r,s,"encType",x.encType,x,null),Bi(r,s,"method",x.method,x,null),Bi(r,s,"target",x.target,x,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){r.removeAttribute(u);break}p=Vs(""+p),r.setAttribute(u,p);break;case"onClick":p!=null&&(r.onclick=kh);break;case"onScroll":p!=null&&Jr("scroll",r);break;case"onScrollEnd":p!=null&&Jr("scrollend",r);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(D(61));if(u=p.__html,u!=null){if(x.children!=null)throw Error(D(60));r.innerHTML=u}}break;case"multiple":r.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":r.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){r.removeAttribute("xlink:href");break}u=Vs(""+p),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?r.setAttribute(u,""+p):r.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?r.setAttribute(u,""):r.removeAttribute(u);break;case"capture":case"download":p===!0?r.setAttribute(u,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?r.setAttribute(u,p):r.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?r.setAttribute(u,p):r.removeAttribute(u);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?r.removeAttribute(u):r.setAttribute(u,p);break;case"popover":Jr("beforetoggle",r),Jr("toggle",r),Br(r,"popover",p);break;case"xlinkActuate":Mn(r,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":Mn(r,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":Mn(r,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":Mn(r,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":Mn(r,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":Mn(r,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":Mn(r,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":Mn(r,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":Mn(r,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Br(r,"is",p);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=Us.get(u)||u,Br(r,u,p))}}function Vf(r,s,u,p,x,A){switch(u){case"style":Sa(r,p,A);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(D(61));if(u=p.__html,u!=null){if(x.children!=null)throw Error(D(60));r.innerHTML=u}}break;case"children":typeof p=="string"?wi(r,p):(typeof p=="number"||typeof p=="bigint")&&wi(r,""+p);break;case"onScroll":p!=null&&Jr("scroll",r);break;case"onScrollEnd":p!=null&&Jr("scrollend",r);break;case"onClick":p!=null&&(r.onclick=kh);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!_n.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(x=u.endsWith("Capture"),s=u.slice(2,x?u.length-7:void 0),A=r[k]||null,A=A!=null?A[u]:null,typeof A=="function"&&r.removeEventListener(s,A,x),typeof p=="function")){typeof A!="function"&&A!==null&&(u in r?r[u]=null:r.hasAttribute(u)&&r.removeAttribute(u)),r.addEventListener(s,p,x);break e}u in r?r[u]=p:p===!0?r.setAttribute(u,""):Br(r,u,p)}}}function oa(r,s,u){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Jr("error",r),Jr("load",r);var p=!1,x=!1,A;for(A in u)if(u.hasOwnProperty(A)){var G=u[A];if(G!=null)switch(A){case"src":p=!0;break;case"srcSet":x=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(D(137,s));default:Bi(r,s,A,G,u,null)}}x&&Bi(r,s,"srcSet",u.srcSet,u,null),p&&Bi(r,s,"src",u.src,u,null);return;case"input":Jr("invalid",r);var ee=A=G=x=null,Se=null,et=null;for(p in u)if(u.hasOwnProperty(p)){var Et=u[p];if(Et!=null)switch(p){case"name":x=Et;break;case"type":G=Et;break;case"checked":Se=Et;break;case"defaultChecked":et=Et;break;case"value":A=Et;break;case"defaultValue":ee=Et;break;case"children":case"dangerouslySetInnerHTML":if(Et!=null)throw Error(D(137,s));break;default:Bi(r,s,p,Et,u,null)}}Ht(r,A,ee,Se,et,G,x,!1),$e(r);return;case"select":Jr("invalid",r),p=G=A=null;for(x in u)if(u.hasOwnProperty(x)&&(ee=u[x],ee!=null))switch(x){case"value":A=ee;break;case"defaultValue":G=ee;break;case"multiple":p=ee;default:Bi(r,s,x,ee,u,null)}s=A,u=G,r.multiple=!!p,s!=null?Ir(r,!!p,s,!1):u!=null&&Ir(r,!!p,u,!0);return;case"textarea":Jr("invalid",r),A=x=p=null;for(G in u)if(u.hasOwnProperty(G)&&(ee=u[G],ee!=null))switch(G){case"value":p=ee;break;case"defaultValue":x=ee;break;case"children":A=ee;break;case"dangerouslySetInnerHTML":if(ee!=null)throw Error(D(91));break;default:Bi(r,s,G,ee,u,null)}Qr(r,p,x,A),$e(r);return;case"option":for(Se in u)if(u.hasOwnProperty(Se)&&(p=u[Se],p!=null))switch(Se){case"selected":r.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:Bi(r,s,Se,p,u,null)}return;case"dialog":Jr("beforetoggle",r),Jr("toggle",r),Jr("cancel",r),Jr("close",r);break;case"iframe":case"object":Jr("load",r);break;case"video":case"audio":for(p=0;p<Rh.length;p++)Jr(Rh[p],r);break;case"image":Jr("error",r),Jr("load",r);break;case"details":Jr("toggle",r);break;case"embed":case"source":case"link":Jr("error",r),Jr("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(et in u)if(u.hasOwnProperty(et)&&(p=u[et],p!=null))switch(et){case"children":case"dangerouslySetInnerHTML":throw Error(D(137,s));default:Bi(r,s,et,p,u,null)}return;default:if(yn(s)){for(Et in u)u.hasOwnProperty(Et)&&(p=u[Et],p!==void 0&&Vf(r,s,Et,p,u,void 0));return}}for(ee in u)u.hasOwnProperty(ee)&&(p=u[ee],p!=null&&Bi(r,s,ee,p,u,null))}function $p(r,s,u,p){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var x=null,A=null,G=null,ee=null,Se=null,et=null,Et=null;for(ct in u){var Ct=u[ct];if(u.hasOwnProperty(ct)&&Ct!=null)switch(ct){case"checked":break;case"value":break;case"defaultValue":Se=Ct;default:p.hasOwnProperty(ct)||Bi(r,s,ct,null,p,Ct)}}for(var lt in p){var ct=p[lt];if(Ct=u[lt],p.hasOwnProperty(lt)&&(ct!=null||Ct!=null))switch(lt){case"type":A=ct;break;case"name":x=ct;break;case"checked":et=ct;break;case"defaultChecked":Et=ct;break;case"value":G=ct;break;case"defaultValue":ee=ct;break;case"children":case"dangerouslySetInnerHTML":if(ct!=null)throw Error(D(137,s));break;default:ct!==Ct&&Bi(r,s,lt,ct,p,Ct)}}qt(r,G,ee,Se,et,Et,A,x);return;case"select":ct=G=ee=lt=null;for(A in u)if(Se=u[A],u.hasOwnProperty(A)&&Se!=null)switch(A){case"value":break;case"multiple":ct=Se;default:p.hasOwnProperty(A)||Bi(r,s,A,null,p,Se)}for(x in p)if(A=p[x],Se=u[x],p.hasOwnProperty(x)&&(A!=null||Se!=null))switch(x){case"value":lt=A;break;case"defaultValue":ee=A;break;case"multiple":G=A;default:A!==Se&&Bi(r,s,x,A,p,Se)}s=ee,u=G,p=ct,lt!=null?Ir(r,!!u,lt,!1):!!p!=!!u&&(s!=null?Ir(r,!!u,s,!0):Ir(r,!!u,u?[]:"",!1));return;case"textarea":ct=lt=null;for(ee in u)if(x=u[ee],u.hasOwnProperty(ee)&&x!=null&&!p.hasOwnProperty(ee))switch(ee){case"value":break;case"children":break;default:Bi(r,s,ee,null,p,x)}for(G in p)if(x=p[G],A=u[G],p.hasOwnProperty(G)&&(x!=null||A!=null))switch(G){case"value":lt=x;break;case"defaultValue":ct=x;break;case"children":break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(D(91));break;default:x!==A&&Bi(r,s,G,x,p,A)}$r(r,lt,ct);return;case"option":for(var Cr in u)if(lt=u[Cr],u.hasOwnProperty(Cr)&&lt!=null&&!p.hasOwnProperty(Cr))switch(Cr){case"selected":r.selected=!1;break;default:Bi(r,s,Cr,null,p,lt)}for(Se in p)if(lt=p[Se],ct=u[Se],p.hasOwnProperty(Se)&&lt!==ct&&(lt!=null||ct!=null))switch(Se){case"selected":r.selected=lt&&typeof lt!="function"&&typeof lt!="symbol";break;default:Bi(r,s,Se,lt,p,ct)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Tr in u)lt=u[Tr],u.hasOwnProperty(Tr)&&lt!=null&&!p.hasOwnProperty(Tr)&&Bi(r,s,Tr,null,p,lt);for(et in p)if(lt=p[et],ct=u[et],p.hasOwnProperty(et)&&lt!==ct&&(lt!=null||ct!=null))switch(et){case"children":case"dangerouslySetInnerHTML":if(lt!=null)throw Error(D(137,s));break;default:Bi(r,s,et,lt,p,ct)}return;default:if(yn(s)){for(var ji in u)lt=u[ji],u.hasOwnProperty(ji)&&lt!==void 0&&!p.hasOwnProperty(ji)&&Vf(r,s,ji,void 0,p,lt);for(Et in p)lt=p[Et],ct=u[Et],!p.hasOwnProperty(Et)||lt===ct||lt===void 0&&ct===void 0||Vf(r,s,Et,lt,p,ct);return}}for(var Xe in u)lt=u[Xe],u.hasOwnProperty(Xe)&&lt!=null&&!p.hasOwnProperty(Xe)&&Bi(r,s,Xe,null,p,lt);for(Ct in p)lt=p[Ct],ct=u[Ct],!p.hasOwnProperty(Ct)||lt===ct||lt==null&&ct==null||Bi(r,s,Ct,lt,p,ct)}var ep=null,qf=null;function mo(r){return r.nodeType===9?r:r.ownerDocument}function tp(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function rp(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function Gf(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Zf=null;function Dm(){var r=window.event;return r&&r.type==="popstate"?r===Zf?!1:(Zf=r,!0):(Zf=null,!1)}var Xp=typeof setTimeout=="function"?setTimeout:void 0,Yp=typeof clearTimeout=="function"?clearTimeout:void 0,Vc=typeof Promise=="function"?Promise:void 0,Wp=typeof queueMicrotask=="function"?queueMicrotask:typeof Vc<"u"?function(r){return Vc.resolve(null).then(r).catch(Hf)}:Xp;function Hf(r){setTimeout(function(){throw r})}function El(r){return r==="head"}function Bh(r,s){var u=s,p=0,x=0;do{var A=u.nextSibling;if(r.removeChild(u),A&&A.nodeType===8)if(u=A.data,u==="/$"){if(0<p&&8>p){u=p;var G=r.ownerDocument;if(u&1&&Gc(G.documentElement),u&2&&Gc(G.body),u&4)for(u=G.head,Gc(u),G=u.firstChild;G;){var ee=G.nextSibling,Se=G.nodeName;G[Le]||Se==="SCRIPT"||Se==="STYLE"||Se==="LINK"&&G.rel.toLowerCase()==="stylesheet"||u.removeChild(G),G=ee}}if(x===0){r.removeChild(A),Ji(s);return}x--}else u==="$"||u==="$?"||u==="$!"?x++:p=u.charCodeAt(0)-48;else p=0;u=A}while(u);Ji(s)}function qc(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var u=s;switch(s=s.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":qc(u),wt(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}r.removeChild(u)}}function $f(r,s,u,p){for(;r.nodeType===1;){var x=u;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!p&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(p){if(!r[Le])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(A=r.getAttribute("rel"),A==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(A!==x.rel||r.getAttribute("href")!==(x.href==null||x.href===""?null:x.href)||r.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin)||r.getAttribute("title")!==(x.title==null?null:x.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(A=r.getAttribute("src"),(A!==(x.src==null?null:x.src)||r.getAttribute("type")!==(x.type==null?null:x.type)||r.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin))&&A&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var A=x.name==null?null:""+x.name;if(x.type==="hidden"&&r.getAttribute("name")===A)return r}else return r;if(r=wa(r.nextSibling),r===null)break}return null}function Im(r,s,u){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!u||(r=wa(r.nextSibling),r===null))return null;return r}function ip(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState==="complete"}function Pm(r,s){var u=r.ownerDocument;if(r.data!=="$?"||u.readyState==="complete")s();else{var p=function(){s(),u.removeEventListener("DOMContentLoaded",p)};u.addEventListener("DOMContentLoaded",p),r._reactRetry=p}}function wa(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="F!"||s==="F")break;if(s==="/$")return null}}return r}var Un=null;function Sl(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var u=r.data;if(u==="$"||u==="$!"||u==="$?"){if(s===0)return r;s--}else u==="/$"&&s++}r=r.previousSibling}return null}function Xf(r,s,u){switch(s=mo(u),r){case"html":if(r=s.documentElement,!r)throw Error(D(452));return r;case"head":if(r=s.head,!r)throw Error(D(453));return r;case"body":if(r=s.body,!r)throw Error(D(454));return r;default:throw Error(D(451))}}function Gc(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);wt(r)}var ds=new Map,Yf=new Set;function Wf(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Fo=st.d;st.d={f:Qp,r:Rm,D:np,C:Kp,L:Oh,m:ap,X:sp,S:Jp,M:Kf};function Qp(){var r=Fo.f(),s=sa();return r||s}function Rm(r){var s=Jt(r);s!==null&&s.tag===5&&s.type==="form"?no(s):Fo.r(r)}var Zu=typeof document>"u"?null:document;function Qf(r,s,u){var p=Zu;if(p&&typeof s=="string"&&s){var x=Bt(s);x='link[rel="'+r+'"][href="'+x+'"]',typeof u=="string"&&(x+='[crossorigin="'+u+'"]'),Yf.has(x)||(Yf.add(x),r={rel:r,crossOrigin:u,href:s},p.querySelector(x)===null&&(s=p.createElement("link"),oa(s,"link",r),Qt(s),p.head.appendChild(s)))}}function np(r){Fo.D(r),Qf("dns-prefetch",r,null)}function Kp(r,s){Fo.C(r,s),Qf("preconnect",r,s)}function Oh(r,s,u){Fo.L(r,s,u);var p=Zu;if(p&&r&&s){var x='link[rel="preload"][as="'+Bt(s)+'"]';s==="image"&&u&&u.imageSrcSet?(x+='[imagesrcset="'+Bt(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(x+='[imagesizes="'+Bt(u.imageSizes)+'"]')):x+='[href="'+Bt(r)+'"]';var A=x;switch(s){case"style":A=lu(r);break;case"script":A=a(r)}ds.has(A)||(r=oe({rel:"preload",href:s==="image"&&u&&u.imageSrcSet?void 0:r,as:s},u),ds.set(A,r),p.querySelector(x)!==null||s==="style"&&p.querySelector(Hu(A))||s==="script"&&p.querySelector(t(A))||(s=p.createElement("link"),oa(s,"link",r),Qt(s),p.head.appendChild(s)))}}function ap(r,s){Fo.m(r,s);var u=Zu;if(u&&r){var p=s&&typeof s.as=="string"?s.as:"script",x='link[rel="modulepreload"][as="'+Bt(p)+'"][href="'+Bt(r)+'"]',A=x;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":A=a(r)}if(!ds.has(A)&&(r=oe({rel:"modulepreload",href:r},s),ds.set(A,r),u.querySelector(x)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(t(A)))return}p=u.createElement("link"),oa(p,"link",r),Qt(p),u.head.appendChild(p)}}}function Jp(r,s,u){Fo.S(r,s,u);var p=Zu;if(p&&r){var x=Hr(p).hoistableStyles,A=lu(r);s=s||"default";var G=x.get(A);if(!G){var ee={loading:0,preload:null};if(G=p.querySelector(Hu(A)))ee.loading=5;else{r=oe({rel:"stylesheet",href:r,"data-precedence":s},u),(u=ds.get(A))&&f(r,u);var Se=G=p.createElement("link");Qt(Se),oa(Se,"link",r),Se._p=new Promise(function(et,Et){Se.onload=et,Se.onerror=Et}),Se.addEventListener("load",function(){ee.loading|=1}),Se.addEventListener("error",function(){ee.loading|=2}),ee.loading|=4,o(G,s,p)}G={type:"stylesheet",instance:G,count:1,state:ee},x.set(A,G)}}}function sp(r,s){Fo.X(r,s);var u=Zu;if(u&&r){var p=Hr(u).hoistableScripts,x=a(r),A=p.get(x);A||(A=u.querySelector(t(x)),A||(r=oe({src:r,async:!0},s),(s=ds.get(x))&&g(r,s),A=u.createElement("script"),Qt(A),oa(A,"link",r),u.head.appendChild(A)),A={type:"script",instance:A,count:1,state:null},p.set(x,A))}}function Kf(r,s){Fo.M(r,s);var u=Zu;if(u&&r){var p=Hr(u).hoistableScripts,x=a(r),A=p.get(x);A||(A=u.querySelector(t(x)),A||(r=oe({src:r,async:!0,type:"module"},s),(s=ds.get(x))&&g(r,s),A=u.createElement("script"),Qt(A),oa(A,"link",r),u.head.appendChild(A)),A={type:"script",instance:A,count:1,state:null},p.set(x,A))}}function Zc(r,s,u,p){var x=(x=Ot.current)?Wf(x):null;if(!x)throw Error(D(446));switch(r){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(s=lu(u.href),u=Hr(x).hoistableStyles,p=u.get(s),p||(p={type:"style",instance:null,count:0,state:null},u.set(s,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){r=lu(u.href);var A=Hr(x).hoistableStyles,G=A.get(r);if(G||(x=x.ownerDocument||x,G={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},A.set(r,G),(A=x.querySelector(Hu(r)))&&!A._p&&(G.instance=A,G.state.loading=5),ds.has(r)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},ds.set(r,u),A||zm(x,r,u,G.state))),s&&p===null)throw Error(D(528,""));return G}if(s&&p!==null)throw Error(D(529,""));return null;case"script":return s=u.async,u=u.src,typeof u=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=a(u),u=Hr(x).hoistableScripts,p=u.get(s),p||(p={type:"script",instance:null,count:0,state:null},u.set(s,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(D(444,r))}}function lu(r){return'href="'+Bt(r)+'"'}function Hu(r){return'link[rel="stylesheet"]['+r+"]"}function Jf(r){return oe({},r,{"data-precedence":r.precedence,precedence:null})}function zm(r,s,u,p){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?p.loading=1:(s=r.createElement("link"),p.preload=s,s.addEventListener("load",function(){return p.loading|=1}),s.addEventListener("error",function(){return p.loading|=2}),oa(s,"link",u),Qt(s),r.head.appendChild(s))}function a(r){return'[src="'+Bt(r)+'"]'}function t(r){return"script[async]"+r}function n(r,s,u){if(s.count++,s.instance===null)switch(s.type){case"style":var p=r.querySelector('style[data-href~="'+Bt(u.href)+'"]');if(p)return s.instance=p,Qt(p),p;var x=oe({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return p=(r.ownerDocument||r).createElement("style"),Qt(p),oa(p,"style",x),o(p,u.precedence,r),s.instance=p;case"stylesheet":x=lu(u.href);var A=r.querySelector(Hu(x));if(A)return s.state.loading|=4,s.instance=A,Qt(A),A;p=Jf(u),(x=ds.get(x))&&f(p,x),A=(r.ownerDocument||r).createElement("link"),Qt(A);var G=A;return G._p=new Promise(function(ee,Se){G.onload=ee,G.onerror=Se}),oa(A,"link",p),s.state.loading|=4,o(A,u.precedence,r),s.instance=A;case"script":return A=a(u.src),(x=r.querySelector(t(A)))?(s.instance=x,Qt(x),x):(p=u,(x=ds.get(A))&&(p=oe({},u),g(p,x)),r=r.ownerDocument||r,x=r.createElement("script"),Qt(x),oa(x,"link",p),r.head.appendChild(x),s.instance=x);case"void":return null;default:throw Error(D(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(p=s.instance,s.state.loading|=4,o(p,u.precedence,r));return s.instance}function o(r,s,u){for(var p=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),x=p.length?p[p.length-1]:null,A=x,G=0;G<p.length;G++){var ee=p[G];if(ee.dataset.precedence===s)A=ee;else if(A!==x)break}A?A.parentNode.insertBefore(r,A.nextSibling):(s=u.nodeType===9?u.head:u,s.insertBefore(r,s.firstChild))}function f(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function g(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var _=null;function v(r,s,u){if(_===null){var p=new Map,x=_=new Map;x.set(u,p)}else x=_,p=x.get(u),p||(p=new Map,x.set(u,p));if(p.has(r))return p;for(p.set(r,null),u=u.getElementsByTagName(r),x=0;x<u.length;x++){var A=u[x];if(!(A[Le]||A[ir]||r==="link"&&A.getAttribute("rel")==="stylesheet")&&A.namespaceURI!=="http://www.w3.org/2000/svg"){var G=A.getAttribute(s)||"";G=r+G;var ee=p.get(G);ee?ee.push(A):p.set(G,[A])}}return p}function T(r,s,u){r=r.ownerDocument||r,r.head.insertBefore(u,s==="title"?r.querySelector("head > title"):null)}function C(r,s,u){if(u===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return r=s.disabled,typeof s.precedence=="string"&&r==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function R(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}var L=null;function j(){}function q(r,s,u){if(L===null)throw Error(D(475));var p=L;if(s.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var x=lu(u.href),A=r.querySelector(Hu(x));if(A){r=A._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(p.count++,p=Y.bind(p),r.then(p,p)),s.state.loading|=4,s.instance=A,Qt(A);return}A=r.ownerDocument||r,u=Jf(u),(x=ds.get(x))&&f(u,x),A=A.createElement("link"),Qt(A);var G=A;G._p=new Promise(function(ee,Se){G.onload=ee,G.onerror=Se}),oa(A,"link",u),s.instance=A}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(s,r),(r=s.state.preload)&&(s.state.loading&3)===0&&(p.count++,s=Y.bind(p),r.addEventListener("load",s),r.addEventListener("error",s))}}function Z(){if(L===null)throw Error(D(475));var r=L;return r.stylesheets&&r.count===0&&fe(r,r.stylesheets),0<r.count?function(s){var u=setTimeout(function(){if(r.stylesheets&&fe(r,r.stylesheets),r.unsuspend){var p=r.unsuspend;r.unsuspend=null,p()}},6e4);return r.unsuspend=s,function(){r.unsuspend=null,clearTimeout(u)}}:null}function Y(){if(this.count--,this.count===0){if(this.stylesheets)fe(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var ne=null;function fe(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,ne=new Map,s.forEach(Ie,r),ne=null,Y.call(r))}function Ie(r,s){if(!(s.state.loading&4)){var u=ne.get(r);if(u)var p=u.get(null);else{u=new Map,ne.set(r,u);for(var x=r.querySelectorAll("link[data-precedence],style[data-precedence]"),A=0;A<x.length;A++){var G=x[A];(G.nodeName==="LINK"||G.getAttribute("media")!=="not all")&&(u.set(G.dataset.precedence,G),p=G)}p&&u.set(null,p)}x=s.instance,G=x.getAttribute("data-precedence"),A=u.get(G)||p,A===p&&u.set(null,x),u.set(G,x),this.count++,p=Y.bind(this),x.addEventListener("load",p),x.addEventListener("error",p),A?A.parentNode.insertBefore(x,A.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(x,r.firstChild)),s.state.loading|=4}}var ve={$$typeof:zt,Provider:null,Consumer:null,_currentValue:ot,_currentValue2:ot,_threadCount:0};function V(r,s,u,p,x,A,G,ee){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=re(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=re(0),this.hiddenUpdates=re(null),this.identifierPrefix=p,this.onUncaughtError=x,this.onCaughtError=A,this.onRecoverableError=G,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ee,this.incompleteTransitions=new Map}function te(r,s,u,p,x,A,G,ee,Se,et,Et,Ct){return r=new V(r,s,u,G,ee,Se,et,Ct),s=1,A===!0&&(s|=24),A=fa(3,null,null,s),r.current=A,A.stateNode=r,s=Co(),s.refCount++,r.pooledCache=s,s.refCount++,A.memoizedState={element:p,isDehydrated:u,cache:s},yc(A),r}function be(r){return r?(r=$s,r):$s}function Ke(r,s,u,p,x,A){x=be(x),p.context===null?p.context=x:p.pendingContext=x,p=Ds(s),p.payload={element:u},A=A===void 0?null:A,A!==null&&(p.callback=A),u=ss(r,p,s),u!==null&&(hs(u,r,s),eo(u,r,s))}function At(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var u=r.retryLane;r.retryLane=u!==0&&u<s?u:s}}function rt(r,s){At(r,s),(r=r.alternate)&&At(r,s)}function ht(r){if(r.tag===13){var s=il(r,67108864);s!==null&&hs(s,r,67108864),rt(r,67108864)}}var Lt=!0;function Dt(r,s,u,p){var x=Re.T;Re.T=null;var A=st.p;try{st.p=2,mt(r,s,u,p)}finally{st.p=A,Re.T=x}}function Ft(r,s,u,p){var x=Re.T;Re.T=null;var A=st.p;try{st.p=8,mt(r,s,u,p)}finally{st.p=A,Re.T=x}}function mt(r,s,u,p){if(Lt){var x=er(p);if(x===null)Lh(r,s,p,hr,u),Pn(r,p);else if(Hn(x,r,s,u,p))p.stopPropagation();else if(Pn(r,p),s&4&&-1<Ki.indexOf(r)){for(;x!==null;){var A=Jt(x);if(A!==null)switch(A.tag){case 3:if(A=A.stateNode,A.current.memoizedState.isDehydrated){var G=Ne(A.pendingLanes);if(G!==0){var ee=A;for(ee.pendingLanes|=2,ee.entangledLanes|=2;G;){var Se=1<<31-ii(G);ee.entanglements[1]|=Se,G&=~Se}Fs(A),(Li&6)===0&&(Af=_r()+500,Vu(0))}}break;case 13:ee=il(A,2),ee!==null&&hs(ee,A,2),sa(),rt(A,2)}if(A=er(p),A===null&&Lh(r,s,p,hr,u),A===x)break;x=A}x!==null&&p.stopPropagation()}else Lh(r,s,p,null,u)}}function er(r){return r=_s(r),cr(r)}var hr=null;function cr(r){if(hr=null,r=Nt(r),r!==null){var s=U(r);if(s===null)r=null;else{var u=s.tag;if(u===13){if(r=I(s),r!==null)return r;r=null}else if(u===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return hr=r,null}function or(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(xi()){case sn:return 2;case gi:return 8;case oi:case Ai:return 32;case Nr:return 268435456;default:return 32}default:return 32}}var Fr=!1,yi=null,Fi=null,an=null,ma=new Map,Zn=new Map,Qi=[],Ki="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Pn(r,s){switch(r){case"focusin":case"focusout":yi=null;break;case"dragenter":case"dragleave":Fi=null;break;case"mouseover":case"mouseout":an=null;break;case"pointerover":case"pointerout":ma.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zn.delete(s.pointerId)}}function Tn(r,s,u,p,x,A){return r===null||r.nativeEvent!==A?(r={blockedOn:s,domEventName:u,eventSystemFlags:p,nativeEvent:A,targetContainers:[x]},s!==null&&(s=Jt(s),s!==null&&ht(s)),r):(r.eventSystemFlags|=p,s=r.targetContainers,x!==null&&s.indexOf(x)===-1&&s.push(x),r)}function Hn(r,s,u,p,x){switch(s){case"focusin":return yi=Tn(yi,r,s,u,p,x),!0;case"dragenter":return Fi=Tn(Fi,r,s,u,p,x),!0;case"mouseover":return an=Tn(an,r,s,u,p,x),!0;case"pointerover":var A=x.pointerId;return ma.set(A,Tn(ma.get(A)||null,r,s,u,p,x)),!0;case"gotpointercapture":return A=x.pointerId,Zn.set(A,Tn(Zn.get(A)||null,r,s,u,p,x)),!0}return!1}function ga(r){var s=Nt(r.target);if(s!==null){var u=U(s);if(u!==null){if(s=u.tag,s===13){if(s=I(u),s!==null){r.blockedOn=s,Gt(r.priority,function(){if(u.tag===13){var p=Oa();p=je(p);var x=il(u,p);x!==null&&hs(x,u,p),rt(u,p)}});return}}else if(s===3&&u.stateNode.current.memoizedState.isDehydrated){r.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Ta(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var u=er(r.nativeEvent);if(u===null){u=r.nativeEvent;var p=new u.constructor(u.type,u);qs=p,u.target.dispatchEvent(p),qs=null}else return s=Jt(u),s!==null&&ht(s),r.blockedOn=u,!1;s.shift()}return!0}function Rn(r,s,u){Ta(r)&&u.delete(s)}function Na(){Fr=!1,yi!==null&&Ta(yi)&&(yi=null),Fi!==null&&Ta(Fi)&&(Fi=null),an!==null&&Ta(an)&&(an=null),ma.forEach(Rn),Zn.forEach(Rn)}function gn(r,s){r.blockedOn===s&&(r.blockedOn=null,Fr||(Fr=!0,w.unstable_scheduleCallback(w.unstable_NormalPriority,Na)))}var En=null;function zn(r){En!==r&&(En=r,w.unstable_scheduleCallback(w.unstable_NormalPriority,function(){En===r&&(En=null);for(var s=0;s<r.length;s+=3){var u=r[s],p=r[s+1],x=r[s+2];if(typeof p!="function"){if(cr(p||u)===null)continue;break}var A=Jt(u);A!==null&&(r.splice(s,3),s-=3,zs(A,{pending:!0,data:x,method:u.method,action:p},p,x))}}))}function Ji(r){function s(Se){return gn(Se,r)}yi!==null&&gn(yi,r),Fi!==null&&gn(Fi,r),an!==null&&gn(an,r),ma.forEach(s),Zn.forEach(s);for(var u=0;u<Qi.length;u++){var p=Qi[u];p.blockedOn===r&&(p.blockedOn=null)}for(;0<Qi.length&&(u=Qi[0],u.blockedOn===null);)ga(u),u.blockedOn===null&&Qi.shift();if(u=(r.ownerDocument||r).$$reactFormReplay,u!=null)for(p=0;p<u.length;p+=3){var x=u[p],A=u[p+1],G=x[k]||null;if(typeof A=="function")G||zn(u);else if(G){var ee=null;if(A&&A.hasAttribute("formAction")){if(x=A,G=A[k]||null)ee=G.formAction;else if(cr(x)!==null)continue}else ee=G.action;typeof ee=="function"?u[p+1]=ee:(u.splice(p,3),p-=3),zn(u)}}}function Ii(r){this._internalRoot=r}Qa.prototype.render=Ii.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(D(409));var u=s.current,p=Oa();Ke(u,p,r,s,null,null)},Qa.prototype.unmount=Ii.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;Ke(r.current,2,null,r,null,null),sa(),s[O]=null}};function Qa(r){this._internalRoot=r}Qa.prototype.unstable_scheduleHydration=function(r){if(r){var s=Ut();r={blockedOn:null,target:r,priority:s};for(var u=0;u<Qi.length&&s!==0&&s<Qi[u].priority;u++);Qi.splice(u,0,r),u===0&&ga(r)}};var $u=S.version;if($u!=="19.1.0")throw Error(D(527,$u,"19.1.0"));st.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(D(188)):(r=Object.keys(r).join(","),Error(D(268,r)));return r=J(s),r=r!==null?K(r):null,r=r===null?null:r.stateNode,r};var go={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:Re,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ed=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ed.isDisabled&&ed.supportsFiber)try{Vi=ed.inject(go),ri=ed}catch{}}return lp.createRoot=function(r,s){if(!B(r))throw Error(D(299));var u=!1,p="",x=wp,A=cf,G=bd,ee=null;return s!=null&&(s.unstable_strictMode===!0&&(u=!0),s.identifierPrefix!==void 0&&(p=s.identifierPrefix),s.onUncaughtError!==void 0&&(x=s.onUncaughtError),s.onCaughtError!==void 0&&(A=s.onCaughtError),s.onRecoverableError!==void 0&&(G=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(ee=s.unstable_transitionCallbacks)),s=te(r,1,!1,null,null,u,p,x,A,G,ee,null),r[O]=s.current,jf(r),new Ii(s)},lp.hydrateRoot=function(r,s,u){if(!B(r))throw Error(D(299));var p=!1,x="",A=wp,G=cf,ee=bd,Se=null,et=null;return u!=null&&(u.unstable_strictMode===!0&&(p=!0),u.identifierPrefix!==void 0&&(x=u.identifierPrefix),u.onUncaughtError!==void 0&&(A=u.onUncaughtError),u.onCaughtError!==void 0&&(G=u.onCaughtError),u.onRecoverableError!==void 0&&(ee=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(Se=u.unstable_transitionCallbacks),u.formState!==void 0&&(et=u.formState)),s=te(r,1,!0,s,u??null,p,x,A,G,ee,Se,et),s.context=be(null),u=s.current,p=Oa(),p=je(p),x=Ds(p),x.callback=null,ss(u,x,p),u=p,s.current.lanes=u,Ze(s,u),Fs(s),r[O]=s.current,jf(r),new Qa(s)},lp.version="19.1.0",lp}var Eg;function U_(){if(Eg)return Bm.exports;Eg=1;function w(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(w)}catch(S){console.error(S)}}return w(),Bm.exports=j_(),Bm.exports}var V_=U_();const q_=vp(V_);a_();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _p(){return _p=Object.assign?Object.assign.bind():function(w){for(var S=1;S<arguments.length;S++){var M=arguments[S];for(var D in M)Object.prototype.hasOwnProperty.call(M,D)&&(w[D]=M[D])}return w},_p.apply(this,arguments)}var $c;(function(w){w.Pop="POP",w.Push="PUSH",w.Replace="REPLACE"})($c||($c={}));const Sg="popstate";function G_(w){w===void 0&&(w={});function S(D,B){let{pathname:U,search:I,hash:c}=D.location;return Xm("",{pathname:U,search:I,hash:c},B.state&&B.state.usr||null,B.state&&B.state.key||"default")}function M(D,B){return typeof B=="string"?B:um(B)}return H_(S,M,null,w)}function $n(w,S){if(w===!1||w===null||typeof w>"u")throw new Error(S)}function s_(w,S){if(!w){typeof console<"u"&&console.warn(S);try{throw new Error(S)}catch{}}}function Z_(){return Math.random().toString(36).substr(2,8)}function Ag(w,S){return{usr:w.state,key:w.key,idx:S}}function Xm(w,S,M,D){return M===void 0&&(M=null),_p({pathname:typeof w=="string"?w:w.pathname,search:"",hash:""},typeof S=="string"?ld(S):S,{state:M,key:S&&S.key||D||Z_()})}function um(w){let{pathname:S="/",search:M="",hash:D=""}=w;return M&&M!=="?"&&(S+=M.charAt(0)==="?"?M:"?"+M),D&&D!=="#"&&(S+=D.charAt(0)==="#"?D:"#"+D),S}function ld(w){let S={};if(w){let M=w.indexOf("#");M>=0&&(S.hash=w.substr(M),w=w.substr(0,M));let D=w.indexOf("?");D>=0&&(S.search=w.substr(D),w=w.substr(0,D)),w&&(S.pathname=w)}return S}function H_(w,S,M,D){D===void 0&&(D={});let{window:B=document.defaultView,v5Compat:U=!1}=D,I=B.history,c=$c.Pop,J=null,K=oe();K==null&&(K=0,I.replaceState(_p({},I.state,{idx:K}),""));function oe(){return(I.state||{idx:null}).idx}function X(){c=$c.Pop;let at=oe(),ft=at==null?null:at-K;K=at,J&&J({action:c,location:qe.location,delta:ft})}function _e(at,ft){c=$c.Push;let pt=Xm(qe.location,at,ft);K=oe()+1;let zt=Ag(pt,K),Rt=qe.createHref(pt);try{I.pushState(zt,"",Rt)}catch(Ge){if(Ge instanceof DOMException&&Ge.name==="DataCloneError")throw Ge;B.location.assign(Rt)}U&&J&&J({action:c,location:qe.location,delta:1})}function se(at,ft){c=$c.Replace;let pt=Xm(qe.location,at,ft);K=oe();let zt=Ag(pt,K),Rt=qe.createHref(pt);I.replaceState(zt,"",Rt),U&&J&&J({action:c,location:qe.location,delta:0})}function Me(at){let ft=B.location.origin!=="null"?B.location.origin:B.location.href,pt=typeof at=="string"?at:um(at);return pt=pt.replace(/ $/,"%20"),$n(ft,"No window.location.(origin|href) available to create URL for href: "+pt),new URL(pt,ft)}let qe={get action(){return c},get location(){return w(B,I)},listen(at){if(J)throw new Error("A history only accepts one active listener");return B.addEventListener(Sg,X),J=at,()=>{B.removeEventListener(Sg,X),J=null}},createHref(at){return S(B,at)},createURL:Me,encodeLocation(at){let ft=Me(at);return{pathname:ft.pathname,search:ft.search,hash:ft.hash}},push:_e,replace:se,go(at){return I.go(at)}};return qe}var Cg;(function(w){w.data="data",w.deferred="deferred",w.redirect="redirect",w.error="error"})(Cg||(Cg={}));function $_(w,S,M){return M===void 0&&(M="/"),X_(w,S,M)}function X_(w,S,M,D){let B=typeof S=="string"?ld(S):S,U=eg(B.pathname||"/",M);if(U==null)return null;let I=o_(w);Y_(I);let c=null;for(let J=0;c==null&&J<I.length;++J){let K=oy(U);c=ny(I[J],K)}return c}function o_(w,S,M,D){S===void 0&&(S=[]),M===void 0&&(M=[]),D===void 0&&(D="");let B=(U,I,c)=>{let J={relativePath:c===void 0?U.path||"":c,caseSensitive:U.caseSensitive===!0,childrenIndex:I,route:U};J.relativePath.startsWith("/")&&($n(J.relativePath.startsWith(D),'Absolute route path "'+J.relativePath+'" nested under path '+('"'+D+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),J.relativePath=J.relativePath.slice(D.length));let K=Xc([D,J.relativePath]),oe=M.concat(J);U.children&&U.children.length>0&&($n(U.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+K+'".')),o_(U.children,S,oe,K)),!(U.path==null&&!U.index)&&S.push({path:K,score:ry(K,U.index),routesMeta:oe})};return w.forEach((U,I)=>{var c;if(U.path===""||!((c=U.path)!=null&&c.includes("?")))B(U,I);else for(let J of l_(U.path))B(U,I,J)}),S}function l_(w){let S=w.split("/");if(S.length===0)return[];let[M,...D]=S,B=M.endsWith("?"),U=M.replace(/\?$/,"");if(D.length===0)return B?[U,""]:[U];let I=l_(D.join("/")),c=[];return c.push(...I.map(J=>J===""?U:[U,J].join("/"))),B&&c.push(...I),c.map(J=>w.startsWith("/")&&J===""?"/":J)}function Y_(w){w.sort((S,M)=>S.score!==M.score?M.score-S.score:iy(S.routesMeta.map(D=>D.childrenIndex),M.routesMeta.map(D=>D.childrenIndex)))}const W_=/^:[\w-]+$/,Q_=3,K_=2,J_=1,ey=10,ty=-2,Mg=w=>w==="*";function ry(w,S){let M=w.split("/"),D=M.length;return M.some(Mg)&&(D+=ty),S&&(D+=K_),M.filter(B=>!Mg(B)).reduce((B,U)=>B+(W_.test(U)?Q_:U===""?J_:ey),D)}function iy(w,S){return w.length===S.length&&w.slice(0,-1).every((D,B)=>D===S[B])?w[w.length-1]-S[S.length-1]:0}function ny(w,S,M){let{routesMeta:D}=w,B={},U="/",I=[];for(let c=0;c<D.length;++c){let J=D[c],K=c===D.length-1,oe=U==="/"?S:S.slice(U.length)||"/",X=ay({path:J.relativePath,caseSensitive:J.caseSensitive,end:K},oe),_e=J.route;if(!X)return null;Object.assign(B,X.params),I.push({params:B,pathname:Xc([U,X.pathname]),pathnameBase:hy(Xc([U,X.pathnameBase])),route:_e}),X.pathnameBase!=="/"&&(U=Xc([U,X.pathnameBase]))}return I}function ay(w,S){typeof w=="string"&&(w={path:w,caseSensitive:!1,end:!0});let[M,D]=sy(w.path,w.caseSensitive,w.end),B=S.match(M);if(!B)return null;let U=B[0],I=U.replace(/(.)\/+$/,"$1"),c=B.slice(1);return{params:D.reduce((K,oe,X)=>{let{paramName:_e,isOptional:se}=oe;if(_e==="*"){let qe=c[X]||"";I=U.slice(0,U.length-qe.length).replace(/(.)\/+$/,"$1")}const Me=c[X];return se&&!Me?K[_e]=void 0:K[_e]=(Me||"").replace(/%2F/g,"/"),K},{}),pathname:U,pathnameBase:I,pattern:w}}function sy(w,S,M){S===void 0&&(S=!1),M===void 0&&(M=!0),s_(w==="*"||!w.endsWith("*")||w.endsWith("/*"),'Route path "'+w+'" will be treated as if it were '+('"'+w.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+w.replace(/\*$/,"/*")+'".'));let D=[],B="^"+w.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(I,c,J)=>(D.push({paramName:c,isOptional:J!=null}),J?"/?([^\\/]+)?":"/([^\\/]+)"));return w.endsWith("*")?(D.push({paramName:"*"}),B+=w==="*"||w==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):M?B+="\\/*$":w!==""&&w!=="/"&&(B+="(?:(?=\\/|$))"),[new RegExp(B,S?void 0:"i"),D]}function oy(w){try{return w.split("/").map(S=>decodeURIComponent(S).replace(/\//g,"%2F")).join("/")}catch(S){return s_(!1,'The URL path "'+w+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+S+").")),w}}function eg(w,S){if(S==="/")return w;if(!w.toLowerCase().startsWith(S.toLowerCase()))return null;let M=S.endsWith("/")?S.length-1:S.length,D=w.charAt(M);return D&&D!=="/"?null:w.slice(M)||"/"}function ly(w,S){S===void 0&&(S="/");let{pathname:M,search:D="",hash:B=""}=typeof w=="string"?ld(w):w;return{pathname:M?M.startsWith("/")?M:uy(M,S):S,search:fy(D),hash:dy(B)}}function uy(w,S){let M=S.replace(/\/+$/,"").split("/");return w.split("/").forEach(B=>{B===".."?M.length>1&&M.pop():B!=="."&&M.push(B)}),M.length>1?M.join("/"):"/"}function jm(w,S,M,D){return"Cannot include a '"+w+"' character in a manually specified "+("`to."+S+"` field ["+JSON.stringify(D)+"].  Please separate it out to the ")+("`to."+M+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function cy(w){return w.filter((S,M)=>M===0||S.route.path&&S.route.path.length>0)}function tg(w,S){let M=cy(w);return S?M.map((D,B)=>B===M.length-1?D.pathname:D.pathnameBase):M.map(D=>D.pathnameBase)}function rg(w,S,M,D){D===void 0&&(D=!1);let B;typeof w=="string"?B=ld(w):(B=_p({},w),$n(!B.pathname||!B.pathname.includes("?"),jm("?","pathname","search",B)),$n(!B.pathname||!B.pathname.includes("#"),jm("#","pathname","hash",B)),$n(!B.search||!B.search.includes("#"),jm("#","search","hash",B)));let U=w===""||B.pathname==="",I=U?"/":B.pathname,c;if(I==null)c=M;else{let X=S.length-1;if(!D&&I.startsWith("..")){let _e=I.split("/");for(;_e[0]==="..";)_e.shift(),X-=1;B.pathname=_e.join("/")}c=X>=0?S[X]:"/"}let J=ly(B,c),K=I&&I!=="/"&&I.endsWith("/"),oe=(U||I===".")&&M.endsWith("/");return!J.pathname.endsWith("/")&&(K||oe)&&(J.pathname+="/"),J}const Xc=w=>w.join("/").replace(/\/\/+/g,"/"),hy=w=>w.replace(/\/+$/,"").replace(/^\/*/,"/"),fy=w=>!w||w==="?"?"":w.startsWith("?")?w:"?"+w,dy=w=>!w||w==="#"?"":w.startsWith("#")?w:"#"+w;function py(w){return w!=null&&typeof w.status=="number"&&typeof w.statusText=="string"&&typeof w.internal=="boolean"&&"data"in w}const u_=["post","put","patch","delete"];new Set(u_);const my=["get",...u_];new Set(my);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yp(){return yp=Object.assign?Object.assign.bind():function(w){for(var S=1;S<arguments.length;S++){var M=arguments[S];for(var D in M)Object.prototype.hasOwnProperty.call(M,D)&&(w[D]=M[D])}return w},yp.apply(this,arguments)}const ig=xt.createContext(null),gy=xt.createContext(null),Wc=xt.createContext(null),ym=xt.createContext(null),Qc=xt.createContext({outlet:null,matches:[],isDataRoute:!1}),c_=xt.createContext(null);function _y(w,S){let{relative:M}=S===void 0?{}:S;ud()||$n(!1);let{basename:D,navigator:B}=xt.useContext(Wc),{hash:U,pathname:I,search:c}=f_(w,{relative:M}),J=I;return D!=="/"&&(J=I==="/"?D:Xc([D,I])),B.createHref({pathname:J,search:c,hash:U})}function ud(){return xt.useContext(ym)!=null}function xp(){return ud()||$n(!1),xt.useContext(ym).location}function h_(w){xt.useContext(Wc).static||xt.useLayoutEffect(w)}function cd(){let{isDataRoute:w}=xt.useContext(Qc);return w?Iy():yy()}function yy(){ud()||$n(!1);let w=xt.useContext(ig),{basename:S,future:M,navigator:D}=xt.useContext(Wc),{matches:B}=xt.useContext(Qc),{pathname:U}=xp(),I=JSON.stringify(tg(B,M.v7_relativeSplatPath)),c=xt.useRef(!1);return h_(()=>{c.current=!0}),xt.useCallback(function(K,oe){if(oe===void 0&&(oe={}),!c.current)return;if(typeof K=="number"){D.go(K);return}let X=rg(K,JSON.parse(I),U,oe.relative==="path");w==null&&S!=="/"&&(X.pathname=X.pathname==="/"?S:Xc([S,X.pathname])),(oe.replace?D.replace:D.push)(X,oe.state,oe)},[S,D,I,U,w])}function f_(w,S){let{relative:M}=S===void 0?{}:S,{future:D}=xt.useContext(Wc),{matches:B}=xt.useContext(Qc),{pathname:U}=xp(),I=JSON.stringify(tg(B,D.v7_relativeSplatPath));return xt.useMemo(()=>rg(w,JSON.parse(I),U,M==="path"),[w,I,U,M])}function vy(w,S){return xy(w,S)}function xy(w,S,M,D){ud()||$n(!1);let{navigator:B}=xt.useContext(Wc),{matches:U}=xt.useContext(Qc),I=U[U.length-1],c=I?I.params:{};I&&I.pathname;let J=I?I.pathnameBase:"/";I&&I.route;let K=xp(),oe;if(S){var X;let at=typeof S=="string"?ld(S):S;J==="/"||(X=at.pathname)!=null&&X.startsWith(J)||$n(!1),oe=at}else oe=K;let _e=oe.pathname||"/",se=_e;if(J!=="/"){let at=J.replace(/^\//,"").split("/");se="/"+_e.replace(/^\//,"").split("/").slice(at.length).join("/")}let Me=$_(w,{pathname:se}),qe=Sy(Me&&Me.map(at=>Object.assign({},at,{params:Object.assign({},c,at.params),pathname:Xc([J,B.encodeLocation?B.encodeLocation(at.pathname).pathname:at.pathname]),pathnameBase:at.pathnameBase==="/"?J:Xc([J,B.encodeLocation?B.encodeLocation(at.pathnameBase).pathname:at.pathnameBase])})),U,M,D);return S&&qe?xt.createElement(ym.Provider,{value:{location:yp({pathname:"/",search:"",hash:"",state:null,key:"default"},oe),navigationType:$c.Pop}},qe):qe}function by(){let w=Dy(),S=py(w)?w.status+" "+w.statusText:w instanceof Error?w.message:JSON.stringify(w),M=w instanceof Error?w.stack:null,B={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return xt.createElement(xt.Fragment,null,xt.createElement("h2",null,"Unexpected Application Error!"),xt.createElement("h3",{style:{fontStyle:"italic"}},S),M?xt.createElement("pre",{style:B},M):null,null)}const wy=xt.createElement(by,null);class Ty extends xt.Component{constructor(S){super(S),this.state={location:S.location,revalidation:S.revalidation,error:S.error}}static getDerivedStateFromError(S){return{error:S}}static getDerivedStateFromProps(S,M){return M.location!==S.location||M.revalidation!=="idle"&&S.revalidation==="idle"?{error:S.error,location:S.location,revalidation:S.revalidation}:{error:S.error!==void 0?S.error:M.error,location:M.location,revalidation:S.revalidation||M.revalidation}}componentDidCatch(S,M){console.error("React Router caught the following error during render",S,M)}render(){return this.state.error!==void 0?xt.createElement(Qc.Provider,{value:this.props.routeContext},xt.createElement(c_.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Ey(w){let{routeContext:S,match:M,children:D}=w,B=xt.useContext(ig);return B&&B.static&&B.staticContext&&(M.route.errorElement||M.route.ErrorBoundary)&&(B.staticContext._deepestRenderedBoundaryId=M.route.id),xt.createElement(Qc.Provider,{value:S},D)}function Sy(w,S,M,D){var B;if(S===void 0&&(S=[]),M===void 0&&(M=null),D===void 0&&(D=null),w==null){var U;if(!M)return null;if(M.errors)w=M.matches;else if((U=D)!=null&&U.v7_partialHydration&&S.length===0&&!M.initialized&&M.matches.length>0)w=M.matches;else return null}let I=w,c=(B=M)==null?void 0:B.errors;if(c!=null){let oe=I.findIndex(X=>X.route.id&&(c==null?void 0:c[X.route.id])!==void 0);oe>=0||$n(!1),I=I.slice(0,Math.min(I.length,oe+1))}let J=!1,K=-1;if(M&&D&&D.v7_partialHydration)for(let oe=0;oe<I.length;oe++){let X=I[oe];if((X.route.HydrateFallback||X.route.hydrateFallbackElement)&&(K=oe),X.route.id){let{loaderData:_e,errors:se}=M,Me=X.route.loader&&_e[X.route.id]===void 0&&(!se||se[X.route.id]===void 0);if(X.route.lazy||Me){J=!0,K>=0?I=I.slice(0,K+1):I=[I[0]];break}}}return I.reduceRight((oe,X,_e)=>{let se,Me=!1,qe=null,at=null;M&&(se=c&&X.route.id?c[X.route.id]:void 0,qe=X.route.errorElement||wy,J&&(K<0&&_e===0?(Py("route-fallback"),Me=!0,at=null):K===_e&&(Me=!0,at=X.route.hydrateFallbackElement||null)));let ft=S.concat(I.slice(0,_e+1)),pt=()=>{let zt;return se?zt=qe:Me?zt=at:X.route.Component?zt=xt.createElement(X.route.Component,null):X.route.element?zt=X.route.element:zt=oe,xt.createElement(Ey,{match:X,routeContext:{outlet:oe,matches:ft,isDataRoute:M!=null},children:zt})};return M&&(X.route.ErrorBoundary||X.route.errorElement||_e===0)?xt.createElement(Ty,{location:M.location,revalidation:M.revalidation,component:qe,error:se,children:pt(),routeContext:{outlet:null,matches:ft,isDataRoute:!0}}):pt()},null)}var d_=function(w){return w.UseBlocker="useBlocker",w.UseRevalidator="useRevalidator",w.UseNavigateStable="useNavigate",w}(d_||{}),p_=function(w){return w.UseBlocker="useBlocker",w.UseLoaderData="useLoaderData",w.UseActionData="useActionData",w.UseRouteError="useRouteError",w.UseNavigation="useNavigation",w.UseRouteLoaderData="useRouteLoaderData",w.UseMatches="useMatches",w.UseRevalidator="useRevalidator",w.UseNavigateStable="useNavigate",w.UseRouteId="useRouteId",w}(p_||{});function Ay(w){let S=xt.useContext(ig);return S||$n(!1),S}function Cy(w){let S=xt.useContext(gy);return S||$n(!1),S}function My(w){let S=xt.useContext(Qc);return S||$n(!1),S}function m_(w){let S=My(),M=S.matches[S.matches.length-1];return M.route.id||$n(!1),M.route.id}function Dy(){var w;let S=xt.useContext(c_),M=Cy(),D=m_();return S!==void 0?S:(w=M.errors)==null?void 0:w[D]}function Iy(){let{router:w}=Ay(d_.UseNavigateStable),S=m_(p_.UseNavigateStable),M=xt.useRef(!1);return h_(()=>{M.current=!0}),xt.useCallback(function(B,U){U===void 0&&(U={}),M.current&&(typeof B=="number"?w.navigate(B):w.navigate(B,yp({fromRouteId:S},U)))},[w,S])}const Dg={};function Py(w,S,M){Dg[w]||(Dg[w]=!0)}function Ry(w,S){w==null||w.v7_startTransition,w==null||w.v7_relativeSplatPath}function fp(w){let{to:S,replace:M,state:D,relative:B}=w;ud()||$n(!1);let{future:U,static:I}=xt.useContext(Wc),{matches:c}=xt.useContext(Qc),{pathname:J}=xp(),K=cd(),oe=rg(S,tg(c,U.v7_relativeSplatPath),J,B==="path"),X=JSON.stringify(oe);return xt.useEffect(()=>K(JSON.parse(X),{replace:M,state:D,relative:B}),[K,X,B,M,D]),null}function qh(w){$n(!1)}function zy(w){let{basename:S="/",children:M=null,location:D,navigationType:B=$c.Pop,navigator:U,static:I=!1,future:c}=w;ud()&&$n(!1);let J=S.replace(/^\/*/,"/"),K=xt.useMemo(()=>({basename:J,navigator:U,static:I,future:yp({v7_relativeSplatPath:!1},c)}),[J,c,U,I]);typeof D=="string"&&(D=ld(D));let{pathname:oe="/",search:X="",hash:_e="",state:se=null,key:Me="default"}=D,qe=xt.useMemo(()=>{let at=eg(oe,J);return at==null?null:{location:{pathname:at,search:X,hash:_e,state:se,key:Me},navigationType:B}},[J,oe,X,_e,se,Me,B]);return qe==null?null:xt.createElement(Wc.Provider,{value:K},xt.createElement(ym.Provider,{children:M,value:qe}))}function Ly(w){let{children:S,location:M}=w;return vy(Ym(S),M)}new Promise(()=>{});function Ym(w,S){S===void 0&&(S=[]);let M=[];return xt.Children.forEach(w,(D,B)=>{if(!xt.isValidElement(D))return;let U=[...S,B];if(D.type===xt.Fragment){M.push.apply(M,Ym(D.props.children,U));return}D.type!==qh&&$n(!1),!D.props.index||!D.props.children||$n(!1);let I={id:D.props.id||U.join("-"),caseSensitive:D.props.caseSensitive,element:D.props.element,Component:D.props.Component,index:D.props.index,path:D.props.path,loader:D.props.loader,action:D.props.action,errorElement:D.props.errorElement,ErrorBoundary:D.props.ErrorBoundary,hasErrorBoundary:D.props.ErrorBoundary!=null||D.props.errorElement!=null,shouldRevalidate:D.props.shouldRevalidate,handle:D.props.handle,lazy:D.props.lazy};D.props.children&&(I.children=Ym(D.props.children,U)),M.push(I)}),M}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Wm(){return Wm=Object.assign?Object.assign.bind():function(w){for(var S=1;S<arguments.length;S++){var M=arguments[S];for(var D in M)Object.prototype.hasOwnProperty.call(M,D)&&(w[D]=M[D])}return w},Wm.apply(this,arguments)}function ky(w,S){if(w==null)return{};var M={},D=Object.keys(w),B,U;for(U=0;U<D.length;U++)B=D[U],!(S.indexOf(B)>=0)&&(M[B]=w[B]);return M}function By(w){return!!(w.metaKey||w.altKey||w.ctrlKey||w.shiftKey)}function Oy(w,S){return w.button===0&&(!S||S==="_self")&&!By(w)}const Ny=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Fy="6";try{window.__reactRouterVersion=Fy}catch{}const jy="startTransition",Ig=B_[jy];function Uy(w){let{basename:S,children:M,future:D,window:B}=w,U=xt.useRef();U.current==null&&(U.current=G_({window:B,v5Compat:!0}));let I=U.current,[c,J]=xt.useState({action:I.action,location:I.location}),{v7_startTransition:K}=D||{},oe=xt.useCallback(X=>{K&&Ig?Ig(()=>J(X)):J(X)},[J,K]);return xt.useLayoutEffect(()=>I.listen(oe),[I,oe]),xt.useEffect(()=>Ry(D),[D]),xt.createElement(zy,{basename:S,children:M,location:c.location,navigationType:c.action,navigator:I,future:D})}const Vy=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",qy=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,cm=xt.forwardRef(function(S,M){let{onClick:D,relative:B,reloadDocument:U,replace:I,state:c,target:J,to:K,preventScrollReset:oe,viewTransition:X}=S,_e=ky(S,Ny),{basename:se}=xt.useContext(Wc),Me,qe=!1;if(typeof K=="string"&&qy.test(K)&&(Me=K,Vy))try{let zt=new URL(window.location.href),Rt=K.startsWith("//")?new URL(zt.protocol+K):new URL(K),Ge=eg(Rt.pathname,se);Rt.origin===zt.origin&&Ge!=null?K=Ge+Rt.search+Rt.hash:qe=!0}catch{}let at=_y(K,{relative:B}),ft=Gy(K,{replace:I,state:c,target:J,preventScrollReset:oe,relative:B,viewTransition:X});function pt(zt){D&&D(zt),zt.defaultPrevented||ft(zt)}return xt.createElement("a",Wm({},_e,{href:Me||at,onClick:qe||U?D:pt,ref:M,target:J}))});var Pg;(function(w){w.UseScrollRestoration="useScrollRestoration",w.UseSubmit="useSubmit",w.UseSubmitFetcher="useSubmitFetcher",w.UseFetcher="useFetcher",w.useViewTransitionState="useViewTransitionState"})(Pg||(Pg={}));var Rg;(function(w){w.UseFetcher="useFetcher",w.UseFetchers="useFetchers",w.UseScrollRestoration="useScrollRestoration"})(Rg||(Rg={}));function Gy(w,S){let{target:M,replace:D,state:B,preventScrollReset:U,relative:I,viewTransition:c}=S===void 0?{}:S,J=cd(),K=xp(),oe=f_(w,{relative:I});return xt.useCallback(X=>{if(Oy(X,M)){X.preventDefault();let _e=D!==void 0?D:um(K)===um(oe);J(w,{replace:_e,state:B,preventScrollReset:U,relative:I,viewTransition:c})}},[K,J,oe,D,B,M,w,U,I,c])}function Zy({onLogin:w}){const[S,M]=xt.useState(""),[D,B]=xt.useState(""),[U,I]=xt.useState(null),[c,J]=xt.useState(!1),K=cd();async function oe(X){X.preventDefault(),J(!0),I(null);try{const _e=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:S.trim(),password:D})}),se=await _e.json();if(!_e.ok)throw new Error(se.error||"Login failed");const{token:Me}=se;localStorage.setItem("authToken",Me),localStorage.setItem("userEmail",S.trim()),w&&w(Me),K("/dashboard",{replace:!0})}catch(_e){I(_e.message)}finally{J(!1)}}return ge.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:ge.jsxs("div",{className:"w-full max-w-md p-6 bg-white rounded-lg shadow-md",children:[ge.jsx("h2",{className:"text-2xl font-semibold mb-4 text-center text-green-700",children:"Sign In"}),U&&ge.jsx("div",{className:"mb-4 text-center text-red-600",children:U}),ge.jsxs("form",{onSubmit:oe,className:"space-y-4",children:[ge.jsxs("div",{children:[ge.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),ge.jsx("input",{id:"email",type:"email",required:!0,value:S,onChange:X=>M(X.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500"})]}),ge.jsxs("div",{children:[ge.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),ge.jsx("input",{id:"password",type:"password",required:!0,minLength:6,value:D,onChange:X=>B(X.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500"})]}),ge.jsx("div",{className:"text-right",children:ge.jsx(cm,{to:"/reset-password",className:"text-sm text-green-600 hover:underline",children:"Forgot password?"})}),ge.jsx("button",{type:"submit",disabled:c,className:`w-full py-2 rounded-lg text-white font-semibold ${c?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:c?"Signing in":"Sign In"})]}),ge.jsxs("p",{className:"mt-4 text-center text-sm text-gray-600",children:["Dont have an account?"," ",ge.jsx(cm,{to:"/signup",className:"text-green-600 hover:underline",children:"Sign Up"})]})]})})}function Hy(){const[w,S]=xt.useState(""),[M,D]=xt.useState(""),[B,U]=xt.useState(null),[I,c]=xt.useState(null),[J,K]=xt.useState(!1),oe=cd();async function X(_e){_e.preventDefault(),K(!0),U(null),c(null);try{const se=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:w.trim(),password:M})}),Me=await se.json();if(!se.ok)throw new Error(Me.error||"Sign up failed");c("Account created! Redirecting to login"),setTimeout(()=>{oe("/login",{replace:!0})},1500)}catch(se){U(se.message)}finally{K(!1)}}return ge.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:ge.jsxs("div",{className:"w-full max-w-md p-6 bg-white rounded-lg shadow-md",children:[ge.jsx("h2",{className:"text-2xl font-semibold mb-4 text-center text-green-700",children:"Sign Up"}),B&&ge.jsx("div",{className:"mb-4 text-center text-red-600",children:B}),I&&ge.jsx("div",{className:"mb-4 text-center text-green-600",children:I}),ge.jsxs("form",{onSubmit:X,className:"space-y-4",children:[ge.jsxs("div",{children:[ge.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),ge.jsx("input",{id:"email",type:"email",required:!0,value:w,onChange:_e=>S(_e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500"})]}),ge.jsxs("div",{children:[ge.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),ge.jsx("input",{id:"password",type:"password",required:!0,minLength:6,value:M,onChange:_e=>D(_e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500"})]}),ge.jsx("button",{type:"submit",disabled:J,className:`w-full py-2 rounded-lg text-white font-semibold ${J?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:J?"Signing up":"Create Account"})]}),ge.jsxs("p",{className:"mt-4 text-center text-sm text-gray-600",children:["Already have an account?"," ",ge.jsx(cm,{to:"/login",className:"text-green-600 hover:underline",children:"Sign In"})]})]})})}function $y(){const[w,S]=xt.useState(""),[M,D]=xt.useState(""),[B,U]=xt.useState(""),[I,c]=xt.useState(null),[J,K]=xt.useState(null),[oe,X]=xt.useState(!1),_e=cd();async function se(Me){Me.preventDefault(),X(!0),c(null),K(null);try{const qe=await fetch("/api/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:w.trim(),resetKey:M.trim(),newPassword:B})}),at=await qe.json();if(!qe.ok)throw new Error(at.error||"Reset failed");K(`Password changed successfully! Your new reset key is:

`+at.newResetKey),X(!1),setTimeout(()=>{_e("/login",{replace:!0})},3e3)}catch(qe){c(qe.message),X(!1)}}return ge.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:ge.jsxs("div",{className:"w-full max-w-md p-6 bg-white rounded-lg shadow-md",children:[ge.jsx("h2",{className:"text-2xl font-semibold mb-4 text-center text-green-700",children:"Reset Password"}),I&&ge.jsx("div",{className:"mb-4 text-center text-red-600",children:I}),J&&ge.jsx("div",{className:"mb-4 whitespace-pre-wrap text-center text-green-600",children:J}),ge.jsxs("form",{onSubmit:se,className:"space-y-4",children:[ge.jsxs("div",{children:[ge.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),ge.jsx("input",{id:"email",type:"email",required:!0,value:w,onChange:Me=>S(Me.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500"})]}),ge.jsxs("div",{children:[ge.jsx("label",{htmlFor:"resetKey",className:"block text-sm font-medium text-gray-700",children:"Reset Key"}),ge.jsx("input",{id:"resetKey",type:"text",required:!0,value:M,onChange:Me=>D(Me.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500"})]}),ge.jsxs("div",{children:[ge.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700",children:"New Password"}),ge.jsx("input",{id:"newPassword",type:"password",required:!0,minLength:6,value:B,onChange:Me=>U(Me.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500"})]}),ge.jsx("button",{type:"submit",disabled:oe,className:`w-full py-2 rounded-lg text-white font-semibold ${oe?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:oe?"Resetting":"Reset Password"})]}),ge.jsxs("p",{className:"mt-4 text-center text-sm text-gray-600",children:["Remembered your password?"," ",ge.jsx(cm,{to:"/login",className:"text-green-600 hover:underline",children:"Sign In"})]})]})})}const Xy="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Yy=(w=21)=>{let S="",M=crypto.getRandomValues(new Uint8Array(w|=0));for(;w--;)S+=Xy[M[w]&63];return S};var om={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.5.0/LICENSE.txt
 */var Wy=om.exports,zg;function Qy(){return zg||(zg=1,function(w,S){(function(M,D){w.exports=D()})(Wy,function(){var M={},D={};function B(I,c,J){if(D[I]=J,I==="index"){var K="var sharedModule = {}; ("+D.shared+")(sharedModule); ("+D.worker+")(sharedModule);",oe={};return D.shared(oe),D.index(M,oe),typeof window<"u"&&M.setWorkerUrl(window.URL.createObjectURL(new Blob([K],{type:"text/javascript"}))),M}}B("shared",["exports"],function(I){function c(a,t,n,o){return new(n||(n=Promise))(function(f,g){function _(C){try{T(o.next(C))}catch(R){g(R)}}function v(C){try{T(o.throw(C))}catch(R){g(R)}}function T(C){var R;C.done?f(C.value):(R=C.value,R instanceof n?R:new n(function(L){L(R)})).then(_,v)}T((o=o.apply(a,t||[])).next())})}function J(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var K,oe;function X(){if(oe)return K;function a(t,n){this.x=t,this.y=n}return oe=1,K=a,a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,n){return this.clone()._rotateAround(t,n)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,o=t.y-this.y;return n*n+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},_matMult:function(t){var n=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var n=Math.cos(t),o=Math.sin(t),f=o*this.x+n*this.y;return this.x=n*this.x-o*this.y,this.y=f,this},_rotateAround:function(t,n){var o=Math.cos(t),f=Math.sin(t),g=n.y+f*(this.x-n.x)+o*(this.y-n.y);return this.x=n.x+o*(this.x-n.x)-f*(this.y-n.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t},K}typeof SuppressedError=="function"&&SuppressedError;var _e,se,Me=J(X()),qe=function(){if(se)return _e;function a(t,n,o,f){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=f}return se=1,_e=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,f=0;f<8;f++){var g=this.sampleCurveX(o)-t;if(Math.abs(g)<n)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=g/_}var v=0,T=1;for(o=t,f=0;f<20&&(g=this.sampleCurveX(o),!(Math.abs(g-t)<n));f++)t>g?v=o:T=o,o=.5*(T-v)+v;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},_e}(),at=J(qe);let ft,pt;function zt(){return ft==null&&(ft=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ft}function Rt(){if(pt==null&&(pt=!1,zt())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const f=4*o;t.fillStyle=`rgb(${f},${f+1},${f+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){pt=!0;break}}}return pt||!1}var Ge=1e-6,Pe=typeof Float32Array<"u"?Float32Array:Array;function gt(){var a=new Pe(9);return Pe!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function bt(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Yt(){var a=new Pe(3);return Pe!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function nr(a){return Math.hypot(a[0],a[1],a[2])}function lr(a,t,n){var o=new Pe(3);return o[0]=a,o[1]=t,o[2]=n,o}Math.hypot||(Math.hypot=function(){for(var a=0,t=arguments.length;t--;)a+=arguments[t]*arguments[t];return Math.sqrt(a)});var dr,Kt=nr;function xr(a,t,n){var o=t[0],f=t[1],g=t[2],_=t[3];return a[0]=n[0]*o+n[4]*f+n[8]*g+n[12]*_,a[1]=n[1]*o+n[5]*f+n[9]*g+n[13]*_,a[2]=n[2]*o+n[6]*f+n[10]*g+n[14]*_,a[3]=n[3]*o+n[7]*f+n[11]*g+n[15]*_,a}function tt(){var a=new Pe(4);return Pe!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Re(){var a=new Pe(2);return Pe!=Float32Array&&(a[0]=0,a[1]=0),a}function st(a,t){var n=new Pe(2);return n[0]=a,n[1]=t,n}Yt(),dr=new Pe(4),Pe!=Float32Array&&(dr[0]=0,dr[1]=0,dr[2]=0,dr[3]=0),Yt(),lr(1,0,0),lr(0,1,0),tt(),tt(),gt(),Re();const ot=8192;function jt(a,t,n){return t*(ot/(a.tileSize*Math.pow(2,n-a.tileID.overscaledZ)))}function ue(a,t){return(a%t+t)%t}function Ye(a,t,n){return a*(1-n)+t*n}function Mt(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,n=t*a;return 4*(a<.5?n:3*(a-t)+n-.75)}function yt(a,t,n,o){const f=new at(a,t,n,o);return g=>f.solve(g)}const vt=yt(.25,.1,.25,1);function It(a,t,n){return Math.min(n,Math.max(t,a))}function Ot(a,t,n){const o=n-t,f=((a-t)%o+o)%o+t;return f===t?n:f}function Xt(a,...t){for(const n of t)for(const o in n)a[o]=n[o];return a}let mr=1;function hi(a,t,n){const o={};for(const f in a)o[f]=t.call(this,a[f],f,a);return o}function Si(a,t,n){const o={};for(const f in a)t.call(this,a[f],f,a)&&(o[f]=a[f]);return o}function jr(a){return Array.isArray(a)?a.map(jr):typeof a=="object"&&a?hi(a,jr):a}const rr={};function mi(a){rr[a]||(typeof console<"u"&&console.warn(a),rr[a]=!0)}function Dr(a,t,n){return(n.y-a.y)*(t.x-a.x)>(t.y-a.y)*(n.x-a.x)}function kr(a){return typeof WorkerGlobalScope<"u"&&a!==void 0&&a instanceof WorkerGlobalScope}let Ui=null;function _r(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const xi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function sn(a,t,n,o,f){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(a,{timestamp:0});try{const _=g==null?void 0:g.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const v=_.startsWith("BGR"),T=new Uint8ClampedArray(o*f*4);if(yield g.copyTo(T,function(C,R,L,j,q){const Z=4*Math.max(1,0),Y=(Math.max(0,L)-L)*j*4+Z,ne=4*j,fe=Math.max(0,R),Ie=Math.max(0,L);return{rect:{x:fe,y:Ie,width:Math.min(C.width,R+j)-fe,height:Math.min(C.height,L+q)-Ie},layout:[{offset:Y,stride:ne}]}}(a,t,n,o,f)),v)for(let C=0;C<T.length;C+=4){const R=T[C];T[C]=T[C+2],T[C+2]=R}return T}finally{g.close()}})}let gi,oi;function Ai(a,t,n,o){return a.addEventListener(t,n,o),{unsubscribe:()=>{a.removeEventListener(t,n,o)}}}function Nr(a){return a*Math.PI/180}function Yi(a){return a/Math.PI*180}const _i={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Vi={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},ri="AbortError";function ei(){return new Error(ri)}const ii={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function yr(a){return ii.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]}const Ar="global-dispatcher";class Zr extends Error{constructor(t,n,o,f){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=f}}const Ur=()=>kr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,li=function(a,t){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){const o=yr(a.url);if(o)return o(a,t);if(kr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,targetMapId:Ar},t)}if(!(/^file:/.test(n=a.url)||/^file:/.test(Ur())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,f){return c(this,void 0,void 0,function*(){const g=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Ur(),signal:f.signal});let _,v;o.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");try{_=yield fetch(g)}catch(C){throw new Zr(0,C.message,o.url,new Blob)}if(!_.ok){const C=yield _.blob();throw new Zr(_.status,_.statusText,o.url,C)}v=o.type==="arrayBuffer"||o.type==="image"?_.arrayBuffer():o.type==="json"?_.json():_.text();const T=yield v;if(f.signal.aborted)throw ei();return{data:T,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}})}(a,t);if(kr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,mustQueue:!0,targetMapId:Ar},t)}var n;return function(o,f){return new Promise((g,_)=>{var v;const T=new XMLHttpRequest;T.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(T.responseType="arraybuffer");for(const C in o.headers)T.setRequestHeader(C,o.headers[C]);o.type==="json"&&(T.responseType="text",!((v=o.headers)===null||v===void 0)&&v.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=o.credentials==="include",T.onerror=()=>{_(new Error(T.statusText))},T.onload=()=>{if(!f.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let C=T.response;if(o.type==="json")try{C=JSON.parse(T.response)}catch(R){return void _(R)}g({data:C,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const C=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});_(new Zr(T.status,T.statusText,o.url,C))}},f.signal.addEventListener("abort",()=>{T.abort(),_(ei())}),T.send(o.body)})}(a,t)};function Ne(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const t=new URL(a),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function W(a,t,n){n[a]&&n[a].indexOf(t)!==-1||(n[a]=n[a]||[],n[a].push(t))}function Q(a,t,n){if(n&&n[a]){const o=n[a].indexOf(t);o!==-1&&n[a].splice(o,1)}}class ae{constructor(t,n={}){Xt(this,n),this.type=t}}class ye extends ae{constructor(t,n={}){super("error",Xt({error:t},n))}}class Ee{on(t,n){return this._listeners=this._listeners||{},W(t,n,this._listeners),{unsubscribe:()=>{this.off(t,n)}}}off(t,n){return Q(t,n,this._listeners),Q(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},W(t,n,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,n){typeof t=="string"&&(t=new ae(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const f=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const v of f)v.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const v of g)Q(o,v,this._oneTimeListeners),v.call(this,t);const _=this._eventedParent;_&&(Xt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof ye&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var re={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ze=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Be(a,t){const n={};for(const o in a)o!=="ref"&&(n[o]=a[o]);return Ze.forEach(o=>{o in t&&(n[o]=t[o])}),n}function Oe(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let n=0;n<a.length;n++)if(!Oe(a[n],t[n]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const n in a)if(!Oe(a[n],t[n]))return!1;return!0}return a===t}function He(a,t){a.push(t)}function je(a,t,n){He(n,{command:"addSource",args:[a,t[a]]})}function _t(a,t,n){He(t,{command:"removeSource",args:[a]}),n[a]=!0}function Ut(a,t,n,o){_t(a,n,o),je(a,t,n)}function Gt(a,t,n){let o;for(o in a[n])if(Object.prototype.hasOwnProperty.call(a[n],o)&&o!=="data"&&!Oe(a[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!Oe(a[n][o],t[n][o]))return!1;return!0}function tr(a,t,n,o,f,g){a=a||{},t=t||{};for(const _ in a)Object.prototype.hasOwnProperty.call(a,_)&&(Oe(a[_],t[_])||n.push({command:g,args:[o,_,t[_],f]}));for(const _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(a,_)&&(Oe(a[_],t[_])||n.push({command:g,args:[o,_,t[_],f]}))}function ir(a){return a.id}function k(a,t){return a[t.id]=t,a}class O{constructor(t,n,o,f){this.message=(t?`${t}: `:"")+o,f&&(this.identifier=f),n!=null&&n.__line__&&(this.line=n.__line__)}}function me(a,...t){for(const n of t)for(const o in n)a[o]=n[o];return a}class de extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class ze{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,f]of n)this.bindings[o]=f}concat(t){return new ze(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const We={kind:"null"},Le={kind:"number"},wt={kind:"string"},Nt={kind:"boolean"},Jt={kind:"color"},ar={kind:"projectionDefinition"},Hr={kind:"object"},Qt={kind:"value"},Pi={kind:"collator"},_n={kind:"formatted"},ui={kind:"padding"},ti={kind:"colorArray"},bi={kind:"numberArray"},Ln={kind:"resolvedImage"},Sr={kind:"variableAnchorOffsetCollection"};function Cn(a,t){return{kind:"array",itemType:a,N:t}}function Br(a){if(a.kind==="array"){const t=Br(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const ms=[We,Le,wt,Nt,Jt,ar,_n,Hr,Cn(Qt),ui,bi,ti,Ln,Sr];function Mn(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Mn(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const n of ms)if(!Mn(n,t))return null}}return`Expected ${Br(a)} but found ${Br(t)} instead.`}function js(a,t){return t.some(n=>n.kind===a.kind)}function gs(a,t){return t.some(n=>n==="null"?a===null:n==="array"?Array.isArray(a):n==="object"?a&&!Array.isArray(a)&&typeof a=="object":n===typeof a)}function Yn(a,t){return a.kind==="array"&&t.kind==="array"?a.itemType.kind===t.itemType.kind&&typeof a.N=="number":a.kind===t.kind}const vo=.96422,Vo=.82521,Yu=4/29,ie=6/29,Ce=3*ie*ie,pe=ie*ie*ie,Ve=Math.PI/180,$e=180/Math.PI;function Ue(a){return(a%=360)<0&&(a+=360),a}function Tt([a,t,n,o]){let f,g;const _=Bt((.2225045*(a=kt(a))+.7168786*(t=kt(t))+.0606169*(n=kt(n)))/1);a===t&&t===n?f=g=_:(f=Bt((.4360747*a+.3850649*t+.1430804*n)/vo),g=Bt((.0139322*a+.0971045*t+.7141733*n)/Vo));const v=116*_-16;return[v<0?0:v,500*(f-_),200*(_-g),o]}function kt(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Bt(a){return a>pe?Math.pow(a,1/3):a/Ce+Yu}function qt([a,t,n,o]){let f=(a+16)/116,g=isNaN(t)?f:f+t/500,_=isNaN(n)?f:f-n/200;return f=1*ur(f),g=vo*ur(g),_=Vo*ur(_),[Ht(3.1338561*g-1.6168667*f-.4906146*_),Ht(-.9787684*g+1.9161415*f+.033454*_),Ht(.0719453*g-.2289914*f+1.4052427*_),o]}function Ht(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function ur(a){return a>ie?a*a*a:Ce*(a-Yu)}const Ir=Object.hasOwn||function(a,t){return Object.prototype.hasOwnProperty.call(a,t)};function $r(a,t){return Ir(a,t)?a[t]:void 0}function Qr(a){return parseInt(a.padEnd(2,a),16)/255}function wi(a,t){return Xr(t?a/100:a,0,1)}function Xr(a,t,n){return Math.min(Math.max(t,a),n)}function wr(a){return!a.some(Number.isNaN)}const Sa={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function yn(a,t,n){return a+n*(t-a)}function Us(a,t,n){return a.map((o,f)=>yn(o,t[f],n))}class Or{constructor(t,n,o,f=1,g=!0){this.r=t,this.g=n,this.b=o,this.a=f,g||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[t,n,o,f]))}static parse(t){if(t instanceof Or)return t;if(typeof t!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const f=$r(Sa,o);if(f){const[_,v,T]=f;return[_/255,v/255,T/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const _=o.length<6?1:2;let v=1;return[Qr(o.slice(v,v+=_)),Qr(o.slice(v,v+=_)),Qr(o.slice(v,v+=_)),Qr(o.slice(v,v+_)||"ff")]}if(o.startsWith("rgb")){const _=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,T,C,R,L,j,q,Z,Y,ne,fe,Ie]=_,ve=[R||" ",q||" ",ne].join("");if(ve==="  "||ve==="  /"||ve===",,"||ve===",,,"){const V=[C,j,Y].join(""),te=V==="%%%"?100:V===""?255:0;if(te){const be=[Xr(+T/te,0,1),Xr(+L/te,0,1),Xr(+Z/te,0,1),fe?wi(+fe,Ie):1];if(wr(be))return be}}return}}const g=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,v,T,C,R,L,j,q,Z]=g,Y=[T||" ",R||" ",j].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){const ne=[+v,Xr(+C,0,100),Xr(+L,0,100),q?wi(+q,Z):1];if(wr(ne))return function([fe,Ie,ve,V]){function te(be){const Ke=(be+fe/30)%12,At=Ie*Math.min(ve,1-ve);return ve-At*Math.max(-1,Math.min(Ke-3,9-Ke,1))}return fe=Ue(fe),Ie/=100,ve/=100,[te(0),te(8),te(4),V]}(ne)}}}(t);return n?new Or(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:f}=this,g=f||1/0;return this.overwriteGetter("rgb",[t/g,n/g,o/g,f])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,o,f,g]=Tt(t),_=Math.sqrt(o*o+f*f);return[Math.round(1e4*_)?Ue(Math.atan2(f,o)*$e):NaN,_,n,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Tt(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,f]=this.rgb;return`rgba(${[t,n,o].map(g=>Math.round(255*g)).join(",")},${f})`}static interpolate(t,n,o,f="rgb"){switch(f){case"rgb":{const[g,_,v,T]=Us(t.rgb,n.rgb,o);return new Or(g,_,v,T,!1)}case"hcl":{const[g,_,v,T]=t.hcl,[C,R,L,j]=n.hcl;let q,Z;if(isNaN(g)||isNaN(C))isNaN(g)?isNaN(C)?q=NaN:(q=C,v!==1&&v!==0||(Z=R)):(q=g,L!==1&&L!==0||(Z=_));else{let ve=C-g;C>g&&ve>180?ve-=360:C<g&&g-C>180&&(ve+=360),q=g+o*ve}const[Y,ne,fe,Ie]=function([ve,V,te,be]){return ve=isNaN(ve)?0:ve*Ve,qt([te,Math.cos(ve)*V,Math.sin(ve)*V,be])}([q,Z??yn(_,R,o),yn(v,L,o),yn(T,j,o)]);return new Or(Y,ne,fe,Ie,!1)}case"lab":{const[g,_,v,T]=qt(Us(t.lab,n.lab,o));return new Or(g,_,v,T,!1)}}}}Or.black=new Or(0,0,0,1),Or.white=new Or(1,1,1,1),Or.transparent=new Or(0,0,0,0),Or.red=new Or(1,0,0,1);class Vs{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const qs=["bottom","center","top"];class _s{constructor(t,n,o,f,g,_){this.text=t,this.image=n,this.scale=o,this.fontStack=f,this.textColor=g,this.verticalAlign=_}}class on{constructor(t){this.sections=t}static fromString(t){return new on([new _s(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof on?t:on.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class ln{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ln)return t;if(typeof t=="number")return new ln([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new ln(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){return new ln(Us(t.values,n.values,o))}}class un{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof un)return t;if(typeof t=="number")return new un([t]);if(Array.isArray(t)){for(const n of t)if(typeof n!="number")return;return new un(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){return new un(Us(t.values,n.values,o))}}class Dn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Dn)return t;if(typeof t=="string"){const o=Or.parse(t);return o?new Dn([o]):void 0}if(!Array.isArray(t))return;const n=[];for(const o of t){if(typeof o!="string")return;const f=Or.parse(o);if(!f)return;n.push(f)}return new Dn(n)}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o,f="rgb"){const g=[];if(t.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let _=0;_<t.values.length;_++)g.push(Or.interpolate(t.values[_],n.values[_],o,f));return new Dn(g)}}class Ri extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const ys=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class en{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof en)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],f=t[n+1];if(typeof o!="string"||!ys.has(o)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new en(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){const f=t.values,g=n.values;if(f.length!==g.length)throw new Ri(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${n.toString()}`);const _=[];for(let v=0;v<f.length;v+=2){if(f[v]!==g[v])throw new Ri(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${f[v]}, to[${v}]: ${g[v]}`);_.push(f[v]);const[T,C]=f[v+1],[R,L]=g[v+1];_.push([yn(T,R,o),yn(C,L,o)])}return new en(_)}}class ua{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ua({name:t,available:!1}):null}}class kn{constructor(t,n,o){this.from=t,this.to=n,this.transition=o}static interpolate(t,n,o){return new kn(t,n,o)}static parse(t){return t instanceof kn?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new kn(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new kn(t.from,t.to,t.transition):typeof t=="string"?new kn(t,t,1):void 0}}function Ua(a,t,n,o){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[a,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[a,t,n,o]:[a,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fi(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof kn||a instanceof Or||a instanceof Vs||a instanceof on||a instanceof ln||a instanceof un||a instanceof Dn||a instanceof en||a instanceof ua)return!0;if(Array.isArray(a)){for(const t of a)if(!fi(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!fi(a[t]))return!1;return!0}return!1}function Oi(a){if(a===null)return We;if(typeof a=="string")return wt;if(typeof a=="boolean")return Nt;if(typeof a=="number")return Le;if(a instanceof Or)return Jt;if(a instanceof kn)return ar;if(a instanceof Vs)return Pi;if(a instanceof on)return _n;if(a instanceof ln)return ui;if(a instanceof un)return bi;if(a instanceof Dn)return ti;if(a instanceof en)return Sr;if(a instanceof ua)return Ln;if(Array.isArray(a)){const t=a.length;let n;for(const o of a){const f=Oi(o);if(n){if(n===f)continue;n=Qt;break}n=f}return Cn(n||Qt,t)}return Hr}function Vr(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof Or||a instanceof kn||a instanceof on||a instanceof ln||a instanceof un||a instanceof Dn||a instanceof en||a instanceof ua?a.toString():JSON.stringify(a)}class br{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!fi(t[1]))return n.error("invalid value");const o=t[1];let f=Oi(o);const g=n.expectedType;return f.kind!=="array"||f.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(f=g),new br(f,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Gs={string:wt,number:Le,boolean:Nt,object:Hr};class Pr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,f=1;const g=t[0];if(g==="array"){let v,T;if(t.length>2){const C=t[1];if(typeof C!="string"||!(C in Gs)||C==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=Gs[C],f++}else v=Qt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=t[2],f++}o=Cn(v,T)}else{if(!Gs[g])throw new Error(`Types doesn't contain name = ${g}`);o=Gs[g]}const _=[];for(;f<t.length;f++){const v=n.parse(t[f],f,Qt);if(!v)return null;_.push(v)}return new Pr(o,_)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!Mn(this.type,Oi(o)))return o;if(n===this.args.length-1)throw new Ri(`Expected value to be of type ${Br(this.type)}, but found ${Br(Oi(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const qn={"to-boolean":Nt,"to-color":Jt,"to-number":Le,"to-string":wt};class cn{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!qn[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const f=qn[o],g=[];for(let _=1;_<t.length;_++){const v=n.parse(t[_],_,Qt);if(!v)return null;g.push(v)}return new cn(f,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const f of this.args){if(n=f.evaluate(t),o=null,n instanceof Or)return n;if(typeof n=="string"){const g=t.parseColor(n);if(g)return g}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ua(n[0],n[1],n[2],n[3]),!o))return new Or(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Ri(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const f=ln.parse(n);if(f)return f}throw new Ri(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const o of this.args){n=o.evaluate(t);const f=un.parse(n);if(f)return f}throw new Ri(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const o of this.args){n=o.evaluate(t);const f=Dn.parse(n);if(f)return f}throw new Ri(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const f=en.parse(n);if(f)return f}throw new Ri(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const f=Number(n);if(!isNaN(f))return f}throw new Ri(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return on.fromString(Vr(this.args[0].evaluate(t)));case"resolvedImage":return ua.fromString(Vr(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return Vr(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Cl=["Unknown","Point","LineString","Polygon"];class qo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Cl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache.get(t);return n||(n=Or.parse(t),this._parseColorCache.set(t,n)),n}}class fu{constructor(t,n,o=[],f,g=new ze,_=[]){this.registry=t,this.path=o,this.key=o.map(v=>`[${v}]`).join(""),this.scope=g,this.errors=_,this.expectedType=f,this._isConstant=n}parse(t,n,o,f,g={}){return n?this.concat(n,o,f)._parse(t,g):this._parse(t,g)}_parse(t,n){function o(f,g,_){return _==="assert"?new Pr(g,[f]):_==="coerce"?new cn(g,[f]):f}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=t[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[f];if(g){let _=g.parse(t,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,T=_.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||T.kind!=="value"){if(v.kind==="projectionDefinition"&&["string","array"].includes(T.kind)||["color","formatted","resolvedImage"].includes(v.kind)&&["value","string"].includes(T.kind)||["padding","numberArray"].includes(v.kind)&&["value","number","array"].includes(T.kind)||v.kind==="colorArray"&&["value","string","array"].includes(T.kind)||v.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(T.kind))_=o(_,v,n.typeAnnotation||"coerce");else if(this.checkSubtype(v,T))return null}else _=o(_,v,n.typeAnnotation||"assert")}if(!(_ instanceof br)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const v=new qo;try{_=new br(_.type,_.evaluate(v))}catch(T){return this.error(T.message),null}}return _}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const f=typeof t=="number"?this.path.concat(t):this.path,g=o?this.scope.concat(o):this.scope;return new fu(this.registry,this._isConstant,f,n||null,g,this.errors)}error(t,...n){const o=`${this.key}${n.map(f=>`[${f}]`).join("")}`;this.errors.push(new de(o,t))}checkSubtype(t,n){const o=Mn(t,n);return o&&this.error(o),o}}class xo{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let g=1;g<t.length-1;g+=2){const _=t[g];if(typeof _!="string")return n.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return n.error("Variable names must contain only alphanumeric characters or '_'.",g);const v=n.parse(t[g+1],g+1);if(!v)return null;o.push([_,v])}const f=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return f?new xo(o,f):null}outputDefined(){return this.result.outputDefined()}}class Go{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new Go(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Zo{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Le),f=n.parse(t[2],2,Cn(n.expectedType||Qt));return o&&f?new Zo(f.type.itemType,o,f):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new Ri(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new Ri(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new Ri(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Ho{constructor(t,n){this.type=Nt,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Qt),f=n.parse(t[2],2,Qt);return o&&f?js(o.type,[Nt,wt,Le,We,Qt])?new Ho(o,f):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Br(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!gs(n,["boolean","string","number","null"]))throw new Ri(`Expected first argument to be of type boolean, string, number or null, but found ${Br(Oi(n))} instead.`);if(!gs(o,["string","array"]))throw new Ri(`Expected second argument to be of type array or string, but found ${Br(Oi(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Ml{constructor(t,n,o){this.type=Le,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Qt),f=n.parse(t[2],2,Qt);if(!o||!f)return null;if(!js(o.type,[Nt,wt,Le,We,Qt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Br(o.type)} instead`);if(t.length===4){const g=n.parse(t[3],3,Le);return g?new Ml(o,f,g):null}return new Ml(o,f)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!gs(n,["boolean","string","number","null"]))throw new Ri(`Expected first argument to be of type boolean, string, number or null, but found ${Br(Oi(n))} instead.`);let f;if(this.fromIndex&&(f=this.fromIndex.evaluate(t)),gs(o,["string"])){const g=o.indexOf(n,f);return g===-1?-1:[...o.slice(0,g)].length}if(gs(o,["array"]))return o.indexOf(n,f);throw new Ri(`Expected second argument to be of type array or string, but found ${Br(Oi(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class $o{constructor(t,n,o,f,g,_){this.inputType=t,this.type=n,this.input=o,this.cases=f,this.outputs=g,this.otherwise=_}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,f;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);const g={},_=[];for(let C=2;C<t.length-1;C+=2){let R=t[C];const L=t[C+1];Array.isArray(R)||(R=[R]);const j=n.concat(C);if(R.length===0)return j.error("Expected at least one branch label.");for(const Z of R){if(typeof Z!="number"&&typeof Z!="string")return j.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return j.error("Numeric branch labels must be integer values.");if(o){if(j.checkSubtype(o,Oi(Z)))return null}else o=Oi(Z);if(g[String(Z)]!==void 0)return j.error("Branch labels must be unique.");g[String(Z)]=_.length}const q=n.parse(L,C,f);if(!q)return null;f=f||q.type,_.push(q)}const v=n.parse(t[1],1,Qt);if(!v)return null;const T=n.parse(t[t.length-1],t.length-1,f);return T?v.type.kind!=="value"&&n.concat(1).checkSubtype(o,v.type)?null:new $o(o,f,v,g,_,T):null}evaluate(t){const n=this.input.evaluate(t);return(Oi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Bn{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const f=[];for(let _=1;_<t.length-1;_+=2){const v=n.parse(t[_],_,Nt);if(!v)return null;const T=n.parse(t[_+1],_+1,o);if(!T)return null;f.push([v,T]),o=o||T.type}const g=n.parse(t[t.length-1],t.length-1,o);if(!g)return null;if(!o)throw new Error("Can't infer output type");return new Bn(o,f,g)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Xo{constructor(t,n,o,f){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=f}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Qt),f=n.parse(t[2],2,Le);if(!o||!f)return null;if(!js(o.type,[Cn(Qt),wt,Qt]))return n.error(`Expected first argument to be of type array or string, but found ${Br(o.type)} instead`);if(t.length===4){const g=n.parse(t[3],3,Le);return g?new Xo(o.type,o,f,g):null}return new Xo(o.type,o,f)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let f;if(this.endIndex&&(f=this.endIndex.evaluate(t)),gs(n,["string"]))return[...n].slice(o,f).join("");if(gs(n,["array"]))return n.slice(o,f);throw new Ri(`Expected first argument to be of type array or string, but found ${Br(Oi(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Yo(a,t){const n=a.length-1;let o,f,g=0,_=n,v=0;for(;g<=_;)if(v=Math.floor((g+_)/2),o=a[v],f=a[v+1],o<=t){if(v===n||t<f)return v;g=v+1}else{if(!(o>t))throw new Ri("Input is not a number.");_=v-1}return 0}class bo{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[f,g]of o)this.labels.push(f),this.outputs.push(g)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,Le);if(!o)return null;const f=[];let g=null;n.expectedType&&n.expectedType.kind!=="value"&&(g=n.expectedType);for(let _=1;_<t.length;_+=2){const v=_===1?-1/0:t[_],T=t[_+1],C=_,R=_+1;if(typeof v!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(f.length&&f[f.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const L=n.parse(T,R,g);if(!L)return null;g=g||L.type,f.push([v,L])}return new bo(g,o,f)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const f=this.input.evaluate(t);if(f<=n[0])return o[0].evaluate(t);const g=n.length;return f>=n[g-1]?o[g-1].evaluate(t):o[Yo(n,f)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function On(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Wu,Qu,$h=function(){if(Qu)return Wu;function a(t,n,o,f){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=f}return Qu=1,Wu=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,f=0;f<8;f++){var g=this.sampleCurveX(o)-t;if(Math.abs(g)<n)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=g/_}var v=0,T=1;for(o=t,f=0;f<20&&(g=this.sampleCurveX(o),!(Math.abs(g-t)<n));f++)t>g?v=o:T=o,o=.5*(T-v)+v;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},Wu}(),Xh=On($h);class Wn{constructor(t,n,o,f,g){this.type=t,this.operator=n,this.interpolation=o,this.input=f,this.labels=[],this.outputs=[];for(const[_,v]of g)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(t,n,o,f){let g=0;if(t.name==="exponential")g=du(n,t.base,o,f);else if(t.name==="linear")g=du(n,1,o,f);else if(t.name==="cubic-bezier"){const _=t.controlPoints;g=new Xh(_[0],_[1],_[2],_[3]).solve(du(n,1,o,f))}return g}static parse(t,n){let[o,f,g,..._]=t;if(!Array.isArray(f)||f.length===0)return n.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const C=f[1];if(typeof C!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:C}}else{if(f[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const C=f.slice(1);if(C.length!==4||C.some(R=>typeof R!="number"||R<0||R>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:C}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(g=n.parse(g,2,Le),!g)return null;const v=[];let T=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||n.expectedType==ti?n.expectedType&&n.expectedType.kind!=="value"&&(T=n.expectedType):T=Jt;for(let C=0;C<_.length;C+=2){const R=_[C],L=_[C+1],j=C+3,q=C+4;if(typeof R!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(v.length&&v[v.length-1][0]>=R)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const Z=n.parse(L,q,T);if(!Z)return null;T=T||Z.type,v.push([R,Z])}return Yn(T,Le)||Yn(T,ar)||Yn(T,Jt)||Yn(T,ui)||Yn(T,bi)||Yn(T,ti)||Yn(T,Sr)||Yn(T,Cn(Le))?new Wn(T,o,f,g,v):n.error(`Type ${Br(T)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const f=this.input.evaluate(t);if(f<=n[0])return o[0].evaluate(t);const g=n.length;if(f>=n[g-1])return o[g-1].evaluate(t);const _=Yo(n,f),v=Wn.interpolationFactor(this.interpolation,f,n[_],n[_+1]),T=o[_].evaluate(t),C=o[_+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return yn(T,C,v);case"color":return Or.interpolate(T,C,v);case"padding":return ln.interpolate(T,C,v);case"colorArray":return Dn.interpolate(T,C,v);case"numberArray":return un.interpolate(T,C,v);case"variableAnchorOffsetCollection":return en.interpolate(T,C,v);case"array":return Us(T,C,v);case"projectionDefinition":return kn.interpolate(T,C,v)}case"interpolate-hcl":switch(this.type.kind){case"color":return Or.interpolate(T,C,v,"hcl");case"colorArray":return Dn.interpolate(T,C,v,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Or.interpolate(T,C,v,"lab");case"colorArray":return Dn.interpolate(T,C,v,"lab")}}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function du(a,t,n,o){const f=o-n,g=a-n;return f===0?0:t===1?g/f:(Math.pow(t,g)-1)/(Math.pow(t,f)-1)}const vs={color:Or.interpolate,number:yn,padding:ln.interpolate,numberArray:un.interpolate,colorArray:Dn.interpolate,variableAnchorOffsetCollection:en.interpolate,array:Us};class Wo{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o=null;const f=n.expectedType;f&&f.kind!=="value"&&(o=f);const g=[];for(const v of t.slice(1)){const T=n.parse(v,1+g.length,o,void 0,{typeAnnotation:"omit"});if(!T)return null;o=o||T.type,g.push(T)}if(!o)throw new Error("No output type");const _=f&&g.some(v=>Mn(f,v.type));return new Wo(_?Qt:o,g)}evaluate(t){let n,o=null,f=0;for(const g of this.args)if(f++,o=g.evaluate(t),o&&o instanceof ua&&!o.available&&(n||(n=o.name),o=null,f===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Qo(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Va(a,t,n,o){return o.compare(t,n)===0}function Ko(a,t,n){const o=a!=="=="&&a!=="!=";return class g_{constructor(g,_,v){this.type=Nt,this.lhs=g,this.rhs=_,this.collator=v,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const v=g[0];let T=_.parse(g[1],1,Qt);if(!T)return null;if(!Qo(v,T.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${Br(T.type)}'.`);let C=_.parse(g[2],2,Qt);if(!C)return null;if(!Qo(v,C.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${Br(C.type)}'.`);if(T.type.kind!==C.type.kind&&T.type.kind!=="value"&&C.type.kind!=="value")return _.error(`Cannot compare types '${Br(T.type)}' and '${Br(C.type)}'.`);o&&(T.type.kind==="value"&&C.type.kind!=="value"?T=new Pr(C.type,[T]):T.type.kind!=="value"&&C.type.kind==="value"&&(C=new Pr(T.type,[C])));let R=null;if(g.length===4){if(T.type.kind!=="string"&&C.type.kind!=="string"&&T.type.kind!=="value"&&C.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(R=_.parse(g[3],3,Pi),!R)return null}return new g_(T,C,R)}evaluate(g){const _=this.lhs.evaluate(g),v=this.rhs.evaluate(g);if(o&&this.hasUntypedArgument){const T=Oi(_),C=Oi(v);if(T.kind!==C.kind||T.kind!=="string"&&T.kind!=="number")throw new Ri(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${T.kind}, ${C.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const T=Oi(_),C=Oi(v);if(T.kind!=="string"||C.kind!=="string")return t(g,_,v)}return this.collator?n(g,_,v,this.collator.evaluate(g)):t(g,_,v)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const Ku=Ko("==",function(a,t,n){return t===n},Va),Yh=Ko("!=",function(a,t,n){return t!==n},function(a,t,n,o){return!Va(0,t,n,o)}),Kc=Ko("<",function(a,t,n){return t<n},function(a,t,n,o){return o.compare(t,n)<0}),dd=Ko(">",function(a,t,n){return t>n},function(a,t,n,o){return o.compare(t,n)>0}),pd=Ko("<=",function(a,t,n){return t<=n},function(a,t,n,o){return o.compare(t,n)<=0}),md=Ko(">=",function(a,t,n){return t>=n},function(a,t,n,o){return o.compare(t,n)>=0});class Ju{constructor(t,n,o){this.type=Pi,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const f=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Nt);if(!f)return null;const g=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Nt);if(!g)return null;let _=null;return o.locale&&(_=n.parse(o.locale,1,wt),!_)?null:new Ju(f,g,_)}evaluate(t){return new Vs(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Dl{constructor(t,n,o,f,g){this.type=wt,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,Le);if(!o)return null;const f=t[2];if(typeof f!="object"||Array.isArray(f))return n.error("NumberFormat options argument must be an object.");let g=null;if(f.locale&&(g=n.parse(f.locale,1,wt),!g))return null;let _=null;if(f.currency&&(_=n.parse(f.currency,1,wt),!_))return null;let v=null;if(f["min-fraction-digits"]&&(v=n.parse(f["min-fraction-digits"],1,Le),!v))return null;let T=null;return f["max-fraction-digits"]&&(T=n.parse(f["max-fraction-digits"],1,Le),!T)?null:new Dl(o,g,_,v,T)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class ec{constructor(t){this.type=_n,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const f=[];let g=!1;for(let _=1;_<=t.length-1;++_){const v=t[_];if(g&&typeof v=="object"&&!Array.isArray(v)){g=!1;let T=null;if(v["font-scale"]&&(T=n.parse(v["font-scale"],1,Le),!T))return null;let C=null;if(v["text-font"]&&(C=n.parse(v["text-font"],1,Cn(wt)),!C))return null;let R=null;if(v["text-color"]&&(R=n.parse(v["text-color"],1,Jt),!R))return null;let L=null;if(v["vertical-align"]){if(typeof v["vertical-align"]=="string"&&!qs.includes(v["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${v["vertical-align"]}' instead.`);if(L=n.parse(v["vertical-align"],1,wt),!L)return null}const j=f[f.length-1];j.scale=T,j.font=C,j.textColor=R,j.verticalAlign=L}else{const T=n.parse(t[_],1,Qt);if(!T)return null;const C=T.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,f.push({content:T,scale:null,font:null,textColor:null,verticalAlign:null})}}return new ec(f)}evaluate(t){return new on(this.sections.map(n=>{const o=n.content.evaluate(t);return Oi(o)===Ln?new _s("",o,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(t):null):new _s(Vr(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null,n.verticalAlign?n.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor),n.verticalAlign&&t(n.verticalAlign)}outputDefined(){return!1}}class tc{constructor(t){this.type=Ln,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,wt);return o?new tc(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=ua.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class rc{constructor(t){this.type=Le,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Br(o.type)} instead.`):new rc(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new Ri(`Expected value to be of type string or array, but found ${Br(Oi(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const qa=8192;function Il(a,t){const n=(180+a[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,t.z);return[Math.round(n*f*qa),Math.round(o*f*qa)]}function Jc(a,t){const n=Math.pow(2,t.z);return[(f=(a[0]/qa+t.x)/n,360*f-180),(o=(a[1]/qa+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,f}function Pl(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function Rl(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function Wh(a,t,n){const o=a[0]-t[0],f=a[1]-t[1],g=a[0]-n[0],_=a[1]-n[1];return o*_-g*f==0&&o*g<=0&&f*_<=0}function pu(a,t,n,o){return(f=[o[0]-n[0],o[1]-n[1]])[0]*(g=[t[0]-a[0],t[1]-a[1]])[1]-f[1]*g[0]!=0&&!(!th(a,t,n,o)||!th(n,o,a,t));var f,g}function eh(a,t,n){for(const o of n)for(let f=0;f<o.length-1;++f)if(pu(a,t,o[f],o[f+1]))return!0;return!1}function Ga(a,t,n=!1){let o=!1;for(const v of t)for(let T=0;T<v.length-1;T++){if(Wh(a,v[T],v[T+1]))return n;(g=v[T])[1]>(f=a)[1]!=(_=v[T+1])[1]>f[1]&&f[0]<(_[0]-g[0])*(f[1]-g[1])/(_[1]-g[1])+g[0]&&(o=!o)}var f,g,_;return o}function Qh(a,t){for(const n of t)if(Ga(a,n))return!0;return!1}function Kh(a,t){for(const n of a)if(!Ga(n,t))return!1;for(let n=0;n<a.length-1;++n)if(eh(a[n],a[n+1],t))return!1;return!0}function gd(a,t){for(const n of t)if(Kh(a,n))return!0;return!1}function th(a,t,n,o){const f=o[0]-n[0],g=o[1]-n[1],_=(a[0]-n[0])*g-f*(a[1]-n[1]),v=(t[0]-n[0])*g-f*(t[1]-n[1]);return _>0&&v<0||_<0&&v>0}function zl(a,t,n){const o=[];for(let f=0;f<a.length;f++){const g=[];for(let _=0;_<a[f].length;_++){const v=Il(a[f][_],n);Pl(t,v),g.push(v)}o.push(g)}return o}function Ll(a,t,n){const o=[];for(let f=0;f<a.length;f++){const g=zl(a[f],t,n);o.push(g)}return o}function kl(a,t,n,o){if(a[0]<n[0]||a[0]>n[2]){const f=.5*o;let g=a[0]-n[0]>f?-o:n[0]-a[0]>f?o:0;g===0&&(g=a[0]-n[2]>f?-o:n[2]-a[0]>f?o:0),a[0]+=g}Pl(t,a)}function Jh(a,t,n,o){const f=Math.pow(2,o.z)*qa,g=[o.x*qa,o.y*qa],_=[];for(const v of a)for(const T of v){const C=[T.x+g[0],T.y+g[1]];kl(C,t,n,f),_.push(C)}return _}function Bl(a,t,n,o){const f=Math.pow(2,o.z)*qa,g=[o.x*qa,o.y*qa],_=[];for(const T of a){const C=[];for(const R of T){const L=[R.x+g[0],R.y+g[1]];Pl(t,L),C.push(L)}_.push(C)}if(t[2]-t[0]<=f/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const T of _)for(const C of T)kl(C,t,n,f)}var v;return _}class Zs{constructor(t,n){this.type=Nt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(fi(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const f=[];for(const g of o.features){const{type:_,coordinates:v}=g.geometry;_==="Polygon"&&f.push(v),_==="MultiPolygon"&&f.push(...v)}if(f.length)return new Zs(o,{type:"MultiPolygon",coordinates:f})}else if(o.type==="Feature"){const f=o.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Zs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Zs(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(o.type==="Polygon"){const v=zl(o.coordinates,g,_),T=Jh(n.geometry(),f,g,_);if(!Rl(f,g))return!1;for(const C of T)if(!Ga(C,v))return!1}if(o.type==="MultiPolygon"){const v=Ll(o.coordinates,g,_),T=Jh(n.geometry(),f,g,_);if(!Rl(f,g))return!1;for(const C of T)if(!Qh(C,v))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(o.type==="Polygon"){const v=zl(o.coordinates,g,_),T=Bl(n.geometry(),f,g,_);if(!Rl(f,g))return!1;for(const C of T)if(!Kh(C,v))return!1}if(o.type==="MultiPolygon"){const v=Ll(o.coordinates,g,_),T=Bl(n.geometry(),f,g,_);if(!Rl(f,g))return!1;for(const C of T)if(!gd(C,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let rh=class{constructor(a=[],t=(n,o)=>n<o?-1:n>o?1:0){if(this.data=a,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:t,compare:n}=this,o=t[a];for(;a>0;){const f=a-1>>1,g=t[f];if(n(o,g)>=0)break;t[a]=g,a=f}t[a]=o}_down(a){const{data:t,compare:n}=this,o=this.length>>1,f=t[a];for(;a<o;){let g=1+(a<<1);const _=g+1;if(_<this.length&&n(t[_],t[g])<0&&(g=_),n(t[g],f)>=0)break;t[a]=t[g],a=g}t[a]=f}};function ic(a,t,n=0,o=a.length-1,f=ih){for(;o>n;){if(o-n>600){const T=o-n+1,C=t-n+1,R=Math.log(T),L=.5*Math.exp(2*R/3),j=.5*Math.sqrt(R*L*(T-L)/T)*(C-T/2<0?-1:1);ic(a,t,Math.max(n,Math.floor(t-C*L/T+j)),Math.min(o,Math.floor(t+(T-C)*L/T+j)),f)}const g=a[t];let _=n,v=o;for(wo(a,n,t),f(a[o],g)>0&&wo(a,n,o);_<v;){for(wo(a,_,v),_++,v--;f(a[_],g)<0;)_++;for(;f(a[v],g)>0;)v--}f(a[n],g)===0?wo(a,n,v):(v++,wo(a,v,o)),v<=t&&(n=v+1),t<=v&&(o=v-1)}}function wo(a,t,n){const o=a[t];a[t]=a[n],a[n]=o}function ih(a,t){return a<t?-1:a>t?1:0}function mu(a,t){if(a.length<=1)return[a];const n=[];let o,f;for(const g of a){const _=_d(g);_!==0&&(g.area=Math.abs(_),f===void 0&&(f=_<0),f===_<0?(o&&n.push(o),o=[g]):o.push(g))}if(o&&n.push(o),t>1)for(let g=0;g<n.length;g++)n[g].length<=t||(ic(n[g],t,1,n[g].length-1,ef),n[g]=n[g].slice(0,t));return n}function ef(a,t){return t.area-a.area}function _d(a){let t=0;for(let n,o,f=0,g=a.length,_=g-1;f<g;_=f++)n=a[f],o=a[_],t+=(o.x-n.x)*(n.y+o.y);return t}const nh=1/298.257223563,tf=nh*(2-nh),rf=Math.PI/180;class ah{constructor(t){const n=6378.137*rf*1e3,o=Math.cos(t*rf),f=1/(1-tf*(1-o*o)),g=Math.sqrt(f);this.kx=n*g*o,this.ky=n*g*f*(1-tf)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,f=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+f*f)}pointOnLine(t,n){let o,f,g,_,v=1/0;for(let T=0;T<t.length-1;T++){let C=t[T][0],R=t[T][1],L=this.wrap(t[T+1][0]-C)*this.kx,j=(t[T+1][1]-R)*this.ky,q=0;L===0&&j===0||(q=(this.wrap(n[0]-C)*this.kx*L+(n[1]-R)*this.ky*j)/(L*L+j*j),q>1?(C=t[T+1][0],R=t[T+1][1]):q>0&&(C+=L/this.kx*q,R+=j/this.ky*q)),L=this.wrap(n[0]-C)*this.kx,j=(n[1]-R)*this.ky;const Z=L*L+j*j;Z<v&&(v=Z,o=C,f=R,g=T,_=q)}return{point:[o,f],index:g,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function ya(a,t){return t[0]-a[0]}function qr(a){return a[1]-a[0]+1}function xs(a,t){return a[1]>=a[0]&&a[1]<t}function nc(a,t){if(a[0]>a[1])return[null,null];const n=qr(a);if(t){if(n===2)return[a,null];const f=Math.floor(n/2);return[[a[0],a[0]+f],[a[0]+f,a[1]]]}if(n===1)return[a,null];const o=Math.floor(n/2)-1;return[[a[0],a[0]+o],[a[0]+o+1,a[1]]]}function ac(a,t){if(!xs(t,a.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)Pl(n,a[o]);return n}function sc(a){const t=[1/0,1/0,-1/0,-1/0];for(const n of a)for(const o of n)Pl(t,o);return t}function oc(a){return a[0]!==-1/0&&a[1]!==-1/0&&a[2]!==1/0&&a[3]!==1/0}function sh(a,t,n){if(!oc(a)||!oc(t))return NaN;let o=0,f=0;return a[2]<t[0]&&(o=t[0]-a[2]),a[0]>t[2]&&(o=a[0]-t[2]),a[1]>t[3]&&(f=a[1]-t[3]),a[3]<t[1]&&(f=t[1]-a[3]),n.distance([0,0],[o,f])}function Za(a,t,n){const o=n.pointOnLine(t,a);return n.distance(a,o.point)}function gu(a,t,n,o,f){const g=Math.min(Za(a,[n,o],f),Za(t,[n,o],f)),_=Math.min(Za(n,[a,t],f),Za(o,[a,t],f));return Math.min(g,_)}function _u(a,t,n,o,f){if(!xs(t,a.length)||!xs(o,n.length))return 1/0;let g=1/0;for(let _=t[0];_<t[1];++_){const v=a[_],T=a[_+1];for(let C=o[0];C<o[1];++C){const R=n[C],L=n[C+1];if(pu(v,T,R,L))return 0;g=Math.min(g,gu(v,T,R,L,f))}}return g}function oh(a,t,n,o,f){if(!xs(t,a.length)||!xs(o,n.length))return NaN;let g=1/0;for(let _=t[0];_<=t[1];++_)for(let v=o[0];v<=o[1];++v)if(g=Math.min(g,f.distance(a[_],n[v])),g===0)return g;return g}function nf(a,t,n){if(Ga(a,t,!0))return 0;let o=1/0;for(const f of t){const g=f[0],_=f[f.length-1];if(g!==_&&(o=Math.min(o,Za(a,[_,g],n)),o===0))return o;const v=n.pointOnLine(f,a);if(o=Math.min(o,n.distance(a,v.point)),o===0)return o}return o}function Jo(a,t,n,o){if(!xs(t,a.length))return NaN;for(let g=t[0];g<=t[1];++g)if(Ga(a[g],n,!0))return 0;let f=1/0;for(let g=t[0];g<t[1];++g){const _=a[g],v=a[g+1];for(const T of n)for(let C=0,R=T.length,L=R-1;C<R;L=C++){const j=T[L],q=T[C];if(pu(_,v,j,q))return 0;f=Math.min(f,gu(_,v,j,q,o))}}return f}function el(a,t){for(const n of a)for(const o of n)if(Ga(o,t,!0))return!0;return!1}function lh(a,t,n,o=1/0){const f=sc(a),g=sc(t);if(o!==1/0&&sh(f,g,n)>=o)return o;if(Rl(f,g)){if(el(a,t))return 0}else if(el(t,a))return 0;let _=1/0;for(const v of a)for(let T=0,C=v.length,R=C-1;T<C;R=T++){const L=v[R],j=v[T];for(const q of t)for(let Z=0,Y=q.length,ne=Y-1;Z<Y;ne=Z++){const fe=q[ne],Ie=q[Z];if(pu(L,j,fe,Ie))return 0;_=Math.min(_,gu(L,j,fe,Ie,n))}}return _}function uh(a,t,n,o,f,g){if(!g)return;const _=sh(ac(o,g),f,n);_<t&&a.push([_,g,[0,0]])}function bs(a,t,n,o,f,g,_){if(!g||!_)return;const v=sh(ac(o,g),ac(f,_),n);v<t&&a.push([v,g,_])}function yu(a,t,n,o,f=1/0){let g=Math.min(o.distance(a[0],n[0][0]),f);if(g===0)return g;const _=new rh([[0,[0,a.length-1],[0,0]]],ya),v=sc(n);for(;_.length>0;){const T=_.pop();if(T[0]>=g)continue;const C=T[1],R=t?50:100;if(qr(C)<=R){if(!xs(C,a.length))return NaN;if(t){const L=Jo(a,C,n,o);if(isNaN(L)||L===0)return L;g=Math.min(g,L)}else for(let L=C[0];L<=C[1];++L){const j=nf(a[L],n,o);if(g=Math.min(g,j),g===0)return 0}}else{const L=nc(C,t);uh(_,g,o,a,v,L[0]),uh(_,g,o,a,v,L[1])}}return g}function vu(a,t,n,o,f,g=1/0){let _=Math.min(g,f.distance(a[0],n[0]));if(_===0)return _;const v=new rh([[0,[0,a.length-1],[0,n.length-1]]],ya);for(;v.length>0;){const T=v.pop();if(T[0]>=_)continue;const C=T[1],R=T[2],L=t?50:100,j=o?50:100;if(qr(C)<=L&&qr(R)<=j){if(!xs(C,a.length)&&xs(R,n.length))return NaN;let q;if(t&&o)q=_u(a,C,n,R,f),_=Math.min(_,q);else if(t&&!o){const Z=a.slice(C[0],C[1]+1);for(let Y=R[0];Y<=R[1];++Y)if(q=Za(n[Y],Z,f),_=Math.min(_,q),_===0)return _}else if(!t&&o){const Z=n.slice(R[0],R[1]+1);for(let Y=C[0];Y<=C[1];++Y)if(q=Za(a[Y],Z,f),_=Math.min(_,q),_===0)return _}else q=oh(a,C,n,R,f),_=Math.min(_,q)}else{const q=nc(C,t),Z=nc(R,o);bs(v,_,f,a,n,q[0],Z[0]),bs(v,_,f,a,n,q[0],Z[1]),bs(v,_,f,a,n,q[1],Z[0]),bs(v,_,f,a,n,q[1],Z[1])}}return _}function lc(a){return a.type==="MultiPolygon"?a.coordinates.map(t=>({type:"Polygon",coordinates:t})):a.type==="MultiLineString"?a.coordinates.map(t=>({type:"LineString",coordinates:t})):a.type==="MultiPoint"?a.coordinates.map(t=>({type:"Point",coordinates:t})):[a]}class tl{constructor(t,n){this.type=Le,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(fi(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new tl(o,o.features.map(f=>lc(f.geometry)).flat());if(o.type==="Feature")return new tl(o,lc(o.geometry));if("type"in o&&"coordinates"in o)return new tl(o,lc(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const f=n.geometry(),g=f.flat().map(T=>Jc([T.x,T.y],n.canonical));if(f.length===0)return NaN;const _=new ah(g[0][1]);let v=1/0;for(const T of o){switch(T.type){case"Point":v=Math.min(v,vu(g,!1,[T.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,vu(g,!1,T.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,yu(g,!1,T.coordinates,_,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const f=n.geometry(),g=f.flat().map(T=>Jc([T.x,T.y],n.canonical));if(f.length===0)return NaN;const _=new ah(g[0][1]);let v=1/0;for(const T of o){switch(T.type){case"Point":v=Math.min(v,vu(g,!0,[T.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,vu(g,!0,T.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,yu(g,!0,T.coordinates,_,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="Polygon")return function(n,o){const f=n.geometry();if(f.length===0||f[0].length===0)return NaN;const g=mu(f,0).map(T=>T.map(C=>C.map(R=>Jc([R.x,R.y],n.canonical)))),_=new ah(g[0][0][0][1]);let v=1/0;for(const T of o)for(const C of g){switch(T.type){case"Point":v=Math.min(v,yu([T.coordinates],!1,C,_,v));break;case"LineString":v=Math.min(v,yu(T.coordinates,!0,C,_,v));break;case"Polygon":v=Math.min(v,lh(C,T.coordinates,_,v))}if(v===0)return v}return v}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class uc{constructor(t){this.type=Qt,this.key=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=t[1];return o==null?n.error("Global state property must be defined."):typeof o!="string"?n.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new uc(o)}evaluate(t){var n;const o=(n=t.globals)===null||n===void 0?void 0:n.globalState;return o&&Object.keys(o).length!==0?$r(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Ol={"==":Ku,"!=":Yh,">":dd,"<":Kc,">=":md,"<=":pd,array:Pr,at:Zo,boolean:Pr,case:Bn,coalesce:Wo,collator:Ju,format:ec,image:tc,in:Ho,"index-of":Ml,interpolate:Wn,"interpolate-hcl":Wn,"interpolate-lab":Wn,length:rc,let:xo,literal:br,match:$o,number:Pr,"number-format":Dl,object:Pr,slice:Xo,step:bo,string:Pr,"to-boolean":cn,"to-color":cn,"to-number":cn,"to-string":cn,var:Go,within:Zs,distance:tl,"global-state":uc};class Aa{constructor(t,n,o,f){this.name=t,this.type=n,this._evaluate=o,this.args=f}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],f=Aa.definitions[o];if(!f)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(f)?f[0]:f.type,_=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,v=_.filter(([C])=>!Array.isArray(C)||C.length===t.length-1);let T=null;for(const[C,R]of v){T=new fu(n.registry,ca,n.path,null,n.scope);const L=[];let j=!1;for(let q=1;q<t.length;q++){const Z=t[q],Y=Array.isArray(C)?C[q-1]:C.type,ne=T.parse(Z,1+L.length,Y);if(!ne){j=!0;break}L.push(ne)}if(!j)if(Array.isArray(C)&&C.length!==L.length)T.error(`Expected ${C.length} arguments, but found ${L.length} instead.`);else{for(let q=0;q<L.length;q++){const Z=Array.isArray(C)?C[q]:C.type,Y=L[q];T.concat(q+1).checkSubtype(Z,Y.type)}if(T.errors.length===0)return new Aa(o,g,R,L)}}if(v.length===1)n.errors.push(...T.errors);else{const C=(v.length?v:_).map(([L])=>{return j=L,Array.isArray(j)?`(${j.map(Br).join(", ")})`:`(${Br(j.type)}...)`;var j}).join(" | "),R=[];for(let L=1;L<t.length;L++){const j=n.parse(t[L],1+R.length);if(!j)return null;R.push(Br(j.type))}n.error(`Expected arguments of type ${C}, but found (${R.join(", ")}) instead.`)}return null}static register(t,n){Aa.definitions=n;for(const o in n)t[o]=Aa}}function ch(a,[t,n,o,f]){t=t.evaluate(a),n=n.evaluate(a),o=o.evaluate(a);const g=f?f.evaluate(a):1,_=Ua(t,n,o,g);if(_)throw new Ri(_);return new Or(t/255,n/255,o/255,g,!1)}function cc(a,t){return a in t}function Ca(a,t){const n=t[a];return n===void 0?null:n}function To(a){return{type:a}}function ca(a){if(a instanceof Go)return ca(a.boundExpression);if(a instanceof Aa&&a.name==="error"||a instanceof Ju||a instanceof Zs||a instanceof tl||a instanceof uc)return!1;const t=a instanceof cn||a instanceof Pr;let n=!0;return a.eachChild(o=>{n=t?n&&ca(o):n&&o instanceof br}),!!n&&ha(a)&&Nl(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ha(a){if(a instanceof Aa&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Zs||a instanceof tl)return!1;let t=!0;return a.eachChild(n=>{t&&!ha(n)&&(t=!1)}),t}function ws(a){if(a instanceof Aa&&a.name==="feature-state")return!1;let t=!0;return a.eachChild(n=>{t&&!ws(n)&&(t=!1)}),t}function Nl(a,t){if(a instanceof Aa&&t.indexOf(a.name)>=0)return!1;let n=!0;return a.eachChild(o=>{n&&!Nl(o,t)&&(n=!1)}),n}function rl(a){return{result:"success",value:a}}function Hs(a){return{result:"error",value:a}}function Eo(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function il(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function xu(a){return!!a.expression&&a.expression.interpolated}function Lr(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function $s(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)&&Oi(a)===Hr}function hc(a){return a}function fa(a,t){const n=a.stops&&typeof a.stops[0][0]=="object",o=n||!(n||a.property!==void 0),f=a.type||(xu(t)?"exponential":"interval"),g=function(R){switch(R.type){case"color":return Or.parse;case"padding":return ln.parse;case"numberArray":return un.parse;case"colorArray":return Dn.parse;default:return null}}(t);if(g&&((a=me({},a)).stops&&(a.stops=a.stops.map(R=>[R[0],g(R[1])])),a.default=g(a.default?a.default:t.default)),a.colorSpace&&(_=a.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var _;const v=function(R){switch(R){case"exponential":return bu;case"interval":return af;case"categorical":return Xs;case"identity":return al;default:throw new Error(`Unknown function type "${R}"`)}}(f);let T,C;if(f==="categorical"){T=Object.create(null);for(const R of a.stops)T[R[0]]=R[1];C=typeof a.stops[0][0]}if(n){const R={},L=[];for(let Z=0;Z<a.stops.length;Z++){const Y=a.stops[Z],ne=Y[0].zoom;R[ne]===void 0&&(R[ne]={zoom:ne,type:a.type,property:a.property,default:a.default,stops:[]},L.push(ne)),R[ne].stops.push([Y[0].value,Y[1]])}const j=[];for(const Z of L)j.push([R[Z].zoom,fa(R[Z],t)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:Wn.interpolationFactor.bind(void 0,q),zoomStops:j.map(Z=>Z[0]),evaluate:({zoom:Z},Y)=>bu({stops:j,base:a.base},t,Z).evaluate(Z,Y)}}if(o){const R=f==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:Wn.interpolationFactor.bind(void 0,R),zoomStops:a.stops.map(L=>L[0]),evaluate:({zoom:L})=>v(a,t,L,T,C)}}return{kind:"source",evaluate(R,L){const j=L&&L.properties?L.properties[a.property]:void 0;return j===void 0?nl(a.default,t.default):v(a,t,j,T,C)}}}function nl(a,t,n){return a!==void 0?a:t!==void 0?t:n!==void 0?n:void 0}function Xs(a,t,n,o,f){return nl(typeof n===f?o[n]:void 0,a.default,t.default)}function af(a,t,n){if(Lr(n)!=="number")return nl(a.default,t.default);const o=a.stops.length;if(o===1||n<=a.stops[0][0])return a.stops[0][1];if(n>=a.stops[o-1][0])return a.stops[o-1][1];const f=Yo(a.stops.map(g=>g[0]),n);return a.stops[f][1]}function bu(a,t,n){const o=a.base!==void 0?a.base:1;if(Lr(n)!=="number")return nl(a.default,t.default);const f=a.stops.length;if(f===1||n<=a.stops[0][0])return a.stops[0][1];if(n>=a.stops[f-1][0])return a.stops[f-1][1];const g=Yo(a.stops.map(R=>R[0]),n),_=function(R,L,j,q){const Z=q-j,Y=R-j;return Z===0?0:L===1?Y/Z:(Math.pow(L,Y)-1)/(Math.pow(L,Z)-1)}(n,o,a.stops[g][0],a.stops[g+1][0]),v=a.stops[g][1],T=a.stops[g+1][1],C=vs[t.type]||hc;return typeof v.evaluate=="function"?{evaluate(...R){const L=v.evaluate.apply(void 0,R),j=T.evaluate.apply(void 0,R);if(L!==void 0&&j!==void 0)return C(L,j,_,a.colorSpace)}}:C(v,T,_,a.colorSpace)}function al(a,t,n){switch(t.type){case"color":n=Or.parse(n);break;case"formatted":n=on.fromString(n.toString());break;case"resolvedImage":n=ua.fromString(n.toString());break;case"padding":n=ln.parse(n);break;case"colorArray":n=Dn.parse(n);break;case"numberArray":n=un.parse(n);break;default:Lr(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return nl(n,a.default,t.default)}Aa.register(Ol,{error:[{kind:"error"},[wt],(a,[t])=>{throw new Ri(t.evaluate(a))}],typeof:[wt,[Qt],(a,[t])=>Br(Oi(t.evaluate(a)))],"to-rgba":[Cn(Le,4),[Jt],(a,[t])=>{const[n,o,f,g]=t.evaluate(a).rgb;return[255*n,255*o,255*f,g]}],rgb:[Jt,[Le,Le,Le],ch],rgba:[Jt,[Le,Le,Le,Le],ch],has:{type:Nt,overloads:[[[wt],(a,[t])=>cc(t.evaluate(a),a.properties())],[[wt,Hr],(a,[t,n])=>cc(t.evaluate(a),n.evaluate(a))]]},get:{type:Qt,overloads:[[[wt],(a,[t])=>Ca(t.evaluate(a),a.properties())],[[wt,Hr],(a,[t,n])=>Ca(t.evaluate(a),n.evaluate(a))]]},"feature-state":[Qt,[wt],(a,[t])=>Ca(t.evaluate(a),a.featureState||{})],properties:[Hr,[],a=>a.properties()],"geometry-type":[wt,[],a=>a.geometryType()],id:[Qt,[],a=>a.id()],zoom:[Le,[],a=>a.globals.zoom],"heatmap-density":[Le,[],a=>a.globals.heatmapDensity||0],"line-progress":[Le,[],a=>a.globals.lineProgress||0],accumulated:[Qt,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Le,To(Le),(a,t)=>{let n=0;for(const o of t)n+=o.evaluate(a);return n}],"*":[Le,To(Le),(a,t)=>{let n=1;for(const o of t)n*=o.evaluate(a);return n}],"-":{type:Le,overloads:[[[Le,Le],(a,[t,n])=>t.evaluate(a)-n.evaluate(a)],[[Le],(a,[t])=>-t.evaluate(a)]]},"/":[Le,[Le,Le],(a,[t,n])=>t.evaluate(a)/n.evaluate(a)],"%":[Le,[Le,Le],(a,[t,n])=>t.evaluate(a)%n.evaluate(a)],ln2:[Le,[],()=>Math.LN2],pi:[Le,[],()=>Math.PI],e:[Le,[],()=>Math.E],"^":[Le,[Le,Le],(a,[t,n])=>Math.pow(t.evaluate(a),n.evaluate(a))],sqrt:[Le,[Le],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[Le,[Le],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[Le,[Le],(a,[t])=>Math.log(t.evaluate(a))],log2:[Le,[Le],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[Le,[Le],(a,[t])=>Math.sin(t.evaluate(a))],cos:[Le,[Le],(a,[t])=>Math.cos(t.evaluate(a))],tan:[Le,[Le],(a,[t])=>Math.tan(t.evaluate(a))],asin:[Le,[Le],(a,[t])=>Math.asin(t.evaluate(a))],acos:[Le,[Le],(a,[t])=>Math.acos(t.evaluate(a))],atan:[Le,[Le],(a,[t])=>Math.atan(t.evaluate(a))],min:[Le,To(Le),(a,t)=>Math.min(...t.map(n=>n.evaluate(a)))],max:[Le,To(Le),(a,t)=>Math.max(...t.map(n=>n.evaluate(a)))],abs:[Le,[Le],(a,[t])=>Math.abs(t.evaluate(a))],round:[Le,[Le],(a,[t])=>{const n=t.evaluate(a);return n<0?-Math.round(-n):Math.round(n)}],floor:[Le,[Le],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[Le,[Le],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[Nt,[wt,Qt],(a,[t,n])=>a.properties()[t.value]===n.value],"filter-id-==":[Nt,[Qt],(a,[t])=>a.id()===t.value],"filter-type-==":[Nt,[wt],(a,[t])=>a.geometryType()===t.value],"filter-<":[Nt,[wt,Qt],(a,[t,n])=>{const o=a.properties()[t.value],f=n.value;return typeof o==typeof f&&o<f}],"filter-id-<":[Nt,[Qt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[Nt,[wt,Qt],(a,[t,n])=>{const o=a.properties()[t.value],f=n.value;return typeof o==typeof f&&o>f}],"filter-id->":[Nt,[Qt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[Nt,[wt,Qt],(a,[t,n])=>{const o=a.properties()[t.value],f=n.value;return typeof o==typeof f&&o<=f}],"filter-id-<=":[Nt,[Qt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[Nt,[wt,Qt],(a,[t,n])=>{const o=a.properties()[t.value],f=n.value;return typeof o==typeof f&&o>=f}],"filter-id->=":[Nt,[Qt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[Nt,[Qt],(a,[t])=>t.value in a.properties()],"filter-has-id":[Nt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Nt,[Cn(wt)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[Nt,[Cn(Qt)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[Nt,[wt,Cn(Qt)],(a,[t,n])=>n.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[Nt,[wt,Cn(Qt)],(a,[t,n])=>function(o,f,g,_){for(;g<=_;){const v=g+_>>1;if(f[v]===o)return!0;f[v]>o?_=v-1:g=v+1}return!1}(a.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Nt,overloads:[[[Nt,Nt],(a,[t,n])=>t.evaluate(a)&&n.evaluate(a)],[To(Nt),(a,t)=>{for(const n of t)if(!n.evaluate(a))return!1;return!0}]]},any:{type:Nt,overloads:[[[Nt,Nt],(a,[t,n])=>t.evaluate(a)||n.evaluate(a)],[To(Nt),(a,t)=>{for(const n of t)if(n.evaluate(a))return!0;return!1}]]},"!":[Nt,[Nt],(a,[t])=>!t.evaluate(a)],"is-supported-script":[Nt,[wt],(a,[t])=>{const n=a.globals&&a.globals.isSupportedScript;return!n||n(t.evaluate(a))}],upcase:[wt,[wt],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[wt,[wt],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[wt,To(Qt),(a,t)=>t.map(n=>Vr(n.evaluate(a))).join("")],"resolved-locale":[wt,[Pi],(a,[t])=>t.evaluate(a).resolvedLocale()]});class Fl{constructor(t,n){this.expression=t,this._warningHistory={},this._evaluator=new qo,this._defaultValue=n?function(o){if(o.type==="color"&&$s(o.default))return new Or(0,0,0,0);switch(o.type){case"color":return Or.parse(o.default)||null;case"padding":return ln.parse(o.default)||null;case"numberArray":return un.parse(o.default)||null;case"colorArray":return Dn.parse(o.default)||null;case"variableAnchorOffsetCollection":return en.parse(o.default)||null;case"projectionDefinition":return kn.parse(o.default)||null;default:return o.default===void 0?null:o.default}}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,o,f,g,_){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=f,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,f,g,_){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=f,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Ri(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function sl(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Ol}function Ys(a,t){const n=new fu(Ol,ca,[],t?function(f){const g={color:Jt,string:wt,number:Le,enum:wt,boolean:Nt,formatted:_n,padding:ui,numberArray:bi,colorArray:ti,projectionDefinition:ar,resolvedImage:Ln,variableAnchorOffsetCollection:Sr};return f.type==="array"?Cn(g[f.value]||Qt,f.length):g[f.type]}(t):void 0),o=n.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?rl(new Fl(o,t)):Hs(n.errors)}class So{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!ws(n.expression)}evaluateWithoutErrorHandling(t,n,o,f,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,f,g,_)}evaluate(t,n,o,f,g,_){return this._styleExpression.evaluate(t,n,o,f,g,_)}}class ol{constructor(t,n,o,f){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!ws(n.expression),this.interpolationType=f}evaluateWithoutErrorHandling(t,n,o,f,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,f,g,_)}evaluate(t,n,o,f,g,_){return this._styleExpression.evaluate(t,n,o,f,g,_)}interpolationFactor(t,n,o){return this.interpolationType?Wn.interpolationFactor(this.interpolationType,t,n,o):0}}function jl(a,t){const n=Ys(a,t);if(n.result==="error")return n;const o=n.value.expression,f=ha(o);if(!f&&!Eo(t))return Hs([new de("","data expressions not supported")]);const g=Nl(o,["zoom"]);if(!g&&!il(t))return Hs([new de("","zoom expressions not supported")]);const _=Kn(o);return _||g?_ instanceof de?Hs([_]):_ instanceof Wn&&!xu(t)?Hs([new de("",'"interpolate" expressions cannot be used with this property')]):rl(_?new ol(f?"camera":"composite",n.value,_.labels,_ instanceof Wn?_.interpolation:void 0):new So(f?"constant":"source",n.value)):Hs([new de("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Qn{constructor(t,n){this._parameters=t,this._specification=n,me(this,fa(this._parameters,this._specification))}static deserialize(t){return new Qn(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Kn(a){let t=null;if(a instanceof xo)t=Kn(a.result);else if(a instanceof Wo){for(const n of a.args)if(t=Kn(n),t)break}else(a instanceof bo||a instanceof Wn)&&a.input instanceof Aa&&a.input.name==="zoom"&&(t=a);return t instanceof de||a.eachChild(n=>{const o=Kn(n);o instanceof de?t=o:!t&&o?t=new de("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new de("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Ja(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!Ja(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const es={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ma(a){if(a==null)return{filter:()=>!0,needGeometry:!1};Ja(a)||(a=Ul(a));const t=Ys(a,es);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,f)=>t.value.evaluate(n,o,{},f),needGeometry:hh(a)}}function Ts(a,t){return a<t?-1:a>t?1:0}function hh(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let t=1;t<a.length;t++)if(hh(a[t]))return!0;return!1}function Ul(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?wu(a[1],a[2],"=="):t==="!="?ni(wu(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?wu(a[1],a[2],t):t==="any"?(n=a.slice(1),["any"].concat(n.map(Ul))):t==="all"?["all"].concat(a.slice(1).map(Ul)):t==="none"?["all"].concat(a.slice(1).map(Ul).map(ni)):t==="in"?Jn(a[1],a.slice(2)):t==="!in"?ni(Jn(a[1],a.slice(2))):t==="has"?tn(a[1]):t!=="!has"||ni(tn(a[1]));var n}function wu(a,t,n){switch(a){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,a,t]}}function Jn(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",a,["literal",t.sort(Ts)]]:["filter-in-small",a,["literal",t]]}}function tn(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function ni(a){return["!",a]}function Es(a){const t=typeof a;if(t==="number"||t==="boolean"||t==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let f="[";for(const g of a)f+=`${Es(g)},`;return`${f}]`}const n=Object.keys(a).sort();let o="{";for(let f=0;f<n.length;f++)o+=`${JSON.stringify(n[f])}:${Es(a[n[f]])},`;return`${o}}`}function ts(a){let t="";for(const n of Ze)t+=`/${Es(a[n])}`;return t}function ll(a){const t=a.value;return t?[new O(a.key,t,"constants have been deprecated as of v8")]:[]}function Ci(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Ws(a){if(Array.isArray(a))return a.map(Ws);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const n in a)t[n]=Ws(a[n]);return t}return Ci(a)}function va(a){const t=a.key,n=a.value,o=a.valueSpec||{},f=a.objectElementValidators||{},g=a.style,_=a.styleSpec,v=a.validateSpec;let T=[];const C=Lr(n);if(C!=="object")return[new O(t,n,`object expected, ${C} found`)];for(const R in n){const L=R.split(".")[0],j=$r(o,L)||o["*"];let q;if($r(f,L))q=f[L];else if($r(o,L))q=v;else if(f["*"])q=f["*"];else{if(!o["*"]){T.push(new O(t,n[R],`unknown property "${R}"`));continue}q=v}T=T.concat(q({key:(t&&`${t}.`)+R,value:n[R],valueSpec:j,style:g,styleSpec:_,object:n,objectKey:R,validateSpec:v},n))}for(const R in o)f[R]||o[R].required&&o[R].default===void 0&&n[R]===void 0&&T.push(new O(t,n,`missing required property "${R}"`));return T}function ul(a){const t=a.value,n=a.valueSpec,o=a.style,f=a.styleSpec,g=a.key,_=a.arrayElementValidator||a.validateSpec;if(Lr(t)!=="array")return[new O(g,t,`array expected, ${Lr(t)} found`)];if(n.length&&t.length!==n.length)return[new O(g,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new O(g,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let v={type:n.value,values:n.values};f.$version<7&&(v.function=n.function),Lr(n.value)==="object"&&(v=n.value);let T=[];for(let C=0;C<t.length;C++)T=T.concat(_({array:t,arrayIndex:C,value:t[C],valueSpec:v,validateSpec:a.validateSpec,style:o,styleSpec:f,key:`${g}[${C}]`}));return T}function Qs(a){const t=a.key,n=a.value,o=a.valueSpec;let f=Lr(n);return f==="number"&&n!=n&&(f="NaN"),f!=="number"?[new O(t,n,`number expected, ${f} found`)]:"minimum"in o&&n<o.minimum?[new O(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new O(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function fc(a){const t=a.valueSpec,n=Ci(a.value.type);let o,f,g,_={};const v=n!=="categorical"&&a.value.property===void 0,T=!v,C=Lr(a.value.stops)==="array"&&Lr(a.value.stops[0])==="array"&&Lr(a.value.stops[0][0])==="object",R=va({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(q){if(n==="identity")return[new O(q.key,q.value,'identity function may not have a "stops" property')];let Z=[];const Y=q.value;return Z=Z.concat(ul({key:q.key,value:Y,valueSpec:q.valueSpec,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:L})),Lr(Y)==="array"&&Y.length===0&&Z.push(new O(q.key,Y,"array must have at least one stop")),Z},default:function(q){return q.validateSpec({key:q.key,value:q.value,valueSpec:t,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec})}}});return n==="identity"&&v&&R.push(new O(a.key,a.value,'missing required property "property"')),n==="identity"||a.value.stops||R.push(new O(a.key,a.value,'missing required property "stops"')),n==="exponential"&&a.valueSpec.expression&&!xu(a.valueSpec)&&R.push(new O(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(T&&!Eo(a.valueSpec)?R.push(new O(a.key,a.value,"property functions not supported")):v&&!il(a.valueSpec)&&R.push(new O(a.key,a.value,"zoom functions not supported"))),n!=="categorical"&&!C||a.value.property!==void 0||R.push(new O(a.key,a.value,'"property" property is required')),R;function L(q){let Z=[];const Y=q.value,ne=q.key;if(Lr(Y)!=="array")return[new O(ne,Y,`array expected, ${Lr(Y)} found`)];if(Y.length!==2)return[new O(ne,Y,`array length 2 expected, length ${Y.length} found`)];if(C){if(Lr(Y[0])!=="object")return[new O(ne,Y,`object expected, ${Lr(Y[0])} found`)];if(Y[0].zoom===void 0)return[new O(ne,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new O(ne,Y,"object stop key must have value")];if(g&&g>Ci(Y[0].zoom))return[new O(ne,Y[0].zoom,"stop zoom values must appear in ascending order")];Ci(Y[0].zoom)!==g&&(g=Ci(Y[0].zoom),f=void 0,_={}),Z=Z.concat(va({key:`${ne}[0]`,value:Y[0],valueSpec:{zoom:{}},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:Qs,value:j}}))}else Z=Z.concat(j({key:`${ne}[0]`,value:Y[0],validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec},Y));return sl(Ws(Y[1]))?Z.concat([new O(`${ne}[1]`,Y[1],"expressions are not allowed in function stops.")]):Z.concat(q.validateSpec({key:`${ne}[1]`,value:Y[1],valueSpec:t,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec}))}function j(q,Z){const Y=Lr(q.value),ne=Ci(q.value),fe=q.value!==null?q.value:Z;if(o){if(Y!==o)return[new O(q.key,fe,`${Y} stop domain type must match previous stop domain type ${o}`)]}else o=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean")return[new O(q.key,fe,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&n!=="categorical"){let Ie=`number expected, ${Y} found`;return Eo(t)&&n===void 0&&(Ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new O(q.key,fe,Ie)]}return n!=="categorical"||Y!=="number"||isFinite(ne)&&Math.floor(ne)===ne?n!=="categorical"&&Y==="number"&&f!==void 0&&ne<f?[new O(q.key,fe,"stop domain values must appear in ascending order")]:(f=ne,n==="categorical"&&ne in _?[new O(q.key,fe,"stop domain values must be unique")]:(_[ne]=!0,[])):[new O(q.key,fe,`integer expected, found ${ne}`)]}}function xa(a){const t=(a.expressionContext==="property"?jl:Ys)(Ws(a.value),a.valueSpec);if(t.result==="error")return t.value.map(o=>new O(`${a.key}${o.key}`,a.value,o.message));const n=t.value.expression||t.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!n.outputDefined())return[new O(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!ws(n))return[new O(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!ws(n))return[new O(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Nl(n,["zoom","feature-state"]))return[new O(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!ha(n))return[new O(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Tu(a){const t=a.key,n=a.value,o=Lr(n);return o!=="string"?[new O(t,n,`color expected, ${o} found`)]:Or.parse(String(n))?[]:[new O(t,n,`color expected, "${n}" found`)]}function rs(a){const t=a.key,n=a.value,o=a.valueSpec,f=[];return Array.isArray(o.values)?o.values.indexOf(Ci(n))===-1&&f.push(new O(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(Ci(n))===-1&&f.push(new O(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),f}function is(a){return Ja(Ws(a.value))?xa(me({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ks(a)}function Ks(a){const t=a.value,n=a.key;if(Lr(t)!=="array")return[new O(n,t,`array expected, ${Lr(t)} found`)];const o=a.styleSpec;let f,g=[];if(t.length<1)return[new O(n,t,"filter array must have at least 1 element")];switch(g=g.concat(rs({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:a.style,styleSpec:a.styleSpec})),Ci(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ci(t[1])==="$type"&&g.push(new O(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new O(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=Lr(t[1]),f!=="string"&&g.push(new O(`${n}[1]`,t[1],`string expected, ${f} found`)));for(let _=2;_<t.length;_++)f=Lr(t[_]),Ci(t[1])==="$type"?g=g.concat(rs({key:`${n}[${_}]`,value:t[_],valueSpec:o.geometry_type,style:a.style,styleSpec:a.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&g.push(new O(`${n}[${_}]`,t[_],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)g=g.concat(Ks({key:`${n}[${_}]`,value:t[_],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":f=Lr(t[1]),t.length!==2?g.push(new O(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="string"&&g.push(new O(`${n}[1]`,t[1],`string expected, ${f} found`))}return g}function Ss(a,t){const n=a.key,o=a.validateSpec,f=a.style,g=a.styleSpec,_=a.value,v=a.objectKey,T=g[`${t}_${a.layerType}`];if(!T)return[];const C=v.match(/^(.*)-transition$/);if(t==="paint"&&C&&T[C[1]]&&T[C[1]].transition)return o({key:n,value:_,valueSpec:g.transition,style:f,styleSpec:g});const R=a.valueSpec||T[v];if(!R)return[new O(n,_,`unknown property "${v}"`)];let L;if(Lr(_)==="string"&&Eo(R)&&!R.tokens&&(L=/^{([^}]+)}$/.exec(_)))return[new O(n,_,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const j=[];return a.layerType==="symbol"&&(v==="text-field"&&f&&!f.glyphs&&j.push(new O(n,_,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&$s(Ws(_))&&Ci(_.type)==="identity"&&j.push(new O(n,_,'"text-font" does not support identity functions'))),j.concat(o({key:a.key,value:_,valueSpec:R,style:f,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:v}))}function dc(a){return Ss(a,"paint")}function Ao(a){return Ss(a,"layout")}function As(a){let t=[];const n=a.value,o=a.key,f=a.style,g=a.styleSpec;if(Lr(n)!=="object")return[new O(o,n,`object expected, ${Lr(n)} found`)];n.type||n.ref||t.push(new O(o,n,'either "type" or "ref" is required'));let _=Ci(n.type);const v=Ci(n.ref);if(n.id){const T=Ci(n.id);for(let C=0;C<a.arrayIndex;C++){const R=f.layers[C];Ci(R.id)===T&&t.push(new O(o,n.id,`duplicate layer id "${n.id}", previously used at line ${R.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach(C=>{C in n&&t.push(new O(o,n[C],`"${C}" is prohibited for ref layers`))}),f.layers.forEach(C=>{Ci(C.id)===v&&(T=C)}),T?T.ref?t.push(new O(o,n.ref,"ref cannot reference another ref layer")):_=Ci(T.type):t.push(new O(o,n.ref,`ref layer "${v}" not found`))}else if(_!=="background")if(n.source){const T=f.sources&&f.sources[n.source],C=T&&Ci(T.type);T?C==="vector"&&_==="raster"?t.push(new O(o,n.source,`layer "${n.id}" requires a raster source`)):C!=="raster-dem"&&_==="hillshade"?t.push(new O(o,n.source,`layer "${n.id}" requires a raster-dem source`)):C==="raster"&&_!=="raster"?t.push(new O(o,n.source,`layer "${n.id}" requires a vector source`)):C!=="vector"||n["source-layer"]?C==="raster-dem"&&_!=="hillshade"?t.push(new O(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!n.paint||!n.paint["line-gradient"]||C==="geojson"&&T.lineMetrics||t.push(new O(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new O(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new O(o,n.source,`source "${n.source}" not found`))}else t.push(new O(o,n,'missing required property "source"'));return t=t.concat(va({key:o,value:n,valueSpec:g.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${o}.type`,value:n.type,valueSpec:g.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:n,objectKey:"type"}),filter:is,layout:T=>va({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>Ao(me({layerType:_},C))}}),paint:T=>va({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>dc(me({layerType:_},C))}})}})),t}function hn(a){const t=a.value,n=a.key,o=Lr(t);return o!=="string"?[new O(n,t,`string expected, ${o} found`)]:[]}const Ha={promoteId:function({key:a,value:t}){if(Lr(t)==="string")return hn({key:a,value:t});{const n=[];for(const o in t)n.push(...hn({key:`${a}.${o}`,value:t[o]}));return n}}};function Nn(a){const t=a.value,n=a.key,o=a.styleSpec,f=a.style,g=a.validateSpec;if(!t.type)return[new O(n,t,'"type" is required')];const _=Ci(t.type);let v;switch(_){case"vector":case"raster":return v=va({key:n,value:t,valueSpec:o[`source_${_.replace("-","_")}`],style:a.style,styleSpec:o,objectElementValidators:Ha,validateSpec:g}),v;case"raster-dem":return v=function(T){var C;const R=(C=T.sourceName)!==null&&C!==void 0?C:"",L=T.value,j=T.styleSpec,q=j.source_raster_dem,Z=T.style;let Y=[];const ne=Lr(L);if(L===void 0)return Y;if(ne!=="object")return Y.push(new O("source_raster_dem",L,`object expected, ${ne} found`)),Y;const fe=Ci(L.encoding)==="custom",Ie=["redFactor","greenFactor","blueFactor","baseShift"],ve=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const V in L)!fe&&Ie.includes(V)?Y.push(new O(V,L[V],`In "${R}": "${V}" is only valid when "encoding" is set to "custom". ${ve} encoding found`)):q[V]?Y=Y.concat(T.validateSpec({key:V,value:L[V],valueSpec:q[V],validateSpec:T.validateSpec,style:Z,styleSpec:j})):Y.push(new O(V,L[V],`unknown property "${V}"`));return Y}({sourceName:n,value:t,style:a.style,styleSpec:o,validateSpec:g}),v;case"geojson":if(v=va({key:n,value:t,valueSpec:o.source_geojson,style:f,styleSpec:o,validateSpec:g,objectElementValidators:Ha}),t.cluster)for(const T in t.clusterProperties){const[C,R]=t.clusterProperties[T],L=typeof C=="string"?[C,["accumulated"],["get",T]]:C;v.push(...xa({key:`${n}.${T}.map`,value:R,expressionContext:"cluster-map"})),v.push(...xa({key:`${n}.${T}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return v;case"video":return va({key:n,value:t,valueSpec:o.source_video,style:f,validateSpec:g,styleSpec:o});case"image":return va({key:n,value:t,valueSpec:o.source_image,style:f,validateSpec:g,styleSpec:o});case"canvas":return[new O(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return rs({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Eu(a){const t=a.value,n=a.styleSpec,o=n.light,f=a.style;let g=[];const _=Lr(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new O("light",t,`object expected, ${_} found`)]),g;for(const v in t){const T=v.match(/^(.*)-transition$/);g=g.concat(T&&o[T[1]]&&o[T[1]].transition?a.validateSpec({key:v,value:t[v],valueSpec:n.transition,validateSpec:a.validateSpec,style:f,styleSpec:n}):o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:a.validateSpec,style:f,styleSpec:n}):[new O(v,t[v],`unknown property "${v}"`)])}return g}function fh(a){const t=a.value,n=a.styleSpec,o=n.sky,f=a.style,g=Lr(t);if(t===void 0)return[];if(g!=="object")return[new O("sky",t,`object expected, ${g} found`)];let _=[];for(const v in t)_=_.concat(o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],style:f,styleSpec:n}):[new O(v,t[v],`unknown property "${v}"`)]);return _}function Vl(a){const t=a.value,n=a.styleSpec,o=n.terrain,f=a.style;let g=[];const _=Lr(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new O("terrain",t,`object expected, ${_} found`)]),g;for(const v in t)g=g.concat(o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:a.validateSpec,style:f,styleSpec:n}):[new O(v,t[v],`unknown property "${v}"`)]);return g}function dh(a){let t=[];const n=a.value,o=a.key;if(Array.isArray(n)){const f=[],g=[];for(const _ in n)n[_].id&&f.includes(n[_].id)&&t.push(new O(o,n,`all the sprites' ids must be unique, but ${n[_].id} is duplicated`)),f.push(n[_].id),n[_].url&&g.includes(n[_].url)&&t.push(new O(o,n,`all the sprites' URLs must be unique, but ${n[_].url} is duplicated`)),g.push(n[_].url),t=t.concat(va({key:`${o}[${_}]`,value:n[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return t}return hn({key:o,value:n})}function pc(a){return t=a.value,t&&t.constructor===Object?[]:[new O(a.key,a.value,`object expected, ${Lr(a.value)} found`)];var t}const Sn={"*":()=>[],array:ul,boolean:function(a){const t=a.value,n=a.key,o=Lr(t);return o!=="boolean"?[new O(n,t,`boolean expected, ${o} found`)]:[]},number:Qs,color:Tu,constants:ll,enum:rs,filter:is,function:fc,layer:As,object:va,source:Nn,light:Eu,sky:fh,terrain:Vl,projection:function(a){const t=a.value,n=a.styleSpec,o=n.projection,f=a.style,g=Lr(t);if(t===void 0)return[];if(g!=="object")return[new O("projection",t,`object expected, ${g} found`)];let _=[];for(const v in t)_=_.concat(o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],style:f,styleSpec:n}):[new O(v,t[v],`unknown property "${v}"`)]);return _},projectionDefinition:function(a){const t=a.key;let n=a.value;n=n instanceof String?n.valueOf():n;const o=Lr(n);return o!=="array"||function(f){return Array.isArray(f)&&f.length===3&&typeof f[0]=="string"&&typeof f[1]=="string"&&typeof f[2]=="number"}(n)||function(f){return!!["interpolate","step","literal"].includes(f[0])}(n)?["array","string"].includes(o)?[]:[new O(t,n,`projection expected, invalid type "${o}" found`)]:[new O(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:hn,formatted:function(a){return hn(a).length===0?[]:xa(a)},resolvedImage:function(a){return hn(a).length===0?[]:xa(a)},padding:function(a){const t=a.key,n=a.value;if(Lr(n)==="array"){if(n.length<1||n.length>4)return[new O(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let f=[];for(let g=0;g<n.length;g++)f=f.concat(a.validateSpec({key:`${t}[${g}]`,value:n[g],validateSpec:a.validateSpec,valueSpec:o}));return f}return Qs({key:t,value:n,valueSpec:{}})},numberArray:function(a){const t=a.key,n=a.value;if(Lr(n)==="array"){const o={type:"number"};if(n.length<1)return[new O(t,n,"array length at least 1 expected, length 0 found")];let f=[];for(let g=0;g<n.length;g++)f=f.concat(a.validateSpec({key:`${t}[${g}]`,value:n[g],validateSpec:a.validateSpec,valueSpec:o}));return f}return Qs({key:t,value:n,valueSpec:{}})},colorArray:function(a){const t=a.key,n=a.value;if(Lr(n)==="array"){if(n.length<1)return[new O(t,n,"array length at least 1 expected, length 0 found")];let o=[];for(let f=0;f<n.length;f++)o=o.concat(Tu({key:`${t}[${f}]`,value:n[f]}));return o}return Tu({key:t,value:n})},variableAnchorOffsetCollection:function(a){const t=a.key,n=a.value,o=Lr(n),f=a.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new O(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let _=0;_<n.length;_+=2)g=g.concat(rs({key:`${t}[${_}]`,value:n[_],valueSpec:f.layout_symbol["text-anchor"]})),g=g.concat(ul({key:`${t}[${_+1}]`,value:n[_+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:f}));return g},sprite:dh,state:pc};function Co(a){const t=a.value,n=a.valueSpec,o=a.styleSpec;return a.validateSpec=Co,n.expression&&$s(Ci(t))?fc(a):n.expression&&sl(Ws(t))?xa(a):n.type&&Sn[n.type]?Sn[n.type](a):va(me({},a,{valueSpec:n.type?o[n.type]:n}))}function ql(a){const t=a.value,n=a.key,o=hn(a);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new O(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new O(n,t,'"glyphs" url must include a "{range}" token'))),o}function An(a,t=re){let n=[];return n=n.concat(Co({key:"",value:a,valueSpec:t.$root,styleSpec:t,style:a,validateSpec:Co,objectElementValidators:{glyphs:ql,"*":()=>[]}})),a.constants&&(n=n.concat(ll({key:"constants",value:a.constants}))),ns(n)}function Da(a){return function(t){return a({...t,validateSpec:Co})}}function ns(a){return[].concat(a).sort((t,n)=>t.line-n.line)}function ea(a){return function(...t){return ns(a.apply(this,t))}}An.source=ea(Da(Nn)),An.sprite=ea(Da(dh)),An.glyphs=ea(Da(ql)),An.light=ea(Da(Eu)),An.sky=ea(Da(fh)),An.terrain=ea(Da(Vl)),An.state=ea(Da(pc)),An.layer=ea(Da(As)),An.filter=ea(Da(is)),An.paintProperty=ea(Da(dc)),An.layoutProperty=ea(Da(Ao));const Gl=An,Su=Gl.light,yd=Gl.sky,mc=Gl.paintProperty,Cs=Gl.layoutProperty;function Au(a,t){let n=!1;if(t&&t.length)for(const o of t)a.fire(new ye(new Error(o.message))),n=!0;return n}class Js{constructor(t,n,o){const f=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(n=_[1])+2*(o=_[2]);for(let T=0;T<this.d*this.d;T++){const C=_[3+T],R=_[3+T+1];f.push(C===R?null:_.subarray(C,R))}const v=_[3+f.length+1];this.keys=_.subarray(_[3+f.length],v),this.bboxes=_.subarray(v),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let _=0;_<this.d*this.d;_++)f.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const g=o/n*t;this.min=-g,this.max=t+g}insert(t,n,o,f,g){this._forEachCell(n,o,f,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(f),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,f,g,_){this.cells[g].push(_)}query(t,n,o,f,g){const _=this.min,v=this.max;if(t<=_&&n<=_&&v<=o&&v<=f&&!g)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(t,n,o,f,this._queryCell,T,{},g),T}}_queryCell(t,n,o,f,g,_,v,T){const C=this.cells[g];if(C!==null){const R=this.keys,L=this.bboxes;for(let j=0;j<C.length;j++){const q=C[j];if(v[q]===void 0){const Z=4*q;(T?T(L[Z+0],L[Z+1],L[Z+2],L[Z+3]):t<=L[Z+2]&&n<=L[Z+3]&&o>=L[Z+0]&&f>=L[Z+1])?(v[q]=!0,_.push(R[q])):v[q]=!1}}}}_forEachCell(t,n,o,f,g,_,v,T){const C=this._convertToCellCoord(t),R=this._convertToCellCoord(n),L=this._convertToCellCoord(o),j=this._convertToCellCoord(f);for(let q=C;q<=L;q++)for(let Z=R;Z<=j;Z++){const Y=this.d*Z+q;if((!T||T(this._convertFromCellCoord(q),this._convertFromCellCoord(Z),this._convertFromCellCoord(q+1),this._convertFromCellCoord(Z+1)))&&g.call(this,t,n,o,f,Y,_,v,T))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let _=0;_<this.cells.length;_++)o+=this.cells[_].length;const f=new Int32Array(n+o+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let g=n;for(let _=0;_<t.length;_++){const v=t[_];f[3+_]=g,f.set(v,g),g+=v.length}return f[3+t.length]=g,f.set(this.keys,g),g+=this.keys.length,f[3+t.length+1]=g,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new Js(t.buffer)}}const as={};function Wt(a,t,n={}){if(as[a])throw new Error(`${a} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:a,writeable:!1}),as[a]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}Wt("Object",Object),Wt("TransferableGridIndex",Js),Wt("Color",Or),Wt("Error",Error),Wt("AJAXError",Zr),Wt("ResolvedImage",ua),Wt("StylePropertyFunction",Qn),Wt("StyleExpression",Fl,{omit:["_evaluator"]}),Wt("ZoomDependentExpression",ol),Wt("ZoomConstantExpression",So),Wt("CompoundExpression",Aa,{omit:["_evaluate"]});for(const a in Ol)Ol[a]._classRegistryKey||Wt(`Expression_${a}`,Ol[a]);function Cu(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function cl(a){return a.$name||a.constructor._classRegistryKey}function gc(a){return!function(t){if(t===null||typeof t!="object")return!1;const n=cl(t);return!(!n||n==="Object")}(a)&&(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error||Cu(a)||_r(a)||ArrayBuffer.isView(a)||a instanceof ImageData)}function hl(a,t){if(gc(a))return(Cu(a)||_r(a))&&t&&t.push(a),ArrayBuffer.isView(a)&&t&&t.push(a.buffer),a instanceof ImageData&&t&&t.push(a.data.buffer),a;if(Array.isArray(a)){const g=[];for(const _ of a)g.push(hl(_,t));return g}if(typeof a!="object")throw new Error("can't serialize object of type "+typeof a);const n=cl(a);if(!n)throw new Error(`can't serialize object of unregistered class ${a.constructor.name}`);if(!as[n])throw new Error(`${n} is not registered.`);const{klass:o}=as[n],f=o.serialize?o.serialize(a,t):{};if(o.serialize){if(t&&f===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in a){if(!a.hasOwnProperty(g)||as[n].omit.indexOf(g)>=0)continue;const _=a[g];f[g]=as[n].shallow.indexOf(g)>=0?_:hl(_,t)}a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(f.$name=n),f}function Mo(a){if(gc(a))return a;if(Array.isArray(a))return a.map(Mo);if(typeof a!="object")throw new Error("can't deserialize object of type "+typeof a);const t=cl(a)||"Object";if(!as[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=as[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(a);const o=Object.create(n.prototype);for(const f of Object.keys(a)){if(f==="$name")continue;const g=a[f];o[f]=as[t].shallow.indexOf(f)>=0?g:Mo(g)}return o}class _c{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const zr={"Latin-1 Supplement":a=>a>=128&&a<=255,"Hangul Jamo":a=>a>=4352&&a<=4607,Khmer:a=>a>=6016&&a<=6143,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Kanbun:a=>a>=12688&&a<=12703,"CJK Strokes":a=>a>=12736&&a<=12783,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Hangul Syllables":a=>a>=44032&&a<=55215,"Private Use Area":a=>a>=57344&&a<=63743,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function Mu(a){for(const t of a)if(ss(t.charCodeAt(0)))return!0;return!1}function sf(a){for(const t of a)if(!vc(t.charCodeAt(0)))return!1;return!0}function Ms(a){const t=a.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}const yc=Ms(["Arab","Dupl","Mong","Ougr","Syrc"]);function vc(a){return!yc.test(String.fromCodePoint(a))}const Ds=Ms(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ss(a){return!(a!==746&&a!==747&&(a<4352||!(zr["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||zr["CJK Compatibility"](a)||zr["CJK Strokes"](a)||!(!zr["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||zr["Enclosed CJK Letters and Months"](a)||zr["Ideographic Description Characters"](a)||zr.Kanbun(a)||zr.Katakana(a)&&a!==12540||!(!zr["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!zr["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||zr["Vertical Forms"](a)||zr["Yijing Hexagram Symbols"](a)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(a))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(a))||Ds.test(String.fromCodePoint(a)))))}function eo(a){return!(ss(a)||function(t){return!!(zr["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||zr["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||zr["Letterlike Symbols"](t)||zr["Number Forms"](t)||zr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||zr["Control Pictures"](t)&&t!==9251||zr["Optical Character Recognition"](t)||zr["Enclosed Alphanumerics"](t)||zr["Geometric Shapes"](t)||zr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||zr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||zr["CJK Symbols and Punctuation"](t)||zr.Katakana(t)||zr["Private Use Area"](t)||zr["CJK Compatibility Forms"](t)||zr["Small Form Variants"](t)||zr["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(a))}const ph=Ms(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Zl(a){return ph.test(String.fromCodePoint(a))}function Du(a,t){return!(!t&&Zl(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||zr.Khmer(a))}function Iu(a){for(const t of a)if(Zl(t.charCodeAt(0)))return!0;return!1}const Is=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(a){this.pluginStatus=a.pluginStatus,this.pluginURL=a.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(a){if(Is.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=a.applyArabicShaping,this.processBidirectionalText=a.processBidirectionalText,this.processStyledBidirectionalText=a.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(a,t){return c(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(a.pluginStatus!=="loading")return this.setState(a),a;const n=a.pluginURL,o=new Promise(g=>{this.loadScriptResolve=g});t(n);const f=new Promise(g=>setTimeout(()=>g(),this.TIMEOUT));if(yield Promise.race([o,f]),this.isParsed()){const g={pluginStatus:"loaded",pluginURL:n};return this.setState(g),g}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)})}};class zi{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new _c,this.transition={})}isSupportedScript(t){return function(n,o){for(const f of n)if(!Du(f.charCodeAt(0),o))return!1;return!0}(t,Is.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class Ps{constructor(t,n){this.property=t,this.value=n,this.expression=function(o,f){if($s(o))return new Qn(o,f);if(sl(o)){const g=jl(o,f);if(g.result==="error")throw new Error(g.value.map(_=>`${_.key}: ${_.message}`).join(", "));return g.value}{let g=o;return f.type==="color"&&typeof o=="string"?g=Or.parse(o):f.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?f.type!=="numberArray"||typeof o!="number"&&!Array.isArray(o)?f.type!=="colorArray"||typeof o!="string"&&!Array.isArray(o)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(o)?g=en.parse(o):f.type==="projectionDefinition"&&typeof o=="string"&&(g=kn.parse(o)):g=Dn.parse(o):g=un.parse(o):g=ln.parse(o),{kind:"constant",evaluate:()=>g}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class Hl{constructor(t){this.property=t,this.value=new Ps(t,void 0)}transitioned(t,n){return new xc(this.property,this.value,n,Xt({},t.transition,this.transition),t.now)}untransitioned(){return new xc(this.property,this.value,null,{},0)}}class mh{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return jr(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Hl(this._values[t].property)),this._values[t].value=new Ps(this._values[t].property,n===null?void 0:jr(n))}getTransition(t){return jr(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Hl(this._values[t].property)),this._values[t].transition=jr(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const f=this.getTransition(n);f!==void 0&&(t[`${n}-transition`]=f)}return t}transitioned(t,n){const o=new bc(this._properties);for(const f of Object.keys(this._values))o._values[f]=this._values[f].transitioned(t,n._values[f]);return o}untransitioned(){const t=new bc(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class xc{constructor(t,n,o,f,g){this.property=t,this.value=n,this.begin=g+f.delay||0,this.end=this.begin+f.duration||0,t.specification.transition&&(f.delay||f.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const f=t.now||0,g=this.value.possiblyEvaluate(t,n,o),_=this.prior;if(_){if(f>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(f<this.begin)return _.possiblyEvaluate(t,n,o);{const v=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,n,o),g,Mt(v))}}return g}}class bc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const f=new di(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(t,n,o);return f}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Do{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return jr(this._values[t].value)}setValue(t,n){this._values[t]=new Ps(this._values[t].property,n===null?void 0:jr(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const f=new di(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(t,n,o);return f}}class vr{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,f){return this.property.evaluate(this.value,this.parameters,t,n,o,f)}}class di{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class $t{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const f=vs[this.specification.type];return f?f(t,n,o):t}}class pr{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,f){return new vr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,f)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new vr(this,{kind:"constant",value:void 0},t.parameters);const f=vs[this.specification.type];if(f){const g=f(t.value.value,n.value.value,o);return new vr(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,n,o,f,g,_){return t.kind==="constant"?t.value:t.evaluate(n,o,f,g,_)}}class Rs extends pr{possiblyEvaluate(t,n,o,f){if(t.value===void 0)return new vr(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const g=t.expression.evaluate(n,null,{},o,f),_=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,v=this._calculate(_,_,_,n);return new vr(this,{kind:"constant",value:v},n)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new vr(this,{kind:"constant",value:g},n)}return new vr(this,t.expression,n)}evaluate(t,n,o,f,g,_){if(t.kind==="source"){const v=t.evaluate(n,o,f,g,_);return this._calculate(v,v,v,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,f),t.evaluate({zoom:Math.floor(n.zoom)},o,f),t.evaluate({zoom:Math.floor(n.zoom)+1},o,f),n):t.value}_calculate(t,n,o,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class to{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,f){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(n,null,{},o,f);return this._calculate(g,g,g,n)}return this._calculate(t.expression.evaluate(new zi(Math.floor(n.zoom-1),n)),t.expression.evaluate(new zi(Math.floor(n.zoom),n)),t.expression.evaluate(new zi(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class $l{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,f){return!!t.expression.evaluate(n,null,{},o,f)}interpolate(){return!1}}class Wi{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const f=this.defaultPropertyValues[n]=new Ps(o,void 0),g=this.defaultTransitionablePropertyValues[n]=new Hl(o);this.defaultTransitioningPropertyValues[n]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=f.possiblyEvaluate({})}}}Wt("DataDrivenProperty",pr),Wt("DataConstantProperty",$t),Wt("CrossFadedDataDrivenProperty",Rs),Wt("CrossFadedProperty",to),Wt("ColorRampProperty",$l);const Io="-transition";class $a extends Ee{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new Do(n.layout)),n.paint)){this._transitionablePaint=new mh(n.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new di(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,o={}){n!=null&&this._validate(Cs,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(Io)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(mc,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(Io))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const f=this._transitionablePaint._values[t],g=f.property.specification["property-type"]==="cross-faded-data-driven",_=f.value.isDataDriven(),v=f.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const T=this._transitionablePaint._values[t].value;return T.isDataDriven()||_||g||this._handleOverridablePaintPropertyUpdate(t,v,T)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Si(t,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(t,n,o,f,g={}){return(!g||g.validate!==!1)&&Au(this,t.call(Gl,{key:n,layerType:this.type,objectKey:o,value:f,styleSpec:re,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof vr&&Eo(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const fn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ro{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class qi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Gi(a,t=1){let n=0,o=0;return{members:a.map(f=>{const g=fn[f.type].BYTES_PER_ELEMENT,_=n=fl(n,Math.max(t,g)),v=f.components||1;return o=Math.max(o,g),n+=g*v,{name:f.name,type:f.type,components:v,offset:_}}),size:fl(n,Math.max(o,t)),alignment:t}}function fl(a,t){return Math.ceil(a/t)*t}class Pu extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const f=2*t;return this.int16[f+0]=n,this.int16[f+1]=o,t}}Pu.prototype.bytesPerElement=4,Wt("StructArrayLayout2i4",Pu);class dl extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,o)}emplace(t,n,o,f){const g=3*t;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=f,t}}dl.prototype.bytesPerElement=6,Wt("StructArrayLayout3i6",dl);class io extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,f)}emplace(t,n,o,f,g){const _=4*t;return this.int16[_+0]=n,this.int16[_+1]=o,this.int16[_+2]=f,this.int16[_+3]=g,t}}io.prototype.bytesPerElement=8,Wt("StructArrayLayout4i8",io);class Ru extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,f,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,f,g,_)}emplace(t,n,o,f,g,_,v){const T=6*t;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=f,this.int16[T+3]=g,this.int16[T+4]=_,this.int16[T+5]=v,t}}Ru.prototype.bytesPerElement=12,Wt("StructArrayLayout2i4i12",Ru);class ta extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,f,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,f,g,_)}emplace(t,n,o,f,g,_,v){const T=4*t,C=8*t;return this.int16[T+0]=n,this.int16[T+1]=o,this.uint8[C+4]=f,this.uint8[C+5]=g,this.uint8[C+6]=_,this.uint8[C+7]=v,t}}ta.prototype.bytesPerElement=8,Wt("StructArrayLayout2i4ub8",ta);class Zi extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const f=2*t;return this.float32[f+0]=n,this.float32[f+1]=o,t}}Zi.prototype.bytesPerElement=8,Wt("StructArrayLayout2f8",Zi);class zu extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,f,g,_,v,T,C,R){const L=this.length;return this.resize(L+1),this.emplace(L,t,n,o,f,g,_,v,T,C,R)}emplace(t,n,o,f,g,_,v,T,C,R,L){const j=10*t;return this.uint16[j+0]=n,this.uint16[j+1]=o,this.uint16[j+2]=f,this.uint16[j+3]=g,this.uint16[j+4]=_,this.uint16[j+5]=v,this.uint16[j+6]=T,this.uint16[j+7]=C,this.uint16[j+8]=R,this.uint16[j+9]=L,t}}zu.prototype.bytesPerElement=20,Wt("StructArrayLayout10ui20",zu);class d extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,f,g,_,v,T,C,R,L,j){const q=this.length;return this.resize(q+1),this.emplace(q,t,n,o,f,g,_,v,T,C,R,L,j)}emplace(t,n,o,f,g,_,v,T,C,R,L,j,q){const Z=12*t;return this.int16[Z+0]=n,this.int16[Z+1]=o,this.int16[Z+2]=f,this.int16[Z+3]=g,this.uint16[Z+4]=_,this.uint16[Z+5]=v,this.uint16[Z+6]=T,this.uint16[Z+7]=C,this.int16[Z+8]=R,this.int16[Z+9]=L,this.int16[Z+10]=j,this.int16[Z+11]=q,t}}d.prototype.bytesPerElement=24,Wt("StructArrayLayout4i4ui4i24",d);class e extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,o)}emplace(t,n,o,f){const g=3*t;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=f,t}}e.prototype.bytesPerElement=12,Wt("StructArrayLayout3f12",e);class i extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}i.prototype.bytesPerElement=4,Wt("StructArrayLayout1ul4",i);class l extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,f,g,_,v,T,C){const R=this.length;return this.resize(R+1),this.emplace(R,t,n,o,f,g,_,v,T,C)}emplace(t,n,o,f,g,_,v,T,C,R){const L=10*t,j=5*t;return this.int16[L+0]=n,this.int16[L+1]=o,this.int16[L+2]=f,this.int16[L+3]=g,this.int16[L+4]=_,this.int16[L+5]=v,this.uint32[j+3]=T,this.uint16[L+8]=C,this.uint16[L+9]=R,t}}l.prototype.bytesPerElement=20,Wt("StructArrayLayout6i1ul2ui20",l);class h extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,f,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,f,g,_)}emplace(t,n,o,f,g,_,v){const T=6*t;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=f,this.int16[T+3]=g,this.int16[T+4]=_,this.int16[T+5]=v,t}}h.prototype.bytesPerElement=12,Wt("StructArrayLayout2i2i2i12",h);class m extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,f,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,f,g)}emplace(t,n,o,f,g,_){const v=4*t,T=8*t;return this.float32[v+0]=n,this.float32[v+1]=o,this.float32[v+2]=f,this.int16[T+6]=g,this.int16[T+7]=_,t}}m.prototype.bytesPerElement=16,Wt("StructArrayLayout2f1f2i16",m);class y extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,f,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,f,g,_)}emplace(t,n,o,f,g,_,v){const T=16*t,C=4*t,R=8*t;return this.uint8[T+0]=n,this.uint8[T+1]=o,this.float32[C+1]=f,this.float32[C+2]=g,this.int16[R+6]=_,this.int16[R+7]=v,t}}y.prototype.bytesPerElement=16,Wt("StructArrayLayout2ub2f2i16",y);class b extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,o)}emplace(t,n,o,f){const g=3*t;return this.uint16[g+0]=n,this.uint16[g+1]=o,this.uint16[g+2]=f,t}}b.prototype.bytesPerElement=6,Wt("StructArrayLayout3ui6",b);class E extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,f,g,_,v,T,C,R,L,j,q,Z,Y,ne,fe){const Ie=this.length;return this.resize(Ie+1),this.emplace(Ie,t,n,o,f,g,_,v,T,C,R,L,j,q,Z,Y,ne,fe)}emplace(t,n,o,f,g,_,v,T,C,R,L,j,q,Z,Y,ne,fe,Ie){const ve=24*t,V=12*t,te=48*t;return this.int16[ve+0]=n,this.int16[ve+1]=o,this.uint16[ve+2]=f,this.uint16[ve+3]=g,this.uint32[V+2]=_,this.uint32[V+3]=v,this.uint32[V+4]=T,this.uint16[ve+10]=C,this.uint16[ve+11]=R,this.uint16[ve+12]=L,this.float32[V+7]=j,this.float32[V+8]=q,this.uint8[te+36]=Z,this.uint8[te+37]=Y,this.uint8[te+38]=ne,this.uint32[V+10]=fe,this.int16[ve+22]=Ie,t}}E.prototype.bytesPerElement=48,Wt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",E);class P extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,f,g,_,v,T,C,R,L,j,q,Z,Y,ne,fe,Ie,ve,V,te,be,Ke,At,rt,ht,Lt,Dt){const Ft=this.length;return this.resize(Ft+1),this.emplace(Ft,t,n,o,f,g,_,v,T,C,R,L,j,q,Z,Y,ne,fe,Ie,ve,V,te,be,Ke,At,rt,ht,Lt,Dt)}emplace(t,n,o,f,g,_,v,T,C,R,L,j,q,Z,Y,ne,fe,Ie,ve,V,te,be,Ke,At,rt,ht,Lt,Dt,Ft){const mt=32*t,er=16*t;return this.int16[mt+0]=n,this.int16[mt+1]=o,this.int16[mt+2]=f,this.int16[mt+3]=g,this.int16[mt+4]=_,this.int16[mt+5]=v,this.int16[mt+6]=T,this.int16[mt+7]=C,this.uint16[mt+8]=R,this.uint16[mt+9]=L,this.uint16[mt+10]=j,this.uint16[mt+11]=q,this.uint16[mt+12]=Z,this.uint16[mt+13]=Y,this.uint16[mt+14]=ne,this.uint16[mt+15]=fe,this.uint16[mt+16]=Ie,this.uint16[mt+17]=ve,this.uint16[mt+18]=V,this.uint16[mt+19]=te,this.uint16[mt+20]=be,this.uint16[mt+21]=Ke,this.uint16[mt+22]=At,this.uint32[er+12]=rt,this.float32[er+13]=ht,this.float32[er+14]=Lt,this.uint16[mt+30]=Dt,this.uint16[mt+31]=Ft,t}}P.prototype.bytesPerElement=64,Wt("StructArrayLayout8i15ui1ul2f2ui64",P);class z extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}z.prototype.bytesPerElement=4,Wt("StructArrayLayout1f4",z);class F extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,o)}emplace(t,n,o,f){const g=3*t;return this.uint16[6*t+0]=n,this.float32[g+1]=o,this.float32[g+2]=f,t}}F.prototype.bytesPerElement=12,Wt("StructArrayLayout1ui2f12",F);class N extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,o)}emplace(t,n,o,f){const g=4*t;return this.uint32[2*t+0]=n,this.uint16[g+2]=o,this.uint16[g+3]=f,t}}N.prototype.bytesPerElement=8,Wt("StructArrayLayout1ul2ui8",N);class H extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const f=2*t;return this.uint16[f+0]=n,this.uint16[f+1]=o,t}}H.prototype.bytesPerElement=4,Wt("StructArrayLayout2ui4",H);class $ extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}$.prototype.bytesPerElement=2,Wt("StructArrayLayout1ui2",$);class ce extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,f)}emplace(t,n,o,f,g){const _=4*t;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=f,this.float32[_+3]=g,t}}ce.prototype.bytesPerElement=16,Wt("StructArrayLayout4f16",ce);class le extends ro{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Me(this.anchorPointX,this.anchorPointY)}}le.prototype.size=20;class he extends l{get(t){return new le(this,t)}}Wt("CollisionBoxArray",he);class xe extends ro{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}xe.prototype.size=48;class Te extends E{get(t){return new xe(this,t)}}Wt("PlacedSymbolArray",Te);class we extends ro{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}we.prototype.size=64;class Ae extends P{get(t){return new we(this,t)}}Wt("SymbolInstanceArray",Ae);class ke extends z{getoffsetX(t){return this.float32[1*t+0]}}Wt("GlyphOffsetArray",ke);class De extends dl{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Wt("SymbolLineVertexArray",De);class Qe extends ro{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Qe.prototype.size=12;class dt extends F{get(t){return new Qe(this,t)}}Wt("TextAnchorOffsetArray",dt);class nt extends ro{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}nt.prototype.size=8;class it extends N{get(t){return new nt(this,t)}}Wt("FeatureIndexArray",it);class ut extends Pu{}class Zt extends Pu{}class Vt extends Pu{}class St extends Ru{}class sr extends ta{}class Rr extends Zi{}class Gr extends zu{}class Hi extends d{}class Ti extends e{}class $i extends i{}class Ni extends h{}class Mi extends y{}class ai extends b{}class vn extends H{}const In=Gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fn}=In;class si{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,n,o,f){const g=this.segments[this.segments.length-1];return t>si.MAX_VERTEX_ARRAY_LENGTH&&mi(`Max vertices per segment is ${si.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${si.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!g||g.vertexLength+t>si.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==f?this.createNewSegment(n,o,f):g}createNewSegment(t,n,o){const f={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(f.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(f),f}getOrCreateLatestSegment(t,n,o){return this.prepareSegment(0,t,n,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,f){return new si([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:f,vaos:{},sortKey:0}])}}function zs(a,t){return 256*(a=It(Math.floor(a),0,255))+It(Math.floor(t),0,255)}si.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Wt("SegmentVector",si);const os=Gi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var no,ao,Xl,so={exports:{}},pl={exports:{}},Ia={exports:{}},oo=function(){if(Xl)return so.exports;Xl=1;var a=(no||(no=1,pl.exports=function(n,o){var f,g,_,v,T,C,R,L;for(g=n.length-(f=3&n.length),_=o,T=3432918353,C=461845907,L=0;L<g;)R=255&n.charCodeAt(L)|(255&n.charCodeAt(++L))<<8|(255&n.charCodeAt(++L))<<16|(255&n.charCodeAt(++L))<<24,++L,_=27492+(65535&(v=5*(65535&(_=(_^=R=(65535&(R=(R=(65535&R)*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*C+(((R>>>16)*C&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(R=0,f){case 3:R^=(255&n.charCodeAt(L+2))<<16;case 2:R^=(255&n.charCodeAt(L+1))<<8;case 1:_^=R=(65535&(R=(R=(65535&(R^=255&n.charCodeAt(L)))*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*C+(((R>>>16)*C&65535)<<16)&4294967295}return _^=n.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),pl.exports),t=(ao||(ao=1,Ia.exports=function(n,o){for(var f,g=n.length,_=o^g,v=0;g>=4;)f=1540483477*(65535&(f=255&n.charCodeAt(v)|(255&n.charCodeAt(++v))<<8|(255&n.charCodeAt(++v))<<16|(255&n.charCodeAt(++v))<<24))+((1540483477*(f>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),g-=4,++v;switch(g){case 3:_^=(255&n.charCodeAt(v+2))<<16;case 2:_^=(255&n.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&n.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Ia.exports);return so.exports=a,so.exports.murmur3=a,so.exports.murmur2=t,so.exports}(),Pa=J(oo);class Ls{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,f){this.ids.push(rn(t)),this.positions.push(n,o,f)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=rn(t);let o=0,f=this.ids.length-1;for(;o<f;){const _=o+f>>1;this.ids[_]>=n?f=_:o=_+1}const g=[];for(;this.ids[o]===n;)g.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return g}static serialize(t,n){const o=new Float64Array(t.ids),f=new Uint32Array(t.positions);return xn(o,f,0,o.length-1),n&&n.push(o.buffer,f.buffer),{ids:o,positions:f}}static deserialize(t){const n=new Ls;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function rn(a){const t=+a;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Pa(String(a))}function xn(a,t,n,o){for(;n<o;){const f=a[n+o>>1];let g=n-1,_=o+1;for(;;){do g++;while(a[g]<f);do _--;while(a[_]>f);if(g>=_)break;ra(a,g,_),ra(t,3*g,3*_),ra(t,3*g+1,3*_+1),ra(t,3*g+2,3*_+2)}_-n<o-_?(xn(a,t,n,_),n=_+1):(xn(a,t,_+1,o),o=_)}}function ra(a,t,n){const o=a[t];a[t]=a[n],a[n]=o}Wt("FeaturePositionMap",Ls);class Ei{constructor(t,n){this.gl=t.gl,this.location=n}}class Lu extends Ei{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class gh extends Ei{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class of extends Ei{constructor(t,n){super(t,n),this.current=Or.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Yl=new Float32Array(16);function ml(a){return[zs(255*a.r,255*a.g),zs(255*a.b,255*a.a)]}class Po{constructor(t,n,o){this.value=t,this.uniformNames=n.map(f=>`u_${f}`),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new of(t,n):new Lu(t,n)}}class ia{constructor(t,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,f){const g=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new gh(t,n):new Lu(t,n)}}class Ra{constructor(t,n,o,f){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,n,o,f,g){const _=this.paintVertexArray.length,v=this.expression.evaluate(new zi(0),n,{},f,[],g);this.paintVertexArray.resize(t),this._setPaintValue(_,t,v)}updatePaintArray(t,n,o,f){const g=this.expression.evaluate({zoom:0},o,f);this._setPaintValue(t,n,g)}_setPaintValue(t,n,o){if(this.type==="color"){const f=ml(o);for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,f[0],f[1])}else{for(let f=t;f<n;f++)this.paintVertexArray.emplace(f,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class za{constructor(t,n,o,f,g,_){this.expression=t,this.uniformNames=n.map(v=>`u_${v}_t`),this.type=o,this.useIntegerZoom=f,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,n,o,f,g){const _=this.expression.evaluate(new zi(this.zoom),n,{},f,[],g),v=this.expression.evaluate(new zi(this.zoom+1),n,{},f,[],g),T=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(T,t,_,v)}updatePaintArray(t,n,o,f){const g=this.expression.evaluate({zoom:this.zoom},o,f),_=this.expression.evaluate({zoom:this.zoom+1},o,f);this._setPaintValue(t,n,g,_)}_setPaintValue(t,n,o,f){if(this.type==="color"){const g=ml(o),_=ml(f);for(let v=t;v<n;v++)this.paintVertexArray.emplace(v,g[0],g[1],_[0],_[1])}else{for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,o,f);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(f))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,f=It(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(f)}getBinding(t,n,o){return new Lu(t,n)}}class ks{constructor(t,n,o,f,g,_){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=f,this.layerId=_,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,n,o){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(f,t,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(t,n,o,f,g){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],g)}_setPaintValues(t,n,o,f){if(!f||!o)return;const{min:g,mid:_,max:v}=o,T=f[g],C=f[_],R=f[v];if(T&&C&&R)for(let L=t;L<n;L++)this.zoomInPaintVertexArray.emplace(L,C.tl[0],C.tl[1],C.br[0],C.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],C.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,C.tl[0],C.tl[1],C.br[0],C.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],C.pixelRatio,R.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,os.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,os.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class lo{constructor(t,n,o){this.binders={},this._buffers=[];const f=[];for(const g in t.paint._values){if(!o(g))continue;const _=t.paint.get(g);if(!(_ instanceof vr&&Eo(_.property.specification)))continue;const v=ba(g,t.type),T=_.value,C=_.property.specification.type,R=_.property.useIntegerZoom,L=_.property.specification["property-type"],j=L==="cross-faded"||L==="cross-faded-data-driven";if(T.kind==="constant")this.binders[g]=j?new ia(T.value,v):new Po(T.value,v,C),f.push(`/u_${g}`);else if(T.kind==="source"||j){const q=co(g,C,"source");this.binders[g]=j?new ks(T,C,R,n,q,t.id):new Ra(T,v,C,q),f.push(`/a_${g}`)}else{const q=co(g,C,"composite");this.binders[g]=new za(T,v,C,R,n,q),f.push(`/z_${g}`)}}this.cacheKey=f.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Ra||n instanceof za?n.maxValue:0}populatePaintArrays(t,n,o,f,g){for(const _ in this.binders){const v=this.binders[_];(v instanceof Ra||v instanceof za||v instanceof ks)&&v.populatePaintArray(t,n,o,f,g)}}setConstantPatternPositions(t,n){for(const o in this.binders){const f=this.binders[o];f instanceof ia&&f.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,f,g){let _=!1;for(const v in t){const T=n.getPositions(v);for(const C of T){const R=o.feature(C.index);for(const L in this.binders){const j=this.binders[L];if((j instanceof Ra||j instanceof za||j instanceof ks)&&j.expression.isStateDependent===!0){const q=f.paint.get(L);j.expression=q.value,j.updatePaintArray(C.start,C.end,R,t[v],g),_=!0}}}}return _}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Po||o instanceof ia)&&t.push(...o.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Ra||o instanceof za)for(let f=0;f<o.paintVertexAttributes.length;f++)t.push(o.paintVertexAttributes[f].name);else if(o instanceof ks)for(let f=0;f<os.members.length;f++)t.push(os.members[f].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Po||o instanceof ia||o instanceof za)for(const f of o.uniformNames)t.push(f)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const f in this.binders){const g=this.binders[f];if(g instanceof Po||g instanceof ia||g instanceof za){for(const _ of g.uniformNames)if(n[_]){const v=g.getBinding(t,n[_],_);o.push({name:_,property:f,binding:v})}}}return o}setUniforms(t,n,o,f){for(const{name:g,property:_,binding:v}of n)this.binders[_].setUniform(v,f,o.get(_),g)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof ks){const f=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(o instanceof Ra||o instanceof za)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof Ra||o instanceof za||o instanceof ks)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Ra||n instanceof za||n instanceof ks)&&n.destroy()}}}class uo{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const f of t)this.programConfigurations[f.id]=new lo(f,n,o);this.needsUpload=!1,this._featureMap=new Ls,this._bufferOffset=0}populatePaintArrays(t,n,o,f,g,_){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(t,n,f,g,_);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,f){for(const g of o)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,n,g,f)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ba(a,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}function co(a,t,n){const o={color:{source:Zi,composite:ce},number:{source:z,composite:Zi}},f=function(g){return{"line-pattern":{source:Gr,composite:Gr},"fill-pattern":{source:Gr,composite:Gr},"fill-extrusion-pattern":{source:Gr,composite:Gr}}[g]}(a);return f&&f[n]||o[t][n]}Wt("ConstantBinder",Po),Wt("CrossFadedConstantBinder",ia),Wt("SourceExpressionBinder",Ra),Wt("CrossFadedCompositeBinder",ks),Wt("CompositeExpressionBinder",za),Wt("ProgramConfiguration",lo,{omit:["_buffers"]}),Wt("ProgramConfigurationSet",uo);const Ro=Math.pow(2,14)-1,vd=-Ro-1;function Xa(a){const t=ot/a.extent,n=a.loadGeometry();for(let o=0;o<n.length;o++){const f=n[o];for(let g=0;g<f.length;g++){const _=f[g],v=Math.round(_.x*t),T=Math.round(_.y*t);_.x=It(v,vd,Ro),_.y=It(T,vd,Ro),(v<_.x||v>_.x+1||T<_.y||T>_.y+1)&&mi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function La(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?Xa(a):[]}}const jn=-32768;function lf(a,t,n,o,f){a.emplaceBack(jn+8*t+o,jn+8*n+f)}class _h{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Zt,this.indexArray=new ai,this.segments=new si,this.programConfigurations=new uo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){const f=this.layers[0],g=[];let _=null,v=!1,T=f.type==="heatmap";if(f.type==="circle"){const R=f;_=R.layout.get("circle-sort-key"),v=!_.isConstant(),T=T||R.paint.get("circle-pitch-alignment")==="map"}const C=T?n.subdivisionGranularity.circle:1;for(const{feature:R,id:L,index:j,sourceLayerIndex:q}of t){const Z=this.layers[0]._featureFilter.needGeometry,Y=La(R,Z);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),Y,o))continue;const ne=v?_.evaluate(Y,{},o):void 0,fe={id:L,properties:R.properties,type:R.type,sourceLayerIndex:q,index:j,geometry:Z?Y.geometry:Xa(R),patterns:{},sortKey:ne};g.push(fe)}v&&g.sort((R,L)=>R.sortKey-L.sortKey);for(const R of g){const{geometry:L,index:j,sourceLayerIndex:q}=R,Z=t[j].feature;this.addFeature(R,L,j,o,C),n.featureIndex.insert(Z,L,j,q,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,f,g=1){let _;switch(g){case 1:_=[0,7];break;case 3:_=[0,2,5,7];break;case 5:_=[0,1,3,4,6,7];break;case 7:_=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${g}; valid values are 1, 3, 5, 7.`)}const v=_.length;for(const T of n)for(const C of T){const R=C.x,L=C.y;if(R<0||R>=ot||L<0||L>=ot)continue;const j=this.segments.prepareSegment(v*v,this.layoutVertexArray,this.indexArray,t.sortKey),q=j.vertexLength;for(let Z=0;Z<v;Z++)for(let Y=0;Y<v;Y++)lf(this.layoutVertexArray,R,L,_[Y],_[Z]);for(let Z=0;Z<v-1;Z++)for(let Y=0;Y<v-1;Y++){const ne=q+Z*v+Y,fe=q+(Z+1)*v+Y;this.indexArray.emplaceBack(ne,fe+1,ne+1),this.indexArray.emplaceBack(ne,fe,fe+1)}j.vertexLength+=v*v,j.primitiveLength+=(v-1)*(v-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},f)}}function uf(a,t){for(let n=0;n<a.length;n++)if(Wl(t,a[n]))return!0;for(let n=0;n<t.length;n++)if(Wl(a,t[n]))return!0;return!!wc(a,t)}function bp(a,t,n){return!!Wl(a,t)||!!cf(t,a,n)}function xd(a,t){if(a.length===1)return yh(t,a[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let f=0;f<o.length;f++)if(Wl(a,o[f]))return!0}for(let n=0;n<a.length;n++)if(yh(t,a[n]))return!0;for(let n=0;n<t.length;n++)if(wc(a,t[n]))return!0;return!1}function ku(a,t,n){if(a.length>1){if(wc(a,t))return!0;for(let o=0;o<t.length;o++)if(cf(t[o],a,n))return!0}for(let o=0;o<a.length;o++)if(cf(a[o],t,n))return!0;return!1}function wc(a,t){if(a.length===0||t.length===0)return!1;for(let n=0;n<a.length-1;n++){const o=a[n],f=a[n+1];for(let g=0;g<t.length-1;g++)if(wp(o,f,t[g],t[g+1]))return!0}return!1}function wp(a,t,n,o){return Dr(a,n,o)!==Dr(t,n,o)&&Dr(a,t,n)!==Dr(a,t,o)}function cf(a,t,n){const o=n*n;if(t.length===1)return a.distSqr(t[0])<o;for(let f=1;f<t.length;f++)if(bd(a,t[f-1],t[f])<o)return!0;return!1}function bd(a,t,n){const o=t.distSqr(n);if(o===0)return a.distSqr(t);const f=((a.x-t.x)*(n.x-t.x)+(a.y-t.y)*(n.y-t.y))/o;return a.distSqr(f<0?t:f>1?n:n.sub(t)._mult(f)._add(t))}function yh(a,t){for(let n=0;n<a.length;n++)if(Wl(a[n],t))return!0;return!1}function Wl(a,t){let n=!1;for(let o=0,f=a.length-1;o<a.length;f=o++){const g=a[o],_=a[f];g.y>t.y!=_.y>t.y&&t.x<(_.x-g.x)*(t.y-g.y)/(_.y-g.y)+g.x&&(n=!n)}return n}function wd(a,t,n){const o=n[0],f=n[2];if(a.x<o.x&&t.x<o.x||a.x>f.x&&t.x>f.x||a.y<o.y&&t.y<o.y||a.y>f.y&&t.y>f.y)return!1;const g=Dr(a,t,n[0]);return g!==Dr(a,t,n[1])||g!==Dr(a,t,n[2])||g!==Dr(a,t,n[3])}function Tc(a,t,n){const o=t.paint.get(a).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(a)}function vh(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function hf(a,t,n,o,f){if(!t[0]&&!t[1])return a;const g=Me.convert(t)._mult(f);n==="viewport"&&g._rotate(-o);const _=[];for(let v=0;v<a.length;v++)_.push(a[v].sub(g));return _}let Td,Gn;Wt("CircleBucket",_h,{omit:["layers"]});var da={get paint(){return Gn=Gn||new Wi({"circle-radius":new pr(re.paint_circle["circle-radius"]),"circle-color":new pr(re.paint_circle["circle-color"]),"circle-blur":new pr(re.paint_circle["circle-blur"]),"circle-opacity":new pr(re.paint_circle["circle-opacity"]),"circle-translate":new $t(re.paint_circle["circle-translate"]),"circle-translate-anchor":new $t(re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $t(re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $t(re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pr(re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pr(re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pr(re.paint_circle["circle-stroke-opacity"])})},get layout(){return Td=Td||new Wi({"circle-sort-key":new pr(re.layout_circle["circle-sort-key"])})}};class Tp extends $a{constructor(t){super(t,da)}createBucket(t){return new _h(t)}queryRadius(t){const n=t;return Tc("circle-radius",this,n)+Tc("circle-stroke-width",this,n)+vh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:f,transform:g,pixelsToTileUnits:_,unwrappedTileID:v,getElevation:T}){const C=hf(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-g.bearingInRadians,_),R=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),L=this.paint.get("circle-pitch-alignment")==="map",j=L?C:function(Z,Y,ne,fe){return Z.map(Ie=>Ed(Ie,Y,ne,fe))}(C,g,v,T),q=L?R*_:R;for(const Z of f)for(const Y of Z){const ne=L?Y:Ed(Y,g,v,T);let fe=q;const Ie=g.projectTileCoordinates(Y.x,Y.y,v,T).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?fe*=Ie/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(fe*=g.cameraToCenterDistance/Ie),bp(j,ne,fe))return!0}return!1}}function Ed(a,t,n,o){const f=t.projectTileCoordinates(a.x,a.y,n,o).point;return new Me((.5*f.x+.5)*t.width,(.5*-f.y+.5)*t.height)}class Sd extends _h{}let Ad;Wt("HeatmapBucket",Sd,{omit:["layers"]});var Ep={get paint(){return Ad=Ad||new Wi({"heatmap-radius":new pr(re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pr(re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $t(re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $l(re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $t(re.paint_heatmap["heatmap-opacity"])})}};function Ec(a,{width:t,height:n},o,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${t*n*o}`)}else f=new Uint8Array(t*n*o);return a.width=t,a.height=n,a.data=f,a}function ff(a,{width:t,height:n},o){if(t===a.width&&n===a.height)return;const f=Ec({},{width:t,height:n},o);df(a,f,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,t),height:Math.min(a.height,n)},o),a.width=t,a.height=n,a.data=f.data}function df(a,t,n,o,f,g){if(f.width===0||f.height===0)return t;if(f.width>a.width||f.height>a.height||n.x>a.width-f.width||n.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>t.width||f.height>t.height||o.x>t.width-f.width||o.y>t.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const _=a.data,v=t.data;if(_===v)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<f.height;T++){const C=((n.y+T)*a.width+n.x)*g,R=((o.y+T)*t.width+o.x)*g;for(let L=0;L<f.width*g;L++)v[R+L]=_[C+L]}return t}class Sc{constructor(t,n){Ec(this,t,1,n)}resize(t){ff(this,t,1)}clone(){return new Sc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,f,g){df(t,n,o,f,g,1)}}class Ya{constructor(t,n){Ec(this,t,4,n)}resize(t){ff(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ya({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,f,g){df(t,n,o,f,g,4)}}function pf(a){const t={},n=a.resolution||256,o=a.clips?a.clips.length:1,f=a.image||new Ya({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const g=(_,v,T)=>{t[a.evaluationKey]=T;const C=a.expression.evaluate(t);f.data[_+v+0]=Math.floor(255*C.r/C.a),f.data[_+v+1]=Math.floor(255*C.g/C.a),f.data[_+v+2]=Math.floor(255*C.b/C.a),f.data[_+v+3]=Math.floor(255*C.a)};if(a.clips)for(let _=0,v=0;_<o;++_,v+=4*n)for(let T=0,C=0;T<n;T++,C+=4){const R=T/(n-1),{start:L,end:j}=a.clips[_];g(v,C,L*(1-R)+j*R)}else for(let _=0,v=0;_<n;_++,v+=4)g(0,v,_/(n-1));return f}Wt("AlphaImage",Sc),Wt("RGBAImage",Ya);const xh="big-fb";class Cd extends $a{createBucket(t){return new Sd(t)}constructor(t){super(t,Ep),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=pf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(xh)&&this.heatmapFbos.delete(xh)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Md;var Dd={get paint(){return Md=Md||new Wi({"hillshade-illumination-direction":new $t(re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new $t(re.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new $t(re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $t(re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $t(re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $t(re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $t(re.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new $t(re.paint_hillshade["hillshade-method"])})}};class mf extends $a{constructor(t){super(t,Dd),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,f=this.paint.get("hillshade-shadow-color").values;const g=Math.max(t.length,n.length,o.length,f.length);t=t.concat(Array(g-t.length).fill(t.at(-1))),n=n.concat(Array(g-n.length).fill(n.at(-1))),o=o.concat(Array(g-o.length).fill(o.at(-1))),f=f.concat(Array(g-f.length).fill(f.at(-1)));const _=n.map(Nr);return{directionRadians:t.map(Nr),altitudeRadians:_,shadowColor:f,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Id=Gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Sp}=Id;function bh(a,t,n){const o=n.patternDependencies;let f=!1;for(const g of t){const _=g.paint.get(`${a}-pattern`);_.isConstant()||(f=!0);const v=_.constantOr(null);v&&(f=!0,o[v.to]=!0,o[v.from]=!0)}return f}function gf(a,t,n,o,f){const g=f.patternDependencies;for(const _ of t){const v=_.paint.get(`${a}-pattern`).value;if(v.kind!=="constant"){let T=v.evaluate({zoom:o-1},n,{},f.availableImages),C=v.evaluate({zoom:o},n,{},f.availableImages),R=v.evaluate({zoom:o+1},n,{},f.availableImages);T=T&&T.name?T.name:T,C=C&&C.name?C.name:C,R=R&&R.name?R.name:R,g[T]=!0,g[C]=!0,g[R]=!0,n.patterns[_.id]={min:T,mid:C,max:R}}}return n}function zo(a,t,n,o,f){let g;if(f===function(_,v,T,C){let R=0;for(let L=v,j=T-C;L<T;L+=C)R+=(_[j]-_[L])*(_[L+1]+_[j+1]),j=L;return R}(a,t,n,o)>0)for(let _=t;_<n;_+=o)g=vf(_/o|0,a[_],a[_+1],g);else for(let _=n-o;_>=t;_-=o)g=vf(_/o|0,a[_],a[_+1],g);return g&&Lo(g,g.next)&&(Ql(g),g=g.next),g}function gl(a,t){if(!a)return a;t||(t=a);let n,o=a;do if(n=!1,o.steiner||!Lo(o,o.next)&&dn(o.prev,o,o.next)!==0)o=o.next;else{if(Ql(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function wh(a,t,n,o,f,g,_){if(!a)return;!_&&g&&function(T,C,R,L){let j=T;do j.z===0&&(j.z=Pd(j.x,j.y,C,R,L)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==T);j.prevZ.nextZ=null,j.prevZ=null,function(q){let Z,Y=1;do{let ne,fe=q;q=null;let Ie=null;for(Z=0;fe;){Z++;let ve=fe,V=0;for(let be=0;be<Y&&(V++,ve=ve.nextZ,ve);be++);let te=Y;for(;V>0||te>0&&ve;)V!==0&&(te===0||!ve||fe.z<=ve.z)?(ne=fe,fe=fe.nextZ,V--):(ne=ve,ve=ve.nextZ,te--),Ie?Ie.nextZ=ne:q=ne,ne.prevZ=Ie,Ie=ne;fe=ve}Ie.nextZ=null,Y*=2}while(Z>1)}(j)}(a,o,f,g);let v=a;for(;a.prev!==a.next;){const T=a.prev,C=a.next;if(g?_l(a,o,f,g):Ap(a))t.push(T.i,a.i,C.i),Ql(a),a=C.next,v=C.next;else if((a=C)===v){_?_===1?wh(a=Cp(gl(a),t),t,n,o,f,g,2):_===2&&_f(a,t,n,o,f,g):wh(gl(a),t,n,o,f,g,1);break}}}function Ap(a){const t=a.prev,n=a,o=a.next;if(dn(t,n,o)>=0)return!1;const f=t.x,g=n.x,_=o.x,v=t.y,T=n.y,C=o.y,R=Math.min(f,g,_),L=Math.min(v,T,C),j=Math.max(f,g,_),q=Math.max(v,T,C);let Z=o.next;for(;Z!==t;){if(Z.x>=R&&Z.x<=j&&Z.y>=L&&Z.y<=q&&Bs(f,v,g,T,_,C,Z.x,Z.y)&&dn(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function _l(a,t,n,o){const f=a.prev,g=a,_=a.next;if(dn(f,g,_)>=0)return!1;const v=f.x,T=g.x,C=_.x,R=f.y,L=g.y,j=_.y,q=Math.min(v,T,C),Z=Math.min(R,L,j),Y=Math.max(v,T,C),ne=Math.max(R,L,j),fe=Pd(q,Z,t,n,o),Ie=Pd(Y,ne,t,n,o);let ve=a.prevZ,V=a.nextZ;for(;ve&&ve.z>=fe&&V&&V.z<=Ie;){if(ve.x>=q&&ve.x<=Y&&ve.y>=Z&&ve.y<=ne&&ve!==f&&ve!==_&&Bs(v,R,T,L,C,j,ve.x,ve.y)&&dn(ve.prev,ve,ve.next)>=0||(ve=ve.prevZ,V.x>=q&&V.x<=Y&&V.y>=Z&&V.y<=ne&&V!==f&&V!==_&&Bs(v,R,T,L,C,j,V.x,V.y)&&dn(V.prev,V,V.next)>=0))return!1;V=V.nextZ}for(;ve&&ve.z>=fe;){if(ve.x>=q&&ve.x<=Y&&ve.y>=Z&&ve.y<=ne&&ve!==f&&ve!==_&&Bs(v,R,T,L,C,j,ve.x,ve.y)&&dn(ve.prev,ve,ve.next)>=0)return!1;ve=ve.prevZ}for(;V&&V.z<=Ie;){if(V.x>=q&&V.x<=Y&&V.y>=Z&&V.y<=ne&&V!==f&&V!==_&&Bs(v,R,T,L,C,j,V.x,V.y)&&dn(V.prev,V,V.next)>=0)return!1;V=V.nextZ}return!0}function Cp(a,t){let n=a;do{const o=n.prev,f=n.next.next;!Lo(o,f)&&ho(o,n,n.next,f)&&Mc(o,f)&&Mc(f,o)&&(t.push(o.i,n.i,f.i),Ql(n),Ql(n.next),n=a=f),n=n.next}while(n!==a);return gl(n)}function _f(a,t,n,o,f,g){let _=a;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&Dp(_,v)){let T=yf(_,v);return _=gl(_,_.next),T=gl(T,T.next),wh(_,t,n,o,f,g,0),void wh(T,t,n,o,f,g,0)}v=v.next}_=_.next}while(_!==a)}function Th(a,t){let n=a.x-t.x;return n===0&&(n=a.y-t.y,n===0)&&(n=(a.next.y-a.y)/(a.next.x-a.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function bn(a,t){const n=function(f,g){let _=g;const v=f.x,T=f.y;let C,R=-1/0;if(Lo(f,_))return _;do{if(Lo(f,_.next))return _.next;if(T<=_.y&&T>=_.next.y&&_.next.y!==_.y){const Y=_.x+(T-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(Y<=v&&Y>R&&(R=Y,C=_.x<_.next.x?_:_.next,Y===v))return C}_=_.next}while(_!==g);if(!C)return null;const L=C,j=C.x,q=C.y;let Z=1/0;_=C;do{if(v>=_.x&&_.x>=j&&v!==_.x&&Ac(T<q?v:R,T,j,q,T<q?R:v,T,_.x,_.y)){const Y=Math.abs(T-_.y)/(v-_.x);Mc(_,f)&&(Y<Z||Y===Z&&(_.x>C.x||_.x===C.x&&bm(C,_)))&&(C=_,Z=Y)}_=_.next}while(_!==L);return C}(a,t);if(!n)return t;const o=yf(n,a);return gl(o,o.next),gl(n,n.next)}function bm(a,t){return dn(a.prev,a,t.prev)<0&&dn(t.next,a,a.next)<0}function Pd(a,t,n,o,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-n)*f|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*f|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Mp(a){let t=a,n=a;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==a);return n}function Ac(a,t,n,o,f,g,_,v){return(f-_)*(t-v)>=(a-_)*(g-v)&&(a-_)*(o-v)>=(n-_)*(t-v)&&(n-_)*(g-v)>=(f-_)*(o-v)}function Bs(a,t,n,o,f,g,_,v){return!(a===_&&t===v)&&Ac(a,t,n,o,f,g,_,v)}function Dp(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!function(n,o){let f=n;do{if(f.i!==n.i&&f.next.i!==n.i&&f.i!==o.i&&f.next.i!==o.i&&ho(f,f.next,n,o))return!0;f=f.next}while(f!==n);return!1}(a,t)&&(Mc(a,t)&&Mc(t,a)&&function(n,o){let f=n,g=!1;const _=(n.x+o.x)/2,v=(n.y+o.y)/2;do f.y>v!=f.next.y>v&&f.next.y!==f.y&&_<(f.next.x-f.x)*(v-f.y)/(f.next.y-f.y)+f.x&&(g=!g),f=f.next;while(f!==n);return g}(a,t)&&(dn(a.prev,a,t.prev)||dn(a,t.prev,t))||Lo(a,t)&&dn(a.prev,a,a.next)>0&&dn(t.prev,t,t.next)>0)}function dn(a,t,n){return(t.y-a.y)*(n.x-t.x)-(t.x-a.x)*(n.y-t.y)}function Lo(a,t){return a.x===t.x&&a.y===t.y}function ho(a,t,n,o){const f=Cc(dn(a,t,n)),g=Cc(dn(a,t,o)),_=Cc(dn(n,o,a)),v=Cc(dn(n,o,t));return f!==g&&_!==v||!(f!==0||!Eh(a,n,t))||!(g!==0||!Eh(a,o,t))||!(_!==0||!Eh(n,a,o))||!(v!==0||!Eh(n,t,o))}function Eh(a,t,n){return t.x<=Math.max(a.x,n.x)&&t.x>=Math.min(a.x,n.x)&&t.y<=Math.max(a.y,n.y)&&t.y>=Math.min(a.y,n.y)}function Cc(a){return a>0?1:a<0?-1:0}function Mc(a,t){return dn(a.prev,a,a.next)<0?dn(a,t,a.next)>=0&&dn(a,a.prev,t)>=0:dn(a,t,a.prev)<0||dn(a,a.next,t)<0}function yf(a,t){const n=xf(a.i,a.x,a.y),o=xf(t.i,t.x,t.y),f=a.next,g=t.prev;return a.next=t,t.prev=a,n.next=f,f.prev=n,o.next=n,n.prev=o,g.next=o,o.prev=g,o}function vf(a,t,n,o){const f=xf(a,t,n);return o?(f.next=o.next,f.prev=o,o.next.prev=f,o.next=f):(f.prev=f,f.next=f),f}function Ql(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function xf(a,t,n){return{i:a,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Wa{constructor(t,n){if(n>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=n}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class pn{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}pn.noSubdivision=new pn({fill:new Wa(0,0),line:new Wa(0,0),tile:new Wa(0,0),stencil:new Wa(0,0),circle:1}),Wt("SubdivisionGranularityExpression",Wa),Wt("SubdivisionGranularitySetting",pn);const Kl=-32768,Dc=32767;class na{constructor(t,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=ot/t,this._canonical=n}_getKey(t,n){return(t+=32768)<<16|(n+=32768)<<0}_vertexToIndex(t,n){if(t<-32768||n<-32768||t>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),f=0|Math.round(n),g=this._getKey(o,f);if(this._vertexDictionary.has(g))return this._vertexDictionary.get(g);const _=this._vertexBuffer.length/2;return this._vertexDictionary.set(g,_),this._vertexBuffer.push(o,f),_}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(f,g){const _=[];for(let v=0;v<g.length;v+=3){const T=g[v],C=g[v+1],R=g[v+2],L=f[2*T],j=f[2*T+1];(f[2*C]-L)*(f[2*R+1]-j)-(f[2*C+1]-j)*(f[2*R]-L)>0?(_.push(T),_.push(R),_.push(C)):(_.push(T),_.push(C),_.push(R))}return _}(this._vertexBuffer,t);const n=[],o=t.length;for(let f=0;f<o;f+=3){const g=[t[f+0],t[f+1],t[f+2]],_=[this._vertexBuffer[2*t[f+0]+0],this._vertexBuffer[2*t[f+0]+1],this._vertexBuffer[2*t[f+1]+0],this._vertexBuffer[2*t[f+1]+1],this._vertexBuffer[2*t[f+2]+0],this._vertexBuffer[2*t[f+2]+1]];let v=1/0,T=1/0,C=-1/0,R=-1/0;for(let Y=0;Y<3;Y++){const ne=_[2*Y],fe=_[2*Y+1];v=Math.min(v,ne),C=Math.max(C,ne),T=Math.min(T,fe),R=Math.max(R,fe)}if(v===C||T===R)continue;const L=Math.floor(v/this._granularityCellSize),j=Math.ceil(C/this._granularityCellSize),q=Math.floor(T/this._granularityCellSize),Z=Math.ceil(R/this._granularityCellSize);if(L!==j||q!==Z)for(let Y=q;Y<Z;Y++){const ne=this._scanlineGenerateVertexRingForCellRow(Y,_,g);Pp(this._vertexBuffer,ne,n)}else n.push(...g)}return n}_scanlineGenerateVertexRingForCellRow(t,n,o){const f=t*this._granularityCellSize,g=f+this._granularityCellSize,_=[];for(let v=0;v<3;v++){const T=n[2*v],C=n[2*v+1],R=n[2*(v+1)%6],L=n[(2*(v+1)+1)%6],j=n[2*(v+2)%6],q=n[(2*(v+2)+1)%6],Z=R-T,Y=L-C,ne=Z===0,fe=Y===0,Ie=(f-C)/Y,ve=(g-C)/Y,V=Math.min(Ie,ve),te=Math.max(Ie,ve);if(!fe&&(V>=1||te<=0)||fe&&(C<f||C>g)){L>=f&&L<=g&&_.push(o[(v+1)%3]);continue}!fe&&V>0&&_.push(this._vertexToIndex(T+Z*V,C+Y*V));const be=T+Z*Math.max(V,0),Ke=T+Z*Math.min(te,1);ne||this._generateIntraEdgeVertices(_,T,C,R,L,be,Ke),!fe&&te<1&&_.push(this._vertexToIndex(T+Z*te,C+Y*te)),(fe||L>=f&&L<=g)&&_.push(o[(v+1)%3]),!fe&&(L<=f||L>=g)&&this._generateInterEdgeVertices(_,T,C,R,L,j,q,Ke,f,g)}return _}_generateIntraEdgeVertices(t,n,o,f,g,_,v){const T=f-n,C=g-o,R=C===0,L=R?Math.min(n,f):Math.min(_,v),j=R?Math.max(n,f):Math.max(_,v),q=Math.floor(L/this._granularityCellSize)+1,Z=Math.ceil(j/this._granularityCellSize)-1;if(R?n<f:_<v)for(let Y=q;Y<=Z;Y++){const ne=Y*this._granularityCellSize;t.push(this._vertexToIndex(ne,o+C*(ne-n)/T))}else for(let Y=Z;Y>=q;Y--){const ne=Y*this._granularityCellSize;t.push(this._vertexToIndex(ne,o+C*(ne-n)/T))}}_generateInterEdgeVertices(t,n,o,f,g,_,v,T,C,R){const L=g-o,j=_-f,q=v-g,Z=(C-g)/q,Y=(R-g)/q,ne=Math.min(Z,Y),fe=Math.max(Z,Y),Ie=f+j*ne;let ve=Math.floor(Math.min(Ie,T)/this._granularityCellSize)+1,V=Math.ceil(Math.max(Ie,T)/this._granularityCellSize)-1,te=T<Ie;const be=q===0;if(be&&(v===C||v===R))return;if(be||ne>=1||fe<=0){const At=o-v,rt=_+(n-_)*Math.min((C-v)/At,(R-v)/At);ve=Math.floor(Math.min(rt,T)/this._granularityCellSize)+1,V=Math.ceil(Math.max(rt,T)/this._granularityCellSize)-1,te=T<rt}const Ke=L>0?R:C;if(te)for(let At=ve;At<=V;At++)t.push(this._vertexToIndex(At*this._granularityCellSize,Ke));else for(let At=V;At>=ve;At--)t.push(this._vertexToIndex(At*this._granularityCellSize,Ke))}_generateOutline(t){const n=[];for(const o of t){const f=Jl(o,this._granularity,!0),g=this._pointArrayToIndices(f),_=[];for(let v=1;v<g.length;v++)_.push(g[v-1]),_.push(g[v]);n.push(_)}return n}_handlePoles(t){let n=!1,o=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(n||o)&&this._fillPoles(t,n,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let n=0;n<t.length;n+=2){const o=t[n+1];o===Kl&&(t[n+1]=-32767),o===Dc&&(t[n+1]=32766)}}_generatePoleQuad(t,n,o,f,g,_){f>g!=(_===Kl)?(t.push(n),t.push(o),t.push(this._vertexToIndex(f,_)),t.push(o),t.push(this._vertexToIndex(g,_)),t.push(this._vertexToIndex(f,_))):(t.push(o),t.push(n),t.push(this._vertexToIndex(f,_)),t.push(this._vertexToIndex(g,_)),t.push(o),t.push(this._vertexToIndex(f,_)))}_fillPoles(t,n,o){const f=this._vertexBuffer,g=ot,_=t.length;for(let v=2;v<_;v+=3){const T=t[v-2],C=t[v-1],R=t[v],L=f[2*T],j=f[2*T+1],q=f[2*C],Z=f[2*C+1],Y=f[2*R],ne=f[2*R+1];n&&(j===0&&Z===0&&this._generatePoleQuad(t,T,C,L,q,Kl),Z===0&&ne===0&&this._generatePoleQuad(t,C,R,q,Y,Kl),ne===0&&j===0&&this._generatePoleQuad(t,R,T,Y,L,Kl)),o&&(j===g&&Z===g&&this._generatePoleQuad(t,T,C,L,q,Dc),Z===g&&ne===g&&this._generatePoleQuad(t,C,R,q,Y,Dc),ne===g&&j===g&&this._generatePoleQuad(t,R,T,Y,L,Dc))}}_initializeVertices(t){for(let n=0;n<t.length;n+=2)this._vertexToIndex(t[n],t[n+1])}subdividePolygonInternal(t,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:f}=function(v){const T=[],C=[];for(const R of v)if(R.length!==0){R!==v[0]&&T.push(C.length/2);for(let L=0;L<R.length;L++)C.push(R[L].x),C.push(R[L].y)}return{flattened:C,holeIndices:T}}(t);let g;this._initializeVertices(o);try{const v=function(C,R,L=2){const j=R&&R.length,q=j?R[0]*L:C.length;let Z=zo(C,0,q,L,!0);const Y=[];if(!Z||Z.next===Z.prev)return Y;let ne,fe,Ie;if(j&&(Z=function(ve,V,te,be){const Ke=[];for(let At=0,rt=V.length;At<rt;At++){const ht=zo(ve,V[At]*be,At<rt-1?V[At+1]*be:ve.length,be,!1);ht===ht.next&&(ht.steiner=!0),Ke.push(Mp(ht))}Ke.sort(Th);for(let At=0;At<Ke.length;At++)te=bn(Ke[At],te);return te}(C,R,Z,L)),C.length>80*L){ne=1/0,fe=1/0;let ve=-1/0,V=-1/0;for(let te=L;te<q;te+=L){const be=C[te],Ke=C[te+1];be<ne&&(ne=be),Ke<fe&&(fe=Ke),be>ve&&(ve=be),Ke>V&&(V=Ke)}Ie=Math.max(ve-ne,V-fe),Ie=Ie!==0?32767/Ie:0}return wh(Z,Y,L,ne,fe,Ie,0),Y}(o,f),T=this._convertIndices(o,v);g=this._subdivideTrianglesScanline(T)}catch(v){console.error(v)}let _=[];return n&&(_=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(g),{verticesFlattened:this._vertexBuffer,indicesTriangles:g,indicesLineList:_}}_convertIndices(t,n){const o=[];for(let f=0;f<n.length;f++)o.push(this._vertexToIndex(t[2*n[f]],t[2*n[f]+1]));return o}_pointArrayToIndices(t){const n=[];for(let o=0;o<t.length;o++){const f=t[o];n.push(this._vertexToIndex(f.x,f.y))}return n}}function Ip(a,t,n,o=!0){return new na(n,t).subdividePolygonInternal(a,o)}function Jl(a,t,n=!1){if(!a||a.length<1)return[];if(a.length<2)return[];const o=a[0],f=a[a.length-1],g=n&&(o.x!==f.x||o.y!==f.y);if(t<2)return g?[...a,a[0]]:[...a];const _=Math.floor(ot/t),v=[];v.push(new Me(a[0].x,a[0].y));const T=a.length,C=g?T:T-1;for(let R=0;R<C;R++){const L=a[R],j=R<T-1?a[R+1]:a[0],q=L.x,Z=L.y,Y=j.x,ne=j.y,fe=q!==Y,Ie=Z!==ne;if(!fe&&!Ie)continue;const ve=Y-q,V=ne-Z,te=Math.abs(ve),be=Math.abs(V);let Ke=q,At=Z;for(;;){const ht=ve>0?(Math.floor(Ke/_)+1)*_:(Math.ceil(Ke/_)-1)*_,Lt=V>0?(Math.floor(At/_)+1)*_:(Math.ceil(At/_)-1)*_,Dt=Math.abs(Ke-ht),Ft=Math.abs(At-Lt),mt=Math.abs(Ke-Y),er=Math.abs(At-ne),hr=fe?Dt/te:Number.POSITIVE_INFINITY,cr=Ie?Ft/be:Number.POSITIVE_INFINITY;if((mt<=Dt||!fe)&&(er<=Ft||!Ie))break;if(hr<cr&&fe||!Ie){Ke=ht,At+=V*hr;const or=new Me(Ke,Math.round(At));v[v.length-1].x===or.x&&v[v.length-1].y===or.y||v.push(or)}else{Ke+=ve*cr,At=Lt;const or=new Me(Math.round(Ke),At);v[v.length-1].x===or.x&&v[v.length-1].y===or.y||v.push(or)}}const rt=new Me(Y,ne);v[v.length-1].x===rt.x&&v[v.length-1].y===rt.y||v.push(rt)}return v}function Pp(a,t,n){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,f=a[2*t[0]];for(let T=1;T<t.length;T++){const C=a[2*t[T]];C<f&&(f=C,o=T)}const g=t.length;let _=o,v=(_+1)%g;for(;;){const T=_-1>=0?_-1:g-1,C=(v+1)%g,R=a[2*t[T]],L=a[2*t[C]],j=a[2*t[_]],q=a[2*t[_]+1],Z=a[2*t[v]+1];let Y=!1;if(R<L)Y=!0;else if(R>L)Y=!1;else{const ne=Z-q,fe=-(a[2*t[v]]-j),Ie=q<Z?1:-1;((R-j)*ne+(a[2*t[T]+1]-q)*fe)*Ie>((L-j)*ne+(a[2*t[C]+1]-q)*fe)*Ie&&(Y=!0)}if(Y){const ne=t[T],fe=t[_],Ie=t[v];ne!==fe&&ne!==Ie&&fe!==Ie&&n.push(Ie,fe,ne),_--,_<0&&(_=g-1)}else{const ne=t[C],fe=t[_],Ie=t[v];ne!==fe&&ne!==Ie&&fe!==Ie&&n.push(Ie,fe,ne),v++,v>=g&&(v=0)}if(T===C)break}}function nn(a,t,n,o,f,g,_,v,T){const C=f.length/2,R=_&&v&&T;if(C<si.MAX_VERTEX_ARRAY_LENGTH){const L=t.prepareSegment(C,n,o),j=L.vertexLength;for(let Y=0;Y<g.length;Y+=3)o.emplaceBack(j+g[Y],j+g[Y+1],j+g[Y+2]);let q,Z;L.vertexLength+=C,L.primitiveLength+=g.length/3,R&&(Z=_.prepareSegment(C,n,v),q=Z.vertexLength,Z.vertexLength+=C);for(let Y=0;Y<f.length;Y+=2)a(f[Y],f[Y+1]);if(R)for(let Y=0;Y<T.length;Y++){const ne=T[Y];for(let fe=1;fe<ne.length;fe+=2)v.emplaceBack(q+ne[fe-1],q+ne[fe]);Z.primitiveLength+=ne.length/2}}else(function(L,j,q,Z,Y,ne){const fe=[];for(let be=0;be<Z.length/2;be++)fe.push(-1);const Ie={count:0};let ve=0,V=L.getOrCreateLatestSegment(j,q),te=V.vertexLength;for(let be=2;be<Y.length;be+=3){const Ke=Y[be-2],At=Y[be-1],rt=Y[be];let ht=fe[Ke]<ve,Lt=fe[At]<ve,Dt=fe[rt]<ve;V.vertexLength+((ht?1:0)+(Lt?1:0)+(Dt?1:0))>si.MAX_VERTEX_ARRAY_LENGTH&&(V=L.createNewSegment(j,q),ve=Ie.count,ht=!0,Lt=!0,Dt=!0,te=0);const Ft=aa(fe,Z,ne,Ie,Ke,ht,V),mt=aa(fe,Z,ne,Ie,At,Lt,V),er=aa(fe,Z,ne,Ie,rt,Dt,V);q.emplaceBack(te+Ft-ve,te+mt-ve,te+er-ve),V.primitiveLength++}})(t,n,o,f,g,a),R&&function(L,j,q,Z,Y,ne){const fe=[];for(let be=0;be<Z.length/2;be++)fe.push(-1);const Ie={count:0};let ve=0,V=L.getOrCreateLatestSegment(j,q),te=V.vertexLength;for(let be=0;be<Y.length;be++){const Ke=Y[be];for(let At=1;At<Y[be].length;At+=2){const rt=Ke[At-1],ht=Ke[At];let Lt=fe[rt]<ve,Dt=fe[ht]<ve;V.vertexLength+((Lt?1:0)+(Dt?1:0))>si.MAX_VERTEX_ARRAY_LENGTH&&(V=L.createNewSegment(j,q),ve=Ie.count,Lt=!0,Dt=!0,te=0);const Ft=aa(fe,Z,ne,Ie,rt,Lt,V),mt=aa(fe,Z,ne,Ie,ht,Dt,V);q.emplaceBack(te+Ft-ve,te+mt-ve),V.primitiveLength++}}}(_,n,v,f,T,a),t.forceNewSegmentOnNextPrepare(),_==null||_.forceNewSegmentOnNextPrepare()}function aa(a,t,n,o,f,g,_){if(g){const v=o.count;return n(t[2*f],t[2*f+1]),a[f]=o.count,o.count++,_.vertexLength++,v}return a[f]}class fo{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Vt,this.indexArray=new ai,this.indexArray2=new vn,this.programConfigurations=new uo(t.layers,t.zoom),this.segments=new si,this.segments2=new si,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=bh("fill",this.layers,n);const f=this.layers[0].layout.get("fill-sort-key"),g=!f.isConstant(),_=[];for(const{feature:v,id:T,index:C,sourceLayerIndex:R}of t){const L=this.layers[0]._featureFilter.needGeometry,j=La(v,L);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),j,o))continue;const q=g?f.evaluate(j,{},o,n.availableImages):void 0,Z={id:T,properties:v.properties,type:v.type,sourceLayerIndex:R,index:C,geometry:L?j.geometry:Xa(v),patterns:{},sortKey:q};_.push(Z)}g&&_.sort((v,T)=>v.sortKey-T.sortKey);for(const v of _){const{geometry:T,index:C,sourceLayerIndex:R}=v;if(this.hasPattern){const L=gf("fill",this.layers,v,this.zoom,n);this.patternFeatures.push(L)}else this.addFeature(v,T,C,o,{},n.subdivisionGranularity);n.featureIndex.insert(t[C].feature,T,C,R,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,n,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Sp),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,f,g,_){for(const v of mu(n,500)){const T=Ip(v,f,_.fill.getGranularityForZoomLevel(f.z)),C=this.layoutVertexArray;nn((R,L)=>{C.emplaceBack(R,L)},this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles,this.segments2,this.indexArray2,T.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,g,f)}}let Rd,zd;Wt("FillBucket",fo,{omit:["layers","patternFeatures"]});var wm={get paint(){return zd=zd||new Wi({"fill-antialias":new $t(re.paint_fill["fill-antialias"]),"fill-opacity":new pr(re.paint_fill["fill-opacity"]),"fill-color":new pr(re.paint_fill["fill-color"]),"fill-outline-color":new pr(re.paint_fill["fill-outline-color"]),"fill-translate":new $t(re.paint_fill["fill-translate"]),"fill-translate-anchor":new $t(re.paint_fill["fill-translate-anchor"]),"fill-pattern":new Rs(re.paint_fill["fill-pattern"])})},get layout(){return Rd=Rd||new Wi({"fill-sort-key":new pr(re.layout_fill["fill-sort-key"])})}};class Ld extends $a{constructor(t){super(t,wm)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new fo(t)}queryRadius(){return vh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:n,transform:o,pixelsToTileUnits:f}){return xd(hf(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,f),n)}isTileClipped(){return!0}}const ls=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),po=Gi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Rp}=ls;var ka,kd,ko,eu,Bo,bf,wf,us={};function Bd(){if(kd)return ka;kd=1;var a=X();function t(f,g,_,v,T){this.properties={},this.extent=_,this.type=0,this._pbf=f,this._geometry=-1,this._keys=v,this._values=T,f.readFields(n,this,g)}function n(f,g,_){f==1?g.id=_.readVarint():f==2?function(v,T){for(var C=v.readVarint()+v.pos;v.pos<C;){var R=T._keys[v.readVarint()],L=T._values[v.readVarint()];T.properties[R]=L}}(_,g):f==3?g.type=_.readVarint():f==4&&(g._geometry=_.pos)}function o(f){for(var g,_,v=0,T=0,C=f.length,R=C-1;T<C;R=T++)v+=((_=f[R]).x-(g=f[T]).x)*(g.y+_.y);return v}return ka=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var g,_=f.readVarint()+f.pos,v=1,T=0,C=0,R=0,L=[];f.pos<_;){if(T<=0){var j=f.readVarint();v=7&j,T=j>>3}if(T--,v===1||v===2)C+=f.readSVarint(),R+=f.readSVarint(),v===1&&(g&&L.push(g),g=[]),g.push(new a(C,R));else{if(v!==7)throw new Error("unknown command "+v);g&&g.push(g[0].clone())}}return g&&L.push(g),L},t.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var g=f.readVarint()+f.pos,_=1,v=0,T=0,C=0,R=1/0,L=-1/0,j=1/0,q=-1/0;f.pos<g;){if(v<=0){var Z=f.readVarint();_=7&Z,v=Z>>3}if(v--,_===1||_===2)(T+=f.readSVarint())<R&&(R=T),T>L&&(L=T),(C+=f.readSVarint())<j&&(j=C),C>q&&(q=C);else if(_!==7)throw new Error("unknown command "+_)}return[R,j,L,q]},t.prototype.toGeoJSON=function(f,g,_){var v,T,C=this.extent*Math.pow(2,_),R=this.extent*f,L=this.extent*g,j=this.loadGeometry(),q=t.types[this.type];function Z(fe){for(var Ie=0;Ie<fe.length;Ie++){var ve=fe[Ie];fe[Ie]=[360*(ve.x+R)/C-180,360/Math.PI*Math.atan(Math.exp((180-360*(ve.y+L)/C)*Math.PI/180))-90]}}switch(this.type){case 1:var Y=[];for(v=0;v<j.length;v++)Y[v]=j[v][0];Z(j=Y);break;case 2:for(v=0;v<j.length;v++)Z(j[v]);break;case 3:for(j=function(fe){var Ie=fe.length;if(Ie<=1)return[fe];for(var ve,V,te=[],be=0;be<Ie;be++){var Ke=o(fe[be]);Ke!==0&&(V===void 0&&(V=Ke<0),V===Ke<0?(ve&&te.push(ve),ve=[fe[be]]):ve.push(fe[be]))}return ve&&te.push(ve),te}(j),v=0;v<j.length;v++)for(T=0;T<j[v].length;T++)Z(j[v][T])}j.length===1?j=j[0]:q="Multi"+q;var ne={type:"Feature",geometry:{type:q,coordinates:j},properties:this.properties};return"id"in this&&(ne.id=this.id),ne},ka}function Bu(){if(eu)return ko;eu=1;var a=Bd();function t(o,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(n,this,f),this.length=this._features.length}function n(o,f,g){o===15?f.version=g.readVarint():o===1?f.name=g.readString():o===5?f.extent=g.readVarint():o===2?f._features.push(g.pos):o===3?f._keys.push(g.readString()):o===4&&f._values.push(function(_){for(var v=null,T=_.readVarint()+_.pos;_.pos<T;){var C=_.readVarint()>>3;v=C===1?_.readString():C===2?_.readFloat():C===3?_.readDouble():C===4?_.readVarint64():C===5?_.readVarint():C===6?_.readSVarint():C===7?_.readBoolean():null}return v}(g))}return ko=t,t.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var f=this._pbf.readVarint()+this._pbf.pos;return new a(this._pbf,f,this.extent,this._keys,this._values)},ko}function Ic(){return wf||(wf=1,us.VectorTile=function(){if(bf)return Bo;bf=1;var a=Bu();function t(n,o,f){if(n===3){var g=new a(f,f.readVarint()+f.pos);g.length&&(o[g.name]=g)}}return Bo=function(n,o){this.layers=n.readFields(t,{},o)},Bo}(),us.VectorTileFeature=Bd(),us.VectorTileLayer=Bu()),us}var yl=J(Ic());const Pc=yl.VectorTileFeature.types,Tf=Math.pow(2,13);function Rc(a,t,n,o,f,g,_,v){a.emplaceBack(t,n,2*Math.floor(o*Tf)+_,f*Tf*2,g*Tf*2,Math.round(v))}class Ou{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new St,this.centroidVertexArray=new ut,this.indexArray=new ai,this.programConfigurations=new uo(t.layers,t.zoom),this.segments=new si,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.features=[],this.hasPattern=bh("fill-extrusion",this.layers,n);for(const{feature:f,id:g,index:_,sourceLayerIndex:v}of t){const T=this.layers[0]._featureFilter.needGeometry,C=La(f,T);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),C,o))continue;const R={id:g,sourceLayerIndex:v,index:_,geometry:T?C.geometry:Xa(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(gf("fill-extrusion",this.layers,R,this.zoom,n)):this.addFeature(R,R.geometry,_,o,{},n.subdivisionGranularity),n.featureIndex.insert(f,R.geometry,_,v,this.index,!0)}}addFeatures(t,n,o){for(const f of this.features){const{geometry:g}=f;this.addFeature(f,g,f.index,n,o,t.subdivisionGranularity)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Rp),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,po.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,f,g,_){for(const v of mu(n,500)){const T={x:0,y:0,sampleCount:0},C=this.layoutVertexArray.length;this.processPolygon(T,f,t,v,_);const R=this.layoutVertexArray.length-C,L=Math.floor(T.x/T.sampleCount),j=Math.floor(T.y/T.sampleCount);for(let q=0;q<R;q++)this.centroidVertexArray.emplaceBack(L,j)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,g,f)}processPolygon(t,n,o,f,g){if(f.length<1||Od(f[0]))return;for(const L of f)L.length!==0&&zp(t,L);const _={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},v=g.fill.getGranularityForZoomLevel(n.z),T=Pc[o.type]==="Polygon";for(const L of f){if(L.length===0||Od(L))continue;const j=Jl(L,v,T);this._generateSideFaces(j,_)}if(!T)return;const C=Ip(f,n,v,!1),R=this.layoutVertexArray;nn((L,j)=>{Rc(R,L,j,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,C.verticesFlattened,C.indicesTriangles)}_generateSideFaces(t,n){let o=0;for(let f=1;f<t.length;f++){const g=t[f],_=t[f-1];if(Ef(g,_))continue;n.segment.vertexLength+4>si.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const v=g.sub(_)._perp()._unit(),T=_.dist(g);o+T>32768&&(o=0),Rc(this.layoutVertexArray,g.x,g.y,v.x,v.y,0,0,o),Rc(this.layoutVertexArray,g.x,g.y,v.x,v.y,0,1,o),o+=T,Rc(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,0,o),Rc(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,1,o);const C=n.segment.vertexLength;this.indexArray.emplaceBack(C,C+2,C+1),this.indexArray.emplaceBack(C+1,C+2,C+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function zp(a,t){for(let n=0;n<t.length;n++){const o=t[n];n===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(a.x+=o.x,a.y+=o.y,a.sampleCount++)}}function Ef(a,t){return a.x===t.x&&(a.x<0||a.x>ot)||a.y===t.y&&(a.y<0||a.y>ot)}function Od(a){return a.every(t=>t.x<0)||a.every(t=>t.x>ot)||a.every(t=>t.y<0)||a.every(t=>t.y>ot)}let Lp;Wt("FillExtrusionBucket",Ou,{omit:["layers","features"]});var Tm={get paint(){return Lp=Lp||new Wi({"fill-extrusion-opacity":new $t(re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pr(re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $t(re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $t(re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Rs(re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pr(re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pr(re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $t(re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Li extends $a{constructor(t){super(t,Tm)}createBucket(t){return new Ou(t)}queryRadius(){return vh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:f,transform:g,pixelsToTileUnits:_,pixelPosMatrix:v}){const T=hf(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-g.bearingInRadians,_),C=this.paint.get("fill-extrusion-height").evaluate(n,o),R=this.paint.get("fill-extrusion-base").evaluate(n,o),L=function(q,Z,Y){const ne=[];for(const fe of q){const Ie=[fe.x,fe.y,0,1];xr(Ie,Ie,Z),ne.push(new Me(Ie[0]/Ie[3],Ie[1]/Ie[3]))}return ne}(T,v),j=function(q,Z,Y,ne){const fe=[],Ie=[],ve=ne[8]*Z,V=ne[9]*Z,te=ne[10]*Z,be=ne[11]*Z,Ke=ne[8]*Y,At=ne[9]*Y,rt=ne[10]*Y,ht=ne[11]*Y;for(const Lt of q){const Dt=[],Ft=[];for(const mt of Lt){const er=mt.x,hr=mt.y,cr=ne[0]*er+ne[4]*hr+ne[12],or=ne[1]*er+ne[5]*hr+ne[13],Fr=ne[2]*er+ne[6]*hr+ne[14],yi=ne[3]*er+ne[7]*hr+ne[15],Fi=Fr+te,an=yi+be,ma=cr+Ke,Zn=or+At,Qi=Fr+rt,Ki=yi+ht,Pn=new Me((cr+ve)/an,(or+V)/an);Pn.z=Fi/an,Dt.push(Pn);const Tn=new Me(ma/Ki,Zn/Ki);Tn.z=Qi/Ki,Ft.push(Tn)}fe.push(Dt),Ie.push(Ft)}return[fe,Ie]}(f,R,C,v);return function(q,Z,Y){let ne=1/0;xd(Y,Z)&&(ne=Kr(Y,Z[0]));for(let fe=0;fe<Z.length;fe++){const Ie=Z[fe],ve=q[fe];for(let V=0;V<Ie.length-1;V++){const te=Ie[V],be=[te,Ie[V+1],ve[V+1],ve[V],te];uf(Y,be)&&(ne=Math.min(ne,Kr(Y,be)))}}return ne!==1/0&&ne}(j[0],j[1],L)}}function Di(a,t){return a.x*t.x+a.y*t.y}function Kr(a,t){if(a.length===1){let n=0;const o=t[n++];let f;for(;!f||o.equals(f);)if(f=t[n++],!f)return 1/0;for(;n<t.length;n++){const g=t[n],_=a[0],v=f.sub(o),T=g.sub(o),C=_.sub(o),R=Di(v,v),L=Di(v,T),j=Di(T,T),q=Di(C,v),Z=Di(C,T),Y=R*j-L*L,ne=(j*q-L*Z)/Y,fe=(R*Z-L*q)/Y,Ie=o.z*(1-ne-fe)+f.z*ne+g.z*fe;if(isFinite(Ie))return Ie}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const ci=Gi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ki}=ci,cs=Gi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:tu}=cs,zc=yl.VectorTileFeature.types,Nd=Math.cos(Math.PI/180*37.5),Oo=Math.pow(2,14)/.5;class mn{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new sr,this.layoutVertexArray2=new Rr,this.indexArray=new ai,this.programConfigurations=new uo(t.layers,t.zoom),this.segments=new si,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=bh("line",this.layers,n);const f=this.layers[0].layout.get("line-sort-key"),g=!f.isConstant(),_=[];for(const{feature:v,id:T,index:C,sourceLayerIndex:R}of t){const L=this.layers[0]._featureFilter.needGeometry,j=La(v,L);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),j,o))continue;const q=g?f.evaluate(j,{},o):void 0,Z={id:T,properties:v.properties,type:v.type,sourceLayerIndex:R,index:C,geometry:L?j.geometry:Xa(v),patterns:{},sortKey:q};_.push(Z)}g&&_.sort((v,T)=>v.sortKey-T.sortKey);for(const v of _){const{geometry:T,index:C,sourceLayerIndex:R}=v;if(this.hasPattern){const L=gf("line",this.layers,v,this.zoom,n);this.patternFeatures.push(L)}else this.addFeature(v,T,C,o,{},n.subdivisionGranularity);n.featureIndex.insert(t[C].feature,T,C,R,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,n,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,tu)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ki),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,f,g,_){const v=this.layers[0].layout,T=v.get("line-join").evaluate(t,{}),C=v.get("line-cap"),R=v.get("line-miter-limit"),L=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const j of n)this.addLine(j,t,T,C,R,L,f,_);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,g,f)}addLine(t,n,o,f,g,_,v,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Jl(t,v?T.line.getGranularityForZoomLevel(v.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ve=0;ve<t.length-1;ve++)this.totalDistance+=t[ve].dist(t[ve+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C=zc[n.type]==="Polygon";let R=t.length;for(;R>=2&&t[R-1].equals(t[R-2]);)R--;let L=0;for(;L<R-1&&t[L].equals(t[L+1]);)L++;if(R<(C?3:2))return;o==="bevel"&&(g=1.05);const j=this.overscaling<=16?15*ot/(512*this.overscaling):0,q=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let Z,Y,ne,fe,Ie;this.e1=this.e2=-1,C&&(Z=t[R-2],Ie=t[L].sub(Z)._unit()._perp());for(let ve=L;ve<R;ve++){if(ne=ve===R-1?C?t[L+1]:void 0:t[ve+1],ne&&t[ve].equals(ne))continue;Ie&&(fe=Ie),Z&&(Y=Z),Z=t[ve],Ie=ne?ne.sub(Z)._unit()._perp():fe,fe=fe||Ie;let V=fe.add(Ie);V.x===0&&V.y===0||V._unit();const te=fe.x*Ie.x+fe.y*Ie.y,be=V.x*Ie.x+V.y*Ie.y,Ke=be!==0?1/be:1/0,At=2*Math.sqrt(2-2*be),rt=be<Nd&&Y&&ne,ht=fe.x*Ie.y-fe.y*Ie.x>0;if(rt&&ve>L){const Ft=Z.dist(Y);if(Ft>2*j){const mt=Z.sub(Z.sub(Y)._mult(j/Ft)._round());this.updateDistance(Y,mt),this.addCurrentVertex(mt,fe,0,0,q),Y=mt}}const Lt=Y&&ne;let Dt=Lt?o:C?"butt":f;if(Lt&&Dt==="round"&&(Ke<_?Dt="miter":Ke<=2&&(Dt="fakeround")),Dt==="miter"&&Ke>g&&(Dt="bevel"),Dt==="bevel"&&(Ke>2&&(Dt="flipbevel"),Ke<g&&(Dt="miter")),Y&&this.updateDistance(Y,Z),Dt==="miter")V._mult(Ke),this.addCurrentVertex(Z,V,0,0,q);else if(Dt==="flipbevel"){if(Ke>100)V=Ie.mult(-1);else{const Ft=Ke*fe.add(Ie).mag()/fe.sub(Ie).mag();V._perp()._mult(Ft*(ht?-1:1))}this.addCurrentVertex(Z,V,0,0,q),this.addCurrentVertex(Z,V.mult(-1),0,0,q)}else if(Dt==="bevel"||Dt==="fakeround"){const Ft=-Math.sqrt(Ke*Ke-1),mt=ht?Ft:0,er=ht?0:Ft;if(Y&&this.addCurrentVertex(Z,fe,mt,er,q),Dt==="fakeround"){const hr=Math.round(180*At/Math.PI/20);for(let cr=1;cr<hr;cr++){let or=cr/hr;if(or!==.5){const yi=or-.5;or+=or*yi*(or-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*yi*yi+(.848013+te*(.215638*te-1.06021)))}const Fr=Ie.sub(fe)._mult(or)._add(fe)._unit()._mult(ht?-1:1);this.addHalfVertex(Z,Fr.x,Fr.y,!1,ht,0,q)}}ne&&this.addCurrentVertex(Z,Ie,-mt,-er,q)}else if(Dt==="butt")this.addCurrentVertex(Z,V,0,0,q);else if(Dt==="square"){const Ft=Y?1:-1;this.addCurrentVertex(Z,V,Ft,Ft,q)}else Dt==="round"&&(Y&&(this.addCurrentVertex(Z,fe,0,0,q),this.addCurrentVertex(Z,fe,1,1,q,!0)),ne&&(this.addCurrentVertex(Z,Ie,-1,-1,q,!0),this.addCurrentVertex(Z,Ie,0,0,q)));if(rt&&ve<R-1){const Ft=Z.dist(ne);if(Ft>2*j){const mt=Z.add(ne.sub(Z)._mult(j/Ft)._round());this.updateDistance(Z,mt),this.addCurrentVertex(mt,Ie,0,0,q),Z=mt}}}}addCurrentVertex(t,n,o,f,g,_=!1){const v=n.y*f-n.x,T=-n.y-n.x*f;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,_,!1,o,g),this.addHalfVertex(t,v,T,_,!0,-f,g),this.distance>Oo/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,f,g,_))}addHalfVertex({x:t,y:n},o,f,g,_,v,T){const C=.5*(this.lineClips?this.scaledDistance*(Oo-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(n<<1)+(_?1:0),Math.round(63*o)+128,Math.round(63*f)+128,1+(v===0?0:v<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,R,this.e2),T.primitiveLength++),_?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let vl,ru;Wt("LineBucket",mn,{omit:["layers","patternFeatures"]});var Sf={get paint(){return ru=ru||new Wi({"line-opacity":new pr(re.paint_line["line-opacity"]),"line-color":new pr(re.paint_line["line-color"]),"line-translate":new $t(re.paint_line["line-translate"]),"line-translate-anchor":new $t(re.paint_line["line-translate-anchor"]),"line-width":new pr(re.paint_line["line-width"]),"line-gap-width":new pr(re.paint_line["line-gap-width"]),"line-offset":new pr(re.paint_line["line-offset"]),"line-blur":new pr(re.paint_line["line-blur"]),"line-dasharray":new to(re.paint_line["line-dasharray"]),"line-pattern":new Rs(re.paint_line["line-pattern"]),"line-gradient":new $l(re.paint_line["line-gradient"])})},get layout(){return vl=vl||new Wi({"line-cap":new $t(re.layout_line["line-cap"]),"line-join":new pr(re.layout_line["line-join"]),"line-miter-limit":new $t(re.layout_line["line-miter-limit"]),"line-round-limit":new $t(re.layout_line["line-round-limit"]),"line-sort-key":new pr(re.layout_line["line-sort-key"])})}};class Os extends pr{possiblyEvaluate(t,n){return n=new zi(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,f){return n=Xt({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,f)}}let xl;class Sh extends $a{constructor(t){super(t,Sf),this.gradientVersion=0,xl||(xl=new Os(Sf.paint.properties["line-width"].specification),xl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof bo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=xl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new mn(t)}queryRadius(t){const n=t,o=Ba(Tc("line-width",this,n),Tc("line-gap-width",this,n)),f=Tc("line-offset",this,n);return o/2+Math.abs(f)+vh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:f,transform:g,pixelsToTileUnits:_}){const v=hf(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-g.bearingInRadians,_),T=_/2*Ba(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),C=this.paint.get("line-offset").evaluate(n,o);return C&&(f=function(R,L){const j=[];for(let q=0;q<R.length;q++){const Z=R[q],Y=[];for(let ne=0;ne<Z.length;ne++){const fe=Z[ne-1],Ie=Z[ne],ve=Z[ne+1],V=ne===0?new Me(0,0):Ie.sub(fe)._unit()._perp(),te=ne===Z.length-1?new Me(0,0):ve.sub(Ie)._unit()._perp(),be=V._add(te)._unit(),Ke=be.x*te.x+be.y*te.y;Ke!==0&&be._mult(1/Ke),Y.push(be._mult(L)._add(Ie))}j.push(Y)}return j}(f,C*_)),function(R,L,j){for(let q=0;q<L.length;q++){const Z=L[q];if(R.length>=3){for(let Y=0;Y<Z.length;Y++)if(Wl(R,Z[Y]))return!0}if(ku(R,Z,j))return!0}return!1}(v,f,T)}isTileClipped(){return!0}}function Ba(a,t){return t>0?t+2*a:a}const Fd=Gi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),jd=Gi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Gi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Af=Gi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Gi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ah=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),iu=Gi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function pa(a,t,n){return a.sections.forEach(o=>{o.text=function(f,g,_){const v=g.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?f=f.toLocaleUpperCase():v==="lowercase"&&(f=f.toLocaleLowerCase()),Is.applyArabicShaping&&(f=Is.applyArabicShaping(f)),f}(o.text,t,n)}),a}Gi([{name:"triangle",components:3,type:"Uint16"}]),Gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Gi([{type:"Float32",name:"offsetX"}]),Gi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Gi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ns={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Nu,nu,Cf,wn=24,Mf={};function Ch(){return Nu||(Nu=1,Mf.read=function(a,t,n,o,f){var g,_,v=8*f-o-1,T=(1<<v)-1,C=T>>1,R=-7,L=n?f-1:0,j=n?-1:1,q=a[t+L];for(L+=j,g=q&(1<<-R)-1,q>>=-R,R+=v;R>0;g=256*g+a[t+L],L+=j,R-=8);for(_=g&(1<<-R)-1,g>>=-R,R+=o;R>0;_=256*_+a[t+L],L+=j,R-=8);if(g===0)g=1-C;else{if(g===T)return _?NaN:1/0*(q?-1:1);_+=Math.pow(2,o),g-=C}return(q?-1:1)*_*Math.pow(2,g-o)},Mf.write=function(a,t,n,o,f,g){var _,v,T,C=8*g-f-1,R=(1<<C)-1,L=R>>1,j=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,q=o?0:g-1,Z=o?1:-1,Y=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,_=R):(_=Math.floor(Math.log(t)/Math.LN2),t*(T=Math.pow(2,-_))<1&&(_--,T*=2),(t+=_+L>=1?j/T:j*Math.pow(2,1-L))*T>=2&&(_++,T/=2),_+L>=R?(v=0,_=R):_+L>=1?(v=(t*T-1)*Math.pow(2,f),_+=L):(v=t*Math.pow(2,L-1)*Math.pow(2,f),_=0));f>=8;a[n+q]=255&v,q+=Z,v/=256,f-=8);for(_=_<<f|v,C+=f;C>0;a[n+q]=255&_,q+=Z,_/=256,C-=8);a[n+q-Z]|=128*Y}),Mf}function Df(){if(Cf)return nu;Cf=1,nu=t;var a=Ch();function t(V){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(V)?V:new Uint8Array(V||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var n=4294967296,o=1/n,f=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function g(V){return V.type===t.Bytes?V.readVarint()+V.pos:V.pos+1}function _(V,te,be){return be?4294967296*te+(V>>>0):4294967296*(te>>>0)+(V>>>0)}function v(V,te,be){var Ke=te<=16383?1:te<=2097151?2:te<=268435455?3:Math.floor(Math.log(te)/(7*Math.LN2));be.realloc(Ke);for(var At=be.pos-1;At>=V;At--)be.buf[At+Ke]=be.buf[At]}function T(V,te){for(var be=0;be<V.length;be++)te.writeVarint(V[be])}function C(V,te){for(var be=0;be<V.length;be++)te.writeSVarint(V[be])}function R(V,te){for(var be=0;be<V.length;be++)te.writeFloat(V[be])}function L(V,te){for(var be=0;be<V.length;be++)te.writeDouble(V[be])}function j(V,te){for(var be=0;be<V.length;be++)te.writeBoolean(V[be])}function q(V,te){for(var be=0;be<V.length;be++)te.writeFixed32(V[be])}function Z(V,te){for(var be=0;be<V.length;be++)te.writeSFixed32(V[be])}function Y(V,te){for(var be=0;be<V.length;be++)te.writeFixed64(V[be])}function ne(V,te){for(var be=0;be<V.length;be++)te.writeSFixed64(V[be])}function fe(V,te){return(V[te]|V[te+1]<<8|V[te+2]<<16)+16777216*V[te+3]}function Ie(V,te,be){V[be]=te,V[be+1]=te>>>8,V[be+2]=te>>>16,V[be+3]=te>>>24}function ve(V,te){return(V[te]|V[te+1]<<8|V[te+2]<<16)+(V[te+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(V,te,be){for(be=be||this.length;this.pos<be;){var Ke=this.readVarint(),At=Ke>>3,rt=this.pos;this.type=7&Ke,V(At,te,this),this.pos===rt&&this.skip(Ke)}return te},readMessage:function(V,te){return this.readFields(V,te,this.readVarint()+this.pos)},readFixed32:function(){var V=fe(this.buf,this.pos);return this.pos+=4,V},readSFixed32:function(){var V=ve(this.buf,this.pos);return this.pos+=4,V},readFixed64:function(){var V=fe(this.buf,this.pos)+fe(this.buf,this.pos+4)*n;return this.pos+=8,V},readSFixed64:function(){var V=fe(this.buf,this.pos)+ve(this.buf,this.pos+4)*n;return this.pos+=8,V},readFloat:function(){var V=a.read(this.buf,this.pos,!0,23,4);return this.pos+=4,V},readDouble:function(){var V=a.read(this.buf,this.pos,!0,52,8);return this.pos+=8,V},readVarint:function(V){var te,be,Ke=this.buf;return te=127&(be=Ke[this.pos++]),be<128?te:(te|=(127&(be=Ke[this.pos++]))<<7,be<128?te:(te|=(127&(be=Ke[this.pos++]))<<14,be<128?te:(te|=(127&(be=Ke[this.pos++]))<<21,be<128?te:function(At,rt,ht){var Lt,Dt,Ft=ht.buf;if(Lt=(112&(Dt=Ft[ht.pos++]))>>4,Dt<128||(Lt|=(127&(Dt=Ft[ht.pos++]))<<3,Dt<128)||(Lt|=(127&(Dt=Ft[ht.pos++]))<<10,Dt<128)||(Lt|=(127&(Dt=Ft[ht.pos++]))<<17,Dt<128)||(Lt|=(127&(Dt=Ft[ht.pos++]))<<24,Dt<128)||(Lt|=(1&(Dt=Ft[ht.pos++]))<<31,Dt<128))return _(At,Lt,rt);throw new Error("Expected varint not more than 10 bytes")}(te|=(15&(be=Ke[this.pos]))<<28,V,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var V=this.readVarint();return V%2==1?(V+1)/-2:V/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var V=this.readVarint()+this.pos,te=this.pos;return this.pos=V,V-te>=12&&f?function(be,Ke,At){return f.decode(be.subarray(Ke,At))}(this.buf,te,V):function(be,Ke,At){for(var rt="",ht=Ke;ht<At;){var Lt,Dt,Ft,mt=be[ht],er=null,hr=mt>239?4:mt>223?3:mt>191?2:1;if(ht+hr>At)break;hr===1?mt<128&&(er=mt):hr===2?(192&(Lt=be[ht+1]))==128&&(er=(31&mt)<<6|63&Lt)<=127&&(er=null):hr===3?(Dt=be[ht+2],(192&(Lt=be[ht+1]))==128&&(192&Dt)==128&&((er=(15&mt)<<12|(63&Lt)<<6|63&Dt)<=2047||er>=55296&&er<=57343)&&(er=null)):hr===4&&(Dt=be[ht+2],Ft=be[ht+3],(192&(Lt=be[ht+1]))==128&&(192&Dt)==128&&(192&Ft)==128&&((er=(15&mt)<<18|(63&Lt)<<12|(63&Dt)<<6|63&Ft)<=65535||er>=1114112)&&(er=null)),er===null?(er=65533,hr=1):er>65535&&(er-=65536,rt+=String.fromCharCode(er>>>10&1023|55296),er=56320|1023&er),rt+=String.fromCharCode(er),ht+=hr}return rt}(this.buf,te,V)},readBytes:function(){var V=this.readVarint()+this.pos,te=this.buf.subarray(this.pos,V);return this.pos=V,te},readPackedVarint:function(V,te){if(this.type!==t.Bytes)return V.push(this.readVarint(te));var be=g(this);for(V=V||[];this.pos<be;)V.push(this.readVarint(te));return V},readPackedSVarint:function(V){if(this.type!==t.Bytes)return V.push(this.readSVarint());var te=g(this);for(V=V||[];this.pos<te;)V.push(this.readSVarint());return V},readPackedBoolean:function(V){if(this.type!==t.Bytes)return V.push(this.readBoolean());var te=g(this);for(V=V||[];this.pos<te;)V.push(this.readBoolean());return V},readPackedFloat:function(V){if(this.type!==t.Bytes)return V.push(this.readFloat());var te=g(this);for(V=V||[];this.pos<te;)V.push(this.readFloat());return V},readPackedDouble:function(V){if(this.type!==t.Bytes)return V.push(this.readDouble());var te=g(this);for(V=V||[];this.pos<te;)V.push(this.readDouble());return V},readPackedFixed32:function(V){if(this.type!==t.Bytes)return V.push(this.readFixed32());var te=g(this);for(V=V||[];this.pos<te;)V.push(this.readFixed32());return V},readPackedSFixed32:function(V){if(this.type!==t.Bytes)return V.push(this.readSFixed32());var te=g(this);for(V=V||[];this.pos<te;)V.push(this.readSFixed32());return V},readPackedFixed64:function(V){if(this.type!==t.Bytes)return V.push(this.readFixed64());var te=g(this);for(V=V||[];this.pos<te;)V.push(this.readFixed64());return V},readPackedSFixed64:function(V){if(this.type!==t.Bytes)return V.push(this.readSFixed64());var te=g(this);for(V=V||[];this.pos<te;)V.push(this.readSFixed64());return V},skip:function(V){var te=7&V;if(te===t.Varint)for(;this.buf[this.pos++]>127;);else if(te===t.Bytes)this.pos=this.readVarint()+this.pos;else if(te===t.Fixed32)this.pos+=4;else{if(te!==t.Fixed64)throw new Error("Unimplemented type: "+te);this.pos+=8}},writeTag:function(V,te){this.writeVarint(V<<3|te)},realloc:function(V){for(var te=this.length||16;te<this.pos+V;)te*=2;if(te!==this.length){var be=new Uint8Array(te);be.set(this.buf),this.buf=be,this.length=te}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(V){this.realloc(4),Ie(this.buf,V,this.pos),this.pos+=4},writeSFixed32:function(V){this.realloc(4),Ie(this.buf,V,this.pos),this.pos+=4},writeFixed64:function(V){this.realloc(8),Ie(this.buf,-1&V,this.pos),Ie(this.buf,Math.floor(V*o),this.pos+4),this.pos+=8},writeSFixed64:function(V){this.realloc(8),Ie(this.buf,-1&V,this.pos),Ie(this.buf,Math.floor(V*o),this.pos+4),this.pos+=8},writeVarint:function(V){(V=+V||0)>268435455||V<0?function(te,be){var Ke,At;if(te>=0?(Ke=te%4294967296|0,At=te/4294967296|0):(At=~(-te/4294967296),4294967295^(Ke=~(-te%4294967296))?Ke=Ke+1|0:(Ke=0,At=At+1|0)),te>=18446744073709552e3||te<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");be.realloc(10),function(rt,ht,Lt){Lt.buf[Lt.pos++]=127&rt|128,rt>>>=7,Lt.buf[Lt.pos++]=127&rt|128,rt>>>=7,Lt.buf[Lt.pos++]=127&rt|128,rt>>>=7,Lt.buf[Lt.pos++]=127&rt|128,Lt.buf[Lt.pos]=127&(rt>>>=7)}(Ke,0,be),function(rt,ht){var Lt=(7&rt)<<4;ht.buf[ht.pos++]|=Lt|((rt>>>=3)?128:0),rt&&(ht.buf[ht.pos++]=127&rt|((rt>>>=7)?128:0),rt&&(ht.buf[ht.pos++]=127&rt|((rt>>>=7)?128:0),rt&&(ht.buf[ht.pos++]=127&rt|((rt>>>=7)?128:0),rt&&(ht.buf[ht.pos++]=127&rt|((rt>>>=7)?128:0),rt&&(ht.buf[ht.pos++]=127&rt)))))}(At,be)}(V,this):(this.realloc(4),this.buf[this.pos++]=127&V|(V>127?128:0),V<=127||(this.buf[this.pos++]=127&(V>>>=7)|(V>127?128:0),V<=127||(this.buf[this.pos++]=127&(V>>>=7)|(V>127?128:0),V<=127||(this.buf[this.pos++]=V>>>7&127))))},writeSVarint:function(V){this.writeVarint(V<0?2*-V-1:2*V)},writeBoolean:function(V){this.writeVarint(!!V)},writeString:function(V){V=String(V),this.realloc(4*V.length),this.pos++;var te=this.pos;this.pos=function(Ke,At,rt){for(var ht,Lt,Dt=0;Dt<At.length;Dt++){if((ht=At.charCodeAt(Dt))>55295&&ht<57344){if(!Lt){ht>56319||Dt+1===At.length?(Ke[rt++]=239,Ke[rt++]=191,Ke[rt++]=189):Lt=ht;continue}if(ht<56320){Ke[rt++]=239,Ke[rt++]=191,Ke[rt++]=189,Lt=ht;continue}ht=Lt-55296<<10|ht-56320|65536,Lt=null}else Lt&&(Ke[rt++]=239,Ke[rt++]=191,Ke[rt++]=189,Lt=null);ht<128?Ke[rt++]=ht:(ht<2048?Ke[rt++]=ht>>6|192:(ht<65536?Ke[rt++]=ht>>12|224:(Ke[rt++]=ht>>18|240,Ke[rt++]=ht>>12&63|128),Ke[rt++]=ht>>6&63|128),Ke[rt++]=63&ht|128)}return rt}(this.buf,V,this.pos);var be=this.pos-te;be>=128&&v(te,be,this),this.pos=te-1,this.writeVarint(be),this.pos+=be},writeFloat:function(V){this.realloc(4),a.write(this.buf,V,this.pos,!0,23,4),this.pos+=4},writeDouble:function(V){this.realloc(8),a.write(this.buf,V,this.pos,!0,52,8),this.pos+=8},writeBytes:function(V){var te=V.length;this.writeVarint(te),this.realloc(te);for(var be=0;be<te;be++)this.buf[this.pos++]=V[be]},writeRawMessage:function(V,te){this.pos++;var be=this.pos;V(te,this);var Ke=this.pos-be;Ke>=128&&v(be,Ke,this),this.pos=be-1,this.writeVarint(Ke),this.pos+=Ke},writeMessage:function(V,te,be){this.writeTag(V,t.Bytes),this.writeRawMessage(te,be)},writePackedVarint:function(V,te){te.length&&this.writeMessage(V,T,te)},writePackedSVarint:function(V,te){te.length&&this.writeMessage(V,C,te)},writePackedBoolean:function(V,te){te.length&&this.writeMessage(V,j,te)},writePackedFloat:function(V,te){te.length&&this.writeMessage(V,R,te)},writePackedDouble:function(V,te){te.length&&this.writeMessage(V,L,te)},writePackedFixed32:function(V,te){te.length&&this.writeMessage(V,q,te)},writePackedSFixed32:function(V,te){te.length&&this.writeMessage(V,Z,te)},writePackedFixed64:function(V,te){te.length&&this.writeMessage(V,Y,te)},writePackedSFixed64:function(V,te){te.length&&this.writeMessage(V,ne,te)},writeBytesField:function(V,te){this.writeTag(V,t.Bytes),this.writeBytes(te)},writeFixed32Field:function(V,te){this.writeTag(V,t.Fixed32),this.writeFixed32(te)},writeSFixed32Field:function(V,te){this.writeTag(V,t.Fixed32),this.writeSFixed32(te)},writeFixed64Field:function(V,te){this.writeTag(V,t.Fixed64),this.writeFixed64(te)},writeSFixed64Field:function(V,te){this.writeTag(V,t.Fixed64),this.writeSFixed64(te)},writeVarintField:function(V,te){this.writeTag(V,t.Varint),this.writeVarint(te)},writeSVarintField:function(V,te){this.writeTag(V,t.Varint),this.writeSVarint(te)},writeStringField:function(V,te){this.writeTag(V,t.Bytes),this.writeString(te)},writeFloatField:function(V,te){this.writeTag(V,t.Fixed32),this.writeFloat(te)},writeDoubleField:function(V,te){this.writeTag(V,t.Fixed64),this.writeDouble(te)},writeBooleanField:function(V,te){this.writeVarintField(V,!!te)}},nu}var Oa=J(Df());const If=3;function hs(a,t,n){a===1&&n.readMessage(kp,t)}function kp(a,t,n){if(a===3){const{id:o,bitmap:f,width:g,height:_,left:v,top:T,advance:C}=n.readMessage(Bp,{});t.push({id:o,bitmap:new Sc({width:g+2*If,height:_+2*If},f),metrics:{width:g,height:_,left:v,top:T,advance:C}})}}function Bp(a,t,n){a===1?t.id=n.readVarint():a===2?t.bitmap=n.readBytes():a===3?t.width=n.readVarint():a===4?t.height=n.readVarint():a===5?t.left=n.readSVarint():a===6?t.top=n.readSVarint():a===7&&(t.advance=n.readVarint())}const Em=If;function bl(a){let t=0,n=0;for(const _ of a)t+=_.w*_.h,n=Math.max(n,_.w);a.sort((_,v)=>v.h-_.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let f=0,g=0;for(const _ of a)for(let v=o.length-1;v>=0;v--){const T=o[v];if(!(_.w>T.w||_.h>T.h)){if(_.x=T.x,_.y=T.y,g=Math.max(g,_.y+_.h),f=Math.max(f,_.x+_.w),_.w===T.w&&_.h===T.h){const C=o.pop();v<o.length&&(o[v]=C)}else _.h===T.h?(T.x+=_.w,T.w-=_.w):_.w===T.w?(T.y+=_.h,T.h-=_.h):(o.push({x:T.x+_.w,y:T.y,w:T.w-_.w,h:_.h}),T.y+=_.h,T.h-=_.h);break}}return{w:f,h:g,fill:t/(f*g)||0}}const sa=1;class Mh{constructor(t,{pixelRatio:n,version:o,stretchX:f,stretchY:g,content:_,textFitWidth:v,textFitHeight:T}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=f,this.stretchY=g,this.content=_,this.version=o,this.textFitWidth=v,this.textFitHeight=T}get tl(){return[this.paddedRect.x+sa,this.paddedRect.y+sa]}get br(){return[this.paddedRect.x+this.paddedRect.w-sa,this.paddedRect.y+this.paddedRect.h-sa]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*sa)/this.pixelRatio,(this.paddedRect.h-2*sa)/this.pixelRatio]}}class Fu{constructor(t,n){const o={},f={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,o,g),this.addImages(n,f,g);const{w:_,h:v}=bl(g),T=new Ya({width:_||1,height:v||1});for(const C in t){const R=t[C],L=o[C].paddedRect;Ya.copy(R.data,T,{x:0,y:0},{x:L.x+sa,y:L.y+sa},R.data)}for(const C in n){const R=n[C],L=f[C].paddedRect,j=L.x+sa,q=L.y+sa,Z=R.data.width,Y=R.data.height;Ya.copy(R.data,T,{x:0,y:0},{x:j,y:q},R.data),Ya.copy(R.data,T,{x:0,y:Y-1},{x:j,y:q-1},{width:Z,height:1}),Ya.copy(R.data,T,{x:0,y:0},{x:j,y:q+Y},{width:Z,height:1}),Ya.copy(R.data,T,{x:Z-1,y:0},{x:j-1,y:q},{width:1,height:Y}),Ya.copy(R.data,T,{x:0,y:0},{x:j+Z,y:q},{width:1,height:Y})}this.image=T,this.iconPositions=o,this.patternPositions=f}addImages(t,n,o){for(const f in t){const g=t[f],_={x:0,y:0,w:g.data.width+2*sa,h:g.data.height+2*sa};o.push(_),n[f]=new Mh(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[f,g]=t.tl;o.update(n.data,void 0,{x:f,y:g})}}var wl;Wt("ImagePosition",Mh),Wt("ImageAtlas",Fu),I.al=void 0,(wl=I.al||(I.al={}))[wl.none=0]="none",wl[wl.horizontal=1]="horizontal",wl[wl.vertical=2]="vertical",wl[wl.horizontalOnly=3]="horizontalOnly";const Dh=-17;class Lc{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,n,o){const f=new Lc;return f.scale=t||1,f.fontStack=n,f.verticalAlign=o||"bottom",f}static forImage(t,n){const o=new Lc;return o.imageName=t,o.verticalAlign=n||"bottom",o}}class au{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new au;for(let f=0;f<t.sections.length;f++){const g=t.sections[f];g.image?o.addImageSection(g):o.addTextSection(g,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let o=0;o<t.length;o++){const f=t.charCodeAt(o+1)||null,g=t.charCodeAt(o-1)||null;n+=f&&eo(f)&&!Ns[t[o+1]]||g&&eo(g)&&!Ns[t[o-1]]||!Ns[t[o]]?t[o]:Ns[t[o]]}return n}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&Pf[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&Pf[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new au;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}getMaxImageSize(t){let n=0,o=0;for(let f=0;f<this.length();f++){const g=this.getSection(f);if(g.imageName){const _=t[g.imageName];if(!_)continue;const v=_.displaySize;n=Math.max(n,v[0]),o=Math.max(o,v[1])}}return{maxImageWidth:n,maxImageHeight:o}}addTextSection(t,n){this.text+=t.text,this.sections.push(Lc.forText(t.scale,t.fontStack||n,t.verticalAlign));const o=this.sections.length-1;for(let f=0;f<t.text.length;++f)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void mi("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Lc.forImage(n,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):mi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function kc(a,t,n,o,f,g,_,v,T,C,R,L,j,q,Z){const Y=au.fromFeature(a,f);let ne;L===I.al.vertical&&Y.verticalizePunctuation();const{processBidirectionalText:fe,processStyledBidirectionalText:Ie}=Is;if(fe&&Y.sections.length===1){ne=[];const te=fe(Y.toString(),Rf(Y,C,g,t,o,q));for(const be of te){const Ke=new au;Ke.text=be,Ke.sections=Y.sections;for(let At=0;At<be.length;At++)Ke.sectionIndex.push(0);ne.push(Ke)}}else if(Ie){ne=[];const te=Ie(Y.text,Y.sectionIndex,Rf(Y,C,g,t,o,q));for(const be of te){const Ke=new au;Ke.text=be[0],Ke.sectionIndex=be[1],Ke.sections=Y.sections,ne.push(Ke)}}else ne=function(te,be){const Ke=[],At=te.text;let rt=0;for(const ht of be)Ke.push(te.substring(rt,ht)),rt=ht;return rt<At.length&&Ke.push(te.substring(rt,At.length)),Ke}(Y,Rf(Y,C,g,t,o,q));const ve=[],V={positionedLines:ve,text:Y.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(te,be,Ke,At,rt,ht,Lt,Dt,Ft,mt,er,hr){let cr=0,or=0,Fr=0,yi=0;const Fi=Dt==="right"?1:Dt==="left"?0:.5,an=wn/hr;let ma=0;for(const Ki of rt){Ki.trim();const Pn=Ki.getMaxScale(),Tn={positionedGlyphs:[],lineOffset:0};te.positionedLines[ma]=Tn;const Hn=Tn.positionedGlyphs;let ga=0;if(!Ki.length()){or+=ht,++ma;continue}const Ta=Op(At,Ki,an);for(let Na=0;Na<Ki.length();Na++){const gn=Ki.getSection(Na),En=Ki.getSectionIndex(Na),zn=Ki.getCharCode(Na),Ji=Np(Ft,er,zn);let Ii;if(gn.imageName){if(te.iconsInText=!0,gn.scale=gn.scale*an,Ii=Fp(gn,Ji,Pn,Ta,At),!Ii)continue;ga=Math.max(ga,Ii.imageOffset)}else if(Ii=Lf(gn,zn,Ji,Ta,be,Ke),!Ii)continue;const{rect:Qa,metrics:$u,baselineOffset:go}=Ii;Hn.push({glyph:zn,imageName:gn.imageName,x:cr,y:or+go+Dh,vertical:Ji,scale:gn.scale,fontStack:gn.fontStack,sectionIndex:En,metrics:$u,rect:Qa}),Ji?(te.verticalizable=!0,cr+=(gn.imageName?$u.advance:wn)*gn.scale+mt):cr+=$u.advance*gn.scale+mt}Hn.length!==0&&(Fr=Math.max(cr-mt,Fr),jp(Hn,0,Hn.length-1,Fi)),cr=0,Tn.lineOffset=Math.max(ga,(Pn-1)*wn);const Rn=ht*Pn+ga;or+=Rn,yi=Math.max(Rn,yi),++ma}const{horizontalAlign:Zn,verticalAlign:Qi}=zf(Lt);(function(Ki,Pn,Tn,Hn,ga,Ta,Rn,Na,gn){const En=(Pn-Tn)*ga;let zn=0;zn=Ta!==Rn?-Na*Hn-Dh:-Hn*gn*Rn+.5*Rn;for(const Ji of Ki)for(const Ii of Ji.positionedGlyphs)Ii.x+=En,Ii.y+=zn})(te.positionedLines,Fi,Zn,Qi,Fr,yi,ht,or,rt.length),te.top+=-Qi*or,te.bottom=te.top+or,te.left+=-Zn*Fr,te.right=te.left+Fr}(V,t,n,o,ne,_,v,T,L,C,j,Z),!function(te){for(const be of te)if(be.positionedGlyphs.length!==0)return!1;return!0}(ve)&&V}const Pf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Sm={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Am={40:!0};function Ud(a,t,n,o,f,g){if(t.imageName){const _=o[t.imageName];return _?_.displaySize[0]*t.scale*wn/g+f:0}{const _=n[t.fontStack],v=_&&_[a];return v?v.metrics.advance*t.scale+f:0}}function Vd(a,t,n,o){const f=Math.pow(a-t,2);return o?a<t?f/2:2*f:f+Math.abs(n)*n}function Bc(a,t,n){let o=0;return a===10&&(o-=1e4),n&&(o+=150),a!==40&&a!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function Ih(a,t,n,o,f,g){let _=null,v=Vd(t,n,f,g);for(const T of o){const C=Vd(t-T.x,n,f,g)+T.badness;C<=v&&(_=T,v=C)}return{index:a,x:t,priorBreak:_,badness:v}}function qd(a){return a?qd(a.priorBreak).concat(a.index):[]}function Rf(a,t,n,o,f,g){if(!a)return[];const _=[],v=function(L,j,q,Z,Y,ne){let fe=0;for(let Ie=0;Ie<L.length();Ie++){const ve=L.getSection(Ie);fe+=Ud(L.getCharCode(Ie),ve,Z,Y,j,ne)}return fe/Math.max(1,Math.ceil(fe/q))}(a,t,n,o,f,g),T=a.text.indexOf("")>=0;let C=0;for(let L=0;L<a.length();L++){const j=a.getSection(L),q=a.getCharCode(L);if(Pf[q]||(C+=Ud(q,j,o,f,t,g)),L<a.length()-1){const Z=!((R=q)<11904)&&(!!zr["CJK Compatibility Forms"](R)||!!zr["CJK Compatibility"](R)||!!zr["CJK Strokes"](R)||!!zr["CJK Symbols and Punctuation"](R)||!!zr["Enclosed CJK Letters and Months"](R)||!!zr["Halfwidth and Fullwidth Forms"](R)||!!zr["Ideographic Description Characters"](R)||!!zr["Vertical Forms"](R)||Ds.test(String.fromCodePoint(R)));(Sm[q]||Z||j.imageName||L!==a.length()-2&&Am[a.getCharCode(L+1)])&&_.push(Ih(L+1,C,v,_,Bc(q,a.getCharCode(L+1),Z&&T),!1))}}var R;return qd(Ih(a.length(),C,v,_,0,!0))}function zf(a){let t=.5,n=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Op(a,t,n){const o=t.getMaxScale()*wn,{maxImageWidth:f,maxImageHeight:g}=t.getMaxImageSize(a),_=Math.max(o,g*n);return{verticalLineContentWidth:Math.max(o,f*n),horizontalLineContentHeight:_}}function Gd(a){switch(a){case"top":return 0;case"center":return .5;default:return 1}}function Np(a,t,n){return!(a===I.al.horizontal||!t&&!ss(n)||t&&(Pf[n]||(o=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Lf(a,t,n,o,f,g){const _=g[a.fontStack],v=function(C,R,L,j){if(C&&C.rect)return C;const q=R[L.fontStack],Z=q&&q[j];return Z?{rect:null,metrics:Z.metrics}:null}(_&&_[t],f,a,t);if(v===null)return null;let T;if(n)T=o.verticalLineContentWidth-a.scale*wn;else{const C=Gd(a.verticalAlign);T=(o.horizontalLineContentHeight-a.scale*wn)*C}return{rect:v.rect,metrics:v.metrics,baselineOffset:T}}function Fp(a,t,n,o,f){const g=f[a.imageName];if(!g)return null;const _=g.paddedRect,v=g.displaySize,T={width:v[0],height:v[1],left:sa,top:-3,advance:t?v[1]:v[0]};let C;if(t)C=o.verticalLineContentWidth-v[1]*a.scale;else{const R=Gd(a.verticalAlign);C=(o.horizontalLineContentHeight-v[1]*a.scale)*R}return{rect:_,metrics:T,baselineOffset:C,imageOffset:(t?v[0]:v[1])*a.scale-wn*n}}function jp(a,t,n,o){if(o===0)return;const f=a[n],g=(a[n].x+f.metrics.advance*f.scale)*o;for(let _=t;_<=n;_++)a[_].x-=g}function Xi(a,t,n){const{horizontalAlign:o,verticalAlign:f}=zf(n),g=t[0]-a.displaySize[0]*o,_=t[1]-a.displaySize[1]*f;return{image:a,top:_,bottom:_+a.displaySize[1],left:g,right:g+a.displaySize[0]}}function kf(a){var t,n;let o=a.left,f=a.top,g=a.right-o,_=a.bottom-f;const v=(t=a.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",T=(n=a.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",C=(a.image.content[2]-a.image.content[0])/(a.image.content[3]-a.image.content[1]);if(T==="proportional"){if(v==="stretchOnly"&&g/_<C||v==="proportional"){const R=Math.ceil(_*C);o*=R/g,g=R}}else if(v==="proportional"&&T==="stretchOnly"&&C!==0&&g/_>C){const R=Math.ceil(g/C);f*=R/_,_=R}return{x1:o,y1:f,x2:o+g,y2:f+_}}function Up(a,t,n,o,f,g){const _=a.image;let v;if(_.content){const ne=_.content,fe=_.pixelRatio||1;v=[ne[0]/fe,ne[1]/fe,_.displaySize[0]-ne[2]/fe,_.displaySize[1]-ne[3]/fe]}const T=t.left*g,C=t.right*g;let R,L,j,q;n==="width"||n==="both"?(q=f[0]+T-o[3],L=f[0]+C+o[1]):(q=f[0]+(T+C-_.displaySize[0])/2,L=q+_.displaySize[0]);const Z=t.top*g,Y=t.bottom*g;return n==="height"||n==="both"?(R=f[1]+Z-o[0],j=f[1]+Y+o[2]):(R=f[1]+(Z+Y-_.displaySize[1])/2,j=R+_.displaySize[1]),{image:_,top:R,right:L,bottom:j,left:q,collisionPadding:v}}const Oc=255,No=128,su=Oc*No;function Vp(a,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new zi(a+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:f}=n;let g=0;for(;g<o.length&&o[g]<=a;)g++;g=Math.max(0,g-1);let _=g;for(;_<o.length&&o[_]<a+1;)_++;_=Math.min(o.length-1,_);const v=o[g],T=o[_];return n.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:T,interpolationType:f}:{kind:"camera",minZoom:v,maxZoom:T,minSize:n.evaluate(new zi(v)),maxSize:n.evaluate(new zi(T)),interpolationType:f}}}function Nc(a,t,n){let o="never";const f=a.get(t);return f?o=f:a.get(n)&&(o="always"),o}const Fc=yl.VectorTileFeature.types,Zd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ju(a,t,n,o,f,g,_,v,T,C,R,L,j){const q=v?Math.min(su,Math.round(v[0])):0,Z=v?Math.min(su,Math.round(v[1])):0;a.emplaceBack(t,n,Math.round(32*o),Math.round(32*f),g,_,(q<<1)+(T?1:0),Z,16*C,16*R,256*L,256*j)}function Ph(a,t,n){a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n)}function Uu(a){for(const t of a.sections)if(Iu(t.text))return!0;return!1}class Fs{constructor(t){this.layoutVertexArray=new Hi,this.indexArray=new ai,this.programConfigurations=t,this.segments=new si,this.dynamicLayoutVertexArray=new Ti,this.opacityVertexArray=new $i,this.hasVisibleVertices=!1,this.placedSymbolArray=new Te}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,f){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fd.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,jd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Zd,!0),this.opacityVertexBuffer.itemSize=1),(o||f)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Wt("SymbolBuffers",Fs);class Vu{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new si,this.collisionVertexArray=new Mi}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Af.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Wt("CollisionBuffers",Vu);class jc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vp(this.zoom,n["text-size"]),this.iconSizeData=Vp(this.zoom,n["icon-size"]);const o=this.layers[0].layout,f=o.get("symbol-sort-key"),g=o.get("symbol-z-order");this.canOverlap=Nc(o,"text-overlap","text-allow-overlap")!=="never"||Nc(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(_=>I.al[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID}createArrays(){this.text=new Fs(new uo(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Fs(new uo(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new ke,this.lineVertexArray=new De,this.symbolInstances=new Ae,this.textAnchorOffsets=new dt}calculateGlyphDependencies(t,n,o,f,g){for(let _=0;_<t.length;_++)if(n[t.charCodeAt(_)]=!0,(o||f)&&g){const v=Ns[t.charAt(_)];v&&(n[v.charCodeAt(0)]=!0)}}populate(t,n,o){const f=this.layers[0],g=f.layout,_=g.get("text-font"),v=g.get("text-field"),T=g.get("icon-image"),C=(v.value.kind!=="constant"||v.value.value instanceof on&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),R=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,L=g.get("symbol-sort-key");if(this.features=[],!C&&!R)return;const j=n.iconDependencies,q=n.glyphDependencies,Z=n.availableImages,Y=new zi(this.zoom);for(const{feature:ne,id:fe,index:Ie,sourceLayerIndex:ve}of t){const V=f._featureFilter.needGeometry,te=La(ne,V);if(!f._featureFilter.filter(Y,te,o))continue;let be,Ke;if(V||(te.geometry=Xa(ne)),C){const rt=f.getValueAndResolveTokens("text-field",te,o,Z),ht=on.factory(rt),Lt=this.hasRTLText=this.hasRTLText||Uu(ht);(!Lt||Is.getRTLTextPluginStatus()==="unavailable"||Lt&&Is.isParsed())&&(be=pa(ht,f,te))}if(R){const rt=f.getValueAndResolveTokens("icon-image",te,o,Z);Ke=rt instanceof ua?rt:ua.fromString(rt)}if(!be&&!Ke)continue;const At=this.sortFeaturesByKey?L.evaluate(te,{},o):void 0;if(this.features.push({id:fe,text:be,icon:Ke,index:Ie,sourceLayerIndex:ve,geometry:te.geometry,properties:ne.properties,type:Fc[ne.type],sortKey:At}),Ke&&(j[Ke.name]=!0),be){const rt=_.evaluate(te,{},o).join(","),ht=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(I.al.vertical)>=0;for(const Lt of be.sections)if(Lt.image)j[Lt.image.name]=!0;else{const Dt=Mu(be.toString()),Ft=Lt.fontStack||rt,mt=q[Ft]=q[Ft]||{};this.calculateGlyphDependencies(Lt.text,mt,ht,this.allowVerticalPlacement,Dt)}}}g.get("symbol-placement")==="line"&&(this.features=function(ne){const fe={},Ie={},ve=[];let V=0;function te(rt){ve.push(ne[rt]),V++}function be(rt,ht,Lt){const Dt=Ie[rt];return delete Ie[rt],Ie[ht]=Dt,ve[Dt].geometry[0].pop(),ve[Dt].geometry[0]=ve[Dt].geometry[0].concat(Lt[0]),Dt}function Ke(rt,ht,Lt){const Dt=fe[ht];return delete fe[ht],fe[rt]=Dt,ve[Dt].geometry[0].shift(),ve[Dt].geometry[0]=Lt[0].concat(ve[Dt].geometry[0]),Dt}function At(rt,ht,Lt){const Dt=Lt?ht[0][ht[0].length-1]:ht[0][0];return`${rt}:${Dt.x}:${Dt.y}`}for(let rt=0;rt<ne.length;rt++){const ht=ne[rt],Lt=ht.geometry,Dt=ht.text?ht.text.toString():null;if(!Dt){te(rt);continue}const Ft=At(Dt,Lt),mt=At(Dt,Lt,!0);if(Ft in Ie&&mt in fe&&Ie[Ft]!==fe[mt]){const er=Ke(Ft,mt,Lt),hr=be(Ft,mt,ve[er].geometry);delete fe[Ft],delete Ie[mt],Ie[At(Dt,ve[hr].geometry,!0)]=hr,ve[er].geometry=null}else Ft in Ie?be(Ft,mt,Lt):mt in fe?Ke(Ft,mt,Lt):(te(rt),fe[Ft]=V-1,Ie[mt]=V-1)}return ve.filter(rt=>rt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,fe)=>ne.sortKey-fe.sortKey)}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let f=t.dist(n[t.segment+1]),g=t.dist(n[t.segment]);const _={};for(let v=t.segment+1;v<n.length;v++)_[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:f},v<n.length-1&&(f+=n[v+1].dist(n[v]));for(let v=t.segment||0;v>=0;v--)_[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:g},v>0&&(g+=n[v-1].dist(n[v]));for(let v=0;v<n.length;v++){const T=_[v];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,f,g,_,v,T,C,R,L,j){const q=t.indexArray,Z=t.layoutVertexArray,Y=t.segments.prepareSegment(4*n.length,Z,q,this.canOverlap?_.sortKey:void 0),ne=this.glyphOffsetArray.length,fe=Y.vertexLength,Ie=this.allowVerticalPlacement&&v===I.al.vertical?Math.PI/2:0,ve=_.text&&_.text.sections;for(let V=0;V<n.length;V++){const{tl:te,tr:be,bl:Ke,br:At,tex:rt,pixelOffsetTL:ht,pixelOffsetBR:Lt,minFontScaleX:Dt,minFontScaleY:Ft,glyphOffset:mt,isSDF:er,sectionIndex:hr}=n[V],cr=Y.vertexLength,or=mt[1];ju(Z,T.x,T.y,te.x,or+te.y,rt.x,rt.y,o,er,ht.x,ht.y,Dt,Ft),ju(Z,T.x,T.y,be.x,or+be.y,rt.x+rt.w,rt.y,o,er,Lt.x,ht.y,Dt,Ft),ju(Z,T.x,T.y,Ke.x,or+Ke.y,rt.x,rt.y+rt.h,o,er,ht.x,Lt.y,Dt,Ft),ju(Z,T.x,T.y,At.x,or+At.y,rt.x+rt.w,rt.y+rt.h,o,er,Lt.x,Lt.y,Dt,Ft),Ph(t.dynamicLayoutVertexArray,T,Ie),q.emplaceBack(cr,cr+2,cr+1),q.emplaceBack(cr+1,cr+2,cr+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(mt[0]),V!==n.length-1&&hr===n[V+1].sectionIndex||t.programConfigurations.populatePaintArrays(Z.length,_,_.index,{},j,ve&&ve[hr])}t.placedSymbolArray.emplaceBack(T.x,T.y,ne,this.glyphOffsetArray.length-ne,fe,C,R,T.segment,o?o[0]:0,o?o[1]:0,f[0],f[1],v,0,!1,0,L)}_addCollisionDebugVertex(t,n,o,f,g,_){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,f,g,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,n,o,f,g,_,v){const T=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),C=T.vertexLength,R=g.layoutVertexArray,L=g.collisionVertexArray,j=v.anchorX,q=v.anchorY;this._addCollisionDebugVertex(R,L,_,j,q,new Me(t,n)),this._addCollisionDebugVertex(R,L,_,j,q,new Me(o,n)),this._addCollisionDebugVertex(R,L,_,j,q,new Me(o,f)),this._addCollisionDebugVertex(R,L,_,j,q,new Me(t,f)),T.vertexLength+=4;const Z=g.indexArray;Z.emplaceBack(C,C+1),Z.emplaceBack(C+1,C+2),Z.emplaceBack(C+2,C+3),Z.emplaceBack(C+3,C),T.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,f){for(let g=t;g<n;g++){const _=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,f?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vu(Ni,Ah.members,vn),this.iconCollisionBox=new Vu(Ni,Ah.members,vn);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,f,g,_,v,T,C){const R={};for(let L=n;L<o;L++){const j=t.get(L);R.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},R.textFeatureIndex=j.featureIndex;break}for(let L=f;L<g;L++){const j=t.get(L);R.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},R.verticalTextFeatureIndex=j.featureIndex;break}for(let L=_;L<v;L++){const j=t.get(L);R.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},R.iconFeatureIndex=j.featureIndex;break}for(let L=T;L<C;L++){const j=t.get(L);R.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},R.verticalIconFeatureIndex=j.featureIndex;break}return R}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),f=o.vertexStartIndex+4*o.numGlyphs;for(let g=o.vertexStartIndex;g<f;g+=4)t.indexArray.emplaceBack(g,g+2,g+1),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),f=[],g=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const T=this.symbolInstances.get(v);f.push(0|Math.round(n*T.anchorX+o*T.anchorY)),g.push(T.featureIndex)}return _.sort((v,T)=>f[v]-f[T]||g[T]-g[v]),_}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((f,g,_)=>{f>=0&&_.indexOf(f)===g&&this.addIndicesForPlacedSymbol(this.text,f)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Hd,$d;Wt("SymbolBucket",jc,{omit:["layers","collisionBoxArray","features","compareText"]}),jc.MAX_GLYPHS=65535,jc.addDynamicAttributes=Ph;var Bf={get paint(){return $d=$d||new Wi({"icon-opacity":new pr(re.paint_symbol["icon-opacity"]),"icon-color":new pr(re.paint_symbol["icon-color"]),"icon-halo-color":new pr(re.paint_symbol["icon-halo-color"]),"icon-halo-width":new pr(re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pr(re.paint_symbol["icon-halo-blur"]),"icon-translate":new $t(re.paint_symbol["icon-translate"]),"icon-translate-anchor":new $t(re.paint_symbol["icon-translate-anchor"]),"text-opacity":new pr(re.paint_symbol["text-opacity"]),"text-color":new pr(re.paint_symbol["text-color"],{runtimeType:Jt,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new pr(re.paint_symbol["text-halo-color"]),"text-halo-width":new pr(re.paint_symbol["text-halo-width"]),"text-halo-blur":new pr(re.paint_symbol["text-halo-blur"]),"text-translate":new $t(re.paint_symbol["text-translate"]),"text-translate-anchor":new $t(re.paint_symbol["text-translate-anchor"])})},get layout(){return Hd=Hd||new Wi({"symbol-placement":new $t(re.layout_symbol["symbol-placement"]),"symbol-spacing":new $t(re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $t(re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pr(re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $t(re.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $t(re.layout_symbol["icon-allow-overlap"]),"icon-overlap":new $t(re.layout_symbol["icon-overlap"]),"icon-ignore-placement":new $t(re.layout_symbol["icon-ignore-placement"]),"icon-optional":new $t(re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $t(re.layout_symbol["icon-rotation-alignment"]),"icon-size":new pr(re.layout_symbol["icon-size"]),"icon-text-fit":new $t(re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $t(re.layout_symbol["icon-text-fit-padding"]),"icon-image":new pr(re.layout_symbol["icon-image"]),"icon-rotate":new pr(re.layout_symbol["icon-rotate"]),"icon-padding":new pr(re.layout_symbol["icon-padding"]),"icon-keep-upright":new $t(re.layout_symbol["icon-keep-upright"]),"icon-offset":new pr(re.layout_symbol["icon-offset"]),"icon-anchor":new pr(re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $t(re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $t(re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $t(re.layout_symbol["text-rotation-alignment"]),"text-field":new pr(re.layout_symbol["text-field"]),"text-font":new pr(re.layout_symbol["text-font"]),"text-size":new pr(re.layout_symbol["text-size"]),"text-max-width":new pr(re.layout_symbol["text-max-width"]),"text-line-height":new $t(re.layout_symbol["text-line-height"]),"text-letter-spacing":new pr(re.layout_symbol["text-letter-spacing"]),"text-justify":new pr(re.layout_symbol["text-justify"]),"text-radial-offset":new pr(re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $t(re.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new pr(re.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new pr(re.layout_symbol["text-anchor"]),"text-max-angle":new $t(re.layout_symbol["text-max-angle"]),"text-writing-mode":new $t(re.layout_symbol["text-writing-mode"]),"text-rotate":new pr(re.layout_symbol["text-rotate"]),"text-padding":new $t(re.layout_symbol["text-padding"]),"text-keep-upright":new $t(re.layout_symbol["text-keep-upright"]),"text-transform":new pr(re.layout_symbol["text-transform"]),"text-offset":new pr(re.layout_symbol["text-offset"]),"text-allow-overlap":new $t(re.layout_symbol["text-allow-overlap"]),"text-overlap":new $t(re.layout_symbol["text-overlap"]),"text-ignore-placement":new $t(re.layout_symbol["text-ignore-placement"]),"text-optional":new $t(re.layout_symbol["text-optional"])})}};class Xd{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:We,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Wt("FormatSectionOverride",Xd,{omit:["defaultValue"]});class Of extends $a{constructor(t){super(t,Bf)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const f=[];for(const g of o)f.indexOf(g)<0&&f.push(g);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,f){const g=this.layout.get(t).evaluate(n,{},o,f),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||sl(_.value)||!g?g:function(v,T){return T.replace(/{([^{}]+)}/g,(C,R)=>v&&R in v?String(v[R]):"")}(n.properties,g)}createBucket(t){return new jc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Bf.paint.overridableProperties){if(!Of.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new Xd(n),f=new Fl(o,n.property.specification);let g=null;g=n.value.kind==="constant"||n.value.kind==="source"?new So("source",f):new ol("composite",f,n.value.zoomStops),this.paint._values[t]=new vr(n.property,g,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Of.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),f=Bf.paint.properties[n];let g=!1;const _=v=>{for(const T of v)if(f.overrides&&f.overrides.hasOverride(T))return void(g=!0)};if(o.value.kind==="constant"&&o.value.value instanceof on)_(o.value.value.sections);else if(o.value.kind==="source"){const v=C=>{g||(C instanceof br&&Oi(C.value)===_n?_(C.value.sections):C instanceof ec?_(C.sections):C.eachChild(v))},T=o.value;T._styleExpression&&v(T._styleExpression.expression)}return g}}let Nf;var qp={get paint(){return Nf=Nf||new Wi({"background-color":new $t(re.paint_background["background-color"]),"background-pattern":new to(re.paint_background["background-pattern"]),"background-opacity":new $t(re.paint_background["background-opacity"])})}};class Gp extends $a{constructor(t){super(t,qp)}}let Zp;var Yd={get paint(){return Zp=Zp||new Wi({"raster-opacity":new $t(re.paint_raster["raster-opacity"]),"raster-hue-rotate":new $t(re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $t(re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $t(re.paint_raster["raster-brightness-max"]),"raster-saturation":new $t(re.paint_raster["raster-saturation"]),"raster-contrast":new $t(re.paint_raster["raster-contrast"]),"raster-resampling":new $t(re.paint_raster["raster-resampling"]),"raster-fade-duration":new $t(re.paint_raster["raster-fade-duration"])})}};class Wd extends $a{constructor(t){super(t,Yd)}}class Cm extends $a{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Mm{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Rh={once:!0},Qd=63710088e-1;class Tl{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Tl(Ot(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,f=t.lat*n,g=Math.sin(o)*Math.sin(f)+Math.cos(o)*Math.cos(f)*Math.cos((t.lng-this.lng)*n);return Qd*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof Tl)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Tl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Tl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Jr=2*Math.PI*Qd;function Ff(a){return Jr*Math.cos(a*Math.PI/180)}function zh(a){return(180+a)/360}function jf(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Kd(a,t){return a/Ff(t)}function Lh(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Uc(a,t){return a*Ff(Lh(t))}class ou{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=Tl.convert(t);return new ou(zh(o.lng),jf(o.lat),Kd(n,o.lat))}toLngLat(){return new Tl(360*this.x-180,Lh(this.y))}toAltitude(){return Uc(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Jr*(t=Lh(this.y),1/Math.cos(t*Math.PI/180));var t}}function qu(a,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[a*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class Uf{constructor(t,n,o){if(!function(f,g,_){return!(f<0||f>25||_<0||_>=Math.pow(2,f)||g<0||g>=Math.pow(2,f))}(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=Gu(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const f=(_=this.y,v=this.z,T=qu(256*(g=this.x),256*(_=Math.pow(2,v)-_-1),v),C=qu(256*(g+1),256*(_+1),v),T[0]+","+T[1]+","+C[0]+","+C[1]);var g,_,v,T,C;const R=function(L,j,q){let Z,Y="";for(let ne=L;ne>0;ne--)Z=1<<ne-1,Y+=(j&Z?1:0)+(q&Z?2:0);return Y}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,f)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new Me((t.x*n-this.x)*ot,(t.y*n-this.y)*ot)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Hp{constructor(t,n){this.wrap=t,this.canonical=n,this.key=Gu(t,n.z,n.z,n.x,n.y)}}class fs{constructor(t,n,o,f,g){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new Uf(o,+f,+g),this.key=Gu(n,t,o,f,g)}clone(){return new fs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new fs(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fs(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?Gu(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):Gu(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new fs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,f=2*this.canonical.y;return[new fs(n,this.wrap,n,o,f),new fs(n,this.wrap,n,o+1,f),new fs(n,this.wrap,n,o,f+1),new fs(n,this.wrap,n,o+1,f+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new fs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new fs(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Hp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new ou(t.x-this.wrap,t.y))}}function Gu(a,t,n,o,f){(a*=2)<0&&(a=-1*a-1);const g=1<<n;return(g*g*a+g*f+o).toString(36)+n.toString(36)+t.toString(36)}Wt("CanonicalTileID",Uf),Wt("OverscaledTileID",fs,{omit:["terrainRttPosMatrix32f"]});class Jd{constructor(t,n,o,f=1,g=1,_=1,v=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void mi(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const T=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=g,this.blueFactor=_,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let C=0;C<T;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(T,C)]=this.data[this._idx(T-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,T)]=this.data[this._idx(C,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let C=0;C<T;C++)for(let R=0;R<T;R++){const L=this.get(C,R);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(t,n){const o=new Uint8Array(this.data.buffer),f=4*this._idx(t,n);return this.unpack(o[f],o[f+1],o[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new Ya({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let f=n*this.dim,g=n*this.dim+this.dim,_=o*this.dim,v=o*this.dim+this.dim;switch(n){case-1:f=g-1;break;case 1:g=f+1}switch(o){case-1:_=v-1;break;case 1:v=_+1}const T=-n*this.dim,C=-o*this.dim;for(let R=_;R<v;R++)for(let L=f;L<g;L++)this.data[this._idx(L,R)]=t.data[this._idx(L+T,R+C)]}}Wt("DEMData",Jd);class kh{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Bi{constructor(t,n,o,f,g){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=f,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class Vf{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Js(ot,16,0),this.grid3D=new Js(ot,16,0),this.featureIndexArray=new it,this.promoteId=n}insert(t,n,o,f,g,_){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,f,g);const T=_?this.grid3D:this.grid;for(let C=0;C<n.length;C++){const R=n[C],L=[1/0,1/0,-1/0,-1/0];for(let j=0;j<R.length;j++){const q=R[j];L[0]=Math.min(L[0],q.x),L[1]=Math.min(L[1],q.y),L[2]=Math.max(L[2],q.x),L[3]=Math.max(L[3],q.y)}L[0]<ot&&L[1]<ot&&L[2]>=0&&L[3]>=0&&T.insert(v,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new yl.VectorTile(new Oa(this.rawTileData)).layers,this.sourceLayerCoder=new kh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,f){this.loadVTLayers();const g=t.params,_=ot/t.tileSize/t.scale,v=Ma(g.filter),T=t.queryGeometry,C=t.queryPadding*_,R=$p(T),L=this.grid.query(R.minX-C,R.minY-C,R.maxX+C,R.maxY+C),j=$p(t.cameraQueryGeometry),q=this.grid3D.query(j.minX-C,j.minY-C,j.maxX+C,j.maxY+C,(ne,fe,Ie,ve)=>function(V,te,be,Ke,At){for(const ht of V)if(te<=ht.x&&be<=ht.y&&Ke>=ht.x&&At>=ht.y)return!0;const rt=[new Me(te,be),new Me(te,At),new Me(Ke,At),new Me(Ke,be)];if(V.length>2){for(const ht of rt)if(Wl(V,ht))return!0}for(let ht=0;ht<V.length-1;ht++)if(wd(V[ht],V[ht+1],rt))return!0;return!1}(t.cameraQueryGeometry,ne-C,fe-C,Ie+C,ve+C));for(const ne of q)L.push(ne);L.sort(ep);const Z={};let Y;for(let ne=0;ne<L.length;ne++){const fe=L[ne];if(fe===Y)continue;Y=fe;const Ie=this.featureIndexArray.get(fe);let ve=null;this.loadMatchingFeature(Z,Ie.bucketIndex,Ie.sourceLayerIndex,Ie.featureIndex,v,g.layers,g.availableImages,n,o,f,(V,te,be)=>(ve||(ve=Xa(V)),te.queryIntersectsFeature({queryGeometry:T,feature:V,featureState:be,geometry:ve,zoom:this.z,transform:t.transform,pixelsToTileUnits:_,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return Z}loadMatchingFeature(t,n,o,f,g,_,v,T,C,R,L){const j=this.bucketLayerIDs[n];if(_&&!j.some(ne=>_.has(ne)))return;const q=this.sourceLayerCoder.decode(o),Z=this.vtLayers[q].feature(f);if(g.needGeometry){const ne=La(Z,!0);if(!g.filter(new zi(this.tileID.overscaledZ),ne,this.tileID.canonical))return}else if(!g.filter(new zi(this.tileID.overscaledZ),Z))return;const Y=this.getId(Z,q);for(let ne=0;ne<j.length;ne++){const fe=j[ne];if(_&&!_.has(fe))continue;const Ie=T[fe];if(!Ie)continue;let ve={};Y&&R&&(ve=R.getState(Ie.sourceLayer||"_geojsonTileLayer",Y));const V=Xt({},C[fe]);V.paint=oa(V.paint,Ie.paint,Z,ve,v),V.layout=oa(V.layout,Ie.layout,Z,ve,v);const te=!L||L(Z,Ie,ve);if(!te)continue;const be=new Bi(Z,this.z,this.x,this.y,Y);be.layer=V;let Ke=t[fe];Ke===void 0&&(Ke=t[fe]=[]),Ke.push({featureIndex:f,feature:be,intersectionZ:te})}}lookupSymbolFeatures(t,n,o,f,g,_,v,T){const C={};this.loadVTLayers();const R=Ma(g);for(const L of t)this.loadMatchingFeature(C,o,f,L,R,_,v,T,n);return C}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){var o;let f=t.id;return this.promoteId&&(f=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof f=="boolean"&&(f=Number(f)),f===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(f=Number(t.properties.cluster_id))),f}}function oa(a,t,n,o,f){return hi(a,(g,_)=>{const v=t instanceof di?t.get(_):null;return v&&v.evaluate?v.evaluate(n,o,f):v})}function $p(a){let t=1/0,n=1/0,o=-1/0,f=-1/0;for(const g of a)t=Math.min(t,g.x),n=Math.min(n,g.y),o=Math.max(o,g.x),f=Math.max(f,g.y);return{minX:t,minY:n,maxX:o,maxY:f}}function ep(a,t){return t-a}function qf(a,t,n,o,f){const g=[];for(let _=0;_<a.length;_++){const v=a[_];let T;for(let C=0;C<v.length-1;C++){let R=v[C],L=v[C+1];R.x<t&&L.x<t||(R.x<t?R=new Me(t,R.y+(t-R.x)/(L.x-R.x)*(L.y-R.y))._round():L.x<t&&(L=new Me(t,R.y+(t-R.x)/(L.x-R.x)*(L.y-R.y))._round()),R.y<n&&L.y<n||(R.y<n?R=new Me(R.x+(n-R.y)/(L.y-R.y)*(L.x-R.x),n)._round():L.y<n&&(L=new Me(R.x+(n-R.y)/(L.y-R.y)*(L.x-R.x),n)._round()),R.x>=o&&L.x>=o||(R.x>=o?R=new Me(o,R.y+(o-R.x)/(L.x-R.x)*(L.y-R.y))._round():L.x>=o&&(L=new Me(o,R.y+(o-R.x)/(L.x-R.x)*(L.y-R.y))._round()),R.y>=f&&L.y>=f||(R.y>=f?R=new Me(R.x+(f-R.y)/(L.y-R.y)*(L.x-R.x),f)._round():L.y>=f&&(L=new Me(R.x+(f-R.y)/(L.y-R.y)*(L.x-R.x),f)._round()),T&&R.equals(T[T.length-1])||(T=[R],g.push(T)),T.push(L)))))}}return g}Wt("FeatureIndex",Vf,{omit:["rawTileData","sourceLayerCoder"]});class mo extends Me{constructor(t,n,o,f){super(t,n),this.angle=o,f!==void 0&&(this.segment=f)}clone(){return new mo(this.x,this.y,this.angle,this.segment)}}function tp(a,t,n,o,f){if(t.segment===void 0||n===0)return!0;let g=t,_=t.segment+1,v=0;for(;v>-n/2;){if(_--,_<0)return!1;v-=a[_].dist(g),g=a[_]}v+=a[_].dist(a[_+1]),_++;const T=[];let C=0;for(;v<n/2;){const R=a[_],L=a[_+1];if(!L)return!1;let j=a[_-1].angleTo(R)-R.angleTo(L);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:v,angleDelta:j}),C+=j;v-T[0].distance>o;)C-=T.shift().angleDelta;if(C>f)return!1;_++,v+=R.dist(L)}return!0}function rp(a){let t=0;for(let n=0;n<a.length-1;n++)t+=a[n].dist(a[n+1]);return t}function Gf(a,t,n){return a?.6*t*n:0}function Zf(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function Dm(a,t,n,o,f,g){const _=Gf(n,f,g),v=Zf(n,o)*g;let T=0;const C=rp(a)/2;for(let R=0;R<a.length-1;R++){const L=a[R],j=a[R+1],q=L.dist(j);if(T+q>C){const Z=(C-T)/q,Y=vs.number(L.x,j.x,Z),ne=vs.number(L.y,j.y,Z),fe=new mo(Y,ne,j.angleTo(L),R);return fe._round(),!_||tp(a,fe,v,_,t)?fe:void 0}T+=q}}function Xp(a,t,n,o,f,g,_,v,T){const C=Gf(o,g,_),R=Zf(o,f),L=R*_,j=a[0].x===0||a[0].x===T||a[0].y===0||a[0].y===T;return t-L<t/4&&(t=L+t/4),Yp(a,j?t/2*v%t:(R/2+2*g)*_*v%t,t,C,n,L,j,!1,T)}function Yp(a,t,n,o,f,g,_,v,T){const C=g/2,R=rp(a);let L=0,j=t-n,q=[];for(let Z=0;Z<a.length-1;Z++){const Y=a[Z],ne=a[Z+1],fe=Y.dist(ne),Ie=ne.angleTo(Y);for(;j+n<L+fe;){j+=n;const ve=(j-L)/fe,V=vs.number(Y.x,ne.x,ve),te=vs.number(Y.y,ne.y,ve);if(V>=0&&V<T&&te>=0&&te<T&&j-C>=0&&j+C<=R){const be=new mo(V,te,Ie,Z);be._round(),o&&!tp(a,be,g,o,f)||q.push(be)}}L+=fe}return v||q.length||_||(q=Yp(a,L/2,n,o,f,g,_,!0,T)),q}Wt("Anchor",mo);const Vc=sa;function Wp(a,t,n,o){const f=[],g=a.image,_=g.pixelRatio,v=g.paddedRect.w-2*Vc,T=g.paddedRect.h-2*Vc;let C={x1:a.left,y1:a.top,x2:a.right,y2:a.bottom};const R=g.stretchX||[[0,v]],L=g.stretchY||[[0,T]],j=(mt,er)=>mt+er[1]-er[0],q=R.reduce(j,0),Z=L.reduce(j,0),Y=v-q,ne=T-Z;let fe=0,Ie=q,ve=0,V=Z,te=0,be=Y,Ke=0,At=ne;if(g.content&&o){const mt=g.content,er=mt[2]-mt[0],hr=mt[3]-mt[1];(g.textFitWidth||g.textFitHeight)&&(C=kf(a)),fe=Hf(R,0,mt[0]),ve=Hf(L,0,mt[1]),Ie=Hf(R,mt[0],mt[2]),V=Hf(L,mt[1],mt[3]),te=mt[0]-fe,Ke=mt[1]-ve,be=er-Ie,At=hr-V}const rt=C.x1,ht=C.y1,Lt=C.x2-rt,Dt=C.y2-ht,Ft=(mt,er,hr,cr)=>{const or=Bh(mt.stretch-fe,Ie,Lt,rt),Fr=qc(mt.fixed-te,be,mt.stretch,q),yi=Bh(er.stretch-ve,V,Dt,ht),Fi=qc(er.fixed-Ke,At,er.stretch,Z),an=Bh(hr.stretch-fe,Ie,Lt,rt),ma=qc(hr.fixed-te,be,hr.stretch,q),Zn=Bh(cr.stretch-ve,V,Dt,ht),Qi=qc(cr.fixed-Ke,At,cr.stretch,Z),Ki=new Me(or,yi),Pn=new Me(an,yi),Tn=new Me(an,Zn),Hn=new Me(or,Zn),ga=new Me(Fr/_,Fi/_),Ta=new Me(ma/_,Qi/_),Rn=t*Math.PI/180;if(Rn){const En=Math.sin(Rn),zn=Math.cos(Rn),Ji=[zn,-En,En,zn];Ki._matMult(Ji),Pn._matMult(Ji),Hn._matMult(Ji),Tn._matMult(Ji)}const Na=mt.stretch+mt.fixed,gn=er.stretch+er.fixed;return{tl:Ki,tr:Pn,bl:Hn,br:Tn,tex:{x:g.paddedRect.x+Vc+Na,y:g.paddedRect.y+Vc+gn,w:hr.stretch+hr.fixed-Na,h:cr.stretch+cr.fixed-gn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ga,pixelOffsetBR:Ta,minFontScaleX:be/_/Lt,minFontScaleY:At/_/Dt,isSDF:n}};if(o&&(g.stretchX||g.stretchY)){const mt=El(R,Y,q),er=El(L,ne,Z);for(let hr=0;hr<mt.length-1;hr++){const cr=mt[hr],or=mt[hr+1];for(let Fr=0;Fr<er.length-1;Fr++)f.push(Ft(cr,er[Fr],or,er[Fr+1]))}}else f.push(Ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:T+1}));return f}function Hf(a,t,n){let o=0;for(const f of a)o+=Math.max(t,Math.min(n,f[1]))-Math.max(t,Math.min(n,f[0]));return o}function El(a,t,n){const o=[{fixed:-1,stretch:0}];for(const[f,g]of a){const _=o[o.length-1];o.push({fixed:f-_.stretch,stretch:_.stretch}),o.push({fixed:f-_.stretch,stretch:_.stretch+(g-f)})}return o.push({fixed:t+Vc,stretch:n}),o}function Bh(a,t,n,o){return a/t*n+o}function qc(a,t,n,o){return a-t*n/o}class $f{constructor(t,n,o,f,g,_,v,T,C,R){var L;if(this.boxStartIndex=t.length,C){let j=_.top,q=_.bottom;const Z=_.collisionPadding;Z&&(j-=Z[1],q+=Z[3]);let Y=q-j;Y>0&&(Y=Math.max(10,Y),this.circleDiameter=Y)}else{const j=!((L=_.image)===null||L===void 0)&&L.content&&(_.image.textFitWidth||_.image.textFitHeight)?kf(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};j.y1=j.y1*v-T[0],j.y2=j.y2*v+T[2],j.x1=j.x1*v-T[3],j.x2=j.x2*v+T[1];const q=_.collisionPadding;if(q&&(j.x1-=q[0]*v,j.y1-=q[1]*v,j.x2+=q[2]*v,j.y2+=q[3]*v),R){const Z=new Me(j.x1,j.y1),Y=new Me(j.x2,j.y1),ne=new Me(j.x1,j.y2),fe=new Me(j.x2,j.y2),Ie=R*Math.PI/180;Z._rotate(Ie),Y._rotate(Ie),ne._rotate(Ie),fe._rotate(Ie),j.x1=Math.min(Z.x,Y.x,ne.x,fe.x),j.x2=Math.max(Z.x,Y.x,ne.x,fe.x),j.y1=Math.min(Z.y,Y.y,ne.y,fe.y),j.y2=Math.max(Z.y,Y.y,ne.y,fe.y)}t.emplaceBack(n.x,n.y,j.x1,j.y1,j.x2,j.y2,o,f,g)}this.boxEndIndex=t.length}}class Im{constructor(t=[],n=(o,f)=>o<f?-1:o>f?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,f=n[t];for(;t>0;){const g=t-1>>1,_=n[g];if(o(f,_)>=0)break;n[t]=_,t=g}n[t]=f}_down(t){const{data:n,compare:o}=this,f=this.length>>1,g=n[t];for(;t<f;){let _=1+(t<<1);const v=_+1;if(v<this.length&&o(n[v],n[_])<0&&(_=v),o(n[_],g)>=0)break;n[t]=n[_],t=_}n[t]=g}}function ip(a,t=1,n=!1){let o=1/0,f=1/0,g=-1/0,_=-1/0;const v=a[0];for(let q=0;q<v.length;q++){const Z=v[q];(!q||Z.x<o)&&(o=Z.x),(!q||Z.y<f)&&(f=Z.y),(!q||Z.x>g)&&(g=Z.x),(!q||Z.y>_)&&(_=Z.y)}const T=Math.min(g-o,_-f);let C=T/2;const R=new Im([],Pm);if(T===0)return new Me(o,f);for(let q=o;q<g;q+=T)for(let Z=f;Z<_;Z+=T)R.push(new wa(q+C,Z+C,C,a));let L=function(q){let Z=0,Y=0,ne=0;const fe=q[0];for(let Ie=0,ve=fe.length,V=ve-1;Ie<ve;V=Ie++){const te=fe[Ie],be=fe[V],Ke=te.x*be.y-be.x*te.y;Y+=(te.x+be.x)*Ke,ne+=(te.y+be.y)*Ke,Z+=3*Ke}return new wa(Y/Z,ne/Z,0,q)}(a),j=R.length;for(;R.length;){const q=R.pop();(q.d>L.d||!L.d)&&(L=q,n&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,j)),q.max-L.d<=t||(C=q.h/2,R.push(new wa(q.p.x-C,q.p.y-C,C,a)),R.push(new wa(q.p.x+C,q.p.y-C,C,a)),R.push(new wa(q.p.x-C,q.p.y+C,C,a)),R.push(new wa(q.p.x+C,q.p.y+C,C,a)),j+=4)}return n&&(console.log(`num probes: ${j}`),console.log(`best distance: ${L.d}`)),L.p}function Pm(a,t){return t.max-a.max}function wa(a,t,n,o){this.p=new Me(a,t),this.h=n,this.d=function(f,g){let _=!1,v=1/0;for(let T=0;T<g.length;T++){const C=g[T];for(let R=0,L=C.length,j=L-1;R<L;j=R++){const q=C[R],Z=C[j];q.y>f.y!=Z.y>f.y&&f.x<(Z.x-q.x)*(f.y-q.y)/(Z.y-q.y)+q.x&&(_=!_),v=Math.min(v,bd(f,q,Z))}}return(_?1:-1)*Math.sqrt(v)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Un;I.aB=void 0,(Un=I.aB||(I.aB={}))[Un.center=1]="center",Un[Un.left=2]="left",Un[Un.right=3]="right",Un[Un.top=4]="top",Un[Un.bottom=5]="bottom",Un[Un["top-left"]=6]="top-left",Un[Un["top-right"]=7]="top-right",Un[Un["bottom-left"]=8]="bottom-left",Un[Un["bottom-right"]=9]="bottom-right";const Sl=7,Xf=Number.POSITIVE_INFINITY;function Gc(a,t){return t[1]!==Xf?function(n,o,f){let g=0,_=0;switch(o=Math.abs(o),f=Math.abs(f),n){case"top-right":case"top-left":case"top":_=f-Sl;break;case"bottom-right":case"bottom-left":case"bottom":_=-f+Sl}switch(n){case"top-right":case"bottom-right":case"right":g=-o;break;case"top-left":case"bottom-left":case"left":g=o}return[g,_]}(a,t[0],t[1]):function(n,o){let f=0,g=0;o<0&&(o=0);const _=o/Math.SQRT2;switch(n){case"top-right":case"top-left":g=_-Sl;break;case"bottom-right":case"bottom-left":g=-_+Sl;break;case"bottom":g=-o+Sl;break;case"top":g=o-Sl}switch(n){case"top-right":case"bottom-right":f=-_;break;case"top-left":case"bottom-left":f=_;break;case"left":f=o;break;case"right":f=-o}return[f,g]}(a,t[0])}function ds(a,t,n){var o;const f=a.layout,g=(o=f.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(g){const v=g.values,T=[];for(let C=0;C<v.length;C+=2){const R=T[C]=v[C],L=v[C+1].map(j=>j*wn);R.startsWith("top")?L[1]-=Sl:R.startsWith("bottom")&&(L[1]+=Sl),T[C+1]=L}return new en(T)}const _=f.get("text-variable-anchor");if(_){let v;v=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(t,{},n)*wn,Xf]:f.get("text-offset").evaluate(t,{},n).map(C=>C*wn);const T=[];for(const C of _)T.push(C,Gc(C,v));return new en(T)}return null}function Yf(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Wf(a,t,n,o,f,g,_,v,T,C,R,L){let j=g.textMaxSize.evaluate(t,{});j===void 0&&(j=_);const q=a.layers[0].layout,Z=q.get("icon-offset").evaluate(t,{},R),Y=Qp(n.horizontal),ne=_/24,fe=a.tilePixelRatio*ne,Ie=a.tilePixelRatio*j/24,ve=a.tilePixelRatio*v,V=a.tilePixelRatio*q.get("symbol-spacing"),te=q.get("text-padding")*a.tilePixelRatio,be=function(hr,cr,or,Fr=1){const yi=hr.get("icon-padding").evaluate(cr,{},or),Fi=yi&&yi.values;return[Fi[0]*Fr,Fi[1]*Fr,Fi[2]*Fr,Fi[3]*Fr]}(q,t,R,a.tilePixelRatio),Ke=q.get("text-max-angle")/180*Math.PI,At=q.get("text-rotation-alignment")!=="viewport"&&q.get("symbol-placement")!=="point",rt=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",ht=q.get("symbol-placement"),Lt=V/2,Dt=q.get("icon-text-fit");let Ft;o&&Dt!=="none"&&(a.allowVerticalPlacement&&n.vertical&&(Ft=Up(o,n.vertical,Dt,q.get("icon-text-fit-padding"),Z,ne)),Y&&(o=Up(o,Y,Dt,q.get("icon-text-fit-padding"),Z,ne)));const mt=R?L.line.getGranularityForZoomLevel(R.z):1,er=(hr,cr)=>{cr.x<0||cr.x>=ot||cr.y<0||cr.y>=ot||function(or,Fr,yi,Fi,an,ma,Zn,Qi,Ki,Pn,Tn,Hn,ga,Ta,Rn,Na,gn,En,zn,Ji,Ii,Qa,$u,go,ed){const r=or.addToLineVertexArray(Fr,yi);let s,u,p,x,A=0,G=0,ee=0,Se=0,et=-1,Et=-1;const Ct={};let lt=Pa("");if(or.allowVerticalPlacement&&Fi.vertical){const _a=Qi.layout.get("text-rotate").evaluate(Ii,{},go)+90;p=new $f(Ki,Fr,Pn,Tn,Hn,Fi.vertical,ga,Ta,Rn,_a),Zn&&(x=new $f(Ki,Fr,Pn,Tn,Hn,Zn,gn,En,Rn,_a))}if(an){const _a=Qi.layout.get("icon-rotate").evaluate(Ii,{}),_o=Qi.layout.get("icon-text-fit")!=="none",Nh=Wp(an,_a,$u,_o),Al=Zn?Wp(Zn,_a,$u,_o):void 0;u=new $f(Ki,Fr,Pn,Tn,Hn,an,gn,En,!1,_a),A=4*Nh.length;const Fh=or.iconSizeData;let cu=null;Fh.kind==="source"?(cu=[No*Qi.layout.get("icon-size").evaluate(Ii,{})],cu[0]>su&&mi(`${or.layerIds[0]}: Value for "icon-size" is >= ${Oc}. Reduce your "icon-size".`)):Fh.kind==="composite"&&(cu=[No*Qa.compositeIconSizes[0].evaluate(Ii,{},go),No*Qa.compositeIconSizes[1].evaluate(Ii,{},go)],(cu[0]>su||cu[1]>su)&&mi(`${or.layerIds[0]}: Value for "icon-size" is >= ${Oc}. Reduce your "icon-size".`)),or.addSymbols(or.icon,Nh,cu,Ji,zn,Ii,I.al.none,Fr,r.lineStartIndex,r.lineLength,-1,go),et=or.icon.placedSymbolArray.length-1,Al&&(G=4*Al.length,or.addSymbols(or.icon,Al,cu,Ji,zn,Ii,I.al.vertical,Fr,r.lineStartIndex,r.lineLength,-1,go),Et=or.icon.placedSymbolArray.length-1)}const ct=Object.keys(Fi.horizontal);for(const _a of ct){const _o=Fi.horizontal[_a];if(!s){lt=Pa(_o.text);const Al=Qi.layout.get("text-rotate").evaluate(Ii,{},go);s=new $f(Ki,Fr,Pn,Tn,Hn,_o,ga,Ta,Rn,Al)}const Nh=_o.positionedLines.length===1;if(ee+=Fo(or,Fr,_o,ma,Qi,Rn,Ii,Na,r,Fi.vertical?I.al.horizontal:I.al.horizontalOnly,Nh?ct:[_a],Ct,et,Qa,go),Nh)break}Fi.vertical&&(Se+=Fo(or,Fr,Fi.vertical,ma,Qi,Rn,Ii,Na,r,I.al.vertical,["vertical"],Ct,Et,Qa,go));const Cr=s?s.boxStartIndex:or.collisionBoxArray.length,Tr=s?s.boxEndIndex:or.collisionBoxArray.length,ji=p?p.boxStartIndex:or.collisionBoxArray.length,Xe=p?p.boxEndIndex:or.collisionBoxArray.length,Fe=u?u.boxStartIndex:or.collisionBoxArray.length,Je=u?u.boxEndIndex:or.collisionBoxArray.length,Pt=x?x.boxStartIndex:or.collisionBoxArray.length,fr=x?x.boxEndIndex:or.collisionBoxArray.length;let Mr=-1;const gr=(_a,_o)=>_a&&_a.circleDiameter?Math.max(_a.circleDiameter,_o):_o;Mr=gr(s,Mr),Mr=gr(p,Mr),Mr=gr(u,Mr),Mr=gr(x,Mr);const Er=Mr>-1?1:0;Er&&(Mr*=ed/wn),or.glyphOffsetArray.length>=jc.MAX_GLYPHS&&mi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ii.sortKey!==void 0&&or.addToSortKeyRanges(or.symbolInstances.length,Ii.sortKey);const la=ds(Qi,Ii,go),[vi,uu]=function(_a,_o){const Nh=_a.length,Al=_o==null?void 0:_o.values;if((Al==null?void 0:Al.length)>0)for(let Fh=0;Fh<Al.length;Fh+=2){const cu=Al[Fh+1];_a.emplaceBack(I.aB[Al[Fh]],cu[0],cu[1])}return[Nh,_a.length]}(or.textAnchorOffsets,la);or.symbolInstances.emplaceBack(Fr.x,Fr.y,Ct.right>=0?Ct.right:-1,Ct.center>=0?Ct.center:-1,Ct.left>=0?Ct.left:-1,Ct.vertical||-1,et,Et,lt,Cr,Tr,ji,Xe,Fe,Je,Pt,fr,Pn,ee,Se,A,G,Er,0,ga,Mr,vi,uu)}(a,cr,hr,n,o,f,Ft,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,fe,[te,te,te,te],At,T,ve,be,rt,Z,t,g,C,R,_)};if(ht==="line")for(const hr of qf(t.geometry,0,0,ot,ot)){const cr=Jl(hr,mt),or=Xp(cr,V,Ke,n.vertical||Y,o,24,Ie,a.overscaling,ot);for(const Fr of or)Y&&Rm(a,Y.text,Lt,Fr)||er(cr,Fr)}else if(ht==="line-center"){for(const hr of t.geometry)if(hr.length>1){const cr=Jl(hr,mt),or=Dm(cr,Ke,n.vertical||Y,o,24,Ie);or&&er(cr,or)}}else if(t.type==="Polygon")for(const hr of mu(t.geometry,0)){const cr=ip(hr,16);er(Jl(hr[0],mt,!0),new mo(cr.x,cr.y,0))}else if(t.type==="LineString")for(const hr of t.geometry){const cr=Jl(hr,mt);er(cr,new mo(cr[0].x,cr[0].y,0))}else if(t.type==="Point")for(const hr of t.geometry)for(const cr of hr)er([cr],new mo(cr.x,cr.y,0))}function Fo(a,t,n,o,f,g,_,v,T,C,R,L,j,q,Z){const Y=function(Ie,ve,V,te,be,Ke,At,rt){const ht=te.layout.get("text-rotate").evaluate(Ke,{})*Math.PI/180,Lt=[];for(const Dt of ve.positionedLines)for(const Ft of Dt.positionedGlyphs){if(!Ft.rect)continue;const mt=Ft.rect||{};let er=Em+1,hr=!0,cr=1,or=0;const Fr=(be||rt)&&Ft.vertical,yi=Ft.metrics.advance*Ft.scale/2;if(rt&&ve.verticalizable&&(or=Dt.lineOffset/2-(Ft.imageName?-(wn-Ft.metrics.width*Ft.scale)/2:(Ft.scale-1)*wn)),Ft.imageName){const En=At[Ft.imageName];hr=En.sdf,cr=En.pixelRatio,er=sa/cr}const Fi=be?[Ft.x+yi,Ft.y]:[0,0];let an=be?[0,0]:[Ft.x+yi+V[0],Ft.y+V[1]-or],ma=[0,0];Fr&&(ma=an,an=[0,0]);const Zn=Ft.metrics.isDoubleResolution?2:1,Qi=(Ft.metrics.left-er)*Ft.scale-yi+an[0],Ki=(-Ft.metrics.top-er)*Ft.scale+an[1],Pn=Qi+mt.w/Zn*Ft.scale/cr,Tn=Ki+mt.h/Zn*Ft.scale/cr,Hn=new Me(Qi,Ki),ga=new Me(Pn,Ki),Ta=new Me(Qi,Tn),Rn=new Me(Pn,Tn);if(Fr){const En=new Me(-yi,yi-Dh),zn=-Math.PI/2,Ji=wn/2-yi,Ii=new Me(5-Dh-Ji,-(Ft.imageName?Ji:0)),Qa=new Me(...ma);Hn._rotateAround(zn,En)._add(Ii)._add(Qa),ga._rotateAround(zn,En)._add(Ii)._add(Qa),Ta._rotateAround(zn,En)._add(Ii)._add(Qa),Rn._rotateAround(zn,En)._add(Ii)._add(Qa)}if(ht){const En=Math.sin(ht),zn=Math.cos(ht),Ji=[zn,-En,En,zn];Hn._matMult(Ji),ga._matMult(Ji),Ta._matMult(Ji),Rn._matMult(Ji)}const Na=new Me(0,0),gn=new Me(0,0);Lt.push({tl:Hn,tr:ga,bl:Ta,br:Rn,tex:mt,writingMode:ve.writingMode,glyphOffset:Fi,sectionIndex:Ft.sectionIndex,isSDF:hr,pixelOffsetTL:Na,pixelOffsetBR:gn,minFontScaleX:0,minFontScaleY:0})}return Lt}(0,n,v,f,g,_,o,a.allowVerticalPlacement),ne=a.textSizeData;let fe=null;ne.kind==="source"?(fe=[No*f.layout.get("text-size").evaluate(_,{})],fe[0]>su&&mi(`${a.layerIds[0]}: Value for "text-size" is >= ${Oc}. Reduce your "text-size".`)):ne.kind==="composite"&&(fe=[No*q.compositeTextSizes[0].evaluate(_,{},Z),No*q.compositeTextSizes[1].evaluate(_,{},Z)],(fe[0]>su||fe[1]>su)&&mi(`${a.layerIds[0]}: Value for "text-size" is >= ${Oc}. Reduce your "text-size".`)),a.addSymbols(a.text,Y,fe,v,g,_,C,t,T.lineStartIndex,T.lineLength,j,Z);for(const Ie of R)L[Ie]=a.text.placedSymbolArray.length-1;return 4*Y.length}function Qp(a){for(const t in a)return a[t];return null}function Rm(a,t,n,o){const f=a.compareText;if(t in f){const g=f[t];for(let _=g.length-1;_>=0;_--)if(o.dist(g[_])<n)return!0}else f[t]=[];return f[t].push(o),!1}const Zu=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Qf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=o>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const g=Zu[15&o];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new Qf(v,_,g,t)}constructor(t,n=64,o=Float64Array,f){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=Zu.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-v%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${o}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+T,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+T),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+T,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return np(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:v}=this,T=[0,g.length-1,0],C=[];for(;T.length;){const R=T.pop()||0,L=T.pop()||0,j=T.pop()||0;if(L-j<=v){for(let ne=j;ne<=L;ne++){const fe=_[2*ne],Ie=_[2*ne+1];fe>=t&&fe<=o&&Ie>=n&&Ie<=f&&C.push(g[ne])}continue}const q=j+L>>1,Z=_[2*q],Y=_[2*q+1];Z>=t&&Z<=o&&Y>=n&&Y<=f&&C.push(g[q]),(R===0?t<=Z:n<=Y)&&(T.push(j),T.push(q-1),T.push(1-R)),(R===0?o>=Z:f>=Y)&&(T.push(q+1),T.push(L),T.push(1-R))}return C}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:g,nodeSize:_}=this,v=[0,f.length-1,0],T=[],C=o*o;for(;v.length;){const R=v.pop()||0,L=v.pop()||0,j=v.pop()||0;if(L-j<=_){for(let ne=j;ne<=L;ne++)Jp(g[2*ne],g[2*ne+1],t,n)<=C&&T.push(f[ne]);continue}const q=j+L>>1,Z=g[2*q],Y=g[2*q+1];Jp(Z,Y,t,n)<=C&&T.push(f[q]),(R===0?t-o<=Z:n-o<=Y)&&(v.push(j),v.push(q-1),v.push(1-R)),(R===0?t+o>=Z:n+o>=Y)&&(v.push(q+1),v.push(L),v.push(1-R))}return T}}function np(a,t,n,o,f,g){if(f-o<=n)return;const _=o+f>>1;Kp(a,t,_,o,f,g),np(a,t,n,o,_-1,1-g),np(a,t,n,_+1,f,1-g)}function Kp(a,t,n,o,f,g){for(;f>o;){if(f-o>600){const C=f-o+1,R=n-o+1,L=Math.log(C),j=.5*Math.exp(2*L/3),q=.5*Math.sqrt(L*j*(C-j)/C)*(R-C/2<0?-1:1);Kp(a,t,n,Math.max(o,Math.floor(n-R*j/C+q)),Math.min(f,Math.floor(n+(C-R)*j/C+q)),g)}const _=t[2*n+g];let v=o,T=f;for(Oh(a,t,o,n),t[2*f+g]>_&&Oh(a,t,o,f);v<T;){for(Oh(a,t,v,T),v++,T--;t[2*v+g]<_;)v++;for(;t[2*T+g]>_;)T--}t[2*o+g]===_?Oh(a,t,o,T):(T++,Oh(a,t,T,f)),T<=n&&(o=T+1),n<=T&&(f=T-1)}}function Oh(a,t,n,o){ap(a,n,o),ap(t,2*n,2*o),ap(t,2*n+1,2*o+1)}function ap(a,t,n){const o=a[t];a[t]=a[n],a[n]=o}function Jp(a,t,n,o){const f=a-n,g=t-o;return f*f+g*g}var sp;I.co=void 0,(sp=I.co||(I.co={})).create="create",sp.load="load",sp.fullLoad="fullLoad";let Kf=null,Zc=[];const lu=1e3/60,Hu="loadTime",Jf="fullLoadTime",zm={mark(a){performance.mark(a)},frame(a){const t=a;Kf!=null&&Zc.push(t-Kf),Kf=t},clearMetrics(){Kf=null,Zc=[],performance.clearMeasures(Hu),performance.clearMeasures(Jf);for(const a in I.co)performance.clearMarks(I.co[a])},getPerformanceMetrics(){performance.measure(Hu,I.co.create,I.co.load),performance.measure(Jf,I.co.create,I.co.fullLoad);const a=performance.getEntriesByName(Hu)[0].duration,t=performance.getEntriesByName(Jf)[0].duration,n=Zc.length,o=1/(Zc.reduce((g,_)=>g+_,0)/n/1e3),f=Zc.filter(g=>g>lu).reduce((g,_)=>g+(_-lu)/lu,0);return{loadTime:a,fullLoadTime:t,fps:o,percentDroppedFrames:f/(n+f)*100,totalFrames:n}}};I.$=ou,I.A=Pe,I.B=vs,I.C=zi,I.D=$t,I.E=Ee,I.F=yd,I.G=function(a){if(Ui==null){const t=a.navigator?a.navigator.userAgent:null;Ui=!!a.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Ui},I.H=class{constructor(a,t){this.target=a,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Mm(()=>this.process()),this.subscription=Ai(this.target,"message",n=>this.receive(n),!1),this.globalScope=kr(self)?a:window}registerMessageHandler(a,t){this.messageHandlers[a]=t}sendAsync(a,t){return new Promise((n,o)=>{const f=Math.round(1e18*Math.random()).toString(36).substring(0,10),g=t?Ai(t.signal,"abort",()=>{g==null||g.unsubscribe(),delete this.resolveRejects[f];const T={id:f,type:"<cancel>",origin:location.origin,targetMapId:a.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},Rh):null;this.resolveRejects[f]={resolve:T=>{g==null||g.unsubscribe(),n(T)},reject:T=>{g==null||g.unsubscribe(),o(T)}};const _=[],v=Object.assign(Object.assign({},a),{id:f,sourceMapId:this.mapId,origin:location.origin,data:hl(a.data,_)});this.target.postMessage(v,{transfer:_})})}receive(a){const t=a.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(kr(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const a=this.taskQueue.shift(),t=this.tasks[a];delete this.tasks[a],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(a,t)}processTask(a,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){const f=this.resolveRejects[a];return delete this.resolveRejects[a],f?void(t.error?f.reject(Mo(t.error)):f.resolve(Mo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(a,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=Mo(t.data),o=new AbortController;this.abortControllers[a]=o;try{const f=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(a,null,f)}catch(f){this.completeTask(a,f)}})}completeTask(a,t,n){const o=[];delete this.abortControllers[a];const f={id:a,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?hl(t):null,data:hl(n,o)};this.target.postMessage(f,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},I.I=Mh,I.J=Ar,I.K=function(){var a=new Pe(16);return Pe!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},I.L=function(a,t,n){var o,f,g,_,v,T,C,R,L,j,q,Z,Y=n[0],ne=n[1],fe=n[2];return t===a?(a[12]=t[0]*Y+t[4]*ne+t[8]*fe+t[12],a[13]=t[1]*Y+t[5]*ne+t[9]*fe+t[13],a[14]=t[2]*Y+t[6]*ne+t[10]*fe+t[14],a[15]=t[3]*Y+t[7]*ne+t[11]*fe+t[15]):(f=t[1],g=t[2],_=t[3],v=t[4],T=t[5],C=t[6],R=t[7],L=t[8],j=t[9],q=t[10],Z=t[11],a[0]=o=t[0],a[1]=f,a[2]=g,a[3]=_,a[4]=v,a[5]=T,a[6]=C,a[7]=R,a[8]=L,a[9]=j,a[10]=q,a[11]=Z,a[12]=o*Y+v*ne+L*fe+t[12],a[13]=f*Y+T*ne+j*fe+t[13],a[14]=g*Y+C*ne+q*fe+t[14],a[15]=_*Y+R*ne+Z*fe+t[15]),a},I.M=function(a,t,n){var o=n[0],f=n[1],g=n[2];return a[0]=t[0]*o,a[1]=t[1]*o,a[2]=t[2]*o,a[3]=t[3]*o,a[4]=t[4]*f,a[5]=t[5]*f,a[6]=t[6]*f,a[7]=t[7]*f,a[8]=t[8]*g,a[9]=t[9]*g,a[10]=t[10]*g,a[11]=t[11]*g,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},I.N=function(a,t,n){var o=t[0],f=t[1],g=t[2],_=t[3],v=t[4],T=t[5],C=t[6],R=t[7],L=t[8],j=t[9],q=t[10],Z=t[11],Y=t[12],ne=t[13],fe=t[14],Ie=t[15],ve=n[0],V=n[1],te=n[2],be=n[3];return a[0]=ve*o+V*v+te*L+be*Y,a[1]=ve*f+V*T+te*j+be*ne,a[2]=ve*g+V*C+te*q+be*fe,a[3]=ve*_+V*R+te*Z+be*Ie,a[4]=(ve=n[4])*o+(V=n[5])*v+(te=n[6])*L+(be=n[7])*Y,a[5]=ve*f+V*T+te*j+be*ne,a[6]=ve*g+V*C+te*q+be*fe,a[7]=ve*_+V*R+te*Z+be*Ie,a[8]=(ve=n[8])*o+(V=n[9])*v+(te=n[10])*L+(be=n[11])*Y,a[9]=ve*f+V*T+te*j+be*ne,a[10]=ve*g+V*C+te*q+be*fe,a[11]=ve*_+V*R+te*Z+be*Ie,a[12]=(ve=n[12])*o+(V=n[13])*v+(te=n[14])*L+(be=n[15])*Y,a[13]=ve*f+V*T+te*j+be*ne,a[14]=ve*g+V*C+te*q+be*fe,a[15]=ve*_+V*R+te*Z+be*Ie,a},I.O=function(a,t){const n={};for(let o=0;o<t.length;o++){const f=t[o];f in a&&(n[f]=a[f])}return n},I.P=Me,I.Q=Tl,I.R=Ya,I.S=jf,I.T=mh,I.U=zh,I.V=zt,I.W=Rt,I.X=sn,I.Y=fs,I.Z=ot,I._=c,I.a=ii,I.a$=function(a,t,n){var o=Math.sin(n),f=Math.cos(n),g=t[4],_=t[5],v=t[6],T=t[7],C=t[8],R=t[9],L=t[10],j=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=g*f+C*o,a[5]=_*f+R*o,a[6]=v*f+L*o,a[7]=T*f+j*o,a[8]=C*f-g*o,a[9]=R*f-_*o,a[10]=L*f-v*o,a[11]=j*f-T*o,a},I.a0=25,I.a1=Uf,I.a2=a=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const o of a){const f=window.document.createElement("source");Ne(o)||(t.crossOrigin="Anonymous"),f.src=o,t.appendChild(f)}})},I.a3=O,I.a4=function(){return mr++},I.a5=he,I.a6=jc,I.a7=Ma,I.a8=La,I.a9=Bi,I.aA=function(a,t,n,o,f=!1){if(!n[0]&&!n[1])return[0,0];const g=f?o==="map"?-a.bearingInRadians:0:o==="viewport"?a.bearingInRadians:0;if(g){const _=Math.sin(g),v=Math.cos(g);n=[n[0]*v-n[1]*_,n[0]*_+n[1]*v]}return[f?n[0]:jt(t,n[0],a.zoom),f?n[1]:jt(t,n[1],a.zoom)]},I.aC=Nc,I.aD=Yf,I.aE=zf,I.aF=Qf,I.aG=Gi,I.aH=pn,I.aI=ut,I.aJ=si,I.aK=ai,I.aL=Ot,I.aM=Yi,I.aN=Uc,I.aO=function(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a[2]=t[2]*n,a},I.aP=function(a,t,n){return a[0]=t[0]+n[0],a[1]=t[1]+n[1],a[2]=t[2]+n[2],a},I.aQ=function(a){var t=new Pe(3);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t},I.aR=function(a,t,n){return a[0]=t[0]*n[0],a[1]=t[1]*n[1],a[2]=t[2]*n[2],a[3]=t[3]*n[3],a},I.aS=function(a,t,n){return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],a},I.aT=function(a,t){var n=t[0],o=t[1],f=t[2],g=n*n+o*o+f*f;return g>0&&(g=1/Math.sqrt(g)),a[0]=t[0]*g,a[1]=t[1]*g,a[2]=t[2]*g,a},I.aU=function(a,t,n){var o=t[0],f=t[1],g=t[2],_=n[0],v=n[1],T=n[2];return a[0]=f*T-g*v,a[1]=g*_-o*T,a[2]=o*v-f*_,a},I.aV=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]},I.aW=Hp,I.aX=Gu,I.aY=function(a,t,n,o,f){var g,_=1/Math.tan(t/2);return a[0]=_/n,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=_,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,f!=null&&f!==1/0?(a[10]=(f+o)*(g=1/(o-f)),a[14]=2*f*o*g):(a[10]=-1,a[14]=-2*o),a},I.aZ=function(a){var t=new Pe(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},I.a_=function(a,t,n){var o=Math.sin(n),f=Math.cos(n),g=t[0],_=t[1],v=t[2],T=t[3],C=t[4],R=t[5],L=t[6],j=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=g*f+C*o,a[1]=_*f+R*o,a[2]=v*f+L*o,a[3]=T*f+j*o,a[4]=C*f-g*o,a[5]=R*f-_*o,a[6]=L*f-v*o,a[7]=j*f-T*o,a},I.aa=function(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,f,g)=>{const _=f||g;return t[o]=!_||_.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},I.ab=Nr,I.ac=function(a){return Math.pow(2,a)},I.ad=bt,I.ae=It,I.af=85.051129,I.ag=Kd,I.ah=function(a){return Math.log(a)/Math.LN2},I.ai=function(a){var t=a[0],n=a[1];return t*t+n*n},I.aj=function(a,t){const n=[];for(const o in a)o in t||n.push(o);return n},I.ak=function(a,t){let n=0,o=0;if(a.kind==="constant")o=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:f,minZoom:g,maxZoom:_}=a,v=f?It(Wn.interpolationFactor(f,t,g,_),0,1):0;a.kind==="camera"?o=vs.number(a.minSize,a.maxSize,v):n=v}return{uSizeT:n,uSize:o}},I.am=function(a,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:f}){return a.kind==="source"?o/No:a.kind==="composite"?vs.number(o/No,f/No,n):t},I.an=function(a,t){var n=t[0],o=t[1],f=t[2],g=t[3],_=t[4],v=t[5],T=t[6],C=t[7],R=t[8],L=t[9],j=t[10],q=t[11],Z=t[12],Y=t[13],ne=t[14],fe=t[15],Ie=n*v-o*_,ve=n*T-f*_,V=n*C-g*_,te=o*T-f*v,be=o*C-g*v,Ke=f*C-g*T,At=R*Y-L*Z,rt=R*ne-j*Z,ht=R*fe-q*Z,Lt=L*ne-j*Y,Dt=L*fe-q*Y,Ft=j*fe-q*ne,mt=Ie*Ft-ve*Dt+V*Lt+te*ht-be*rt+Ke*At;return mt?(a[0]=(v*Ft-T*Dt+C*Lt)*(mt=1/mt),a[1]=(f*Dt-o*Ft-g*Lt)*mt,a[2]=(Y*Ke-ne*be+fe*te)*mt,a[3]=(j*be-L*Ke-q*te)*mt,a[4]=(T*ht-_*Ft-C*rt)*mt,a[5]=(n*Ft-f*ht+g*rt)*mt,a[6]=(ne*V-Z*Ke-fe*ve)*mt,a[7]=(R*Ke-j*V+q*ve)*mt,a[8]=(_*Dt-v*ht+C*At)*mt,a[9]=(o*ht-n*Dt-g*At)*mt,a[10]=(Z*be-Y*V+fe*Ie)*mt,a[11]=(L*V-R*be-q*Ie)*mt,a[12]=(v*rt-_*Lt-T*At)*mt,a[13]=(n*Lt-o*rt+f*At)*mt,a[14]=(Y*ve-Z*te-ne*Ie)*mt,a[15]=(R*te-L*ve+j*Ie)*mt,a):null},I.ao=Re,I.ap=function(a){return Math.hypot(a[0],a[1])},I.aq=function(a){return a[0]=0,a[1]=0,a},I.ar=function(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a},I.as=Ph,I.at=xr,I.au=function(a,t,n,o){const f=t.y-a.y,g=t.x-a.x,_=o.y-n.y,v=o.x-n.x,T=_*g-v*f;if(T===0)return null;const C=(v*(a.y-n.y)-_*(a.x-n.x))/T;return new Me(a.x+C*g,a.y+C*f)},I.av=qf,I.aw=uf,I.ax=function(a){let t=1/0,n=1/0,o=-1/0,f=-1/0;for(const g of a)t=Math.min(t,g.x),n=Math.min(n,g.y),o=Math.max(o,g.x),f=Math.max(f,g.y);return[t,n,o,f]},I.ay=wn,I.az=jt,I.b=_r,I.b$=class extends ${},I.b0=function(){const a=new Float32Array(16);return bt(a),a},I.b1=function(){const a=new Float64Array(16);return bt(a),a},I.b2=function(){return new Float64Array(16)},I.b3=function(a,t,n){const o=new Float64Array(4);return function(f,g,_,v){var T=.5*Math.PI/180;g*=T,_*=T,v*=T;var C=Math.sin(g),R=Math.cos(g),L=Math.sin(_),j=Math.cos(_),q=Math.sin(v),Z=Math.cos(v);f[0]=C*j*Z-R*L*q,f[1]=R*L*Z+C*j*q,f[2]=R*j*q-C*L*Z,f[3]=R*j*Z+C*L*q}(o,a,t-90,n),o},I.b4=function(a,t,n,o){var f,g,_,v,T,C=t[0],R=t[1],L=t[2],j=t[3],q=n[0],Z=n[1],Y=n[2],ne=n[3];return(g=C*q+R*Z+L*Y+j*ne)<0&&(g=-g,q=-q,Z=-Z,Y=-Y,ne=-ne),1-g>Ge?(f=Math.acos(g),_=Math.sin(f),v=Math.sin((1-o)*f)/_,T=Math.sin(o*f)/_):(v=1-o,T=o),a[0]=v*C+T*q,a[1]=v*R+T*Z,a[2]=v*L+T*Y,a[3]=v*j+T*ne,a},I.b5=function(a){const t=new Float64Array(9);var n,o,f,g,_,v,T,C,R,L,j,q,Z,Y,ne,fe,Ie,ve;L=(f=(o=a)[0])*(T=f+f),j=(g=o[1])*T,Z=(_=o[2])*T,Y=_*(C=g+g),fe=(v=o[3])*T,Ie=v*C,ve=v*(R=_+_),(n=t)[0]=1-(q=g*C)-(ne=_*R),n[3]=j-ve,n[6]=Z+Ie,n[1]=j+ve,n[4]=1-L-ne,n[7]=Y-fe,n[2]=Z-Ie,n[5]=Y+fe,n[8]=1-L-q;const V=Yi(-Math.asin(It(t[2],-1,1)));let te,be;return Math.hypot(t[5],t[8])<.001?(te=0,be=-Yi(Math.atan2(t[3],t[4]))):(te=Yi(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),be=Yi(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:te,pitch:V+90,bearing:be}},I.b6=function(a,t){return a.roll==t.roll&&a.pitch==t.pitch&&a.bearing==t.bearing},I.b7=Or,I.b8=Lu,I.b9=Kl,I.bA=function(a){if(a.type==="custom")return new Cm(a);switch(a.type){case"background":return new Gp(a);case"circle":return new Tp(a);case"fill":return new Ld(a);case"fill-extrusion":return new Li(a);case"heatmap":return new Cd(a);case"hillshade":return new mf(a);case"line":return new Sh(a);case"raster":return new Wd(a);case"symbol":return new Of(a)}},I.bB=jr,I.bC=function(a,t){if(!a)return[{command:"setStyle",args:[t]}];let n=[];try{if(!Oe(a.version,t.version))return[{command:"setStyle",args:[t]}];Oe(a.center,t.center)||n.push({command:"setCenter",args:[t.center]}),Oe(a.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),Oe(a.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Oe(a.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),Oe(a.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),Oe(a.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),Oe(a.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),Oe(a.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),Oe(a.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),Oe(a.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),Oe(a.light,t.light)||n.push({command:"setLight",args:[t.light]}),Oe(a.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),Oe(a.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),Oe(a.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},f=[];(function(_,v,T,C){let R;for(R in v=v||{},_=_||{})Object.prototype.hasOwnProperty.call(_,R)&&(Object.prototype.hasOwnProperty.call(v,R)||_t(R,T,C));for(R in v)Object.prototype.hasOwnProperty.call(v,R)&&(Object.prototype.hasOwnProperty.call(_,R)?Oe(_[R],v[R])||(_[R].type==="geojson"&&v[R].type==="geojson"&&Gt(_,v,R)?He(T,{command:"setGeoJSONSourceData",args:[R,v[R].data]}):Ut(R,v,T,C)):je(R,v,T))})(a.sources,t.sources,f,o);const g=[];a.layers&&a.layers.forEach(_=>{"source"in _&&o[_.source]?n.push({command:"removeLayer",args:[_.id]}):g.push(_)}),n=n.concat(f),function(_,v,T){v=v||[];const C=(_=_||[]).map(ir),R=v.map(ir),L=_.reduce(k,{}),j=v.reduce(k,{}),q=C.slice(),Z=Object.create(null);let Y,ne,fe,Ie,ve;for(let V=0,te=0;V<C.length;V++)Y=C[V],Object.prototype.hasOwnProperty.call(j,Y)?te++:(He(T,{command:"removeLayer",args:[Y]}),q.splice(q.indexOf(Y,te),1));for(let V=0,te=0;V<R.length;V++)Y=R[R.length-1-V],q[q.length-1-V]!==Y&&(Object.prototype.hasOwnProperty.call(L,Y)?(He(T,{command:"removeLayer",args:[Y]}),q.splice(q.lastIndexOf(Y,q.length-te),1)):te++,Ie=q[q.length-V],He(T,{command:"addLayer",args:[j[Y],Ie]}),q.splice(q.length-V,0,Y),Z[Y]=!0);for(let V=0;V<R.length;V++)if(Y=R[V],ne=L[Y],fe=j[Y],!Z[Y]&&!Oe(ne,fe))if(Oe(ne.source,fe.source)&&Oe(ne["source-layer"],fe["source-layer"])&&Oe(ne.type,fe.type)){for(ve in tr(ne.layout,fe.layout,T,Y,null,"setLayoutProperty"),tr(ne.paint,fe.paint,T,Y,null,"setPaintProperty"),Oe(ne.filter,fe.filter)||He(T,{command:"setFilter",args:[Y,fe.filter]}),Oe(ne.minzoom,fe.minzoom)&&Oe(ne.maxzoom,fe.maxzoom)||He(T,{command:"setLayerZoomRange",args:[Y,fe.minzoom,fe.maxzoom]}),ne)Object.prototype.hasOwnProperty.call(ne,ve)&&ve!=="layout"&&ve!=="paint"&&ve!=="filter"&&ve!=="metadata"&&ve!=="minzoom"&&ve!=="maxzoom"&&(ve.indexOf("paint.")===0?tr(ne[ve],fe[ve],T,Y,ve.slice(6),"setPaintProperty"):Oe(ne[ve],fe[ve])||He(T,{command:"setLayerProperty",args:[Y,ve,fe[ve]]}));for(ve in fe)Object.prototype.hasOwnProperty.call(fe,ve)&&!Object.prototype.hasOwnProperty.call(ne,ve)&&ve!=="layout"&&ve!=="paint"&&ve!=="filter"&&ve!=="metadata"&&ve!=="minzoom"&&ve!=="maxzoom"&&(ve.indexOf("paint.")===0?tr(ne[ve],fe[ve],T,Y,ve.slice(6),"setPaintProperty"):Oe(ne[ve],fe[ve])||He(T,{command:"setLayerProperty",args:[Y,ve,fe[ve]]}))}else He(T,{command:"removeLayer",args:[Y]}),Ie=q[q.lastIndexOf(Y)+1],He(T,{command:"addLayer",args:[fe,Ie]})}(g,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},I.bD=function(a){const t=[],n=a.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},I.bE=function a(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!a(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!a(t[o],n[o]))return!1;return!0}return t===n},I.bF=hi,I.bG=Si,I.bH=class extends Ei{constructor(a,t){super(a,t),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},I.bI=of,I.bJ=class extends Ei{constructor(a,t){super(a,t),this.current=Yl}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let t=1;t<16;t++)if(a[t]!==this.current[t]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},I.bK=gh,I.bL=class extends Ei{constructor(a,t){super(a,t),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},I.bM=class extends Ei{constructor(a,t){super(a,t),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},I.bN=gt,I.bO=function(a,t){var n=Math.sin(t),o=Math.cos(t);return a[0]=o,a[1]=n,a[2]=0,a[3]=-n,a[4]=o,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},I.bP=function(a,t,n){var o=t[0],f=t[1],g=t[2];return a[0]=o*n[0]+f*n[3]+g*n[6],a[1]=o*n[1]+f*n[4]+g*n[7],a[2]=o*n[2]+f*n[5]+g*n[8],a},I.bQ=function(a,t,n,o,f,g,_){var v=1/(t-n),T=1/(o-f),C=1/(g-_);return a[0]=-2*v,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*C,a[11]=0,a[12]=(t+n)*v,a[13]=(f+o)*T,a[14]=(_+g)*C,a[15]=1,a},I.bR=class extends Ei{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(4*a.length);for(let n=0;n<a.length;n++)t[4*n]=a[n].r,t[4*n+1]=a[n].g,t[4*n+2]=a[n].b,t[4*n+3]=a[n].a;this.gl.uniform4fv(this.location,t)}}},I.bS=class extends Ei{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(a);this.gl.uniform1fv(this.location,t)}}},I.bT=class extends m{},I.bU=iu,I.bV=class extends b{},I.bW=xh,I.bX=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},I.bY=pf,I.bZ=function(a,t,n){var o=t[0],f=t[1],g=t[2],_=n[3]*o+n[7]*f+n[11]*g+n[15];return a[0]=(n[0]*o+n[4]*f+n[8]*g+n[12])/(_=_||1),a[1]=(n[1]*o+n[5]*f+n[9]*g+n[13])/_,a[2]=(n[2]*o+n[6]*f+n[10]*g+n[14])/_,a},I.b_=class extends io{},I.ba=Dc,I.bb=Wa,I.bc=Ye,I.bd=Mt,I.be=kn,I.bf=function(a,t,n,o,f){return Ye(o,f,It((a-t)/(n-t),0,1))},I.bg=ue,I.bh=function(){return new Float64Array(3)},I.bi=function(a,t,n,o){return a[0]=t[0]+n[0]*o,a[1]=t[1]+n[1]*o,a[2]=t[2]+n[2]*o,a},I.bj=Kt,I.bk=function(){return new Float64Array(4)},I.bl=function(a,t,n,o){var f=[],g=[];return f[0]=t[0]-n[0],f[1]=t[1]-n[1],f[2]=t[2]-n[2],g[0]=f[0]*Math.cos(o)-f[1]*Math.sin(o),g[1]=f[0]*Math.sin(o)+f[1]*Math.cos(o),g[2]=f[2],a[0]=g[0]+n[0],a[1]=g[1]+n[1],a[2]=g[2]+n[2],a},I.bm=function(a,t,n,o){var f=[],g=[];return f[0]=t[0]-n[0],f[1]=t[1]-n[1],f[2]=t[2]-n[2],g[0]=f[0],g[1]=f[1]*Math.cos(o)-f[2]*Math.sin(o),g[2]=f[1]*Math.sin(o)+f[2]*Math.cos(o),a[0]=g[0]+n[0],a[1]=g[1]+n[1],a[2]=g[2]+n[2],a},I.bn=function(a,t,n,o){var f=[],g=[];return f[0]=t[0]-n[0],f[1]=t[1]-n[1],f[2]=t[2]-n[2],g[0]=f[2]*Math.sin(o)+f[0]*Math.cos(o),g[1]=f[1],g[2]=f[2]*Math.cos(o)-f[0]*Math.sin(o),a[0]=g[0]+n[0],a[1]=g[1]+n[1],a[2]=g[2]+n[2],a},I.bo=nr,I.bp=function(a,t,n){var o=Math.sin(n),f=Math.cos(n),g=t[0],_=t[1],v=t[2],T=t[3],C=t[8],R=t[9],L=t[10],j=t[11];return t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=g*f-C*o,a[1]=_*f-R*o,a[2]=v*f-L*o,a[3]=T*f-j*o,a[8]=g*o+C*f,a[9]=_*o+R*f,a[10]=v*o+L*f,a[11]=T*o+j*f,a},I.bq=function(a,t){const n=ue(a,360),o=ue(t,360),f=o-n,g=o>n?f-360:f+360;return Math.abs(f)<Math.abs(g)?f:g},I.br=function(a){return a[0]=0,a[1]=0,a[2]=0,a},I.bs=function(a,t,n,o){const f=Math.sqrt(a*a+t*t),g=Math.sqrt(n*n+o*o);a/=f,t/=f,n/=g,o/=g;const _=Math.acos(a*n+t*o);return-t*n+a*o>0?_:-_},I.bt=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]},I.bu=Qd,I.bv=function(a,t){const n=ue(a,2*Math.PI),o=ue(t,2*Math.PI);return Math.min(Math.abs(n-o),Math.abs(n-o+2*Math.PI),Math.abs(n-o-2*Math.PI))},I.bw=function(){const a={},t=re.$version;for(const n in re.$root){const o=re.$root[n];if(o.required){let f=null;f=n==="version"?t:o.type==="array"?[]:{},f!=null&&(a[n]=f)}}return a},I.bx=_c,I.by=Ur,I.bz=function(a){a=a.slice();const t=Object.create(null);for(let n=0;n<a.length;n++)t[a[n].id]=a[n];for(let n=0;n<a.length;n++)"ref"in a[n]&&(a[n]=Be(a[n],t[a[n].ref]));return a},I.c=ei,I.c0=function(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]&&a[3]===t[3]&&a[4]===t[4]&&a[5]===t[5]&&a[6]===t[6]&&a[7]===t[7]&&a[8]===t[8]&&a[9]===t[9]&&a[10]===t[10]&&a[11]===t[11]&&a[12]===t[12]&&a[13]===t[13]&&a[14]===t[14]&&a[15]===t[15]},I.c1=function(a,t){var n=a[0],o=a[1],f=a[2],g=a[3],_=a[4],v=a[5],T=a[6],C=a[7],R=a[8],L=a[9],j=a[10],q=a[11],Z=a[12],Y=a[13],ne=a[14],fe=a[15],Ie=t[0],ve=t[1],V=t[2],te=t[3],be=t[4],Ke=t[5],At=t[6],rt=t[7],ht=t[8],Lt=t[9],Dt=t[10],Ft=t[11],mt=t[12],er=t[13],hr=t[14],cr=t[15];return Math.abs(n-Ie)<=Ge*Math.max(1,Math.abs(n),Math.abs(Ie))&&Math.abs(o-ve)<=Ge*Math.max(1,Math.abs(o),Math.abs(ve))&&Math.abs(f-V)<=Ge*Math.max(1,Math.abs(f),Math.abs(V))&&Math.abs(g-te)<=Ge*Math.max(1,Math.abs(g),Math.abs(te))&&Math.abs(_-be)<=Ge*Math.max(1,Math.abs(_),Math.abs(be))&&Math.abs(v-Ke)<=Ge*Math.max(1,Math.abs(v),Math.abs(Ke))&&Math.abs(T-At)<=Ge*Math.max(1,Math.abs(T),Math.abs(At))&&Math.abs(C-rt)<=Ge*Math.max(1,Math.abs(C),Math.abs(rt))&&Math.abs(R-ht)<=Ge*Math.max(1,Math.abs(R),Math.abs(ht))&&Math.abs(L-Lt)<=Ge*Math.max(1,Math.abs(L),Math.abs(Lt))&&Math.abs(j-Dt)<=Ge*Math.max(1,Math.abs(j),Math.abs(Dt))&&Math.abs(q-Ft)<=Ge*Math.max(1,Math.abs(q),Math.abs(Ft))&&Math.abs(Z-mt)<=Ge*Math.max(1,Math.abs(Z),Math.abs(mt))&&Math.abs(Y-er)<=Ge*Math.max(1,Math.abs(Y),Math.abs(er))&&Math.abs(ne-hr)<=Ge*Math.max(1,Math.abs(ne),Math.abs(hr))&&Math.abs(fe-cr)<=Ge*Math.max(1,Math.abs(fe),Math.abs(cr))},I.c2=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},I.c3=a=>a.type==="symbol",I.c4=a=>a.type==="circle",I.c5=a=>a.type==="heatmap",I.c6=a=>a.type==="line",I.c7=a=>a.type==="fill",I.c8=a=>a.type==="fill-extrusion",I.c9=a=>a.type==="hillshade",I.cA=fo,I.cB=Ou,I.cC=yl,I.cD=Oa,I.cE=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},I.cF=function(a,t,n,o,f){return c(this,void 0,void 0,function*(){if(Rt())try{return yield sn(a,t,n,o,f)}catch{}return function(g,_,v,T,C){const R=g.width,L=g.height;gi&&oi||(gi=new OffscreenCanvas(R,L),oi=gi.getContext("2d",{willReadFrequently:!0})),gi.width=R,gi.height=L,oi.drawImage(g,0,0,R,L);const j=oi.getImageData(_,v,T,C);return oi.clearRect(0,0,R,L),j.data}(a,t,n,o,f)})},I.cG=Jd,I.cH=J,I.cI=X,I.cJ=Ic,I.cK=Df,I.cL=Ys,I.cM=Is,I.ca=a=>a.type==="raster",I.cb=a=>a.type==="background",I.cc=a=>a.type==="custom",I.cd=yt,I.ce=function(a,t,n){const o=st(t.x-n.x,t.y-n.y),f=st(a.x-n.x,a.y-n.y);var g,_;return Yi(Math.atan2(o[0]*f[1]-o[1]*f[0],(g=o)[0]*(_=f)[0]+g[1]*_[1]))},I.cf=vt,I.cg=function(a,t){return Vi[t]&&(a instanceof MouseEvent||a instanceof WheelEvent)},I.ch=function(a,t){return _i[t]&&"touches"in a},I.ci=function(a){return _i[a]||Vi[a]},I.cj=function(a,t,n){var o=t[0],f=t[1];return a[0]=n[0]*o+n[4]*f+n[12],a[1]=n[1]*o+n[5]*f+n[13],a},I.ck=function(a,t){const{x:n,y:o}=ou.fromLngLat(t);return!(a<0||a>25||o<0||o>=1||n<0||n>=1)},I.cl=function(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},I.cm=class extends dl{},I.cn=zm,I.cp=function(a){return a.message===ri},I.cq=Zr,I.cr=function(a,t){ii.REGISTERED_PROTOCOLS[a]=t},I.cs=function(a){delete ii.REGISTERED_PROTOCOLS[a]},I.ct=function(a,t){const n={};for(let f=0;f<a.length;f++){const g=t&&t[a[f].id]||ts(a[f]);t&&(t[a[f].id]=g);let _=n[g];_||(_=n[g]=[]),_.push(a[f])}const o=[];for(const f in n)o.push(n[f]);return o},I.cu=Wt,I.cv=kh,I.cw=Vf,I.cx=Fu,I.cy=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=ot/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const t=a.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,f={layoutIconSize:o["icon-size"].possiblyEvaluate(new zi(a.bucket.zoom+1),a.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new zi(a.bucket.zoom+1),a.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new zi(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:R}=a.bucket.textSizeData;f.compositeTextSizes=[o["text-size"].possiblyEvaluate(new zi(C),a.canonical),o["text-size"].possiblyEvaluate(new zi(R),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:R}=a.bucket.iconSizeData;f.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new zi(C),a.canonical),o["icon-size"].possiblyEvaluate(new zi(R),a.canonical)]}const g=n.get("text-line-height")*wn,_=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",v=n.get("text-keep-upright"),T=n.get("text-size");for(const C of a.bucket.features){const R=n.get("text-font").evaluate(C,{},a.canonical).join(","),L=T.evaluate(C,{},a.canonical),j=f.layoutTextSize.evaluate(C,{},a.canonical),q=f.layoutIconSize.evaluate(C,{},a.canonical),Z={horizontal:{},vertical:void 0},Y=C.text;let ne,fe=[0,0];if(Y){const V=Y.toString(),te=n.get("text-letter-spacing").evaluate(C,{},a.canonical)*wn,be=sf(V)?te:0,Ke=n.get("text-anchor").evaluate(C,{},a.canonical),At=ds(t,C,a.canonical);if(!At){const Dt=n.get("text-radial-offset").evaluate(C,{},a.canonical);fe=Dt?Gc(Ke,[Dt*wn,Xf]):n.get("text-offset").evaluate(C,{},a.canonical).map(Ft=>Ft*wn)}let rt=_?"center":n.get("text-justify").evaluate(C,{},a.canonical);const ht=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(C,{},a.canonical)*wn:1/0,Lt=()=>{a.bucket.allowVerticalPlacement&&Mu(V)&&(Z.vertical=kc(Y,a.glyphMap,a.glyphPositions,a.imagePositions,R,ht,g,Ke,"left",be,fe,I.al.vertical,!0,j,L))};if(!_&&At){const Dt=new Set;if(rt==="auto")for(let mt=0;mt<At.values.length;mt+=2)Dt.add(Yf(At.values[mt]));else Dt.add(rt);let Ft=!1;for(const mt of Dt)if(!Z.horizontal[mt])if(Ft)Z.horizontal[mt]=Z.horizontal[0];else{const er=kc(Y,a.glyphMap,a.glyphPositions,a.imagePositions,R,ht,g,"center",mt,be,fe,I.al.horizontal,!1,j,L);er&&(Z.horizontal[mt]=er,Ft=er.positionedLines.length===1)}Lt()}else{rt==="auto"&&(rt=Yf(Ke));const Dt=kc(Y,a.glyphMap,a.glyphPositions,a.imagePositions,R,ht,g,Ke,rt,be,fe,I.al.horizontal,!1,j,L);Dt&&(Z.horizontal[rt]=Dt),Lt(),Mu(V)&&_&&v&&(Z.vertical=kc(Y,a.glyphMap,a.glyphPositions,a.imagePositions,R,ht,g,Ke,rt,be,fe,I.al.vertical,!1,j,L))}}let Ie=!1;if(C.icon&&C.icon.name){const V=a.imageMap[C.icon.name];V&&(ne=Xi(a.imagePositions[C.icon.name],n.get("icon-offset").evaluate(C,{},a.canonical),n.get("icon-anchor").evaluate(C,{},a.canonical)),Ie=!!V.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=Ie:a.bucket.sdfIcons!==Ie&&mi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(V.pixelRatio!==a.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const ve=Qp(Z.horizontal)||Z.vertical;a.bucket.iconsInText=!!ve&&ve.iconsInText,(ve||ne)&&Wf(a.bucket,C,Z,ne,a.imageMap,f,j,q,fe,Ie,a.canonical,a.subdivisionGranularity)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},I.cz=mn,I.d=Ne,I.e=Xt,I.f=a=>c(void 0,void 0,void 0,function*(){if(a.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(a)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),I.g=yr,I.h=a=>new Promise((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=xi})},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(a)],{type:"image/png"});o.src=a.byteLength?URL.createObjectURL(f):xi}),I.i=kr,I.j=(a,t)=>li(Xt(a,{type:"json"}),t),I.k=ye,I.l=ae,I.m=li,I.n=(a,t)=>li(Xt(a,{type:"arrayBuffer"}),t),I.o=function(a){return new Oa(a).readFields(hs,[])},I.p=bl,I.q=Sc,I.r=Wi,I.s=Ai,I.t=Su,I.u=zr,I.v=re,I.w=mi,I.x=Au,I.y=Gl,I.z=function([a,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:a*Math.cos(t)*Math.sin(n),y:a*Math.sin(t)*Math.sin(n),z:a*Math.cos(n)}}}),B("worker",["./shared"],function(I){class c{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,Q){for(const ye of W){this._layerConfigs[ye.id]=ye;const Ee=this._layers[ye.id]=I.bA(ye);Ee._featureFilter=I.a7(Ee.filter),this.keyCache[ye.id]&&delete this.keyCache[ye.id]}for(const ye of Q)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const ae=I.ct(Object.values(this._layerConfigs),this.keyCache);for(const ye of ae){const Ee=ye.map(je=>this._layers[je.id]),re=Ee[0];if(re.visibility==="none")continue;const Ze=re.source||"";let Be=this.familiesBySource[Ze];Be||(Be=this.familiesBySource[Ze]={});const Oe=re.sourceLayer||"_geojsonTileLayer";let He=Be[Oe];He||(He=Be[Oe]=[]),He.push(Ee)}}}class J{constructor(W){const Q={},ae=[];for(const Ze in W){const Be=W[Ze],Oe=Q[Ze]={};for(const He in Be){const je=Be[+He];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;const _t={x:0,y:0,w:je.bitmap.width+2,h:je.bitmap.height+2};ae.push(_t),Oe[He]={rect:_t,metrics:je.metrics}}}const{w:ye,h:Ee}=I.p(ae),re=new I.q({width:ye||1,height:Ee||1});for(const Ze in W){const Be=W[Ze];for(const Oe in Be){const He=Be[+Oe];if(!He||He.bitmap.width===0||He.bitmap.height===0)continue;const je=Q[Ze][Oe].rect;I.q.copy(He.bitmap,re,{x:0,y:0},{x:je.x+1,y:je.y+1},He.bitmap)}}this.image=re,this.positions=Q}}I.cu("GlyphAtlas",J);class K{constructor(W){this.tileID=new I.Y(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,Q,ae,ye,Ee){return I._(this,void 0,void 0,function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new I.a5;const re=new I.cv(Object.keys(W.layers).sort()),Ze=new I.cw(this.tileID,this.promoteId);Ze.bucketLayerIDs=[];const Be={},Oe={featureIndex:Ze,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ae,subdivisionGranularity:Ee},He=Q.familiesBySource[this.source];for(const We in He){const Le=W.layers[We];if(!Le)continue;Le.version===1&&I.w(`Vector tile source "${this.source}" layer "${We}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const wt=re.encode(We),Nt=[];for(let Jt=0;Jt<Le.length;Jt++){const ar=Le.feature(Jt),Hr=Ze.getId(ar,We);Nt.push({feature:ar,id:Hr,index:Jt,sourceLayerIndex:wt})}for(const Jt of He[We]){const ar=Jt[0];ar.source!==this.source&&I.w(`layer.source = ${ar.source} does not equal this.source = ${this.source}`),ar.minzoom&&this.zoom<Math.floor(ar.minzoom)||ar.maxzoom&&this.zoom>=ar.maxzoom||ar.visibility!=="none"&&(oe(Jt,this.zoom,ae),(Be[ar.id]=ar.createBucket({index:Ze.bucketLayerIDs.length,layers:Jt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wt,sourceID:this.source})).populate(Nt,Oe,this.tileID.canonical),Ze.bucketLayerIDs.push(Jt.map(Hr=>Hr.id)))}}const je=I.bF(Oe.glyphDependencies,We=>Object.keys(We).map(Number));this.inFlightDependencies.forEach(We=>We==null?void 0:We.abort()),this.inFlightDependencies=[];let _t=Promise.resolve({});if(Object.keys(je).length){const We=new AbortController;this.inFlightDependencies.push(We),_t=ye.sendAsync({type:"GG",data:{stacks:je,source:this.source,tileID:this.tileID,type:"glyphs"}},We)}const Ut=Object.keys(Oe.iconDependencies);let Gt=Promise.resolve({});if(Ut.length){const We=new AbortController;this.inFlightDependencies.push(We),Gt=ye.sendAsync({type:"GI",data:{icons:Ut,source:this.source,tileID:this.tileID,type:"icons"}},We)}const tr=Object.keys(Oe.patternDependencies);let ir=Promise.resolve({});if(tr.length){const We=new AbortController;this.inFlightDependencies.push(We),ir=ye.sendAsync({type:"GI",data:{icons:tr,source:this.source,tileID:this.tileID,type:"patterns"}},We)}const[k,O,me]=yield Promise.all([_t,Gt,ir]),de=new J(k),ze=new I.cx(O,me);for(const We in Be){const Le=Be[We];Le instanceof I.a6?(oe(Le.layers,this.zoom,ae),I.cy({bucket:Le,glyphMap:k,glyphPositions:de.positions,imageMap:O,imagePositions:ze.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Oe.subdivisionGranularity})):Le.hasPattern&&(Le instanceof I.cz||Le instanceof I.cA||Le instanceof I.cB)&&(oe(Le.layers,this.zoom,ae),Le.addFeatures(Oe,this.tileID.canonical,ze.patternPositions))}return this.status="done",{buckets:Object.values(Be).filter(We=>!We.isEmpty()),featureIndex:Ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:de.image,imageAtlas:ze,glyphMap:this.returnDependencies?k:null,iconMap:this.returnDependencies?O:null,glyphPositions:this.returnDependencies?de.positions:null}})}}function oe(Ne,W,Q){const ae=new I.C(W);for(const ye of Ne)ye.recalculate(ae,Q)}class X{constructor(W,Q,ae){this.actor=W,this.layerIndex=Q,this.availableImages=ae,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(W,Q){return I._(this,void 0,void 0,function*(){const ae=yield I.n(W.request,Q);try{return{vectorTile:new I.cC.VectorTile(new I.cD(ae.data)),rawData:ae.data,cacheControl:ae.cacheControl,expires:ae.expires}}catch(ye){const Ee=new Uint8Array(ae.data);let re=`Unable to parse the tile at ${W.request.url}, `;throw re+=Ee[0]===31&&Ee[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ye.message}`,new Error(re)}})}loadTile(W){return I._(this,void 0,void 0,function*(){const Q=W.uid,ae=!!(W&&W.request&&W.request.collectResourceTiming)&&new I.cE(W.request),ye=new K(W);this.loading[Q]=ye;const Ee=new AbortController;ye.abort=Ee;try{const re=yield this.loadVectorTile(W,Ee);if(delete this.loading[Q],!re)return null;const Ze=re.rawData,Be={};re.expires&&(Be.expires=re.expires),re.cacheControl&&(Be.cacheControl=re.cacheControl);const Oe={};if(ae){const je=ae.finish();je&&(Oe.resourceTiming=JSON.parse(JSON.stringify(je)))}ye.vectorTile=re.vectorTile;const He=ye.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);this.loaded[Q]=ye,this.fetching[Q]={rawTileData:Ze,cacheControl:Be,resourceTiming:Oe};try{const je=yield He;return I.e({rawTileData:Ze.slice(0)},je,Be,Oe)}finally{delete this.fetching[Q]}}catch(re){throw delete this.loading[Q],ye.status="done",this.loaded[Q]=ye,re}})}reloadTile(W){return I._(this,void 0,void 0,function*(){const Q=W.uid;if(!this.loaded||!this.loaded[Q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ae=this.loaded[Q];if(ae.showCollisionBoxes=W.showCollisionBoxes,ae.status==="parsing"){const ye=yield ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);let Ee;if(this.fetching[Q]){const{rawTileData:re,cacheControl:Ze,resourceTiming:Be}=this.fetching[Q];delete this.fetching[Q],Ee=I.e({rawTileData:re.slice(0)},ye,Ze,Be)}else Ee=ye;return Ee}if(ae.status==="done"&&ae.vectorTile)return ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity)})}abortTile(W){return I._(this,void 0,void 0,function*(){const Q=this.loading,ae=W.uid;Q&&Q[ae]&&Q[ae].abort&&(Q[ae].abort.abort(),delete Q[ae])})}removeTile(W){return I._(this,void 0,void 0,function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]})}}class _e{constructor(){this.loaded={}}loadTile(W){return I._(this,void 0,void 0,function*(){const{uid:Q,encoding:ae,rawImageData:ye,redFactor:Ee,greenFactor:re,blueFactor:Ze,baseShift:Be}=W,Oe=ye.width+2,He=ye.height+2,je=I.b(ye)?new I.R({width:Oe,height:He},yield I.cF(ye,-1,-1,Oe,He)):ye,_t=new I.cG(Q,je,ae,Ee,re,Ze,Be);return this.loaded=this.loaded||{},this.loaded[Q]=_t,_t})}removeTile(W){const Q=this.loaded,ae=W.uid;Q&&Q[ae]&&delete Q[ae]}}var se,Me,qe=function(){if(Me)return se;function Ne(Q,ae){if(Q.length!==0){W(Q[0],ae);for(var ye=1;ye<Q.length;ye++)W(Q[ye],!ae)}}function W(Q,ae){for(var ye=0,Ee=0,re=0,Ze=Q.length,Be=Ze-1;re<Ze;Be=re++){var Oe=(Q[re][0]-Q[Be][0])*(Q[Be][1]+Q[re][1]),He=ye+Oe;Ee+=Math.abs(ye)>=Math.abs(Oe)?ye-He+Oe:Oe-He+ye,ye=He}ye+Ee>=0!=!!ae&&Q.reverse()}return Me=1,se=function Q(ae,ye){var Ee,re=ae&&ae.type;if(re==="FeatureCollection")for(Ee=0;Ee<ae.features.length;Ee++)Q(ae.features[Ee],ye);else if(re==="GeometryCollection")for(Ee=0;Ee<ae.geometries.length;Ee++)Q(ae.geometries[Ee],ye);else if(re==="Feature")Q(ae.geometry,ye);else if(re==="Polygon")Ne(ae.coordinates,ye);else if(re==="MultiPolygon")for(Ee=0;Ee<ae.coordinates.length;Ee++)Ne(ae.coordinates[Ee],ye);return ae}}(),at=I.cH(qe);const ft=I.cC.VectorTileFeature.prototype.toGeoJSON;class pt{constructor(W){this._feature=W,this.extent=I.Z,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))}loadGeometry(){if(this._feature.type===1){const W=[];for(const Q of this._feature.geometry)W.push([new I.P(Q[0],Q[1])]);return W}{const W=[];for(const Q of this._feature.geometry){const ae=[];for(const ye of Q)ae.push(new I.P(ye[0],ye[1]));W.push(ae)}return W}}toGeoJSON(W,Q,ae){return ft.call(this,W,Q,ae)}}class zt{constructor(W){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=I.Z,this.length=W.length,this._features=W}feature(W){return new pt(this._features[W])}}var Rt,Ge,Pe,gt={exports:{}},bt=function(){if(Pe)return gt.exports;Pe=1;var Ne=I.cK(),W=function(){if(Ge)return Rt;Ge=1;var He=I.cI(),je=I.cJ().VectorTileFeature;function _t(Gt,tr){this.options=tr||{},this.features=Gt,this.length=Gt.length}function Ut(Gt,tr){this.id=typeof Gt.id=="number"?Gt.id:void 0,this.type=Gt.type,this.rawGeometry=Gt.type===1?[Gt.geometry]:Gt.geometry,this.properties=Gt.tags,this.extent=tr||4096}return Rt=_t,_t.prototype.feature=function(Gt){return new Ut(this.features[Gt],this.options.extent)},Ut.prototype.loadGeometry=function(){var Gt=this.rawGeometry;this.geometry=[];for(var tr=0;tr<Gt.length;tr++){for(var ir=Gt[tr],k=[],O=0;O<ir.length;O++)k.push(new He(ir[O][0],ir[O][1]));this.geometry.push(k)}return this.geometry},Ut.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Gt=this.geometry,tr=1/0,ir=-1/0,k=1/0,O=-1/0,me=0;me<Gt.length;me++)for(var de=Gt[me],ze=0;ze<de.length;ze++){var We=de[ze];tr=Math.min(tr,We.x),ir=Math.max(ir,We.x),k=Math.min(k,We.y),O=Math.max(O,We.y)}return[tr,k,ir,O]},Ut.prototype.toGeoJSON=je.prototype.toGeoJSON,Rt}();function Q(He){var je=new Ne;return function(_t,Ut){for(var Gt in _t.layers)Ut.writeMessage(3,ae,_t.layers[Gt])}(He,je),je.finish()}function ae(He,je){var _t;je.writeVarintField(15,He.version||1),je.writeStringField(1,He.name||""),je.writeVarintField(5,He.extent||4096);var Ut={keys:[],values:[],keycache:{},valuecache:{}};for(_t=0;_t<He.length;_t++)Ut.feature=He.feature(_t),je.writeMessage(2,ye,Ut);var Gt=Ut.keys;for(_t=0;_t<Gt.length;_t++)je.writeStringField(3,Gt[_t]);var tr=Ut.values;for(_t=0;_t<tr.length;_t++)je.writeMessage(4,Oe,tr[_t])}function ye(He,je){var _t=He.feature;_t.id!==void 0&&je.writeVarintField(1,_t.id),je.writeMessage(2,Ee,He),je.writeVarintField(3,_t.type),je.writeMessage(4,Be,_t)}function Ee(He,je){var _t=He.feature,Ut=He.keys,Gt=He.values,tr=He.keycache,ir=He.valuecache;for(var k in _t.properties){var O=_t.properties[k],me=tr[k];if(O!==null){me===void 0&&(Ut.push(k),tr[k]=me=Ut.length-1),je.writeVarint(me);var de=typeof O;de!=="string"&&de!=="boolean"&&de!=="number"&&(O=JSON.stringify(O));var ze=de+":"+O,We=ir[ze];We===void 0&&(Gt.push(O),ir[ze]=We=Gt.length-1),je.writeVarint(We)}}}function re(He,je){return(je<<3)+(7&He)}function Ze(He){return He<<1^He>>31}function Be(He,je){for(var _t=He.loadGeometry(),Ut=He.type,Gt=0,tr=0,ir=_t.length,k=0;k<ir;k++){var O=_t[k],me=1;Ut===1&&(me=O.length),je.writeVarint(re(1,me));for(var de=Ut===3?O.length-1:O.length,ze=0;ze<de;ze++){ze===1&&Ut!==1&&je.writeVarint(re(2,de-1));var We=O[ze].x-Gt,Le=O[ze].y-tr;je.writeVarint(Ze(We)),je.writeVarint(Ze(Le)),Gt+=We,tr+=Le}Ut===3&&je.writeVarint(re(7,1))}}function Oe(He,je){var _t=typeof He;_t==="string"?je.writeStringField(1,He):_t==="boolean"?je.writeBooleanField(7,He):_t==="number"&&(He%1!=0?je.writeDoubleField(3,He):He<0?je.writeSVarintField(6,He):je.writeVarintField(5,He))}return gt.exports=Q,gt.exports.fromVectorTileJs=Q,gt.exports.fromGeojsonVt=function(He,je){je=je||{};var _t={};for(var Ut in He)_t[Ut]=new W(He[Ut].features,je),_t[Ut].name=Ut,_t[Ut].version=je.version,_t[Ut].extent=je.extent;return Q({layers:_t})},gt.exports.GeoJSONWrapper=W,gt.exports}(),Yt=I.cH(bt);const nr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ne=>Ne},lr=Math.fround||(dr=new Float32Array(1),Ne=>(dr[0]=+Ne,dr[0]));var dr;const Kt=3,xr=5,tt=6;class Re{constructor(W){this.options=Object.assign(Object.create(nr),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:Q,minZoom:ae,maxZoom:ye}=this.options;Q&&console.time("total time");const Ee=`prepare ${W.length} points`;Q&&console.time(Ee),this.points=W;const re=[];for(let Be=0;Be<W.length;Be++){const Oe=W[Be];if(!Oe.geometry)continue;const[He,je]=Oe.geometry.coordinates,_t=lr(jt(He)),Ut=lr(ue(je));re.push(_t,Ut,1/0,Be,-1,1),this.options.reduce&&re.push(0)}let Ze=this.trees[ye+1]=this._createTree(re);Q&&console.timeEnd(Ee);for(let Be=ye;Be>=ae;Be--){const Oe=+Date.now();Ze=this.trees[Be]=this._createTree(this._cluster(Ze,Be)),Q&&console.log("z%d: %d clusters in %dms",Be,Ze.numItems,+Date.now()-Oe)}return Q&&console.timeEnd("total time"),this}getClusters(W,Q){let ae=((W[0]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,W[1]));let Ee=W[2]===180?180:((W[2]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)ae=-180,Ee=180;else if(ae>Ee){const je=this.getClusters([ae,ye,180,re],Q),_t=this.getClusters([-180,ye,Ee,re],Q);return je.concat(_t)}const Ze=this.trees[this._limitZoom(Q)],Be=Ze.range(jt(ae),ue(re),jt(Ee),ue(ye)),Oe=Ze.data,He=[];for(const je of Be){const _t=this.stride*je;He.push(Oe[_t+xr]>1?st(Oe,_t,this.clusterProps):this.points[Oe[_t+Kt]])}return He}getChildren(W){const Q=this._getOriginId(W),ae=this._getOriginZoom(W),ye="No cluster with the specified id.",Ee=this.trees[ae];if(!Ee)throw new Error(ye);const re=Ee.data;if(Q*this.stride>=re.length)throw new Error(ye);const Ze=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),Be=Ee.within(re[Q*this.stride],re[Q*this.stride+1],Ze),Oe=[];for(const He of Be){const je=He*this.stride;re[je+4]===W&&Oe.push(re[je+xr]>1?st(re,je,this.clusterProps):this.points[re[je+Kt]])}if(Oe.length===0)throw new Error(ye);return Oe}getLeaves(W,Q,ae){const ye=[];return this._appendLeaves(ye,W,Q=Q||10,ae=ae||0,0),ye}getTile(W,Q,ae){const ye=this.trees[this._limitZoom(W)],Ee=Math.pow(2,W),{extent:re,radius:Ze}=this.options,Be=Ze/re,Oe=(ae-Be)/Ee,He=(ae+1+Be)/Ee,je={features:[]};return this._addTileFeatures(ye.range((Q-Be)/Ee,Oe,(Q+1+Be)/Ee,He),ye.data,Q,ae,Ee,je),Q===0&&this._addTileFeatures(ye.range(1-Be/Ee,Oe,1,He),ye.data,Ee,ae,Ee,je),Q===Ee-1&&this._addTileFeatures(ye.range(0,Oe,Be/Ee,He),ye.data,-1,ae,Ee,je),je.features.length?je:null}getClusterExpansionZoom(W){let Q=this._getOriginZoom(W)-1;for(;Q<=this.options.maxZoom;){const ae=this.getChildren(W);if(Q++,ae.length!==1)break;W=ae[0].properties.cluster_id}return Q}_appendLeaves(W,Q,ae,ye,Ee){const re=this.getChildren(Q);for(const Ze of re){const Be=Ze.properties;if(Be&&Be.cluster?Ee+Be.point_count<=ye?Ee+=Be.point_count:Ee=this._appendLeaves(W,Be.cluster_id,ae,ye,Ee):Ee<ye?Ee++:W.push(Ze),W.length===ae)break}return Ee}_createTree(W){const Q=new I.aF(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ae=0;ae<W.length;ae+=this.stride)Q.add(W[ae],W[ae+1]);return Q.finish(),Q.data=W,Q}_addTileFeatures(W,Q,ae,ye,Ee,re){for(const Ze of W){const Be=Ze*this.stride,Oe=Q[Be+xr]>1;let He,je,_t;if(Oe)He=ot(Q,Be,this.clusterProps),je=Q[Be],_t=Q[Be+1];else{const tr=this.points[Q[Be+Kt]];He=tr.properties;const[ir,k]=tr.geometry.coordinates;je=jt(ir),_t=ue(k)}const Ut={type:1,geometry:[[Math.round(this.options.extent*(je*Ee-ae)),Math.round(this.options.extent*(_t*Ee-ye))]],tags:He};let Gt;Gt=Oe||this.options.generateId?Q[Be+Kt]:this.points[Q[Be+Kt]].id,Gt!==void 0&&(Ut.id=Gt),re.features.push(Ut)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,Q){const{radius:ae,extent:ye,reduce:Ee,minPoints:re}=this.options,Ze=ae/(ye*Math.pow(2,Q)),Be=W.data,Oe=[],He=this.stride;for(let je=0;je<Be.length;je+=He){if(Be[je+2]<=Q)continue;Be[je+2]=Q;const _t=Be[je],Ut=Be[je+1],Gt=W.within(Be[je],Be[je+1],Ze),tr=Be[je+xr];let ir=tr;for(const k of Gt){const O=k*He;Be[O+2]>Q&&(ir+=Be[O+xr])}if(ir>tr&&ir>=re){let k,O=_t*tr,me=Ut*tr,de=-1;const ze=((je/He|0)<<5)+(Q+1)+this.points.length;for(const We of Gt){const Le=We*He;if(Be[Le+2]<=Q)continue;Be[Le+2]=Q;const wt=Be[Le+xr];O+=Be[Le]*wt,me+=Be[Le+1]*wt,Be[Le+4]=ze,Ee&&(k||(k=this._map(Be,je,!0),de=this.clusterProps.length,this.clusterProps.push(k)),Ee(k,this._map(Be,Le)))}Be[je+4]=ze,Oe.push(O/ir,me/ir,1/0,ze,-1,ir),Ee&&Oe.push(de)}else{for(let k=0;k<He;k++)Oe.push(Be[je+k]);if(ir>1)for(const k of Gt){const O=k*He;if(!(Be[O+2]<=Q)){Be[O+2]=Q;for(let me=0;me<He;me++)Oe.push(Be[O+me])}}}}return Oe}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,Q,ae){if(W[Q+xr]>1){const re=this.clusterProps[W[Q+tt]];return ae?Object.assign({},re):re}const ye=this.points[W[Q+Kt]].properties,Ee=this.options.map(ye);return ae&&Ee===ye?Object.assign({},Ee):Ee}}function st(Ne,W,Q){return{type:"Feature",id:Ne[W+Kt],properties:ot(Ne,W,Q),geometry:{type:"Point",coordinates:[(ae=Ne[W],360*(ae-.5)),Ye(Ne[W+1])]}};var ae}function ot(Ne,W,Q){const ae=Ne[W+xr],ye=ae>=1e4?`${Math.round(ae/1e3)}k`:ae>=1e3?Math.round(ae/100)/10+"k":ae,Ee=Ne[W+tt],re=Ee===-1?{}:Object.assign({},Q[Ee]);return Object.assign(re,{cluster:!0,cluster_id:Ne[W+Kt],point_count:ae,point_count_abbreviated:ye})}function jt(Ne){return Ne/360+.5}function ue(Ne){const W=Math.sin(Ne*Math.PI/180),Q=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return Q<0?0:Q>1?1:Q}function Ye(Ne){const W=(180-360*Ne)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Mt(Ne,W,Q,ae){let ye=ae;const Ee=W+(Q-W>>1);let re,Ze=Q-W;const Be=Ne[W],Oe=Ne[W+1],He=Ne[Q],je=Ne[Q+1];for(let _t=W+3;_t<Q;_t+=3){const Ut=yt(Ne[_t],Ne[_t+1],Be,Oe,He,je);if(Ut>ye)re=_t,ye=Ut;else if(Ut===ye){const Gt=Math.abs(_t-Ee);Gt<Ze&&(re=_t,Ze=Gt)}}ye>ae&&(re-W>3&&Mt(Ne,W,re,ae),Ne[re+2]=ye,Q-re>3&&Mt(Ne,re,Q,ae))}function yt(Ne,W,Q,ae,ye,Ee){let re=ye-Q,Ze=Ee-ae;if(re!==0||Ze!==0){const Be=((Ne-Q)*re+(W-ae)*Ze)/(re*re+Ze*Ze);Be>1?(Q=ye,ae=Ee):Be>0&&(Q+=re*Be,ae+=Ze*Be)}return re=Ne-Q,Ze=W-ae,re*re+Ze*Ze}function vt(Ne,W,Q,ae){const ye={id:Ne??null,type:W,geometry:Q,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(W==="Point"||W==="MultiPoint"||W==="LineString")It(ye,Q);else if(W==="Polygon")It(ye,Q[0]);else if(W==="MultiLineString")for(const Ee of Q)It(ye,Ee);else if(W==="MultiPolygon")for(const Ee of Q)It(ye,Ee[0]);return ye}function It(Ne,W){for(let Q=0;Q<W.length;Q+=3)Ne.minX=Math.min(Ne.minX,W[Q]),Ne.minY=Math.min(Ne.minY,W[Q+1]),Ne.maxX=Math.max(Ne.maxX,W[Q]),Ne.maxY=Math.max(Ne.maxY,W[Q+1])}function Ot(Ne,W,Q,ae){if(!W.geometry)return;const ye=W.geometry.coordinates;if(ye&&ye.length===0)return;const Ee=W.geometry.type,re=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2);let Ze=[],Be=W.id;if(Q.promoteId?Be=W.properties[Q.promoteId]:Q.generateId&&(Be=ae||0),Ee==="Point")Xt(ye,Ze);else if(Ee==="MultiPoint")for(const Oe of ye)Xt(Oe,Ze);else if(Ee==="LineString")mr(ye,Ze,re,!1);else if(Ee==="MultiLineString"){if(Q.lineMetrics){for(const Oe of ye)Ze=[],mr(Oe,Ze,re,!1),Ne.push(vt(Be,"LineString",Ze,W.properties));return}hi(ye,Ze,re,!1)}else if(Ee==="Polygon")hi(ye,Ze,re,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(const Oe of W.geometry.geometries)Ot(Ne,{id:Be,geometry:Oe,properties:W.properties},Q,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Oe of ye){const He=[];hi(Oe,He,re,!0),Ze.push(He)}}Ne.push(vt(Be,Ee,Ze,W.properties))}function Xt(Ne,W){W.push(Si(Ne[0]),jr(Ne[1]),0)}function mr(Ne,W,Q,ae){let ye,Ee,re=0;for(let Be=0;Be<Ne.length;Be++){const Oe=Si(Ne[Be][0]),He=jr(Ne[Be][1]);W.push(Oe,He,0),Be>0&&(re+=ae?(ye*He-Oe*Ee)/2:Math.sqrt(Math.pow(Oe-ye,2)+Math.pow(He-Ee,2))),ye=Oe,Ee=He}const Ze=W.length-3;W[2]=1,Mt(W,0,Ze,Q),W[Ze+2]=1,W.size=Math.abs(re),W.start=0,W.end=W.size}function hi(Ne,W,Q,ae){for(let ye=0;ye<Ne.length;ye++){const Ee=[];mr(Ne[ye],Ee,Q,ae),W.push(Ee)}}function Si(Ne){return Ne/360+.5}function jr(Ne){const W=Math.sin(Ne*Math.PI/180),Q=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return Q<0?0:Q>1?1:Q}function rr(Ne,W,Q,ae,ye,Ee,re,Ze){if(ae/=W,Ee>=(Q/=W)&&re<ae)return Ne;if(re<Q||Ee>=ae)return null;const Be=[];for(const Oe of Ne){const He=Oe.geometry;let je=Oe.type;const _t=ye===0?Oe.minX:Oe.minY,Ut=ye===0?Oe.maxX:Oe.maxY;if(_t>=Q&&Ut<ae){Be.push(Oe);continue}if(Ut<Q||_t>=ae)continue;let Gt=[];if(je==="Point"||je==="MultiPoint")mi(He,Gt,Q,ae,ye);else if(je==="LineString")Dr(He,Gt,Q,ae,ye,!1,Ze.lineMetrics);else if(je==="MultiLineString")Ui(He,Gt,Q,ae,ye,!1);else if(je==="Polygon")Ui(He,Gt,Q,ae,ye,!0);else if(je==="MultiPolygon")for(const tr of He){const ir=[];Ui(tr,ir,Q,ae,ye,!0),ir.length&&Gt.push(ir)}if(Gt.length){if(Ze.lineMetrics&&je==="LineString"){for(const tr of Gt)Be.push(vt(Oe.id,je,tr,Oe.tags));continue}je!=="LineString"&&je!=="MultiLineString"||(Gt.length===1?(je="LineString",Gt=Gt[0]):je="MultiLineString"),je!=="Point"&&je!=="MultiPoint"||(je=Gt.length===3?"Point":"MultiPoint"),Be.push(vt(Oe.id,je,Gt,Oe.tags))}}return Be.length?Be:null}function mi(Ne,W,Q,ae,ye){for(let Ee=0;Ee<Ne.length;Ee+=3){const re=Ne[Ee+ye];re>=Q&&re<=ae&&_r(W,Ne[Ee],Ne[Ee+1],Ne[Ee+2])}}function Dr(Ne,W,Q,ae,ye,Ee,re){let Ze=kr(Ne);const Be=ye===0?xi:sn;let Oe,He,je=Ne.start;for(let ir=0;ir<Ne.length-3;ir+=3){const k=Ne[ir],O=Ne[ir+1],me=Ne[ir+2],de=Ne[ir+3],ze=Ne[ir+4],We=ye===0?k:O,Le=ye===0?de:ze;let wt=!1;re&&(Oe=Math.sqrt(Math.pow(k-de,2)+Math.pow(O-ze,2))),We<Q?Le>Q&&(He=Be(Ze,k,O,de,ze,Q),re&&(Ze.start=je+Oe*He)):We>ae?Le<ae&&(He=Be(Ze,k,O,de,ze,ae),re&&(Ze.start=je+Oe*He)):_r(Ze,k,O,me),Le<Q&&We>=Q&&(He=Be(Ze,k,O,de,ze,Q),wt=!0),Le>ae&&We<=ae&&(He=Be(Ze,k,O,de,ze,ae),wt=!0),!Ee&&wt&&(re&&(Ze.end=je+Oe*He),W.push(Ze),Ze=kr(Ne)),re&&(je+=Oe)}let _t=Ne.length-3;const Ut=Ne[_t],Gt=Ne[_t+1],tr=ye===0?Ut:Gt;tr>=Q&&tr<=ae&&_r(Ze,Ut,Gt,Ne[_t+2]),_t=Ze.length-3,Ee&&_t>=3&&(Ze[_t]!==Ze[0]||Ze[_t+1]!==Ze[1])&&_r(Ze,Ze[0],Ze[1],Ze[2]),Ze.length&&W.push(Ze)}function kr(Ne){const W=[];return W.size=Ne.size,W.start=Ne.start,W.end=Ne.end,W}function Ui(Ne,W,Q,ae,ye,Ee){for(const re of Ne)Dr(re,W,Q,ae,ye,Ee,!1)}function _r(Ne,W,Q,ae){Ne.push(W,Q,ae)}function xi(Ne,W,Q,ae,ye,Ee){const re=(Ee-W)/(ae-W);return _r(Ne,Ee,Q+(ye-Q)*re,1),re}function sn(Ne,W,Q,ae,ye,Ee){const re=(Ee-Q)/(ye-Q);return _r(Ne,W+(ae-W)*re,Ee,1),re}function gi(Ne,W){const Q=[];for(let ae=0;ae<Ne.length;ae++){const ye=Ne[ae],Ee=ye.type;let re;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")re=oi(ye.geometry,W);else if(Ee==="MultiLineString"||Ee==="Polygon"){re=[];for(const Ze of ye.geometry)re.push(oi(Ze,W))}else if(Ee==="MultiPolygon"){re=[];for(const Ze of ye.geometry){const Be=[];for(const Oe of Ze)Be.push(oi(Oe,W));re.push(Be)}}Q.push(vt(ye.id,Ee,re,ye.tags))}return Q}function oi(Ne,W){const Q=[];Q.size=Ne.size,Ne.start!==void 0&&(Q.start=Ne.start,Q.end=Ne.end);for(let ae=0;ae<Ne.length;ae+=3)Q.push(Ne[ae]+W,Ne[ae+1],Ne[ae+2]);return Q}function Ai(Ne,W){if(Ne.transformed)return Ne;const Q=1<<Ne.z,ae=Ne.x,ye=Ne.y;for(const Ee of Ne.features){const re=Ee.geometry,Ze=Ee.type;if(Ee.geometry=[],Ze===1)for(let Be=0;Be<re.length;Be+=2)Ee.geometry.push(Nr(re[Be],re[Be+1],W,Q,ae,ye));else for(let Be=0;Be<re.length;Be++){const Oe=[];for(let He=0;He<re[Be].length;He+=2)Oe.push(Nr(re[Be][He],re[Be][He+1],W,Q,ae,ye));Ee.geometry.push(Oe)}}return Ne.transformed=!0,Ne}function Nr(Ne,W,Q,ae,ye,Ee){return[Math.round(Q*(Ne*ae-ye)),Math.round(Q*(W*ae-Ee))]}function Yi(Ne,W,Q,ae,ye){const Ee=W===ye.maxZoom?0:ye.tolerance/((1<<W)*ye.extent),re={features:[],numPoints:0,numSimplified:0,numFeatures:Ne.length,source:null,x:Q,y:ae,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ze of Ne)_i(re,Ze,Ee,ye);return re}function _i(Ne,W,Q,ae){const ye=W.geometry,Ee=W.type,re=[];if(Ne.minX=Math.min(Ne.minX,W.minX),Ne.minY=Math.min(Ne.minY,W.minY),Ne.maxX=Math.max(Ne.maxX,W.maxX),Ne.maxY=Math.max(Ne.maxY,W.maxY),Ee==="Point"||Ee==="MultiPoint")for(let Ze=0;Ze<ye.length;Ze+=3)re.push(ye[Ze],ye[Ze+1]),Ne.numPoints++,Ne.numSimplified++;else if(Ee==="LineString")Vi(re,ye,Ne,Q,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(let Ze=0;Ze<ye.length;Ze++)Vi(re,ye[Ze],Ne,Q,Ee==="Polygon",Ze===0);else if(Ee==="MultiPolygon")for(let Ze=0;Ze<ye.length;Ze++){const Be=ye[Ze];for(let Oe=0;Oe<Be.length;Oe++)Vi(re,Be[Oe],Ne,Q,!0,Oe===0)}if(re.length){let Ze=W.tags||null;if(Ee==="LineString"&&ae.lineMetrics){Ze={};for(const Oe in W.tags)Ze[Oe]=W.tags[Oe];Ze.mapbox_clip_start=ye.start/ye.size,Ze.mapbox_clip_end=ye.end/ye.size}const Be={geometry:re,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:Ze};W.id!==null&&(Be.id=W.id),Ne.features.push(Be)}}function Vi(Ne,W,Q,ae,ye,Ee){const re=ae*ae;if(ae>0&&W.size<(ye?re:ae))return void(Q.numPoints+=W.length/3);const Ze=[];for(let Be=0;Be<W.length;Be+=3)(ae===0||W[Be+2]>re)&&(Q.numSimplified++,Ze.push(W[Be],W[Be+1])),Q.numPoints++;ye&&function(Be,Oe){let He=0;for(let je=0,_t=Be.length,Ut=_t-2;je<_t;Ut=je,je+=2)He+=(Be[je]-Be[Ut])*(Be[je+1]+Be[Ut+1]);if(He>0===Oe)for(let je=0,_t=Be.length;je<_t/2;je+=2){const Ut=Be[je],Gt=Be[je+1];Be[je]=Be[_t-2-je],Be[je+1]=Be[_t-1-je],Be[_t-2-je]=Ut,Be[_t-1-je]=Gt}}(Ze,Ee),Ne.push(Ze)}const ri={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ei{constructor(W,Q){const ae=(Q=this.options=function(Ee,re){for(const Ze in re)Ee[Ze]=re[Ze];return Ee}(Object.create(ri),Q)).debug;if(ae&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");let ye=function(Ee,re){const Ze=[];if(Ee.type==="FeatureCollection")for(let Be=0;Be<Ee.features.length;Be++)Ot(Ze,Ee.features[Be],re,Be);else Ot(Ze,Ee.type==="Feature"?Ee:{geometry:Ee},re);return Ze}(W,Q);this.tiles={},this.tileCoords=[],ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ye=function(Ee,re){const Ze=re.buffer/re.extent;let Be=Ee;const Oe=rr(Ee,1,-1-Ze,Ze,0,-1,2,re),He=rr(Ee,1,1-Ze,2+Ze,0,-1,2,re);return(Oe||He)&&(Be=rr(Ee,1,-Ze,1+Ze,0,-1,2,re)||[],Oe&&(Be=gi(Oe,1).concat(Be)),He&&(Be=Be.concat(gi(He,-1)))),Be}(ye,Q),ye.length&&this.splitTile(ye,0,0,0),ae&&(ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,Q,ae,ye,Ee,re,Ze){const Be=[W,Q,ae,ye],Oe=this.options,He=Oe.debug;for(;Be.length;){ye=Be.pop(),ae=Be.pop(),Q=Be.pop(),W=Be.pop();const je=1<<Q,_t=ii(Q,ae,ye);let Ut=this.tiles[_t];if(!Ut&&(He>1&&console.time("creation"),Ut=this.tiles[_t]=Yi(W,Q,ae,ye,Oe),this.tileCoords.push({z:Q,x:ae,y:ye}),He)){He>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,ae,ye,Ut.numFeatures,Ut.numPoints,Ut.numSimplified),console.timeEnd("creation"));const wt=`z${Q}`;this.stats[wt]=(this.stats[wt]||0)+1,this.total++}if(Ut.source=W,Ee==null){if(Q===Oe.indexMaxZoom||Ut.numPoints<=Oe.indexMaxPoints)continue}else{if(Q===Oe.maxZoom||Q===Ee)continue;if(Ee!=null){const wt=Ee-Q;if(ae!==re>>wt||ye!==Ze>>wt)continue}}if(Ut.source=null,W.length===0)continue;He>1&&console.time("clipping");const Gt=.5*Oe.buffer/Oe.extent,tr=.5-Gt,ir=.5+Gt,k=1+Gt;let O=null,me=null,de=null,ze=null,We=rr(W,je,ae-Gt,ae+ir,0,Ut.minX,Ut.maxX,Oe),Le=rr(W,je,ae+tr,ae+k,0,Ut.minX,Ut.maxX,Oe);W=null,We&&(O=rr(We,je,ye-Gt,ye+ir,1,Ut.minY,Ut.maxY,Oe),me=rr(We,je,ye+tr,ye+k,1,Ut.minY,Ut.maxY,Oe),We=null),Le&&(de=rr(Le,je,ye-Gt,ye+ir,1,Ut.minY,Ut.maxY,Oe),ze=rr(Le,je,ye+tr,ye+k,1,Ut.minY,Ut.maxY,Oe),Le=null),He>1&&console.timeEnd("clipping"),Be.push(O||[],Q+1,2*ae,2*ye),Be.push(me||[],Q+1,2*ae,2*ye+1),Be.push(de||[],Q+1,2*ae+1,2*ye),Be.push(ze||[],Q+1,2*ae+1,2*ye+1)}}getTile(W,Q,ae){W=+W,Q=+Q,ae=+ae;const ye=this.options,{extent:Ee,debug:re}=ye;if(W<0||W>24)return null;const Ze=1<<W,Be=ii(W,Q=Q+Ze&Ze-1,ae);if(this.tiles[Be])return Ai(this.tiles[Be],Ee);re>1&&console.log("drilling down to z%d-%d-%d",W,Q,ae);let Oe,He=W,je=Q,_t=ae;for(;!Oe&&He>0;)He--,je>>=1,_t>>=1,Oe=this.tiles[ii(He,je,_t)];return Oe&&Oe.source?(re>1&&(console.log("found parent tile z%d-%d-%d",He,je,_t),console.time("drilling down")),this.splitTile(Oe.source,He,je,_t,W,Q,ae),re>1&&console.timeEnd("drilling down"),this.tiles[Be]?Ai(this.tiles[Be],Ee):null):null}}function ii(Ne,W,Q){return 32*((1<<Ne)*Q+W)+Ne}function yr(Ne,W){return W?Ne.properties[W]:Ne.id}function Ar(Ne,W){if(Ne==null)return!0;if(Ne.type==="Feature")return yr(Ne,W)!=null;if(Ne.type==="FeatureCollection"){const Q=new Set;for(const ae of Ne.features){const ye=yr(ae,W);if(ye==null||Q.has(ye))return!1;Q.add(ye)}return!0}return!1}function Zr(Ne,W){const Q=new Map;if(Ne!=null)if(Ne.type==="Feature")Q.set(yr(Ne,W),Ne);else for(const ae of Ne.features)Q.set(yr(ae,W),ae);return Q}class Ur extends X{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(W,Q){return I._(this,void 0,void 0,function*(){const ae=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ye=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!ye)return null;const Ee=new zt(ye.features);let re=Yt(Ee);return re.byteOffset===0&&re.byteLength===re.buffer.byteLength||(re=new Uint8Array(re)),{vectorTile:Ee,rawData:re.buffer}})}loadData(W){return I._(this,void 0,void 0,function*(){var Q;(Q=this._pendingRequest)===null||Q===void 0||Q.abort();const ae=!!(W&&W.request&&W.request.collectResourceTiming)&&new I.cE(W.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(W,this._pendingRequest),this._geoJSONIndex=W.cluster?new Re(function({superclusterOptions:re,clusterProperties:Ze}){if(!Ze||!re)return re;const Be={},Oe={},He={accumulated:null,zoom:0},je={properties:null},_t=Object.keys(Ze);for(const Ut of _t){const[Gt,tr]=Ze[Ut],ir=I.cL(tr),k=I.cL(typeof Gt=="string"?[Gt,["accumulated"],["get",Ut]]:Gt);Be[Ut]=ir.value,Oe[Ut]=k.value}return re.map=Ut=>{je.properties=Ut;const Gt={};for(const tr of _t)Gt[tr]=Be[tr].evaluate(He,je);return Gt},re.reduce=(Ut,Gt)=>{je.properties=Gt;for(const tr of _t)He.accumulated=Ut[tr],Ut[tr]=Oe[tr].evaluate(He,je)},re}(W)).load((yield this._pendingData).features):(ye=yield this._pendingData,new ei(ye,W.geojsonVtOptions)),this.loaded={};const Ee={};if(ae){const re=ae.finish();re&&(Ee.resourceTiming={},Ee.resourceTiming[W.source]=JSON.parse(JSON.stringify(re)))}return Ee}catch(Ee){if(delete this._pendingRequest,I.cp(Ee))return{abandoned:!0};throw Ee}var ye})}getData(){return I._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(W){const Q=this.loaded;return Q&&Q[W.uid]?super.reloadTile(W):this.loadTile(W)}loadAndProcessGeoJSON(W,Q){return I._(this,void 0,void 0,function*(){let ae=yield this.loadGeoJSON(W,Q);if(delete this._pendingRequest,typeof ae!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(at(ae,!0),W.filter){const ye=I.cL(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map(re=>`${re.key}: ${re.message}`).join(", "));ae={type:"FeatureCollection",features:ae.features.filter(re=>ye.value.evaluate({zoom:0},re))}}return ae})}loadGeoJSON(W,Q){return I._(this,void 0,void 0,function*(){const{promoteId:ae}=W;if(W.request){const ye=yield I.j(W.request,Q);return this._dataUpdateable=Ar(ye.data,ae)?Zr(ye.data,ae):void 0,ye.data}if(typeof W.data=="string")try{const ye=JSON.parse(W.data);return this._dataUpdateable=Ar(ye,ae)?Zr(ye,ae):void 0,ye}catch{throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`)}if(!W.dataDiff)throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${W.source}`);return function(ye,Ee,re){var Ze,Be,Oe,He;if(Ee.removeAll&&ye.clear(),Ee.remove)for(const je of Ee.remove)ye.delete(je);if(Ee.add)for(const je of Ee.add){const _t=yr(je,re);_t!=null&&ye.set(_t,je)}if(Ee.update)for(const je of Ee.update){let _t=ye.get(je.id);if(_t==null)continue;const Ut=!je.removeAllProperties&&(((Ze=je.removeProperties)===null||Ze===void 0?void 0:Ze.length)>0||((Be=je.addOrUpdateProperties)===null||Be===void 0?void 0:Be.length)>0);if((je.newGeometry||je.removeAllProperties||Ut)&&(_t=Object.assign({},_t),ye.set(je.id,_t),Ut&&(_t.properties=Object.assign({},_t.properties))),je.newGeometry&&(_t.geometry=je.newGeometry),je.removeAllProperties)_t.properties={};else if(((Oe=je.removeProperties)===null||Oe===void 0?void 0:Oe.length)>0)for(const Gt of je.removeProperties)Object.prototype.hasOwnProperty.call(_t.properties,Gt)&&delete _t.properties[Gt];if(((He=je.addOrUpdateProperties)===null||He===void 0?void 0:He.length)>0)for(const{key:Gt,value:tr}of je.addOrUpdateProperties)_t.properties[Gt]=tr}}(this._dataUpdateable,W.dataDiff,ae),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(W){return I._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}class li{constructor(W){this.self=W,this.actor=new I.H(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Q,ae)=>{if(this.externalWorkerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.externalWorkerSourceTypes[Q]=ae},this.self.addProtocol=I.cr,this.self.removeProtocol=I.cs,this.self.registerRTLTextPlugin=Q=>{I.cM.setMethods(Q)},this.actor.registerMessageHandler("LDT",(Q,ae)=>this._getDEMWorkerSource(Q,ae.source).loadTile(ae)),this.actor.registerMessageHandler("RDT",(Q,ae)=>I._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Q,ae.source).removeTile(ae)})),this.actor.registerMessageHandler("GCEZ",(Q,ae)=>I._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,ae.type,ae.source).getClusterExpansionZoom(ae)})),this.actor.registerMessageHandler("GCC",(Q,ae)=>I._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,ae.type,ae.source).getClusterChildren(ae)})),this.actor.registerMessageHandler("GCL",(Q,ae)=>I._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,ae.type,ae.source).getClusterLeaves(ae)})),this.actor.registerMessageHandler("LD",(Q,ae)=>this._getWorkerSource(Q,ae.type,ae.source).loadData(ae)),this.actor.registerMessageHandler("GD",(Q,ae)=>this._getWorkerSource(Q,ae.type,ae.source).getData()),this.actor.registerMessageHandler("LT",(Q,ae)=>this._getWorkerSource(Q,ae.type,ae.source).loadTile(ae)),this.actor.registerMessageHandler("RT",(Q,ae)=>this._getWorkerSource(Q,ae.type,ae.source).reloadTile(ae)),this.actor.registerMessageHandler("AT",(Q,ae)=>this._getWorkerSource(Q,ae.type,ae.source).abortTile(ae)),this.actor.registerMessageHandler("RMT",(Q,ae)=>this._getWorkerSource(Q,ae.type,ae.source).removeTile(ae)),this.actor.registerMessageHandler("RS",(Q,ae)=>I._(this,void 0,void 0,function*(){if(!this.workerSources[Q]||!this.workerSources[Q][ae.type]||!this.workerSources[Q][ae.type][ae.source])return;const ye=this.workerSources[Q][ae.type][ae.source];delete this.workerSources[Q][ae.type][ae.source],ye.removeSource!==void 0&&ye.removeSource(ae)})),this.actor.registerMessageHandler("RM",Q=>I._(this,void 0,void 0,function*(){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.workerSources[Q],delete this.demWorkerSources[Q]})),this.actor.registerMessageHandler("SR",(Q,ae)=>I._(this,void 0,void 0,function*(){this.referrer=ae})),this.actor.registerMessageHandler("SRPS",(Q,ae)=>this._syncRTLPluginState(Q,ae)),this.actor.registerMessageHandler("IS",(Q,ae)=>I._(this,void 0,void 0,function*(){this.self.importScripts(ae)})),this.actor.registerMessageHandler("SI",(Q,ae)=>this._setImages(Q,ae)),this.actor.registerMessageHandler("UL",(Q,ae)=>I._(this,void 0,void 0,function*(){this._getLayerIndex(Q).update(ae.layers,ae.removedIds)})),this.actor.registerMessageHandler("SL",(Q,ae)=>I._(this,void 0,void 0,function*(){this._getLayerIndex(Q).replace(ae)}))}_setImages(W,Q){return I._(this,void 0,void 0,function*(){this.availableImages[W]=Q;for(const ae in this.workerSources[W]){const ye=this.workerSources[W][ae];for(const Ee in ye)ye[Ee].availableImages=Q}})}_syncRTLPluginState(W,Q){return I._(this,void 0,void 0,function*(){return yield I.cM.syncState(Q,this.self.importScripts)})}_getAvailableImages(W){let Q=this.availableImages[W];return Q||(Q=[]),Q}_getLayerIndex(W){let Q=this.layerIndexes[W];return Q||(Q=this.layerIndexes[W]=new c),Q}_getWorkerSource(W,Q,ae){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][Q]||(this.workerSources[W][Q]={}),!this.workerSources[W][Q][ae]){const ye={sendAsync:(Ee,re)=>(Ee.targetMapId=W,this.actor.sendAsync(Ee,re))};switch(Q){case"vector":this.workerSources[W][Q][ae]=new X(ye,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][Q][ae]=new Ur(ye,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][Q][ae]=new this.externalWorkerSourceTypes[Q](ye,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][Q][ae]}_getDEMWorkerSource(W,Q){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][Q]||(this.demWorkerSources[W][Q]=new _e),this.demWorkerSources[W][Q]}}return I.i(self)&&(self.worker=new li(self)),li}),B("index",["exports","./shared"],function(I,c){var J="5.5.0";function K(){var d=new c.A(4);return c.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d}let oe,X;const _e={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(d,e,i){const l=requestAnimationFrame(m=>{h(),e(m)}),{unsubscribe:h}=c.s(d.signal,"abort",()=>{h(),cancelAnimationFrame(l),i(c.c())},!1)},frameAsync(d){return new Promise((e,i)=>{this.frame(d,e,i)})},getImageData(d,e=0){return this.getImageCanvasContext(d).getImageData(-e,-e,d.width+2*e,d.height+2*e)},getImageCanvasContext(d){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=d.width,e.height=d.height,i.drawImage(d,0,0,d.width,d.height),i},resolveURL:d=>(oe||(oe=document.createElement("a")),oe.href=d,oe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(X==null&&(X=matchMedia("(prefers-reduced-motion: reduce)")),X.matches)}};class se{static testProp(e){if(!se.docStyle)return e[0];for(let i=0;i<e.length;i++)if(e[i]in se.docStyle)return e[i];return e[0]}static create(e,i,l){const h=window.document.createElement(e);return i!==void 0&&(h.className=i),l&&l.appendChild(h),h}static createNS(e,i){return window.document.createElementNS(e,i)}static disableDrag(){se.docStyle&&se.selectProp&&(se.userSelect=se.docStyle[se.selectProp],se.docStyle[se.selectProp]="none")}static enableDrag(){se.docStyle&&se.selectProp&&(se.docStyle[se.selectProp]=se.userSelect)}static setTransform(e,i){e.style[se.transformProp]=i}static addEventListener(e,i,l,h={}){e.addEventListener(i,l,"passive"in h?h:h.capture)}static removeEventListener(e,i,l,h={}){e.removeEventListener(i,l,"passive"in h?h:h.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",se.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",se.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",se.suppressClickInternal,!0)},0)}static getScale(e){const i=e.getBoundingClientRect();return{x:i.width/e.offsetWidth||1,y:i.height/e.offsetHeight||1,boundingClientRect:i}}static getPoint(e,i,l){const h=i.boundingClientRect;return new c.P((l.clientX-h.left)/i.x-e.clientLeft,(l.clientY-h.top)/i.y-e.clientTop)}static mousePos(e,i){const l=se.getScale(e);return se.getPoint(e,l,i)}static touchPos(e,i){const l=[],h=se.getScale(e);for(let m=0;m<i.length;m++)l.push(se.getPoint(e,h,i[m]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const i=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),l=i.querySelectorAll("script");for(const h of l)h.remove();return se.clean(i),i.innerHTML}static isPossiblyDangerous(e,i){const l=i.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!l.includes("javascript:")&&!l.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const i=e.children;for(const l of i)se.removeAttributes(l),se.clean(l)}static removeAttributes(e){for(const{name:i,value:l}of e.attributes)se.isPossiblyDangerous(i,l)&&e.removeAttribute(i)}}se.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,se.selectProp=se.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),se.transformProp=se.testProp(["transform","WebkitTransform"]);const Me={supported:!1,testSupport:function(d){!ft&&at&&(pt?zt(d):qe=d)}};let qe,at,ft=!1,pt=!1;function zt(d){const e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,at),d.isContextLost())return;Me.supported=!0}catch{}d.deleteTexture(e),ft=!0}var Rt;typeof document<"u"&&(at=document.createElement("img"),at.onload=()=>{qe&&zt(qe),qe=null,pt=!0},at.onerror=()=>{ft=!0,qe=null},at.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(d){let e,i,l,h;d.resetRequestQueue=()=>{e=[],i=0,l=0,h={}},d.addThrottleControl=E=>{const P=l++;return h[P]=E,P},d.removeThrottleControl=E=>{delete h[E],y()},d.getImage=(E,P,z=!0)=>new Promise((F,N)=>{Me.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),c.e(E,{type:"image"}),e.push({abortController:P,requestParameters:E,supportImageRefresh:z,state:"queued",onError:H=>{N(H)},onSuccess:H=>{F(H)}}),y()});const m=E=>c._(this,void 0,void 0,function*(){E.state="running";const{requestParameters:P,supportImageRefresh:z,onError:F,onSuccess:N,abortController:H}=E,$=z===!1&&!c.i(self)&&!c.g(P.url)&&(!P.headers||Object.keys(P.headers).reduce((he,xe)=>he&&xe==="accept",!0));i++;const ce=$?b(P,H):c.m(P,H);try{const he=yield ce;delete E.abortController,E.state="completed",he.data instanceof HTMLImageElement||c.b(he.data)?N(he):he.data&&N({data:yield(le=he.data,typeof createImageBitmap=="function"?c.f(le):c.h(le)),cacheControl:he.cacheControl,expires:he.expires})}catch(he){delete E.abortController,F(he)}finally{i--,y()}var le}),y=()=>{const E=(()=>{for(const P of Object.keys(h))if(h[P]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=i;P<E&&e.length>0;P++){const z=e.shift();z.abortController.signal.aborted?P--:m(z)}},b=(E,P)=>new Promise((z,F)=>{const N=new Image,H=E.url,$=E.credentials;$&&$==="include"?N.crossOrigin="use-credentials":($&&$==="same-origin"||!c.d(H))&&(N.crossOrigin="anonymous"),P.signal.addEventListener("abort",()=>{N.src="",F(c.c())}),N.fetchPriority="high",N.onload=()=>{N.onerror=N.onload=null,z({data:N})},N.onerror=()=>{N.onerror=N.onload=null,P.signal.aborted||F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},N.src=H})}(Rt||(Rt={})),Rt.resetRequestQueue();class Ge{constructor(e){this._transformRequestFn=e}transformRequest(e,i){return this._transformRequestFn&&this._transformRequestFn(e,i)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Pe(d){const e=[];if(typeof d=="string")e.push({id:"default",url:d});else if(d&&d.length>0){const i=[];for(const{id:l,url:h}of d){const m=`${l}${h}`;i.indexOf(m)===-1&&(i.push(m),e.push({id:l,url:h}))}}return e}function gt(d,e,i){try{const l=new URL(d);return l.pathname+=`${e}${i}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${d}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class bt{constructor(e,i,l,h){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(i,h)}update(e,i,l){const{width:h,height:m}=e,y=!(this.size&&this.size[0]===h&&this.size[1]===m||l),{context:b}=this,{gl:E}=b;if(this.useMipmap=!!(i&&i.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!i||i.premultiply!==!1)),y)this.size=[h,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,e):E.texImage2D(E.TEXTURE_2D,0,this.format,h,m,0,this.format,E.UNSIGNED_BYTE,e.data);else{const{x:P,y:z}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?E.texSubImage2D(E.TEXTURE_2D,0,P,z,E.RGBA,E.UNSIGNED_BYTE,e):E.texSubImage2D(E.TEXTURE_2D,0,P,z,h,m,E.RGBA,E.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D),b.pixelStoreUnpackFlipY.setDefault(),b.pixelStoreUnpack.setDefault(),b.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,i,l){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),l!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=m.LINEAR),e!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,l||e),this.filter=e),i!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Yt(d){const{userImage:e}=d;return!!(e&&e.render&&e.render())&&(d.data.replace(new Uint8Array(e.data.buffer)),!0)}class nr extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:i,promiseResolve:l}of this.requestors)l(this._getImagesForIds(i));this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const l=i.spriteData;i.data=new c.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),i.spriteData=null}return i}addImage(e,i){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,i)&&(this.images[e]=i)}_validate(e,i){let l=!0;const h=i.data||i.spriteData;return this._validateStretch(i.stretchX,h&&h.width)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(i.stretchY,h&&h.height)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(i.content,i)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,i){if(!e)return!0;let l=0;for(const h of e){if(h[0]<l||h[1]<h[0]||i<h[1])return!1;l=h[1]}return!0}_validateContent(e,i){if(!e)return!0;if(e.length!==4)return!1;const l=i.spriteData,h=l&&l.width||i.data.width,m=l&&l.height||i.data.height;return!(e[0]<0||h<e[0]||e[1]<0||m<e[1]||e[2]<0||h<e[2]||e[3]<0||m<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,i,l=!0){const h=this.getImage(e);if(l&&(h.data.width!==i.data.width||h.data.height!==i.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${i.data.width}x${i.data.height}).`);i.version=h.version+1,this.images[e]=i,this.updatedImages[e]=!0}removeImage(e){const i=this.images[e];delete this.images[e],delete this.patterns[e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((i,l)=>{let h=!0;if(!this.isLoaded())for(const m of e)this.images[m]||(h=!1);this.isLoaded()||h?i(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:i})})}_getImagesForIds(e){const i={};for(const l of e){let h=this.getImage(l);h||(this.fire(new c.l("styleimagemissing",{id:l})),h=this.getImage(l)),h?i[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:c.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:e,height:i}=this.atlasImage;return{width:e,height:i}}getPattern(e){const i=this.patterns[e],l=this.getImage(e);if(!l)return null;if(i&&i.position.version===l.version)return i.position;if(i)i.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},m=new c.I(h,l);this.patterns[e]={bin:h,position:m}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new bt(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const m in this.patterns)e.push(this.patterns[m].bin);const{w:i,h:l}=c.p(e),h=this.atlasImage;h.resize({width:i||1,height:l||1});for(const m in this.patterns){const{bin:y}=this.patterns[m],b=y.x+1,E=y.y+1,P=this.getImage(m).data,z=P.width,F=P.height;c.R.copy(P,h,{x:0,y:0},{x:b,y:E},{width:z,height:F}),c.R.copy(P,h,{x:0,y:F-1},{x:b,y:E-1},{width:z,height:1}),c.R.copy(P,h,{x:0,y:0},{x:b,y:E+F},{width:z,height:1}),c.R.copy(P,h,{x:z-1,y:0},{x:b-1,y:E},{width:1,height:F}),c.R.copy(P,h,{x:0,y:0},{x:b+z,y:E},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const l=this.getImage(i);l||c.w(`Image with ID: "${i}" was not found`),Yt(l)&&this.updateImage(i,l)}}}const lr=1e20;function dr(d,e,i,l,h,m,y,b,E){for(let P=e;P<e+l;P++)Kt(d,i*m+P,m,h,y,b,E);for(let P=i;P<i+h;P++)Kt(d,P*m+e,1,l,y,b,E)}function Kt(d,e,i,l,h,m,y){m[0]=0,y[0]=-1e20,y[1]=lr,h[0]=d[e];for(let b=1,E=0,P=0;b<l;b++){h[b]=d[e+b*i];const z=b*b;do{const F=m[E];P=(h[b]-h[F]+z-F*F)/(b-F)/2}while(P<=y[E]&&--E>-1);E++,m[E]=b,y[E]=P,y[E+1]=lr}for(let b=0,E=0;b<l;b++){for(;y[E+1]<b;)E++;const P=m[E],z=b-P;d[e+b*i]=h[P]+z*z}}class xr{constructor(e,i){this.requestManager=e,this.localIdeographFontFamily=i,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){const i=[];for(const m in e)for(const y of e[m])i.push(this._getAndCacheGlyphsPromise(m,y));const l=yield Promise.all(i),h={};for(const{stack:m,id:y,glyph:b}of l)h[m]||(h[m]={}),h[m][y]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return h})}_getAndCacheGlyphsPromise(e,i){return c._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[i];if(h!==void 0)return{stack:e,id:i,glyph:h};if(h=this._tinySDF(l,e,i),h)return l.glyphs[i]=h,{stack:e,id:i,glyph:h};const m=Math.floor(i/256);if(256*m>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[m])return{stack:e,id:i,glyph:h};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[m]){const b=xr.loadGlyphRange(e,m,this.url,this.requestManager);l.requests[m]=b}const y=yield l.requests[m];for(const b in y)this._doesCharSupportLocalGlyph(+b)||(l.glyphs[+b]=y[+b]);return l.ranges[m]=!0,{stack:e,id:i,glyph:y[i]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||c.u["CJK Unified Ideographs"](e)||c.u["Hangul Syllables"](e)||c.u.Hiragana(e)||c.u.Katakana(e)||c.u["CJK Symbols and Punctuation"](e)||c.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,i,l){const h=this.localIdeographFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let m=e.tinySDF;if(!m){let b="400";/bold/i.test(i)?b="900":/medium/i.test(i)?b="500":/light/i.test(i)&&(b="200"),m=e.tinySDF=new xr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:h,fontWeight:b})}const y=m.draw(String.fromCharCode(l));return{id:l,bitmap:new c.q({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}}xr.loadGlyphRange=function(d,e,i,l){return c._(this,void 0,void 0,function*(){const h=256*e,m=h+255,y=l.transformRequest(i.replace("{fontstack}",d).replace("{range}",`${h}-${m}`),"Glyphs"),b=yield c.n(y,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${e}, ${h}-${m}`);const E={};for(const P of c.o(b.data))E[P.id]=P;return E})},xr.TinySDF=class{constructor({fontSize:d=24,buffer:e=3,radius:i=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=i;const b=this.size=d+4*e,E=this._createCanvas(b),P=this.ctx=E.getContext("2d",{willReadFrequently:!0});P.font=`${y} ${m} ${d}px ${h}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(d){const e=document.createElement("canvas");return e.width=e.height=d,e}draw(d){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(d),y=Math.ceil(i),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),E=Math.min(this.size-this.buffer,y+Math.ceil(l)),P=b+2*this.buffer,z=E+2*this.buffer,F=Math.max(P*z,0),N=new Uint8ClampedArray(F),H={data:N,width:P,height:z,glyphWidth:b,glyphHeight:E,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(b===0||E===0)return H;const{ctx:$,buffer:ce,gridInner:le,gridOuter:he}=this;$.clearRect(ce,ce,b,E),$.fillText(d,ce,ce+y);const xe=$.getImageData(ce,ce,b,E);he.fill(lr,0,F),le.fill(0,0,F);for(let Te=0;Te<E;Te++)for(let we=0;we<b;we++){const Ae=xe.data[4*(Te*b+we)+3]/255;if(Ae===0)continue;const ke=(Te+ce)*P+we+ce;if(Ae===1)he[ke]=0,le[ke]=lr;else{const De=.5-Ae;he[ke]=De>0?De*De:0,le[ke]=De<0?De*De:0}}dr(he,0,0,P,z,P,this.f,this.v,this.z),dr(le,ce,ce,b,E,P,this.f,this.v,this.z);for(let Te=0;Te<F;Te++){const we=Math.sqrt(he[Te])-Math.sqrt(le[Te]);N[Te]=Math.round(255-255*(we/this.radius+this.cutoff))}return H}};class tt{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,i){return c.z(e.expression.evaluate(i))}interpolate(e,i,l){return{x:c.B.number(e.x,i.x,l),y:c.B.number(e.y,i.y,l),z:c.B.number(e.z,i.z,l)}}}let Re;class st extends c.E{constructor(e){super(),Re=Re||new c.r({anchor:new c.D(c.v.light.anchor),position:new tt,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(Re),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(c.t,e,i))for(const l in e){const h=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,l){return(!l||l.validate!==!1)&&c.x(this,e.call(c.y,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const ot=new c.r({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class jt extends c.E{constructor(e){super(),this._transitionable=new c.T(ot),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.C(0))}setSky(e,i={}){if(!this._validate(c.F,e,i)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const h=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,l={}){return(l==null?void 0:l.validate)!==!1&&c.x(this,e.call(c.y,c.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ue{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,i){const l=e.join(",")+String(i);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,i)),this.dashEntry[l]}getDashRanges(e,i,l){const h=[];let m=e.length%2==1?-e[e.length-1]*l:0,y=e[0]*l,b=!0;h.push({left:m,right:y,isDash:b,zeroLength:e[0]===0});let E=e[0];for(let P=1;P<e.length;P++){b=!b;const z=e[P];m=E*l,E+=z,y=E*l,h.push({left:m,right:y,isDash:b,zeroLength:z===0})}return h}addRoundDash(e,i,l){const h=i/2;for(let m=-l;m<=l;m++){const y=this.width*(this.nextRow+l+m);let b=0,E=e[b];for(let P=0;P<this.width;P++){P/E.right>1&&(E=e[++b]);const z=Math.abs(P-E.left),F=Math.abs(P-E.right),N=Math.min(z,F);let H;const $=m/l*(h+1);if(E.isDash){const ce=h-Math.abs($);H=Math.sqrt(N*N+ce*ce)}else H=h-Math.sqrt(N*N+$*$);this.data[y+P]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(e){for(let b=e.length-1;b>=0;--b){const E=e[b],P=e[b+1];E.zeroLength?e.splice(b,1):P&&P.isDash===E.isDash&&(P.left=E.left,e.splice(b,1))}const i=e[0],l=e[e.length-1];i.isDash===l.isDash&&(i.left=l.left-this.width,l.right=i.right+this.width);const h=this.width*this.nextRow;let m=0,y=e[m];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++m]);const E=Math.abs(b-y.left),P=Math.abs(b-y.right),z=Math.min(E,P);this.data[h+b]=Math.max(0,Math.min(255,(y.isDash?z:-z)+128))}}addDash(e,i){const l=i?7:0,h=2*l+1;if(this.nextRow+h>this.height)return c.w("LineAtlas out of space"),null;let m=0;for(let b=0;b<e.length;b++)m+=e[b];if(m!==0){const b=this.width/m,E=this.getDashRanges(e,this.width,b);i?this.addRoundDash(E,b,l):this.addRegularDash(E)}const y={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:m};return this.nextRow+=h,this.dirty=!0,y}bind(e){const i=e.gl;this.texture?(i.bindTexture(i.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(i.TEXTURE_2D,0,0,0,this.width,this.height,i.ALPHA,i.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.ALPHA,this.width,this.height,0,i.ALPHA,i.UNSIGNED_BYTE,this.data))}}const Ye="maplibre_preloaded_worker_pool";class Mt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Mt.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ye]}numActive(){return Object.keys(this.active).length}}const yt=Math.floor(_e.hardwareConcurrency/2);let vt,It;function Ot(){return vt||(vt=new Mt),vt}Mt.workerCount=c.G(globalThis)?Math.max(Math.min(yt,3),1):1;class Xt{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=i;const l=this.workerPool.acquire(i);for(let h=0;h<l.length;h++){const m=new c.H(l[h],i);m.name=`Worker ${h}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,i){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:e,data:i}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(i=>{i.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,i){for(const l of this.actors)l.registerMessageHandler(e,i)}}function mr(){return It||(It=new Xt(Ot(),c.J),It.registerMessageHandler("GR",(d,e,i)=>c.m(e,i))),It}function hi(d,e){const i=c.K();return c.L(i,i,[1,1,0]),c.M(i,i,[.5*d.width,.5*d.height,1]),d.calculatePosMatrix?c.N(i,i,d.calculatePosMatrix(e.toUnwrapped())):i}function Si(d,e,i,l,h,m,y){var b;const E=function(N,H,$){if(N)for(const ce of N){const le=H[ce];if(le&&le.source===$&&le.type==="fill-extrusion")return!0}else for(const ce in H){const le=H[ce];if(le.source===$&&le.type==="fill-extrusion")return!0}return!1}((b=h==null?void 0:h.layers)!==null&&b!==void 0?b:null,e,d.id),P=m.maxPitchScaleFactor(),z=d.tilesIn(l,P,E);z.sort(jr);const F=[];for(const N of z)F.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(e,i,d._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,h,m,P,hi(d.transform,N.tileID),y?(H,$)=>y(N.tileID,H,$):void 0)});return function(N,H){for(const $ in N)for(const ce of N[$])rr(ce,H);return N}(function(N){const H={},$={};for(const ce of N){const le=ce.queryResults,he=ce.wrappedTileID,xe=$[he]=$[he]||{};for(const Te in le){const we=le[Te],Ae=xe[Te]=xe[Te]||{},ke=H[Te]=H[Te]||[];for(const De of we)Ae[De.featureIndex]||(Ae[De.featureIndex]=!0,ke.push(De))}}return H}(F),d)}function jr(d,e){const i=d.tileID,l=e.tileID;return i.overscaledZ-l.overscaledZ||i.canonical.y-l.canonical.y||i.wrap-l.wrap||i.canonical.x-l.canonical.x}function rr(d,e){const i=d.feature,l=e.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=l}function mi(d,e,i){return c._(this,void 0,void 0,function*(){let l=d;if(d.url?l=(yield c.j(e.transformRequest(d.url,"Source"),i)).data:yield _e.frameAsync(i),!l)return null;const h=c.O(c.e(l,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map(m=>m.id)),h})}class Dr{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.Q?new c.Q(e.lng,e.lat):c.Q.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.Q?new c.Q(e.lng,e.lat):c.Q.convert(e),this}extend(e){const i=this._sw,l=this._ne;let h,m;if(e instanceof c.Q)h=e,m=e;else{if(!(e instanceof Dr))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Dr.convert(e)):this.extend(c.Q.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.Q.convert(e)):this;if(h=e._sw,m=e._ne,!h||!m)return this}return i||l?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new c.Q(h.lng,h.lat),this._ne=new c.Q(m.lng,m.lat)),this}getCenter(){return new c.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.Q(this.getWest(),this.getNorth())}getSouthEast(){return new c.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:l}=c.Q.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(e){return e instanceof Dr?e:e&&new Dr(e)}static fromLngLat(e,i=0){const l=360*i/40075017,h=l/Math.cos(Math.PI/180*e.lat);return new Dr(new c.Q(e.lng-h,e.lat-l),new c.Q(e.lng+h,e.lat+l))}adjustAntiMeridian(){const e=new c.Q(this._sw.lng,this._sw.lat),i=new c.Q(this._ne.lng,this._ne.lat);return new Dr(e,e.lng>i.lng?new c.Q(i.lng+360,i.lat):i)}}class kr{constructor(e,i,l){this.bounds=Dr.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),l=Math.floor(c.U(this.bounds.getWest())*i),h=Math.floor(c.S(this.bounds.getNorth())*i),m=Math.ceil(c.U(this.bounds.getEast())*i),y=Math.ceil(c.S(this.bounds.getSouth())*i);return e.x>=l&&e.x<m&&e.y>=h&&e.y<y}}class Ui extends c.E{constructor(e,i,l,h){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.O(i,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield mi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new kr(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(i,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((m,y)=>{e.reloadPromise={resolve:m,reject:y}})}else e.actor=this.dispatcher.getActor(),h="LT";e.abortController=new AbortController;try{const m=yield e.actor.sendAsync({type:h,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,m)}catch(m){if(delete e.abortController,e.aborted)return;if(m&&m.status!==404)throw m;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,i){if(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),i&&this.map._refreshExpiredTiles&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class _r extends c.E{constructor(e,i,l,h){super(),this.id=e,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},i),c.e(this,c.O(i,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield mi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(c.e(this,i),i.bounds&&(this.tileBounds=new kr(i.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(i){this._tileJSONRequest=null,this.fire(new c.k(i))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield Rt.getImage(this.map._requestManager.transformRequest(i,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,m=h.gl,y=l.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new bt(h,y,m.RGBA,{useMipmap:!0}),e.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class xi extends _r{constructor(e,i,l,h){super(e,i,l,h),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(i,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const h=yield Rt.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(h&&h.data){const m=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&e.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const y=c.b(m)&&c.V()?m:yield this.readImageNow(m),b={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const E=yield e.actor.sendAsync({type:"LDT",data:b});e.dem=E,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(h){if(delete e.abortController,e.aborted)e.state="unloaded";else if(h)throw e.state="errored",h}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.W()){const i=e.width+2,l=e.height+2;try{return new c.R({width:i,height:l},yield c.X(e,-1,-1,i,l))}catch{}}return _e.getImageData(e,1)})}_getNeighboringTiles(e){const i=e.canonical,l=Math.pow(2,i.z),h=(i.x-1+l)%l,m=i.x===0?e.wrap-1:e.wrap,y=(i.x+1+l)%l,b=i.x+1===l?e.wrap+1:e.wrap,E={};return E[new c.Y(e.overscaledZ,m,i.z,h,i.y).key]={backfilled:!1},E[new c.Y(e.overscaledZ,b,i.z,y,i.y).key]={backfilled:!1},i.y>0&&(E[new c.Y(e.overscaledZ,m,i.z,h,i.y-1).key]={backfilled:!1},E[new c.Y(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},E[new c.Y(e.overscaledZ,b,i.z,y,i.y-1).key]={backfilled:!1}),i.y+1<l&&(E[new c.Y(e.overscaledZ,m,i.z,h,i.y+1).key]={backfilled:!1},E[new c.Y(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},E[new c.Y(e.overscaledZ,b,i.z,y,i.y+1).key]={backfilled:!1}),E}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class sn extends c.E{constructor(e,i,l,h){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(h),this._data=i.data,this._options=c.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,i.clusterMaxZoom!==void 0&&this.maxzoom<=i.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(i.buffer!==void 0?i.buffer:128),tolerance:this._pixelsToTileUnits(i.tolerance!==void 0?i.tolerance:.375),extent:c.Z,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:c.Z,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(c.Z/this.tileSize)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(i=>i.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return c._(this,void 0,void 0,function*(){const e=new Dr,i=yield this.getData();let l;switch(i.type){case"FeatureCollection":l=i.features.map(h=>this.getCoordinatesFromGeometry(h.geometry)).flat(1/0);break;case"Feature":l=this.getCoordinatesFromGeometry(i.geometry);break;default:l=this.getCoordinatesFromGeometry(i)}if(l.length==0)return e;for(let h=0;h<l.length-1;h+=2)e.extend([l[h],l[h+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,i,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:i,offset:l}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){const i=c.e({type:this.type},this.workerOptions);e?i.dataDiff=e:typeof this._data=="string"?(i.request=this.map._requestManager.transformRequest(_e.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.l("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));let h=null;l.resourceTiming&&l.resourceTiming[this.id]&&(h=l.resourceTiming[this.id].slice(0));const m={dataType:"source"};this._collectResourceTiming&&h&&h.length>0&&c.e(m,{resourceTiming:h}),this.fire(new c.l("data",Object.assign(Object.assign({},m),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},m),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(l))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){const i=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const h=yield this.actor.sendAsync({type:i,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(h,this.map.painter,i==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class gi extends c.E{constructor(e,i,l,h){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=l,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=i}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const i=yield Rt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,i&&i.data&&(this.image=i.data,e&&(this.coordinates=e),this._finishLoading())}catch(i){this._request=null,this._loaded=!0,this.fire(new c.k(i))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(c.$.fromLngLat);var l;return this.tileID=function(h){let m=1/0,y=1/0,b=-1/0,E=-1/0;for(const N of h)m=Math.min(m,N.x),y=Math.min(y,N.y),b=Math.max(b,N.x),E=Math.max(E,N.y);const P=Math.max(b-m,E-y),z=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),F=Math.pow(2,z);return new c.a1(z,Math.floor((m+b)/2*F),Math.floor((y+E)/2*F))}(i),this.terrainTileRanges=this._getOverlappingTileRanges(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map(h=>this.tileID.getTilePoint(h)._round()),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,i=e.gl;this.texture||(this.texture=new bt(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){let i=1/0,l=1/0,h=-1/0,m=-1/0;for(const b of e)i=Math.min(i,b.x),l=Math.min(l,b.y),h=Math.max(h,b.x),m=Math.max(m,b.y);const y={};for(let b=0;b<=c.a0;b++){const E=Math.pow(2,b),P=Math.floor(i*E),z=Math.floor(l*E),F=Math.floor(h*E),N=Math.floor(m*E);y[b]={minTileX:P,minTileY:z,maxTileX:F,maxTileY:N}}return y}}class oi extends gi{constructor(e,i,l,h){super(e,i,l,h),this.roundZoom=!0,this.type="video",this.options=i}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,"Source").url);try{const i=yield c.a2(this.urls);if(this._loaded=!0,!i)return;this.video=i,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(i){this.fire(new c.k(i))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new c.k(new c.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new bt(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ai extends gi{constructor(e,i,l,h){super(e,i,l,h),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new c.k(new c.a3(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.a3(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new c.k(new c.a3(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.a3(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.a3(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,l=i.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new bt(i,this.canvas,l.RGBA,{premultiply:!0});let h=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,h=!0)}h&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Nr={},Yi=d=>{switch(d){case"geojson":return sn;case"image":return gi;case"raster":return _r;case"raster-dem":return xi;case"vector":return Ui;case"video":return oi;case"canvas":return Ai}return Nr[d]},_i="RTLPluginLoaded";class Vi extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=mr()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(i=>{throw this.status="error",i})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(i,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=_e.resolveURL(i),!this.url)throw new Error(`requested url ${i} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(_i))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ri=null;function ei(){return ri||(ri=new Vi),ri}class ii{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const i=e+this.timeAdded;i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,m){const y={};if(!m)return y;for(const b of h){const E=b.layerIds.map(P=>m.getLayer(P)).filter(Boolean);if(E.length!==0){b.layers=E,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(P=>E.filter(z=>z.id===P)[0]));for(const P of E)y[P.id]=b}}return y}(e.buckets,i==null?void 0:i.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const m=this.buckets[h];if(m instanceof c.a6){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const m=this.buckets[h];if(m instanceof c.a6&&m.hasRTLText){this.hasRTLText=!0,ei().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const m=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(h).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new bt(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new bt(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,l,h,m,y,b,E,P,z,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:m,scale:y,tileSize:this.tileSize,pixelPosMatrix:z,transform:E,params:b,queryPadding:this.queryPadding*P,getElevation:F},e,i,l):{}}querySourceFeatures(e,i){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),m=i&&i.sourceLayer?i.sourceLayer:"",y=h._geojsonTileLayer||h[m];if(!y)return;const b=c.a7(i&&i.filter),{z:E,x:P,y:z}=this.tileID.canonical,F={z:E,x:P,y:z};for(let N=0;N<y.length;N++){const H=y.feature(N);if(b.needGeometry){const le=c.a8(H,!0);if(!b.filter(new c.C(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!b.filter(new c.C(this.tileID.overscaledZ),H))continue;const $=l.getId(H,m),ce=new c.a9(H,E,P,z,$);ce.tile=F,e.push(ce)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const l=c.aa(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(i)if(this.expirationTime<i)h=!0;else{const m=this.expirationTime-i;m?this.expirationTime=l+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!i.style.hasLayer(h))continue;const m=this.buckets[h],y=m.layers[0].sourceLayer||"_geojsonTileLayer",b=l[y],E=e[y];if(!b||!E||Object.keys(E).length===0)continue;m.update(E,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const P=i&&i.style&&i.style.getLayer(h);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_e.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=_e.now()+e}setDependencies(e,i){const l={};for(const h of i)l[h]=!0;this.dependencies[e]=l}hasDependency(e,i){for(const l of e){const h=this.dependencies[l];if(h){for(const m of i)if(h[m])return!0}}return!1}}class yr{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,l){const h=e.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const m={value:i,timeout:void 0};if(l!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},l)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const l=e.wrapped().key,h=i===void 0?0:this.data[l].indexOf(i),m=this.data[l][h];return this.data[l].splice(h,1),m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const l in this.data)for(const h of this.data[l])e(h.value)||i.push(h);for(const l of i)this.remove(l.value.tileID,l)}}class Ar{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,l){const h=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},c.e(this.stateChanges[e][h],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const m in this.state[e])m!==h&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][h]===null){this.deletedStates[e][h]={};for(const m in this.state[e][h])l[m]||(this.deletedStates[e][h][m]=null)}else for(const m in l)this.deletedStates[e]&&this.deletedStates[e][h]&&this.deletedStates[e][h][m]===null&&delete this.deletedStates[e][h][m]}removeFeatureState(e,i,l){if(this.deletedStates[e]===null)return;const h=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&i!==void 0)this.deletedStates[e][h]!==null&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][l]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][h])for(l in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][l]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,i){const l=String(i),h=c.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const m=this.deletedStates[e][i];if(m===null)return{};for(const y in m)delete h[y]}return h}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const m={};for(const y in this.stateChanges[h])this.state[h][y]||(this.state[h][y]={}),c.e(this.state[h][y],this.stateChanges[h][y]),m[y]=this.state[h][y];l[h]=m}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const m={};if(this.deletedStates[h]===null)for(const y in this.state[h])m[y]={},this.state[h][y]={};else for(const y in this.deletedStates[h]){if(this.deletedStates[h][y]===null)this.state[h][y]={};else for(const b of Object.keys(this.deletedStates[h][y]))delete this.state[h][y][b];m[y]=this.state[h][y]}l[h]=l[h]||{},c.e(l[h],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in e)e[h].setFeatureState(l,i)}}const Zr=89.25;function Ur(d,e){const i=c.ae(e.lat,-85.051129,c.af);return new c.P(c.U(e.lng)*d,c.S(i)*d)}function li(d,e){return new c.$(e.x/d,e.y/d).toLngLat()}function Ne(d){return d.cameraToCenterDistance*Math.min(.85*Math.tan(c.ab(90-d.pitch)),Math.tan(c.ab(Zr-d.pitch)))}function W(d,e){const i=d.canonical,l=e/c.ac(i.z),h=i.x+Math.pow(2,i.z)*d.wrap,m=c.ad(new Float64Array(16));return c.L(m,m,[h*l,i.y*l,0]),c.M(m,m,[l/c.Z,l/c.Z,1]),m}function Q(d,e,i,l,h){const m=c.$.fromLngLat(d,e),y=h*c.ag(1,d.lat),b=y*Math.cos(c.ab(i)),E=Math.sqrt(y*y-b*b),P=E*Math.sin(c.ab(-l)),z=E*Math.cos(c.ab(-l));return new c.$(m.x+P,m.y+z,m.z+b)}function ae(d,e,i){const l=e.intersectsFrustum(d);if(!i)return l;const h=e.intersectsPlane(i);return l===0||h===0?0:l===2&&h===2?2:1}function ye(d,e,i){let l=0;const h=(i-e)/10;for(let m=0;m<10;m++)l+=h*Math.pow(Math.cos(e+(m+.5)/10*(i-e)),d);return l}function Ee(d,e){return function(i,l,h,m,y){const b=2*((d-1)/c.ah(Math.cos(c.ab(Zr-y))/Math.cos(c.ab(Zr)))-1),E=Math.acos(h/m),P=2*ye(b-1,0,c.ab(y/2)),z=Math.min(c.ab(Zr),E+c.ab(y/2)),F=ye(b-1,Math.min(z,E-c.ab(y/2)),z),N=Math.atan(l/h),H=Math.hypot(l,h);let $=i;return $+=c.ah(m/H/Math.max(.5,Math.cos(c.ab(y/2)))),$+=b*c.ah(Math.cos(N))/2,$-=c.ah(Math.max(1,F/P/e))/2,$}}const re=Ee(9.314,3);function Ze(d,e){const i=(e.roundZoom?Math.round:Math.floor)(d.zoom+c.ah(d.tileSize/e.tileSize));return Math.max(0,i)}function Be(d,e){const i=d.getCameraFrustum(),l=d.getClippingPlane(),h=d.screenPointToMercatorCoordinate(d.getCameraPoint()),m=c.$.fromLngLat(d.center,d.elevation);h.z=m.z+Math.cos(d.pitchInRadians)*d.cameraToCenterDistance/d.worldSize;const y=d.getCoveringTilesDetailsProvider(),b=y.allowVariableZoom(d,e),E=Ze(d,e),P=e.minzoom||0,z=e.maxzoom!==void 0?e.maxzoom:d.maxZoom,F=Math.min(Math.max(0,E),z),N=Math.pow(2,F),H=[N*h.x,N*h.y,0],$=[N*m.x,N*m.y,0],ce=Math.hypot(m.x-h.x,m.y-h.y),le=Math.abs(m.z-h.z),he=Math.hypot(ce,le),xe=Ae=>({zoom:0,x:0,y:0,wrap:Ae,fullyVisible:!1}),Te=[],we=[];if(d.renderWorldCopies&&y.allowWorldCopies())for(let Ae=1;Ae<=3;Ae++)Te.push(xe(-Ae)),Te.push(xe(Ae));for(Te.push(xe(0));Te.length>0;){const Ae=Te.pop(),ke=Ae.x,De=Ae.y;let Qe=Ae.fullyVisible;const dt={x:ke,y:De,z:Ae.zoom},nt=y.getTileAABB(dt,Ae.wrap,d.elevation,e);if(!Qe){const Vt=ae(i,nt,l);if(Vt===0)continue;Qe=Vt===2}const it=y.distanceToTile2d(h.x,h.y,dt,nt);let ut=E;b&&(ut=(e.calculateTileZoom||re)(d.zoom+c.ah(d.tileSize/e.tileSize),it,le,he,d.fov)),ut=(e.roundZoom?Math.round:Math.floor)(ut),ut=Math.max(0,ut);const Zt=Math.min(ut,z);if(Ae.wrap=y.getWrap(m,dt,Ae.wrap),Ae.zoom>=Zt){if(Ae.zoom<P)continue;const Vt=F-Ae.zoom,St=H[0]-.5-(ke<<Vt),sr=H[1]-.5-(De<<Vt),Rr=e.reparseOverscaled?Math.max(Ae.zoom,ut):Ae.zoom;we.push({tileID:new c.Y(Ae.zoom===z?Rr:Ae.zoom,Ae.wrap,Ae.zoom,ke,De),distanceSq:c.ai([$[0]-.5-ke,$[1]-.5-De]),tileDistanceToCamera:Math.sqrt(St*St+sr*sr)})}else for(let Vt=0;Vt<4;Vt++)Te.push({zoom:Ae.zoom+1,x:(ke<<1)+Vt%2,y:(De<<1)+(Vt>>1),wrap:Ae.wrap,fullyVisible:Qe})}return we.sort((Ae,ke)=>Ae.distanceSq-ke.distanceSq).map(Ae=>Ae.tileID)}class Oe extends c.E{constructor(e,i,l){super(),this.id=e,this.dispatcher=l,this.on("data",h=>this._dataHandler(h)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((h,m,y,b)=>{const E=new(Yi(m.type))(h,m,y,b);if(E.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${E.id}`);return E})(e,i,l,this),this._tiles={},this._cache=new yr(0,h=>this._unloadTile(h)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ar,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,i,l){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,i,l)}catch(h){e.state="errored",h.status!==404?this._source.fire(new c.k(h,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const l=this._tiles[i];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(He).map(e=>e.key)}getRenderableIds(e){const i=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&i.push(this._tiles[l]);return e?i.sort((l,h)=>{const m=l.tileID,y=h.tileID,b=new c.P(m.canonical.x,m.canonical.y)._rotate(-this.transform.bearingInRadians),E=new c.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians);return m.overscaledZ-y.overscaledZ||E.y-b.y||E.x-b.x}).map(l=>l.tileID.key):i.map(l=>l.tileID).sort(He).map(l=>l.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)(e||this._tiles[i].state!=="errored")&&this._reloadTile(i,"reloading")}}_reloadTile(e,i){return c._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=i),yield this._loadTile(l,e,i))})}_tileLoaded(e,i,l){e.timeAdded=_e.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const i=this.getRenderableIds();for(let h=0;h<i.length;h++){const m=i[h];if(e.neighboringTiles&&e.neighboringTiles[m]){const y=this.getTileByID(m);l(e,y),l(y,e)}}function l(h,m){h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0;let y=m.tileID.canonical.x-h.tileID.canonical.x;const b=m.tileID.canonical.y-h.tileID.canonical.y,E=Math.pow(2,h.tileID.canonical.z),P=m.tileID.key;y===0&&b===0||Math.abs(b)>1||(Math.abs(y)>1&&(Math.abs(y+E)===1?y+=E:Math.abs(y-E)===1&&(y-=E)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,y,b),h.neighboringTiles&&h.neighboringTiles[P]&&(h.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,l,h){for(const m in this._tiles){let y=this._tiles[m];if(h[m]||!y.hasData()||y.tileID.overscaledZ<=i||y.tileID.overscaledZ>l)continue;let b=y.tileID;for(;y&&y.tileID.overscaledZ>i+1;){const P=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[P.key],y&&y.hasData()&&(b=P)}let E=b;for(;E.overscaledZ>i;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]||e[E.canonical.key]){h[b.key]=b;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=i?l:null}for(let l=e.overscaledZ-1;l>=i;l--){const h=e.scaledTo(l),m=this._getLoadedTile(h);if(m)return m}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,h=Math.floor(i*l*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(m)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const l={};for(const h in this._tiles){const m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+i),l[m.tileID.key]=m}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(h,this._tiles[h])}}_updateCoveredAndRetainedTiles(e,i,l,h,m,y){const b={},E={},P=Object.keys(e),z=_e.now();for(const F of P){const N=e[F],H=this._tiles[F];if(!H||H.fadeEndTime!==0&&H.fadeEndTime<=z)continue;const $=this.findLoadedParent(N,i),ce=this.findLoadedSibling(N),le=$||ce||null;le&&(this._addTile(le.tileID),b[le.tileID.key]=le.tileID),E[F]=N}this._retainLoadedChildren(E,h,l,e);for(const F in b)e[F]||(this._coveredTiles[F]=!0,e[F]=b[F]);if(y){const F={},N={};for(const H of m)this._tiles[H.key].hasData()?F[H.key]=H:N[H.key]=H;for(const H in N){const $=N[H].children(this._source.maxzoom);this._tiles[$[0].key]&&this._tiles[$[1].key]&&this._tiles[$[2].key]&&this._tiles[$[3].key]&&(F[$[0].key]=e[$[0].key]=$[0],F[$[1].key]=e[$[1].key]=$[1],F[$[2].key]=e[$[2].key]=$[2],F[$[3].key]=e[$[3].key]=$[3],delete N[H])}for(const H in N){const $=N[H],ce=this.findLoadedParent($,this._source.minzoom),le=this.findLoadedSibling($),he=ce||le||null;if(he){F[he.tileID.key]=e[he.tileID.key]=he.tileID;for(const xe in F)F[xe].isChildOf(he.tileID)&&delete F[xe]}}for(const H in this._tiles)F[H]||(this._coveredTiles[H]=!0)}}update(e,i){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=i,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new c.Y(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)):(l=Be(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter(z=>this._source.hasTile(z)))):l=[];const h=Ze(e,this._source),m=Math.max(h-Oe.maxOverzooming,this._source.minzoom),y=Math.max(h+Oe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const z={};for(const F of l)if(F.canonical.z>this._source.minzoom){const N=F.scaledTo(F.canonical.z-1);z[N.key]=N;const H=F.scaledTo(Math.max(this._source.minzoom,Math.min(F.canonical.z,5)));z[H.key]=H}l=l.concat(Object.values(z))}const b=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const E=this._updateRetainedTiles(l,h);je(this._source.type)&&this._updateCoveredAndRetainedTiles(E,m,y,h,l,i);for(const z in E)this._tiles[z].clearFadeHold();const P=c.aj(this._tiles,E);for(const z of P){const F=this._tiles[z];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(z)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,i){var l;const h={},m={},y=Math.max(i-Oe.maxOverzooming,this._source.minzoom),b=Math.max(i+Oe.maxUnderzooming,this._source.minzoom),E={};for(const P of e){const z=this._addTile(P);h[P.key]=P,z.hasData()||i<this._source.maxzoom&&(E[P.key]=P)}this._retainLoadedChildren(E,i,b,h);for(const P of e){let z=this._tiles[P.key];if(z.hasData())continue;if(i+1>this._source.maxzoom){const N=P.children(this._source.maxzoom)[0],H=this.getTile(N);if(H&&H.hasData()){h[N.key]=N;continue}}else{const N=P.children(this._source.maxzoom);if(h[N[0].key]&&h[N[1].key]&&h[N[2].key]&&h[N[3].key])continue}let F=z.wasRequested();for(let N=P.overscaledZ-1;N>=y;--N){const H=P.scaledTo(N);if(m[H.key])break;if(m[H.key]=!0,z=this.getTile(H),!z&&F&&(z=this._addTile(H)),z){const $=z.hasData();if(($||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||F)&&(h[H.key]=H),F=z.wasRequested(),$)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let l,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}i.push(h.key);const m=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;h=m}for(const m of i)this._loadedParentTiles[m]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const i=this._tiles[e].tileID,l=this._getLoadedTile(i);this._loadedSiblingTiles[i.key]=l}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const l=i;return i||(i=new ii(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,e.key,i.state)),i.uses++,this._tiles[e.key]=i,l||this._source.fire(new c.l("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=i.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}refreshTiles(e){for(const i in this._tiles)this._isIdRenderable(i)&&e.some(l=>l.equals(this._tiles[i].tileID.canonical))&&this._reloadTile(i,"expired")}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}_dataHandler(e){const i=e.sourceDataType;e.dataType==="source"&&i==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&i==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,i,l){const h=[],m=this.transform;if(!m)return h;const y=l?m.getCameraQueryGeometry(e):e,b=e.map($=>m.screenPointToMercatorCoordinate($,this.terrain)),E=y.map($=>m.screenPointToMercatorCoordinate($,this.terrain)),P=this.getIds();let z=1/0,F=1/0,N=-1/0,H=-1/0;for(const $ of E)z=Math.min(z,$.x),F=Math.min(F,$.y),N=Math.max(N,$.x),H=Math.max(H,$.y);for(let $=0;$<P.length;$++){const ce=this._tiles[P[$]];if(ce.holdingForFade())continue;const le=m.getCoveringTilesDetailsProvider().allowWorldCopies()?ce.tileID:ce.tileID.unwrapTo(0),he=Math.pow(2,m.zoom-ce.tileID.overscaledZ),xe=i*ce.queryPadding*c.Z/ce.tileSize/he,Te=[le.getTilePoint(new c.$(z,F)),le.getTilePoint(new c.$(N,H))];if(Te[0].x-xe<c.Z&&Te[0].y-xe<c.Z&&Te[1].x+xe>=0&&Te[1].y+xe>=0){const we=b.map(ke=>le.getTilePoint(ke)),Ae=E.map(ke=>le.getTilePoint(ke));h.push({tile:ce,tileID:le,queryGeometry:we,cameraQueryGeometry:Ae,scale:he})}}return h}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);return this.transform&&this.transform.populateCache(i),i}hasTransition(){if(this._source.hasTransition())return!0;if(je(this._source.type)){const e=_e.now();for(const i in this._tiles)if(this._tiles[i].fadeEndTime>=e)return!0}return!1}setFeatureState(e,i,l){this._state.updateState(e=e||"_geojsonTileLayer",i,l)}removeFeatureState(e,i,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,l)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,l){const h=this._tiles[e];h&&h.setDependencies(i,l)}reloadTilesForDependencies(e,i){for(const l in this._tiles)this._tiles[l].hasDependency(e,i)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,i))}}function He(d,e){const i=Math.abs(2*d.wrap)-+(d.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return d.overscaledZ-e.overscaledZ||l-i||e.canonical.y-d.canonical.y||e.canonical.x-d.canonical.x}function je(d){return d==="raster"||d==="image"||d==="video"}Oe.maxOverzooming=10,Oe.maxUnderzooming=3;class _t{constructor(e,i){this.reset(e,i)}reset(e,i){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ae(e,0,1);let i=1,l=this._distances[i];const h=e*this.paddedLength+this.padding;for(;l<h&&i<this._distances.length;)l=this._distances[++i];const m=i-1,y=this._distances[m],b=l-y,E=b>0?(h-y)/b:0;return this.points[m].mult(1-E).add(this.points[i].mult(E))}}function Ut(d,e){let i=!0;return d==="always"||d!=="never"&&e!=="never"||(i=!1),i}class Gt{constructor(e,i,l){const h=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(i/l);for(let y=0;y<this.xCellCount*this.yCellCount;y++)h.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,i,l,h,m){this._forEachCell(i,l,h,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(i),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(m)}insertCircle(e,i,l,h){this._forEachCell(i-h,l-h,i+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(i),this.circles.push(l),this.circles.push(h)}_insertBoxCell(e,i,l,h,m,y){this.boxCells[m].push(y)}_insertCircleCell(e,i,l,h,m,y){this.circleCells[m].push(y)}_query(e,i,l,h,m,y,b){if(l<0||e>this.width||h<0||i>this.height)return[];const E=[];if(e<=0&&i<=0&&this.width<=l&&this.height<=h){if(m)return[{key:null,x1:e,y1:i,x2:l,y2:h}];for(let P=0;P<this.boxKeys.length;P++)E.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const z=this.circles[3*P],F=this.circles[3*P+1],N=this.circles[3*P+2];E.push({key:this.circleKeys[P],x1:z-N,y1:F-N,x2:z+N,y2:F+N})}}else this._forEachCell(e,i,l,h,this._queryCell,E,{hitTest:m,overlapMode:y,seenUids:{box:{},circle:{}}},b);return E}query(e,i,l,h){return this._query(e,i,l,h,!1,null)}hitTest(e,i,l,h,m,y){return this._query(e,i,l,h,!0,m,y).length>0}hitTestCircle(e,i,l,h,m){const y=e-l,b=e+l,E=i-l,P=i+l;if(b<0||y>this.width||P<0||E>this.height)return!1;const z=[];return this._forEachCell(y,E,b,P,this._queryCellCircle,z,{hitTest:!0,overlapMode:h,circle:{x:e,y:i,radius:l},seenUids:{box:{},circle:{}}},m),z.length>0}_queryCell(e,i,l,h,m,y,b,E){const{seenUids:P,hitTest:z,overlapMode:F}=b,N=this.boxCells[m];if(N!==null){const $=this.bboxes;for(const ce of N)if(!P.box[ce]){P.box[ce]=!0;const le=4*ce,he=this.boxKeys[ce];if(e<=$[le+2]&&i<=$[le+3]&&l>=$[le+0]&&h>=$[le+1]&&(!E||E(he))&&(!z||!Ut(F,he.overlapMode))&&(y.push({key:he,x1:$[le],y1:$[le+1],x2:$[le+2],y2:$[le+3]}),z))return!0}}const H=this.circleCells[m];if(H!==null){const $=this.circles;for(const ce of H)if(!P.circle[ce]){P.circle[ce]=!0;const le=3*ce,he=this.circleKeys[ce];if(this._circleAndRectCollide($[le],$[le+1],$[le+2],e,i,l,h)&&(!E||E(he))&&(!z||!Ut(F,he.overlapMode))){const xe=$[le],Te=$[le+1],we=$[le+2];if(y.push({key:he,x1:xe-we,y1:Te-we,x2:xe+we,y2:Te+we}),z)return!0}}}return!1}_queryCellCircle(e,i,l,h,m,y,b,E){const{circle:P,seenUids:z,overlapMode:F}=b,N=this.boxCells[m];if(N!==null){const $=this.bboxes;for(const ce of N)if(!z.box[ce]){z.box[ce]=!0;const le=4*ce,he=this.boxKeys[ce];if(this._circleAndRectCollide(P.x,P.y,P.radius,$[le+0],$[le+1],$[le+2],$[le+3])&&(!E||E(he))&&!Ut(F,he.overlapMode))return y.push(!0),!0}}const H=this.circleCells[m];if(H!==null){const $=this.circles;for(const ce of H)if(!z.circle[ce]){z.circle[ce]=!0;const le=3*ce,he=this.circleKeys[ce];if(this._circlesCollide($[le],$[le+1],$[le+2],P.x,P.y,P.radius)&&(!E||E(he))&&!Ut(F,he.overlapMode))return y.push(!0),!0}}}_forEachCell(e,i,l,h,m,y,b,E){const P=this._convertToXCellCoord(e),z=this._convertToYCellCoord(i),F=this._convertToXCellCoord(l),N=this._convertToYCellCoord(h);for(let H=P;H<=F;H++)for(let $=z;$<=N;$++)if(m.call(this,e,i,l,h,this.xCellCount*$+H,y,b,E))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,i,l,h,m,y){const b=h-e,E=m-i,P=l+y;return P*P>b*b+E*E}_circleAndRectCollide(e,i,l,h,m,y,b){const E=(y-h)/2,P=Math.abs(e-(h+E));if(P>E+l)return!1;const z=(b-m)/2,F=Math.abs(i-(m+z));if(F>z+l)return!1;if(P<=E||F<=z)return!0;const N=P-E,H=F-z;return N*N+H*H<=l*l}}function tr(d,e,i){const l=c.K();if(!d){const{vecSouth:F,vecEast:N}=k(e),H=K();H[0]=N[0],H[1]=N[1],H[2]=F[0],H[3]=F[1],h=H,(z=(y=(m=H)[0])*(P=m[3])-(E=m[2])*(b=m[1]))&&(h[0]=P*(z=1/z),h[1]=-b*z,h[2]=-E*z,h[3]=y*z),l[0]=H[0],l[1]=H[1],l[4]=H[2],l[5]=H[3]}var h,m,y,b,E,P,z;return c.M(l,l,[1/i,1/i,1]),l}function ir(d,e,i,l){if(d){const h=c.K();if(!e){const{vecSouth:m,vecEast:y}=k(i);h[0]=y[0],h[1]=y[1],h[4]=m[0],h[5]=m[1]}return c.M(h,h,[l,l,1]),h}return i.pixelsToClipSpaceMatrix}function k(d){const e=Math.cos(d.rollInRadians),i=Math.sin(d.rollInRadians),l=Math.cos(d.pitchInRadians),h=Math.cos(d.bearingInRadians),m=Math.sin(d.bearingInRadians),y=c.ao();y[0]=-h*l*i-m*e,y[1]=-m*l*i+h*e;const b=c.ap(y);b<1e-9?c.aq(y):c.ar(y,y,1/b);const E=c.ao();E[0]=h*l*e-m*i,E[1]=m*l*e+h*i;const P=c.ap(E);return P<1e-9?c.aq(E):c.ar(E,E,1/P),{vecEast:E,vecSouth:y}}function O(d,e,i,l){let h;l?(h=[d,e,l(d,e),1],c.at(h,h,i)):(h=[d,e,0,1],Ln(h,h,i));const m=h[3];return{point:new c.P(h[0]/m,h[1]/m),signedDistanceFromCamera:m,isOccluded:!1}}function me(d,e){return .5+d/e*.5}function de(d,e){return d.x>=-e[0]&&d.x<=e[0]&&d.y>=-e[1]&&d.y<=e[1]}function ze(d,e,i,l,h,m,y,b,E,P,z,F,N){const H=i?d.textSizeData:d.iconSizeData,$=c.ak(H,e.transform.zoom),ce=[256/e.width*2+1,256/e.height*2+1],le=i?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;le.clear();const he=d.lineVertexArray,xe=i?d.text.placedSymbolArray:d.icon.placedSymbolArray,Te=e.transform.width/e.transform.height;let we=!1;for(let Ae=0;Ae<xe.length;Ae++){const ke=xe.get(Ae);if(ke.hidden||ke.writingMode===c.al.vertical&&!we){bi(ke.numGlyphs,le);continue}we=!1;const De=new c.P(ke.anchorX,ke.anchorY),Qe={getElevation:N,pitchedLabelPlaneMatrix:l,lineVertexArray:he,pitchWithMap:m,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:De,unwrappedTileID:E,width:P,height:z,translation:F},dt=Qt(ke.anchorX,ke.anchorY,Qe);if(!de(dt.point,ce)){bi(ke.numGlyphs,le);continue}const nt=me(e.transform.cameraToCenterDistance,dt.signedDistanceFromCamera),it=c.am(H,$,ke),ut=m?it*e.transform.getPitchedTextCorrection(ke.anchorX,ke.anchorY,E)/nt:it*nt,Zt=wt({projectionContext:Qe,pitchedLabelPlaneMatrixInverse:h,symbol:ke,fontSize:ut,flip:!1,keepUpright:y,glyphOffsetArray:d.glyphOffsetArray,dynamicLayoutVertexArray:le,aspectRatio:Te,rotateToLine:b});we=Zt.useVertical,(Zt.notEnoughRoom||we||Zt.needsFlipping&&wt({projectionContext:Qe,pitchedLabelPlaneMatrixInverse:h,symbol:ke,fontSize:ut,flip:!0,keepUpright:y,glyphOffsetArray:d.glyphOffsetArray,dynamicLayoutVertexArray:le,aspectRatio:Te,rotateToLine:b}).notEnoughRoom)&&bi(ke.numGlyphs,le)}i?d.text.dynamicLayoutVertexBuffer.updateData(le):d.icon.dynamicLayoutVertexBuffer.updateData(le)}function We(d,e,i,l,h,m,y,b){const E=m.glyphStartIndex+m.numGlyphs,P=m.lineStartIndex,z=m.lineStartIndex+m.lineLength,F=e.getoffsetX(m.glyphStartIndex),N=e.getoffsetX(E-1),H=ui(d*F,i,l,h,m.segment,P,z,b,y);if(!H)return null;const $=ui(d*N,i,l,h,m.segment,P,z,b,y);return $?b.projectionCache.anyProjectionOccluded?null:{first:H,last:$}:null}function Le(d,e,i,l){return d===c.al.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*l?{useVertical:!0}:(d===c.al.vertical?e.y<i.y:e.x>i.x)?{needsFlipping:!0}:null}function wt(d){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:i,symbol:l,fontSize:h,flip:m,keepUpright:y,glyphOffsetArray:b,dynamicLayoutVertexArray:E,aspectRatio:P,rotateToLine:z}=d,F=h/24,N=l.lineOffsetX*F,H=l.lineOffsetY*F;let $;if(l.numGlyphs>1){const ce=l.glyphStartIndex+l.numGlyphs,le=l.lineStartIndex,he=l.lineStartIndex+l.lineLength,xe=We(F,b,N,H,m,l,z,e);if(!xe)return{notEnoughRoom:!0};const Te=Hr(xe.first.point.x,xe.first.point.y,e,i),we=Hr(xe.last.point.x,xe.last.point.y,e,i);if(y&&!m){const Ae=Le(l.writingMode,Te,we,P);if(Ae)return Ae}$=[xe.first];for(let Ae=l.glyphStartIndex+1;Ae<ce-1;Ae++)$.push(ui(F*b.getoffsetX(Ae),N,H,m,l.segment,le,he,e,z));$.push(xe.last)}else{if(y&&!m){const le=ar(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,he=l.lineStartIndex+l.segment+1,xe=new c.P(e.lineVertexArray.getx(he),e.lineVertexArray.gety(he)),Te=ar(xe.x,xe.y,e),we=Te.signedDistanceFromCamera>0?Te.point:Nt(e.tileAnchorPoint,xe,le,1,e),Ae=Hr(le.x,le.y,e,i),ke=Hr(we.x,we.y,e,i),De=Le(l.writingMode,Ae,ke,P);if(De)return De}const ce=ui(F*b.getoffsetX(l.glyphStartIndex),N,H,m,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,e,z);if(!ce||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};$=[ce]}for(const ce of $)c.as(E,ce.point,ce.angle);return{}}function Nt(d,e,i,l,h){const m=d.add(d.sub(e)._unit()),y=ar(m.x,m.y,h).point,b=i.sub(y);return i.add(b._mult(l/b.mag()))}function Jt(d,e,i){const l=e.projectionCache;if(l.projections[d])return l.projections[d];const h=new c.P(e.lineVertexArray.getx(d),e.lineVertexArray.gety(d)),m=ar(h.x,h.y,e);if(m.signedDistanceFromCamera>0)return l.projections[d]=m.point,l.anyProjectionOccluded=l.anyProjectionOccluded||m.isOccluded,m.point;const y=d-i.direction;return Nt(i.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),h,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,e)}function ar(d,e,i){const l=d+i.translation[0],h=e+i.translation[1];let m;return i.pitchWithMap?(m=O(l,h,i.pitchedLabelPlaneMatrix,i.getElevation),m.isOccluded=!1):(m=i.transform.projectTileCoordinates(l,h,i.unwrappedTileID,i.getElevation),m.point.x=(.5*m.point.x+.5)*i.width,m.point.y=(.5*-m.point.y+.5)*i.height),m}function Hr(d,e,i,l){if(i.pitchWithMap){const h=[d,e,0,1];return c.at(h,h,l),i.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],i.unwrappedTileID,i.getElevation).point}return{x:d/i.width*2-1,y:e/i.height*2-1}}function Qt(d,e,i){return i.transform.projectTileCoordinates(d,e,i.unwrappedTileID,i.getElevation)}function Pi(d,e,i){return d._unit()._perp()._mult(e*i)}function _n(d,e,i,l,h,m,y,b,E){if(b.projectionCache.offsets[d])return b.projectionCache.offsets[d];const P=i.add(e);if(d+E.direction<l||d+E.direction>=h)return b.projectionCache.offsets[d]=P,P;const z=Jt(d+E.direction,b,E),F=Pi(z.sub(i),y,E.direction),N=i.add(F),H=z.add(F);return b.projectionCache.offsets[d]=c.au(m,P,N,H)||P,b.projectionCache.offsets[d]}function ui(d,e,i,l,h,m,y,b,E){const P=l?d-e:d+e;let z=P>0?1:-1,F=0;l&&(z*=-1,F=Math.PI),z<0&&(F+=Math.PI);let N,H=z>0?m+h:m+h+1;b.projectionCache.cachedAnchorPoint?N=b.projectionCache.cachedAnchorPoint:(N=ar(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=N);let $,ce,le=N,he=N,xe=0,Te=0;const we=Math.abs(P),Ae=[];let ke;for(;xe+Te<=we;){if(H+=z,H<m||H>=y)return null;xe+=Te,he=le,ce=$;const dt={absOffsetX:we,direction:z,distanceFromAnchor:xe,previousVertex:he};if(le=Jt(H,b,dt),i===0)Ae.push(he),ke=le.sub(he);else{let nt;const it=le.sub(he);nt=it.mag()===0?Pi(Jt(H+z,b,dt).sub(le),i,z):Pi(it,i,z),ce||(ce=he.add(nt)),$=_n(H,nt,le,m,y,ce,i,b,dt),Ae.push(ce),ke=$.sub(ce)}Te=ke.mag()}const De=ke._mult((we-xe)/Te)._add(ce||he),Qe=F+Math.atan2(le.y-he.y,le.x-he.x);return Ae.push(De),{point:De,angle:E?Qe:0,path:Ae}}const ti=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function bi(d,e){for(let i=0;i<d;i++){const l=e.length;e.resize(l+4),e.float32.set(ti,3*l)}}function Ln(d,e,i){const l=e[0],h=e[1];return d[0]=i[0]*l+i[4]*h+i[12],d[1]=i[1]*l+i[5]*h+i[13],d[3]=i[3]*l+i[7]*h+i[15],d}const Sr=100;class Cn{constructor(e,i=new Gt(e.width+200,e.height+200,25),l=new Gt(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=l,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Sr,this.screenBottomBoundary=e.height+Sr,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,i,l,h,m,y,b,E,P,z,F,N){const H=this.projectAndGetPerspectiveRatio(e.anchorPointX+E[0],e.anchorPointY+E[1],m,z,N),$=l*H.perspectiveRatio;let ce;if(y||b)ce=this._projectCollisionBox(e,$,h,m,y,b,E,H,z,F,N);else{const ke=H.x+(F?F.x*$:0),De=H.y+(F?F.y*$:0);ce={allPointsOccluded:!1,box:[ke+e.x1*$,De+e.y1*$,ke+e.x2*$,De+e.y2*$]}}const[le,he,xe,Te]=ce.box,we=y?ce.allPointsOccluded:H.isOccluded;let Ae=we;return Ae||(Ae=H.perspectiveRatio<this.perspectiveRatioCutoff),Ae||(Ae=!this.isInsideGrid(le,he,xe,Te)),Ae||i!=="always"&&this.grid.hitTest(le,he,xe,Te,i,P)?{box:[le,he,xe,Te],placeable:!1,offscreen:!1,occluded:we}:{box:[le,he,xe,Te],placeable:!0,offscreen:this.isOffscreen(le,he,xe,Te),occluded:we}}placeCollisionCircles(e,i,l,h,m,y,b,E,P,z,F,N,H,$){const ce=[],le=new c.P(i.anchorX,i.anchorY),he=this.getPerspectiveRatio(le.x,le.y,y,$),xe=(P?m*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,y)/he:m*he)/c.ay,Te={getElevation:$,pitchedLabelPlaneMatrix:b,lineVertexArray:l,pitchWithMap:P,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:le,unwrappedTileID:y,width:this.transform.width,height:this.transform.height,translation:H},we=We(xe,h,i.lineOffsetX*xe,i.lineOffsetY*xe,!1,i,!1,Te);let Ae=!1,ke=!1,De=!0;if(we){const Qe=.5*F*he+N,dt=new c.P(-100,-100),nt=new c.P(this.screenRightBoundary,this.screenBottomBoundary),it=new _t,ut=we.first,Zt=we.last;let Vt=[];for(let Rr=ut.path.length-1;Rr>=1;Rr--)Vt.push(ut.path[Rr]);for(let Rr=1;Rr<Zt.path.length;Rr++)Vt.push(Zt.path[Rr]);const St=2.5*Qe;if(P){const Rr=this.projectPathToScreenSpace(Vt,Te);Vt=Rr.some(Gr=>Gr.signedDistanceFromCamera<=0)?[]:Rr.map(Gr=>Gr.point)}let sr=[];if(Vt.length>0){const Rr=Vt[0].clone(),Gr=Vt[0].clone();for(let Hi=1;Hi<Vt.length;Hi++)Rr.x=Math.min(Rr.x,Vt[Hi].x),Rr.y=Math.min(Rr.y,Vt[Hi].y),Gr.x=Math.max(Gr.x,Vt[Hi].x),Gr.y=Math.max(Gr.y,Vt[Hi].y);sr=Rr.x>=dt.x&&Gr.x<=nt.x&&Rr.y>=dt.y&&Gr.y<=nt.y?[Vt]:Gr.x<dt.x||Rr.x>nt.x||Gr.y<dt.y||Rr.y>nt.y?[]:c.av([Vt],dt.x,dt.y,nt.x,nt.y)}for(const Rr of sr){it.reset(Rr,.25*Qe);let Gr=0;Gr=it.length<=.5*Qe?1:Math.ceil(it.paddedLength/St)+1;for(let Hi=0;Hi<Gr;Hi++){const Ti=Hi/Math.max(Gr-1,1),$i=it.lerp(Ti),Ni=$i.x+Sr,Mi=$i.y+Sr;ce.push(Ni,Mi,Qe,0);const ai=Ni-Qe,vn=Mi-Qe,In=Ni+Qe,Fn=Mi+Qe;if(De=De&&this.isOffscreen(ai,vn,In,Fn),ke=ke||this.isInsideGrid(ai,vn,In,Fn),e!=="always"&&this.grid.hitTestCircle(Ni,Mi,Qe,e,z)&&(Ae=!0,!E))return{circles:[],offscreen:!1,collisionDetected:Ae}}}}return{circles:!E&&Ae||!ke||he<this.perspectiveRatioCutoff?[]:ce,offscreen:De,collisionDetected:Ae}}projectPathToScreenSpace(e,i){const l=function(h,m){const y=c.K();return c.an(y,m.pitchedLabelPlaneMatrix),h.map(b=>{const E=O(b.x,b.y,y,m.getElevation),P=m.transform.projectTileCoordinates(E.point.x,E.point.y,m.unwrappedTileID,m.getElevation);return P.point.x=(.5*P.point.x+.5)*m.width,P.point.y=(.5*-P.point.y+.5)*m.height,P})}(e,i);return function(h){let m=0,y=0,b=0,E=0;for(let P=0;P<h.length;P++)h[P].isOccluded?(b=P+1,E=0):(E++,E>y&&(y=E,m=b));return h.slice(m,m+y)}(l)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[];let l=1/0,h=1/0,m=-1/0,y=-1/0;for(const z of e){const F=new c.P(z.x+Sr,z.y+Sr);l=Math.min(l,F.x),h=Math.min(h,F.y),m=Math.max(m,F.x),y=Math.max(y,F.y),i.push(F)}const b=this.grid.query(l,h,m,y).concat(this.ignoredGrid.query(l,h,m,y)),E={},P={};for(const z of b){const F=z.key;if(E[F.bucketInstanceId]===void 0&&(E[F.bucketInstanceId]={}),E[F.bucketInstanceId][F.featureIndex])continue;const N=[new c.P(z.x1,z.y1),new c.P(z.x2,z.y1),new c.P(z.x2,z.y2),new c.P(z.x1,z.y2)];c.aw(i,N)&&(E[F.bucketInstanceId][F.featureIndex]=!0,P[F.bucketInstanceId]===void 0&&(P[F.bucketInstanceId]=[]),P[F.bucketInstanceId].push(F.featureIndex))}return P}insertCollisionBox(e,i,l,h,m,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:y,overlapMode:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,i,l,h,m,y){const b=l?this.ignoredGrid:this.grid,E={bucketInstanceId:h,featureIndex:m,collisionGroupID:y,overlapMode:i};for(let P=0;P<e.length;P+=4)b.insertCircle(E,e[P],e[P+1],e[P+2])}projectAndGetPerspectiveRatio(e,i,l,h,m){if(m){let y;h?(y=[e,i,h(e,i),1],c.at(y,y,m)):(y=[e,i,0,1],Ln(y,y,m));const b=y[3];return{x:(y[0]/b+1)/2*this.transform.width+Sr,y:(-y[1]/b+1)/2*this.transform.height+Sr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b*.5,isOccluded:!1,signedDistanceFromCamera:b}}{const y=this.transform.projectTileCoordinates(e,i,l,h);return{x:(y.point.x+1)/2*this.transform.width+Sr,y:(1-y.point.y)/2*this.transform.height+Sr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5,isOccluded:y.isOccluded,signedDistanceFromCamera:y.signedDistanceFromCamera}}}getPerspectiveRatio(e,i,l,h){const m=this.transform.projectTileCoordinates(e,i,l,h);return .5+this.transform.cameraToCenterDistance/m.signedDistanceFromCamera*.5}isOffscreen(e,i,l,h){return l<Sr||e>=this.screenRightBoundary||h<Sr||i>this.screenBottomBoundary}isInsideGrid(e,i,l,h){return l>=0&&e<this.gridRightBoundary&&h>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const e=c.ad([]);return c.L(e,e,[-100,-100,0]),e}_projectCollisionBox(e,i,l,h,m,y,b,E,P,z,F){let N=1,H=0,$=0,ce=1;const le=e.anchorPointX+b[0],he=e.anchorPointY+b[1];if(y&&!m){const Vt=this.projectAndGetPerspectiveRatio(le+1,he,h,P,F),St=Vt.x-E.x,sr=Math.atan((Vt.y-E.y)/St)+(St<0?Math.PI:0),Rr=Math.sin(sr),Gr=Math.cos(sr);N=Gr,H=Rr,$=-Rr,ce=Gr}else if(!y&&m){const Vt=k(this.transform);N=Vt.vecEast[0],H=Vt.vecEast[1],$=Vt.vecSouth[0],ce=Vt.vecSouth[1]}let xe=E.x,Te=E.y,we=i;m&&(xe=le,Te=he,we=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),we*=this.transform.getPitchedTextCorrection(le,he,h),z||(we*=c.ae(.5+E.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),z&&(xe+=N*z.x*we+$*z.y*we,Te+=H*z.x*we+ce*z.y*we);const Ae=e.x1*we,ke=e.x2*we,De=(Ae+ke)/2,Qe=e.y1*we,dt=e.y2*we,nt=(Qe+dt)/2,it=[{offsetX:Ae,offsetY:Qe},{offsetX:De,offsetY:Qe},{offsetX:ke,offsetY:Qe},{offsetX:ke,offsetY:nt},{offsetX:ke,offsetY:dt},{offsetX:De,offsetY:dt},{offsetX:Ae,offsetY:dt},{offsetX:Ae,offsetY:nt}];let ut=[];for(const{offsetX:Vt,offsetY:St}of it)ut.push(new c.P(xe+N*Vt+$*St,Te+H*Vt+ce*St));let Zt=!1;if(m){const Vt=ut.map(St=>this.projectAndGetPerspectiveRatio(St.x,St.y,h,P,F));Zt=Vt.some(St=>!St.isOccluded),ut=Vt.map(St=>new c.P(St.x,St.y))}else Zt=!0;return{box:c.ax(ut),allPointsOccluded:!Zt}}}class Br{constructor(e,i,l,h){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?i:-i))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class ms{constructor(e,i,l,h,m){this.text=new Br(e?e.text:null,i,l,m),this.icon=new Br(e?e.icon:null,i,h,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Mn{constructor(e,i,l){this.text=e,this.icon=i,this.skipFade=l}}class js{constructor(e,i,l,h,m){this.bucketInstanceId=e,this.featureIndex=i,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=m}}class gs{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const i=++this.maxGroupID;this.collisionGroups[e]={ID:i,predicate:l=>l.collisionGroupID===i}}return this.collisionGroups[e]}}function Yn(d,e,i,l,h){const{horizontalAlign:m,verticalAlign:y}=c.aE(d);return new c.P(-(m-.5)*e+l[0]*h,-(y-.5)*i+l[1]*h)}class vo{constructor(e,i,l,h,m){this.transform=e.clone(),this.terrain=i,this.collisionIndex=new Cn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new gs(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const i=this.terrain;return i?(l,h)=>i.getElevation(e,l,h):null}getBucketParts(e,i,l,h){const m=l.getBucket(i),y=l.latestFeatureIndex;if(!m||!y||i.id!==m.layerIds[0])return;const b=l.collisionBoxArray,E=m.layers[0].layout,P=m.layers[0].paint,z=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),F=l.tileSize/c.Z,N=l.tileID.toUnwrapped(),H=E.get("text-rotation-alignment")==="map",$=c.az(l,1,this.transform.zoom),ce=c.aA(this.collisionIndex.transform,l,P.get("text-translate"),P.get("text-translate-anchor")),le=c.aA(this.collisionIndex.transform,l,P.get("icon-translate"),P.get("icon-translate-anchor")),he=tr(H,this.transform,$);this.retainedQueryData[m.bucketInstanceId]=new js(m.bucketInstanceId,y,m.sourceLayerIndex,m.index,l.tileID);const xe={bucket:m,layout:E,translationText:ce,translationIcon:le,unwrappedTileID:N,pitchedLabelPlaneMatrix:he,scale:z,textPixelRatio:F,holdingForFade:l.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:c.ak(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(h)for(const Te of m.sortKeyRanges){const{sortKey:we,symbolInstanceStart:Ae,symbolInstanceEnd:ke}=Te;e.push({sortKey:we,symbolInstanceStart:Ae,symbolInstanceEnd:ke,parameters:xe})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:xe})}attemptAnchorPlacement(e,i,l,h,m,y,b,E,P,z,F,N,H,$,ce,le,he,xe,Te,we){const Ae=c.aB[e.textAnchor],ke=[e.textOffset0,e.textOffset1],De=Yn(Ae,l,h,ke,m),Qe=this.collisionIndex.placeCollisionBox(i,N,E,P,z,b,y,le,F.predicate,Te,De,we);if((!xe||this.collisionIndex.placeCollisionBox(xe,N,E,P,z,b,y,he,F.predicate,Te,De,we).placeable)&&Qe.placeable){let dt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(dt=this.prevPlacement.variableOffsets[H.crossTileID].anchor),H.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[H.crossTileID]={textOffset:ke,width:l,height:h,anchor:Ae,textBoxScale:m,prevAnchor:dt},this.markUsedJustification($,Ae,H,ce),$.allowVerticalPlacement&&(this.markUsedOrientation($,ce,H),this.placedOrientations[H.crossTileID]=ce),{shift:De,placedGlyphBoxes:Qe}}}placeLayerBucketPart(e,i,l){const{bucket:h,layout:m,translationText:y,translationIcon:b,unwrappedTileID:E,pitchedLabelPlaneMatrix:P,textPixelRatio:z,holdingForFade:F,collisionBoxArray:N,partiallyEvaluatedTextSize:H,collisionGroup:$}=e.parameters,ce=m.get("text-optional"),le=m.get("icon-optional"),he=c.aC(m,"text-overlap","text-allow-overlap"),xe=he==="always",Te=c.aC(m,"icon-overlap","icon-allow-overlap"),we=Te==="always",Ae=m.get("text-rotation-alignment")==="map",ke=m.get("text-pitch-alignment")==="map",De=m.get("icon-text-fit")!=="none",Qe=m.get("symbol-z-order")==="viewport-y",dt=xe&&(we||!h.hasIconData()||le),nt=we&&(xe||!h.hasTextData()||ce);!h.collisionArrays&&N&&h.deserializeCollisionBoxes(N);const it=this.retainedQueryData[h.bucketInstanceId].tileID,ut=this._getTerrainElevationFunc(it),Zt=this.transform.getFastPathSimpleProjectionMatrix(it),Vt=(St,sr,Rr)=>{var Gr,Hi;if(i[St.crossTileID])return;if(F)return void(this.placements[St.crossTileID]=new Mn(!1,!1,!1));let Ti=!1,$i=!1,Ni=!0,Mi=null,ai={box:null,placeable:!1,offscreen:null,occluded:!1},vn={placeable:!1},In=null,Fn=null,si=null,zs=0,os=0,no=0;sr.textFeatureIndex?zs=sr.textFeatureIndex:St.useRuntimeCollisionCircles&&(zs=St.featureIndex),sr.verticalTextFeatureIndex&&(os=sr.verticalTextFeatureIndex);const ao=sr.textBox;if(ao){const Ia=rn=>{let xn=c.al.horizontal;if(h.allowVerticalPlacement&&!rn&&this.prevPlacement){const ra=this.prevPlacement.placedOrientations[St.crossTileID];ra&&(this.placedOrientations[St.crossTileID]=ra,xn=ra,this.markUsedOrientation(h,xn,St))}return xn},oo=(rn,xn)=>{if(h.allowVerticalPlacement&&St.numVerticalGlyphVertices>0&&sr.verticalTextBox){for(const ra of h.writingModes)if(ra===c.al.vertical?(ai=xn(),vn=ai):ai=rn(),ai&&ai.placeable)break}else ai=rn()},Pa=St.textAnchorOffsetStartIndex,Ls=St.textAnchorOffsetEndIndex;if(Ls===Pa){const rn=(xn,ra)=>{const Ei=this.collisionIndex.placeCollisionBox(xn,he,z,it,E,ke,Ae,y,$.predicate,ut,void 0,Zt);return Ei&&Ei.placeable&&(this.markUsedOrientation(h,ra,St),this.placedOrientations[St.crossTileID]=ra),Ei};oo(()=>rn(ao,c.al.horizontal),()=>{const xn=sr.verticalTextBox;return h.allowVerticalPlacement&&St.numVerticalGlyphVertices>0&&xn?rn(xn,c.al.vertical):{box:null,offscreen:null}}),Ia(ai&&ai.placeable)}else{let rn=c.aB[(Hi=(Gr=this.prevPlacement)===null||Gr===void 0?void 0:Gr.variableOffsets[St.crossTileID])===null||Hi===void 0?void 0:Hi.anchor];const xn=(Ei,Lu,gh)=>{const of=Ei.x2-Ei.x1,Yl=Ei.y2-Ei.y1,ml=St.textBoxScale,Po=De&&Te==="never"?Lu:null;let ia=null,Ra=he==="never"?1:2,za="never";rn&&Ra++;for(let ks=0;ks<Ra;ks++){for(let lo=Pa;lo<Ls;lo++){const uo=h.textAnchorOffsets.get(lo);if(rn&&uo.textAnchor!==rn)continue;const ba=this.attemptAnchorPlacement(uo,Ei,of,Yl,ml,Ae,ke,z,it,E,$,za,St,h,gh,y,b,Po,ut);if(ba&&(ia=ba.placedGlyphBoxes,ia&&ia.placeable))return Ti=!0,Mi=ba.shift,ia}rn?rn=null:za=he}return l&&!ia&&(ia={box:this.collisionIndex.placeCollisionBox(ao,"always",z,it,E,ke,Ae,y,$.predicate,ut,void 0,Zt).box,offscreen:!1,placeable:!1,occluded:!1}),ia};oo(()=>xn(ao,sr.iconBox,c.al.horizontal),()=>{const Ei=sr.verticalTextBox;return h.allowVerticalPlacement&&(!ai||!ai.placeable)&&St.numVerticalGlyphVertices>0&&Ei?xn(Ei,sr.verticalIconBox,c.al.vertical):{box:null,occluded:!0,offscreen:null}}),ai&&(Ti=ai.placeable,Ni=ai.offscreen);const ra=Ia(ai&&ai.placeable);if(!Ti&&this.prevPlacement){const Ei=this.prevPlacement.variableOffsets[St.crossTileID];Ei&&(this.variableOffsets[St.crossTileID]=Ei,this.markUsedJustification(h,Ei.anchor,St,ra))}}}if(In=ai,Ti=In&&In.placeable,Ni=In&&In.offscreen,St.useRuntimeCollisionCircles){const Ia=h.text.placedSymbolArray.get(St.centerJustifiedTextSymbolIndex),oo=c.am(h.textSizeData,H,Ia),Pa=m.get("text-padding");Fn=this.collisionIndex.placeCollisionCircles(he,Ia,h.lineVertexArray,h.glyphOffsetArray,oo,E,P,l,ke,$.predicate,St.collisionCircleDiameter,Pa,y,ut),Fn.circles.length&&Fn.collisionDetected&&!l&&c.w("Collisions detected, but collision boxes are not shown"),Ti=xe||Fn.circles.length>0&&!Fn.collisionDetected,Ni=Ni&&Fn.offscreen}if(sr.iconFeatureIndex&&(no=sr.iconFeatureIndex),sr.iconBox){const Ia=oo=>this.collisionIndex.placeCollisionBox(oo,Te,z,it,E,ke,Ae,b,$.predicate,ut,De&&Mi?Mi:void 0,Zt);vn&&vn.placeable&&sr.verticalIconBox?(si=Ia(sr.verticalIconBox),$i=si.placeable):(si=Ia(sr.iconBox),$i=si.placeable),Ni=Ni&&si.offscreen}const Xl=ce||St.numHorizontalGlyphVertices===0&&St.numVerticalGlyphVertices===0,so=le||St.numIconVertices===0;Xl||so?so?Xl||($i=$i&&Ti):Ti=$i&&Ti:$i=Ti=$i&&Ti;const pl=$i&&si.placeable;if(Ti&&In.placeable&&this.collisionIndex.insertCollisionBox(In.box,he,m.get("text-ignore-placement"),h.bucketInstanceId,vn&&vn.placeable&&os?os:zs,$.ID),pl&&this.collisionIndex.insertCollisionBox(si.box,Te,m.get("icon-ignore-placement"),h.bucketInstanceId,no,$.ID),Fn&&Ti&&this.collisionIndex.insertCollisionCircles(Fn.circles,he,m.get("text-ignore-placement"),h.bucketInstanceId,zs,$.ID),l&&this.storeCollisionData(h.bucketInstanceId,Rr,sr,In,si,Fn),St.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[St.crossTileID]=new Mn((Ti||dt)&&!(In!=null&&In.occluded),($i||nt)&&!(si!=null&&si.occluded),Ni||h.justReloaded),i[St.crossTileID]=!0};if(Qe){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const St=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let sr=St.length-1;sr>=0;--sr){const Rr=St[sr];Vt(h.symbolInstances.get(Rr),h.collisionArrays[Rr],Rr)}}else for(let St=e.symbolInstanceStart;St<e.symbolInstanceEnd;St++)Vt(h.symbolInstances.get(St),h.collisionArrays[St],St);h.justReloaded=!1}storeCollisionData(e,i,l,h,m,y){if(l.textBox||l.iconBox){let b,E;this.collisionBoxArrays.has(e)?b=this.collisionBoxArrays.get(e):(b=new Map,this.collisionBoxArrays.set(e,b)),b.has(i)?E=b.get(i):(E={text:null,icon:null},b.set(i,E)),l.textBox&&(E.text=h.box),l.iconBox&&(E.icon=m.box)}if(y){let b=this.collisionCircleArrays[e];b===void 0&&(b=this.collisionCircleArrays[e]=[]);for(let E=0;E<y.circles.length;E+=4)b.push(y.circles[E+0]-Sr),b.push(y.circles[E+1]-Sr),b.push(y.circles[E+2]),b.push(y.collisionDetected?1:0)}}markUsedJustification(e,i,l,h){let m;m=h===c.al.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[c.aD(i)];const y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const b of y)b>=0&&(e.text.placedSymbolArray.get(b).crossTileID=m>=0&&b!==m?0:l.crossTileID)}markUsedOrientation(e,i,l){const h=i===c.al.horizontal||i===c.al.horizontalOnly?i:0,m=i===c.al.vertical?i:0,y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const b of y)e.text.placedSymbolArray.get(b).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let l=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const h=i?i.symbolFadeChange(e):1,m=i?i.opacities:{},y=i?i.variableOffsets:{},b=i?i.placedOrientations:{};for(const E in this.placements){const P=this.placements[E],z=m[E];z?(this.opacities[E]=new ms(z,h,P.text,P.icon),l=l||P.text!==z.text.placed||P.icon!==z.icon.placed):(this.opacities[E]=new ms(null,h,P.text,P.icon,P.skipFade),l=l||P.text||P.icon)}for(const E in m){const P=m[E];if(!this.opacities[E]){const z=new ms(P,h,!1,!1);z.isHidden()||(this.opacities[E]=z,l=l||P.text.placed||P.icon.placed)}}for(const E in y)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=y[E]);for(const E in b)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=b[E]);if(i&&i.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:e)}updateLayerOpacities(e,i){const l={};for(const h of i){const m=h.getBucket(e);m&&h.latestFeatureIndex&&e.id===m.layerIds[0]&&this.updateBucketOpacities(m,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(e,i,l,h){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const m=e.layers[0],y=m.layout,b=new ms(null,0,!1,!1,!0),E=y.get("text-allow-overlap"),P=y.get("icon-allow-overlap"),z=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),F=y.get("text-rotation-alignment")==="map",N=y.get("text-pitch-alignment")==="map",H=y.get("icon-text-fit")!=="none",$=new ms(null,0,E&&(P||!e.hasIconData()||y.get("icon-optional")),P&&(E||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&h&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(h);const ce=(he,xe,Te)=>{for(let we=0;we<xe/4;we++)he.opacityVertexArray.emplaceBack(Te);he.hasVisibleVertices=he.hasVisibleVertices||Te!==kt},le=this.collisionBoxArrays.get(e.bucketInstanceId);for(let he=0;he<e.symbolInstances.length;he++){const xe=e.symbolInstances.get(he),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:we,crossTileID:Ae}=xe;let ke=this.opacities[Ae];l[Ae]?ke=b:ke||(ke=$,this.opacities[Ae]=ke),l[Ae]=!0;const De=xe.numIconVertices>0,Qe=this.placedOrientations[xe.crossTileID],dt=Qe===c.al.vertical,nt=Qe===c.al.horizontal||Qe===c.al.horizontalOnly;if(Te>0||we>0){const ut=Tt(ke.text);ce(e.text,Te,dt?kt:ut),ce(e.text,we,nt?kt:ut);const Zt=ke.text.isHidden();[xe.rightJustifiedTextSymbolIndex,xe.centerJustifiedTextSymbolIndex,xe.leftJustifiedTextSymbolIndex].forEach(sr=>{sr>=0&&(e.text.placedSymbolArray.get(sr).hidden=Zt||dt?1:0)}),xe.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(xe.verticalPlacedTextSymbolIndex).hidden=Zt||nt?1:0);const Vt=this.variableOffsets[xe.crossTileID];Vt&&this.markUsedJustification(e,Vt.anchor,xe,Qe);const St=this.placedOrientations[xe.crossTileID];St&&(this.markUsedJustification(e,"left",xe,St),this.markUsedOrientation(e,St,xe))}if(De){const ut=Tt(ke.icon),Zt=!(H&&xe.verticalPlacedIconSymbolIndex&&dt);xe.placedIconSymbolIndex>=0&&(ce(e.icon,xe.numIconVertices,Zt?ut:kt),e.icon.placedSymbolArray.get(xe.placedIconSymbolIndex).hidden=ke.icon.isHidden()),xe.verticalPlacedIconSymbolIndex>=0&&(ce(e.icon,xe.numVerticalIconVertices,Zt?kt:ut),e.icon.placedSymbolArray.get(xe.verticalPlacedIconSymbolIndex).hidden=ke.icon.isHidden())}const it=le&&le.has(he)?le.get(he):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const ut=e.collisionArrays[he];if(ut){let Zt=new c.P(0,0);if(ut.textBox||ut.verticalTextBox){let Vt=!0;if(z){const St=this.variableOffsets[Ae];St?(Zt=Yn(St.anchor,St.width,St.height,St.textOffset,St.textBoxScale),F&&Zt._rotate(N?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Vt=!1}if(ut.textBox||ut.verticalTextBox){let St;ut.textBox&&(St=dt),ut.verticalTextBox&&(St=nt),Vo(e.textCollisionBox.collisionVertexArray,ke.text.placed,!Vt||St,it.text,Zt.x,Zt.y)}}if(ut.iconBox||ut.verticalIconBox){const Vt=!!(!nt&&ut.verticalIconBox);let St;ut.iconBox&&(St=Vt),ut.verticalIconBox&&(St=!Vt),Vo(e.iconCollisionBox.collisionVertexArray,ke.icon.placed,St,it.icon,H?Zt.x:0,H?Zt.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,i){const l=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function Vo(d,e,i,l,h,m){l&&l.length!==0||(l=[0,0,0,0]);const y=l[0]-Sr,b=l[1]-Sr,E=l[2]-Sr,P=l[3]-Sr;d.emplaceBack(e?1:0,i?1:0,h||0,m||0,y,b),d.emplaceBack(e?1:0,i?1:0,h||0,m||0,E,b),d.emplaceBack(e?1:0,i?1:0,h||0,m||0,E,P),d.emplaceBack(e?1:0,i?1:0,h||0,m||0,y,P)}const Yu=Math.pow(2,25),ie=Math.pow(2,24),Ce=Math.pow(2,17),pe=Math.pow(2,16),Ve=Math.pow(2,9),$e=Math.pow(2,8),Ue=Math.pow(2,1);function Tt(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const e=d.placed?1:0,i=Math.floor(127*d.opacity);return i*Yu+e*ie+i*Ce+e*pe+i*Ve+e*$e+i*Ue+e}const kt=0;class Bt{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,i,l,h,m){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(i.getBucketParts(y,h,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((b,E)=>b.sortKey-E.sortKey));this._currentPartIndex<y.length;)if(i.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,m())return!0;return!1}}class qt{constructor(e,i,l,h,m,y,b,E){this.placement=new vo(e,i,y,b,E),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(e,i,l){const h=_e.now(),m=()=>!this._forceFullPlacement&&_e.now()-h>2;for(;this._currentPlacementIndex>=0;){const y=i[e[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=b)&&(!y.maxzoom||y.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new Bt(y)),this._inProgressLayer.continuePlacement(l[y.source],this.placement,this._showCollisionBoxes,y,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Ht=512/c.Z/2;class ur{constructor(e,i,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let m=0;m<i.length;m++){const y=i.get(m),b=y.key,E=h.get(b);E?E.push(y):h.set(b,[y])}for(const[m,y]of h){const b={positions:y.map(E=>({x:Math.floor(E.anchorX*Ht),y:Math.floor(E.anchorY*Ht)})),crossTileIDs:y.map(E=>E.crossTileID)};if(b.positions.length>128){const E=new c.aF(b.positions.length,16,Uint16Array);for(const{x:P,y:z}of b.positions)E.add(P,z);E.finish(),delete b.positions,b.index=E}this._symbolsByKey[m]=b}}getScaledCoordinates(e,i){const{x:l,y:h,z:m}=this.tileID.canonical,{x:y,y:b,z:E}=i.canonical,P=Ht/Math.pow(2,E-m),z=(b*c.Z+e.anchorY)*P,F=h*c.Z*Ht;return{x:Math.floor((y*c.Z+e.anchorX)*P-l*c.Z*Ht),y:Math.floor(z-F)}}findMatches(e,i,l){const h=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z);for(let m=0;m<e.length;m++){const y=e.get(m);if(y.crossTileID)continue;const b=this._symbolsByKey[y.key];if(!b)continue;const E=this.getScaledCoordinates(y,i);if(b.index){const P=b.index.range(E.x-h,E.y-h,E.x+h,E.y+h).sort();for(const z of P){const F=b.crossTileIDs[z];if(!l[F]){l[F]=!0,y.crossTileID=F;break}}}else if(b.positions)for(let P=0;P<b.positions.length;P++){const z=b.positions[P],F=b.crossTileIDs[P];if(Math.abs(z.x-E.x)<=h&&Math.abs(z.y-E.y)<=h&&!l[F]){l[F]=!0,y.crossTileID=F;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ir{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class $r{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const i=Math.round((e-this.lng)/360);if(i!==0)for(const l in this.indexes){const h=this.indexes[l],m={};for(const y in h){const b=h[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+i),m[b.tileID.key]=b}this.indexes[l]=m}this.lng=e}addBucket(e,i,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let m=0;m<i.symbolInstances.length;m++)i.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const h=this.usedCrossTileIDs[e.overscaledZ];for(const m in this.indexes){const y=this.indexes[m];if(Number(m)>e.overscaledZ)for(const b in y){const E=y[b];E.tileID.isChildOf(e)&&E.findMatches(i.symbolInstances,e,h)}else{const b=y[e.scaledTo(Number(m)).key];b&&b.findMatches(i.symbolInstances,e,h)}}for(let m=0;m<i.symbolInstances.length;m++){const y=i.symbolInstances.get(m);y.crossTileID||(y.crossTileID=l.generate(),h[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new ur(e,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(e,i){for(const l of i.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[e][h]}removeStaleBuckets(e){let i=!1;for(const l in this.indexes){const h=this.indexes[l];for(const m in h)e[h[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[m]),delete h[m],i=!0)}return i}}class Qr{constructor(){this.layerIndexes={},this.crossTileIDs=new Ir,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,i,l){let h=this.layerIndexes[e.id];h===void 0&&(h=this.layerIndexes[e.id]=new $r);let m=!1;const y={};h.handleWrapJump(l);for(const b of i){const E=b.getBucket(e);E&&e.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(b.tileID,E,this.crossTileIDs)&&(m=!0),y[E.bucketInstanceId]=!0)}return h.removeStaleBuckets(y)&&(m=!0),m}pruneUnusedLayers(e){const i={};e.forEach(l=>{i[l]=!0});for(const l in this.layerIndexes)i[l]||delete this.layerIndexes[l]}}var wi="void main() {fragColor=vec4(1.0);}";const Xr={prelude:wr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:wr("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:wr("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:wr(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:wr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:wr(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:wr(wi,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:wr(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:wr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:wr("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:wr("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:wr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:wr(wi,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:wr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:wr(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:wr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:wr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:wr(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:wr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:wr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wr(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;switch(u_method){case BASIC:
basic_hillshade(deriv);break;case COMBINED:
combined_hillshade(deriv);break;case IGOR:
igor_hillshade(deriv);break;case MULTIDIRECTIONAL:
multidirectional_hillshade(deriv);break;case STANDARD:
default:
standard_hillshade(deriv);break;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:wr(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:wr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:wr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:wr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:wr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:wr(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:wr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:wr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:wr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:wr("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:wr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:wr("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:wr(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:wr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function wr(d,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/in ([\w]+) ([\w]+)/g),h=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=m?m.concat(h):h,b={};return{fragmentSource:d=d.replace(i,(E,P,z,F,N)=>(b[N]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${z} ${F} ${N};
#else
uniform ${z} ${F} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${z} ${F} ${N} = u_${N};
#endif
`)),vertexSource:e=e.replace(i,(E,P,z,F,N)=>{const H=F==="float"?"vec2":"vec4",$=N.match(/color/)?"color":H;return b[N]?P==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${z} ${H} a_${N};
out ${z} ${F} ${N};
#else
uniform ${z} ${F} u_${N};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${z} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${$}(a_${N}, u_${N}_t);
#else
    ${z} ${F} ${N} = u_${N};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${z} ${H} a_${N};
#else
uniform ${z} ${F} u_${N};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${z} ${F} ${N} = a_${N};
#else
    ${z} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${z} ${F} ${N} = unpack_mix_${$}(a_${N}, u_${N}_t);
#else
    ${z} ${F} ${N} = u_${N};
#endif
`}),staticAttributes:l,staticUniforms:y}}class Sa{constructor(e,i,l){this.vertexBuffer=e,this.indexBuffer=i,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var yn=c.aG([{name:"a_pos",type:"Int16",components:2}]);const Us="#define PROJECTION_MERCATOR",Or="mercator";class Vs{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Or}get shaderDefine(){return Us}get shaderPreludeCode(){return Xr.projectionMercator}get vertexShaderPreludeCode(){return Xr.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aH.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,i,l,h,m){if(this._cachedMesh)return this._cachedMesh;const y=new c.aI;y.emplaceBack(0,0),y.emplaceBack(c.Z,0),y.emplaceBack(0,c.Z),y.emplaceBack(c.Z,c.Z);const b=e.createVertexBuffer(y,yn.members),E=c.aJ.simpleSegment(0,0,4,2),P=new c.aK;P.emplaceBack(1,0,2),P.emplaceBack(1,2,3);const z=e.createIndexBuffer(P);return this._cachedMesh=new Sa(b,z,E),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class qs{constructor(e=0,i=0,l=0,h=0){if(isNaN(e)||e<0||isNaN(i)||i<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=i,this.left=l,this.right=h}interpolate(e,i,l){return i.top!=null&&e.top!=null&&(this.top=c.B.number(e.top,i.top,l)),i.bottom!=null&&e.bottom!=null&&(this.bottom=c.B.number(e.bottom,i.bottom,l)),i.left!=null&&e.left!=null&&(this.left=c.B.number(e.left,i.left,l)),i.right!=null&&e.right!=null&&(this.right=c.B.number(e.right,i.right,l)),this}getCenter(e,i){const l=c.ae((this.left+e-this.right)/2,0,e),h=c.ae((this.top+i-this.bottom)/2,0,i);return new c.P(l,h)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new qs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function _s(d,e){if(!d.renderWorldCopies||d.lngRange)return;const i=e.lng-d.center.lng;e.lng+=i>180?-360:i<-180?360:0}function on(d){return Math.max(0,Math.floor(d))}class ln{constructor(e,i,l,h,m,y){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=i||0,this._maxZoom=l||22,this._minPitch=h??0,this._maxPitch=m??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=on(this._zoom),this._scale=c.ac(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new qs,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,i,l){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=on(this._zoom),this._scale=c.ac(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new qs(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!l&&e.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const i=c.aL(e,-180,180)*Math.PI/180;var l,h,m,y,b,E,P,z,F;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=K(),l=this._rotationMatrix,m=-this._bearingInRadians,y=(h=this._rotationMatrix)[0],b=h[1],E=h[2],P=h[3],z=Math.sin(m),F=Math.cos(m),l[0]=y*F+E*z,l[1]=b*F+P*z,l[2]=y*-z+E*F,l[3]=b*-z+P*F)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const i=c.ae(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const i=e/180*Math.PI;this._rollInRadians!==i&&(this._unmodified=!1,this._rollInRadians=i,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aM(this._fovInRadians)}setFov(e){e=c.ae(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=c.ab(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const i=this.getConstrained(this._center,e).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=c.ac(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,i){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=i,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,i,l){this._unmodified=!1,this._edgeInsets.interpolate(e,i,l),this._constrain(),this._calcMatrices()}resize(e,i,l=!0){this._width=e,this._height=i,l&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Dr([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,c.af])}getConstrained(e,i){return this._callbacks.getConstrained(e,i)}getCameraQueryGeometry(e,i){if(i.length===1)return[i[0],e];{let l=e.x,h=e.y,m=e.x,y=e.y;for(const b of i)l=Math.min(l,b.x),h=Math.min(h,b.y),m=Math.max(m,b.x),y=Math.max(y,b.y);return[new c.P(l,h),new c.P(m,h),new c.P(m,y),new c.P(l,y),new c.P(l,h)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:i,zoom:l}=this.getConstrained(this.center,this.zoom);this.setCenter(i),this.setZoom(l),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=c.ad(new Float64Array(16));c.M(e,e,[this._width/2,-this._height/2,1]),c.L(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=c.ad(new Float64Array(16)),c.M(e,e,[1,-1,1]),c.L(e,e,[-1,-1,0]),c.M(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,i,l,h){const m=l!==void 0?l:this.bearing,y=h=h!==void 0?h:this.pitch,b=c.$.fromLngLat(e,i),E=-Math.cos(c.ab(y)),P=Math.sin(c.ab(y)),z=P*Math.sin(c.ab(m)),F=-P*Math.cos(c.ab(m));let N=this.elevation;const H=i-N;let $;E*H>=0||Math.abs(E)<.1?($=1e4,N=i+$*E):$=-H/E;let ce,le,he=c.aN(1,b.y),xe=0;do{if(xe+=1,xe>10)break;le=$/he,ce=new c.$(b.x+z*le,b.y+F*le),he=1/ce.meterInMercatorCoordinateUnits()}while(Math.abs($-le*he)>1e-12);return{center:ce.toLngLat(),elevation:N,zoom:c.ah(this.height/2/Math.tan(this.fovInRadians/2)/le/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const i=c.ag(1,this.center.lat)*this.worldSize,l=this.cameraToCenterDistance/i,h=c.$.fromLngLat(this.center,this.elevation),m=Q(this.center,this.elevation,this.pitch,this.bearing,l);this._elevation=e;const y=this.calculateCenterFromCameraLngLatAlt(m.toLngLat(),c.aN(m.z,h.y),this.bearing,this.pitch);this._elevation=y.elevation,this._center=y.center,this.setZoom(y.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=c.ag(1,this.center.lat)*this.worldSize;return Q(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const i=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/i,e.canonical.y/i,1/i/c.Z,1/i/c.Z]}}class un{constructor(e,i){this.min=e,this.max=i,this.center=c.aO([],c.aP([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],l=c.aQ(this.min),h=c.aQ(this.max);for(let m=0;m<i.length;m++)l[m]=i[m]?this.min[m]:this.center[m],h[m]=i[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new un(l,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let i=!0;for(let l=0;l<e.planes.length;l++){const h=this.intersectsPlane(e.planes[l]);if(h===0)return 0;h===1&&(i=!1)}return i?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let i=e[3],l=e[3];for(let h=0;h<3;h++)e[h]>0?(i+=e[h]*this.min[h],l+=e[h]*this.max[h]):(l+=e[h]*this.min[h],i+=e[h]*this.max[h]);return i>=0?2:l<0?0:1}}class Dn{distanceToTile2d(e,i,l,h){const m=h.distanceX([e,i]),y=h.distanceY([e,i]);return Math.hypot(m,y)}getWrap(e,i,l){return l}getTileAABB(e,i,l,h){var m,y;let b=l,E=l;if(h.terrain){const z=new c.Y(e.z,i,e.z,e.x,e.y),F=h.terrain.getMinMaxElevation(z);b=(m=F.minElevation)!==null&&m!==void 0?m:l,E=(y=F.maxElevation)!==null&&y!==void 0?y:l}const P=1<<e.z;return new un([i+e.x/P,e.y/P,b],[i+(e.x+1)/P,(e.y+1)/P,E])}allowVariableZoom(e,i){const l=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,h=c.ae(78.5-l/2,0,60);return!!i.terrain||e.pitch>h}allowWorldCopies(){return!0}recalculateCache(){}}class Ri{constructor(e,i,l){this.points=e,this.planes=i,this.aabb=l}static fromInvProjectionMatrix(e,i=1,l=0){const h=Math.pow(2,l),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const z=1/(P=c.at([],P,e))[3]/i*h;return c.aR(P,P,[z,z,1/P[3],z])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const z=c.aS([],m[P[0]],m[P[1]]),F=c.aS([],m[P[2]],m[P[1]]),N=c.aT([],c.aU([],z,F)),H=-c.aV(N,m[P[1]]);return N.concat(H)}),b=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],E=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const P of m)for(let z=0;z<3;z++)b[z]=Math.min(b[z],P[z]),E[z]=Math.max(E[z],P[z]);return new Ri(m,y,new un(b,E))}}class ys{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,l){return this._helper.interpolatePadding(e,i,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,l=!0){this._helper.resize(e,i,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,i){}constructor(e,i,l,h,m){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new ln({calcMatrices:()=>{this._calcMatrices()},getConstrained:(y,b)=>this.getConstrained(y,b)},e,i,l,h,m),this._coveringTilesDetailsProvider=new Dn}clone(){const e=new ys;return e.apply(this),e}apply(e,i,l){this._helper.apply(e,i,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const i=[new c.aW(0,e)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new c.P(0,0)),h=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),m=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),y=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),b=Math.floor(Math.min(l.x,h.x,m.x,y.x)),E=Math.floor(Math.max(l.x,h.x,m.x,y.x)),P=1;for(let z=b-P;z<=E+P;z++)z!==0&&i.push(new c.aW(z,e))}return i}getCameraFrustum(){return Ri.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const i=this.screenPointToLocation(this.centerPoint,e),l=e?e.getElevationForLngLatZoom(i,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(e,i){const l=c.ag(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(i,l),m=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),y=c.$.fromLngLat(e),b=new c.$(y.x-(h.x-m.x),y.y-(h.y-m.y));this.setCenter(b==null?void 0:b.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,i){return i?this.coordinatePoint(c.$.fromLngLat(e),i.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(c.$.fromLngLat(e))}screenPointToLocation(e,i){var l;return(l=this.screenPointToMercatorCoordinate(e,i))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(e,i){if(i){const l=i.pointCoordinate(e);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,i){const l=i||0,h=[e.x,e.y,0,1],m=[e.x,e.y,1,1];c.at(h,h,this._pixelMatrixInverse),c.at(m,m,this._pixelMatrixInverse);const y=h[3],b=m[3],E=h[1]/y,P=m[1]/b,z=h[2]/y,F=m[2]/b,N=z===F?0:(l-z)/(F-z);return new c.$(c.B.number(h[0]/y,m[0]/b,N)/this.worldSize,c.B.number(E,P,N)/this.worldSize,l)}coordinatePoint(e,i=0,l=this._pixelMatrix){const h=[e.x*this.worldSize,e.y*this.worldSize,i,1];return c.at(h,h,l),new c.P(h[0]/h[3],h[1]/h[3])}getBounds(){const e=Math.max(0,this._helper._height/2-Ne(this));return new Dr().extend(this.screenPointToLocation(new c.P(0,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(e,i){return i?i.pointCoordinate(e)!=null:e.y>this.height/2-Ne(this)}calculatePosMatrix(e,i=!1,l){var h;const m=(h=e.key)!==null&&h!==void 0?h:c.aX(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),y=i?this._alignedPosMatrixCache:this._posMatrixCache;if(y.has(m)){const P=y.get(m);return l?P.f32:P.f64}const b=W(e,this.worldSize);c.N(b,i?this._alignedProjMatrix:this._viewProjMatrix,b);const E={f64:b,f32:new Float32Array(b)};return y.set(m,E),l?E.f32:E.f64}calculateFogMatrix(e){const i=e.key,l=this._fogMatrixCacheF32;if(l.has(i))return l.get(i);const h=W(e,this.worldSize);return c.N(h,this._fogMatrix,h),l.set(i,new Float32Array(h)),l.get(i)}getConstrained(e,i){i=c.ae(+i,this.minZoom,this.maxZoom);const l={center:new c.Q(e.lng,e.lat),zoom:i};let h=this._helper._lngRange;this._helper._renderWorldCopies||h!==null||(h=[-179.9999999999,180-1e-10]);const m=this.tileSize*c.ac(l.zoom);let y=0,b=m,E=0,P=m,z=0,F=0;const{x:N,y:H}=this.size;if(this._helper._latRange){const Te=this._helper._latRange;y=c.S(Te[1])*m,b=c.S(Te[0])*m,b-y<H&&(z=H/(b-y))}h&&(E=c.aL(c.U(h[0])*m,0,m),P=c.aL(c.U(h[1])*m,0,m),P<E&&(P+=m),P-E<N&&(F=N/(P-E)));const{x:$,y:ce}=Ur(m,e);let le,he;const xe=Math.max(F||0,z||0);if(xe){const Te=new c.P(F?(P+E)/2:$,z?(b+y)/2:ce);return l.center=li(m,Te).wrap(),l.zoom+=c.ah(xe),l}if(this._helper._latRange){const Te=H/2;ce-Te<y&&(he=y+Te),ce+Te>b&&(he=b-Te)}if(h){const Te=(E+P)/2;let we=$;this._helper._renderWorldCopies&&(we=c.aL($,Te-m/2,Te+m/2));const Ae=N/2;we-Ae<E&&(le=E+Ae),we+Ae>P&&(le=P-Ae)}if(le!==void 0||he!==void 0){const Te=new c.P(le??$,he??ce);l.center=li(m,Te).wrap()}return l}calculateCenterFromCameraLngLatAlt(e,i,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,l,h)}_calculateNearFarZIfNeeded(e,i,l){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),m=e-h*this._helper._pixelPerMeter/Math.cos(i),y=h<0?m:e,b=Math.PI/2+this.pitchInRadians,E=c.ab(this.fov)*(Math.abs(Math.cos(c.ab(this.roll)))*this.height+Math.abs(Math.sin(c.ab(this.roll)))*this.width)/this.height*(.5+l.y/this.height),P=Math.sin(E)*y/Math.sin(c.ae(Math.PI-b-E,.01,Math.PI-.01)),z=Ne(this),F=Math.atan(z/this._helper.cameraToCenterDistance),N=c.ab(.75),H=F>N?2*F*(.5+l.y/(2*z)):N,$=Math.sin(H)*y/Math.sin(c.ae(Math.PI-b-H,.01,Math.PI-.01)),ce=Math.min(P,$);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*ce+y),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,i=Ur(this.worldSize,this.center),l=i.x,h=i.y;this._helper._pixelPerMeter=c.ag(1,this.center.lat)*this.worldSize;const m=c.ab(Math.min(this.pitch,Zr)),y=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(m));let b;this._calculateNearFarZIfNeeded(y,m,e),b=new Float64Array(16),c.aY(b,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.an(this._invProjMatrix,b),b[8]=2*-e.x/this._helper._width,b[9]=2*e.y/this._helper._height,this._projectionMatrix=c.aZ(b),c.M(b,b,[1,-1,1]),c.L(b,b,[0,0,-this._helper.cameraToCenterDistance]),c.a_(b,b,-this.rollInRadians),c.a$(b,b,this.pitchInRadians),c.a_(b,b,-this.bearingInRadians),c.L(b,b,[-l,-h,0]),this._mercatorMatrix=c.M([],b,[this.worldSize,this.worldSize,this.worldSize]),c.M(b,b,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,b),c.L(b,b,[0,0,-this.elevation]),this._viewProjMatrix=b,this._invViewProjMatrix=c.an([],b);const E=[0,0,-1,1];c.at(E,E,this._invViewProjMatrix),this._cameraPosition=[E[0]/E[3],E[1]/E[3],E[2]/E[3]],this._fogMatrix=new Float64Array(16),c.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,y,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,c.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.L(this._fogMatrix,this._fogMatrix,[-l,-h,0]),c.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,b);const P=this._helper._width%2/2,z=this._helper._height%2/2,F=Math.cos(this.bearingInRadians),N=Math.sin(-this.bearingInRadians),H=l-Math.round(l)+F*P+N*z,$=h-Math.round(h)+F*z+N*P,ce=new Float64Array(b);if(c.L(ce,ce,[H>.5?H-1:H,$>.5?$-1:$,0]),this._alignedProjMatrix=ce,b=c.an(new Float64Array(16),this._pixelMatrix),!b)throw new Error("failed to invert matrix");this._pixelMatrixInverse=b,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new c.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.at(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=c.ag(1,this.center.lat)*this.worldSize;return Q(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,i){const l=c.$.fromLngLat(e),h=[l.x*this.worldSize,l.y*this.worldSize,i,1];return c.at(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(e){const{overscaledTileID:i,aligned:l,applyTerrainMatrix:h}=e,m=this._helper.getMercatorTileCoordinates(i),y=i?this.calculatePosMatrix(i,l,!0):null;let b;return b=i&&i.terrainRttPosMatrix32f&&h?i.terrainRttPosMatrix32f:y||c.b0(),{mainMatrix:b,tileMercatorCoords:m,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:b}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,i,l){return 1}transformLightDirection(e){return c.aQ(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,i,l,h){const m=this.calculatePosMatrix(l);let y;h?(y=[e,i,h(e,i),1],c.at(y,y,m)):(y=[e,i,0,1],Ln(y,y,m));const b=y[3];return{point:new c.P(y[0]/b,y[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}populateCache(e){for(const i of e)this.calculatePosMatrix(i)}getMatrixForModel(e,i){const l=c.$.fromLngLat(e,i),h=l.meterInMercatorCoordinateUnits(),m=c.b1();return c.L(m,m,[l.x,l.y,l.z]),c.a_(m,m,Math.PI),c.a$(m,m,Math.PI/2),c.M(m,m,[-h,h,h]),m}getProjectionDataForCustomLayer(e=!0){const i=new c.Y(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:e}),h=W(i,this.worldSize);c.N(h,this._viewProjMatrix,h),l.tileMercatorCoords=[0,0,1,1];const m=[c.Z,c.Z,this.worldSize/this._helper.pixelsPerMeter],y=c.b2();return c.M(y,h,m),l.fallbackMatrix=y,l.mainMatrix=y,l}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function en(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function ua(d){if(d.useSlerp)if(d.k<1){const e=c.b3(d.startEulerAngles.roll,d.startEulerAngles.pitch,d.startEulerAngles.bearing),i=c.b3(d.endEulerAngles.roll,d.endEulerAngles.pitch,d.endEulerAngles.bearing),l=new Float64Array(4);c.b4(l,e,i,d.k);const h=c.b5(l);d.tr.setRoll(h.roll),d.tr.setPitch(h.pitch),d.tr.setBearing(h.bearing)}else d.tr.setRoll(d.endEulerAngles.roll),d.tr.setPitch(d.endEulerAngles.pitch),d.tr.setBearing(d.endEulerAngles.bearing);else d.tr.setRoll(c.B.number(d.startEulerAngles.roll,d.endEulerAngles.roll,d.k)),d.tr.setPitch(c.B.number(d.startEulerAngles.pitch,d.endEulerAngles.pitch,d.k)),d.tr.setBearing(c.B.number(d.startEulerAngles.bearing,d.endEulerAngles.bearing,d.k))}function kn(d,e,i,l,h){const m=h.padding,y=Ur(h.worldSize,i.getNorthWest()),b=Ur(h.worldSize,i.getNorthEast()),E=Ur(h.worldSize,i.getSouthEast()),P=Ur(h.worldSize,i.getSouthWest()),z=c.ab(-l),F=y.rotate(z),N=b.rotate(z),H=E.rotate(z),$=P.rotate(z),ce=new c.P(Math.max(F.x,N.x,$.x,H.x),Math.max(F.y,N.y,$.y,H.y)),le=new c.P(Math.min(F.x,N.x,$.x,H.x),Math.min(F.y,N.y,$.y,H.y)),he=ce.sub(le),xe=(h.width-(m.left+m.right+e.left+e.right))/he.x,Te=(h.height-(m.top+m.bottom+e.top+e.bottom))/he.y;if(Te<0||xe<0)return void en();const we=Math.min(c.ah(h.scale*Math.min(xe,Te)),d.maxZoom),Ae=c.P.convert(d.offset),ke=new c.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(c.ab(l)),De=Ae.add(ke).mult(h.scale/c.ac(we));return{center:li(h.worldSize,y.add(E).div(2).sub(De)),zoom:we,bearing:l}}class Ua{get useGlobeControls(){return!1}handlePanInertia(e,i){return{easingOffset:e,easingCenter:i.center}}handleMapControlsRollPitchBearingZoom(e,i){e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta),e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta)}handleMapControlsPan(e,i,l){e.around.distSqr(i.centerPoint)<.01||i.setLocationAtPoint(l,e.around)}cameraForBoxAndBearing(e,i,l,h,m){return kn(e,i,l,h,m)}handleJumpToCenterZoom(e,i){e.zoom!==(i.zoom!==void 0?+i.zoom:e.zoom)&&e.setZoom(+i.zoom),i.center!==void 0&&e.setCenter(c.Q.convert(i.center))}handleEaseTo(e,i){const l=e.zoom,h=e.padding,m={roll:e.roll,pitch:e.pitch,bearing:e.bearing},y={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},b=i.zoom!==void 0,E=!e.isPaddingEqual(i.padding);let P=!1;const z=b?+i.zoom:e.zoom;let F=e.centerPoint.add(i.offsetAsPoint);const N=e.screenPointToLocation(F),{center:H,zoom:$}=e.getConstrained(c.Q.convert(i.center||N),z??l);_s(e,H);const ce=Ur(e.worldSize,N),le=Ur(e.worldSize,H).sub(ce),he=c.ac($-l);return P=$!==l,{easeFunc:xe=>{if(P&&e.setZoom(c.B.number(l,$,xe)),c.b6(m,y)||ua({startEulerAngles:m,endEulerAngles:y,tr:e,k:xe,useSlerp:m.roll!=y.roll}),E&&(e.interpolatePadding(h,i.padding,xe),F=e.centerPoint.add(i.offsetAsPoint)),i.around)e.setLocationAtPoint(i.around,i.aroundPoint);else{const Te=c.ac(e.zoom-l),we=$>l?Math.min(2,he):Math.max(.5,he),Ae=Math.pow(we,1-xe),ke=li(e.worldSize,ce.add(le.mult(xe*Ae)).mult(Te));e.setLocationAtPoint(e.renderWorldCopies?ke.wrap():ke,F)}},isZooming:P,elevationCenter:H}}handleFlyTo(e,i){const l=i.zoom!==void 0,h=e.zoom,m=e.getConstrained(c.Q.convert(i.center||i.locationAtOffset),l?+i.zoom:h),y=m.center,b=m.zoom;_s(e,y);const E=Ur(e.worldSize,i.locationAtOffset),P=Ur(e.worldSize,y).sub(E),z=P.mag(),F=c.ac(b-h);let N;if(i.minZoom!==void 0){const H=Math.min(+i.minZoom,h,b),$=e.getConstrained(y,H).zoom;N=c.ac($-h)}return{easeFunc:(H,$,ce,le)=>{e.setZoom(H===1?b:h+c.ah($));const he=H===1?y:li(e.worldSize,E.add(P.mult(ce)).mult($));e.setLocationAtPoint(e.renderWorldCopies?he.wrap():he,le)},scaleOfZoom:F,targetCenter:y,scaleOfMinZoom:N,pixelPathLength:z}}}class fi{constructor(e,i,l){this.blendFunction=e,this.blendColor=i,this.mask=l}}fi.Replace=[1,0],fi.disabled=new fi(fi.Replace,c.b7.transparent,[!1,!1,!1,!1]),fi.unblended=new fi(fi.Replace,c.b7.transparent,[!0,!0,!0,!0]),fi.alphaBlended=new fi([1,771],c.b7.transparent,[!0,!0,!0,!0]);const Oi=2305;class Vr{constructor(e,i,l){this.enable=e,this.mode=i,this.frontFace=l}}Vr.disabled=new Vr(!1,1029,Oi),Vr.backCCW=new Vr(!0,1029,Oi),Vr.frontCCW=new Vr(!0,1028,Oi);class br{constructor(e,i,l){this.func=e,this.mask=i,this.range=l}}br.ReadOnly=!1,br.ReadWrite=!0,br.disabled=new br(519,br.ReadOnly,[0,1]);const Gs=7680;class Pr{constructor(e,i,l,h,m,y){this.test=e,this.ref=i,this.mask=l,this.fail=h,this.depthFail=m,this.pass=y}}Pr.disabled=new Pr({func:519,mask:0},0,0,Gs,Gs,Gs);const qn=new WeakMap;function cn(d){var e;if(qn.has(d))return qn.get(d);{const i=(e=d.getParameter(d.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return qn.set(d,i),i}}class Cl{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const i=e.context,l=i.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const h=new c.aI;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const m=new c.aK;m.emplaceBack(0,1,2),this._fullscreenTriangle=new Sa(i.createVertexBuffer(h,yn.members),i.createIndexBuffer(m),c.aJ.simpleSegment(0,0,h.length,m.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(l.TEXTURE1);const y=l.createTexture();l.bindTexture(l.TEXTURE_2D,y),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(y),cn(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,i){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,i),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,i=e.gl;e.activeTexture.set(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,i){const l=this._cachedRenderContext.context,h=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:c.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,h.TRIANGLES,br.disabled,Pr.disabled,fi.unblended,Vr.disabled,((m,y)=>({u_input:m,u_output_expected:y}))(e,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&cn(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const m=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:m}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&cn(e)){const i=e.clientWaitSync(this._readbackQueue.sync,0,0);if(i===e.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Cl._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let i=0;return i+=e[0]/256,i+=e[1]/65536,i+=e[2]/16777216,e[3]<127&&(i=-i),i/128}}const qo=c.Z/128;function fu(d,e){const i=d.granularity!==void 0?Math.max(d.granularity,1):1,l=i+(d.generateBorders?2:0),h=i+(d.extendToNorthPole||d.generateBorders?1:0)+(d.extendToSouthPole||d.generateBorders?1:0),m=l+1,y=h+1,b=d.generateBorders?-1:0,E=d.generateBorders||d.extendToNorthPole?-1:0,P=i+(d.generateBorders?1:0),z=i+(d.generateBorders||d.extendToSouthPole?1:0),F=m*y,N=l*h*6,H=m*y>65536;if(H&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const $=H||e==="32bit",ce=new Int16Array(2*F);let le=0;for(let Te=E;Te<=z;Te++)for(let we=b;we<=P;we++){let Ae=we/i*c.Z;we===-1&&(Ae=-64),we===i+1&&(Ae=c.Z+qo);let ke=Te/i*c.Z;Te===-1&&(ke=d.extendToNorthPole?c.b9:-64),Te===i+1&&(ke=d.extendToSouthPole?c.ba:c.Z+qo),ce[le++]=Ae,ce[le++]=ke}const he=$?new Uint32Array(N):new Uint16Array(N);let xe=0;for(let Te=0;Te<h;Te++)for(let we=0;we<l;we++){const Ae=we+1+Te*m,ke=we+(Te+1)*m,De=we+1+(Te+1)*m;he[xe++]=we+Te*m,he[xe++]=ke,he[xe++]=Ae,he[xe++]=Ae,he[xe++]=ke,he[xe++]=De}return{vertices:ce.buffer.slice(0),indices:he.buffer.slice(0),uses32bitIndices:$}}const xo=new c.aH({fill:new c.bb(128,2),line:new c.bb(512,0),tile:new c.bb(128,32),stencil:new c.bb(128,1),circle:3});class Go{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Xr.projectionGlobe}get vertexShaderPreludeCode(){return Xr.projectionMercator.vertexSource}get subdivisionGranularity(){return xo}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Cl(e));const i=c.S(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(i,l),m=_e.now();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=m);const y=Math.min(Math.max((m-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bd(y))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,i,l,h,m){const y=(m==="stencil"?xo.stencil:xo.tile).getGranularityForZoomLevel(i.z);return this._getMesh(e,{granularity:y,generateBorders:l,extendToNorthPole:i.y===0&&h,extendToSouthPole:i.y===(1<<i.z)-1&&h})}_getMesh(e,i){const l=this._getMeshKey(i);if(l in this._tileMeshCache)return this._tileMeshCache[l];const h=function(m,y){const b=fu(y,"16bit"),E=c.aI.deserialize({arrayBuffer:b.vertices,length:b.vertices.byteLength/2/2}),P=c.aK.deserialize({arrayBuffer:b.indices,length:b.indices.byteLength/2/3});return new Sa(m.createVertexBuffer(E,yn.members),m.createIndexBuffer(P),c.aJ.simpleSegment(0,0,E.length,P.length))}(e,i);return this._tileMeshCache[l]=h,h}recalculate(e){}hasTransition(){const e=_e.now();let i=!1;return i=i||(e-this._errorMeasurementLastChangeTime)/1e3<.7,i=i||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,i}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Zo=new c.r({type:new c.D(c.v.projection.type)});class Ho extends c.E{constructor(e){super(),this._transitionable=new c.T(Zo),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.C(0)),this._mercatorProjection=new Vs,this._verticalPerspectiveProjection=new Go}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof c.be){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,i,l,h,m){return this.currentProjection.getMeshFromTileID(e,i,l,h,m)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Ml(d){const e=Xo(d.worldSize,d.center.lat);return 2*Math.PI*e}function $o(d,e,i,l,h){const m=1/(1<<h),y=e/c.Z*m+l*m,b=c.bg((d/c.Z*m+i*m)*Math.PI*2+Math.PI,2*Math.PI),E=2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI,P=Math.cos(E),z=new Float64Array(3);return z[0]=Math.sin(b)*P,z[1]=Math.sin(E),z[2]=Math.cos(b)*P,z}function Bn(d){return function(e,i){const l=Math.cos(i),h=new Float64Array(3);return h[0]=Math.sin(e)*l,h[1]=Math.sin(i),h[2]=Math.cos(e)*l,h}(d.lng*Math.PI/180,d.lat*Math.PI/180)}function Xo(d,e){return d/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Yo(d){const e=Math.asin(d[1])/Math.PI*180,i=Math.sqrt(d[0]*d[0]+d[2]*d[2]);if(i>1e-6){const l=d[0]/i,h=Math.acos(d[2]/i),m=(l>0?h:-h)/Math.PI*180;return new c.Q(c.aL(m,-180,180),e)}return new c.Q(0,e)}function bo(d){return Math.cos(d*Math.PI/180)}function On(d,e){const i=bo(d),l=bo(e);return c.ah(l/i)}function Wu(d,e){const i=d.rotate(e.bearingInRadians),l=e.zoom+On(e.center.lat,0),h=c.bc(1/bo(e.center.lat),1/bo(Math.min(Math.abs(e.center.lat),60)),c.bf(l,7,3,0,1)),m=360/Ml({worldSize:e.worldSize,center:{lat:e.center.lat}});return new c.Q(e.center.lng-i.x*m*h,c.ae(e.center.lat+i.y*m,-85.051129,c.af))}function Qu(d){const e=.5*d,i=Math.sin(e),l=Math.cos(e);return Math.log(i+l)-Math.log(l-i)}function $h(d,e,i,l){const h=d.lat+i*l;if(Math.abs(i)>1){const m=(Math.sign(d.lat+i)!==Math.sign(d.lat)?-Math.abs(d.lat):Math.abs(d.lat))*Math.PI/180,y=Math.abs(d.lat+i)*Math.PI/180,b=Qu(m+l*(y-m)),E=Qu(m),P=Qu(y);return new c.Q(d.lng+e*((b-E)/(P-E)),h)}return new c.Q(d.lng+e*l,h)}class Xh{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=e}recalculateCache(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(e,i,l,h){const m=`${e.z}_${e.x}_${e.y}`,y=this._cache.get(m);if(y)return y;const b=this._cachePrevious.get(m);if(b)return this._cache.set(m,b),b;const E=this._aabbFactory(e,i,l,h);return this._cache.set(m,E),this._hadAnyChanges=!0,E}}function Wn(d,e,i){const l=d-e;return l<0?-l:Math.max(0,l-i)}function du(d,e,i,l,h){const m=d-i;let y;return y=m<0?Math.min(-m,1+m-h):m>1?Math.min(Math.max(m-h,0),1-m):0,Math.max(y,Wn(e,l,h))}class vs{constructor(){this._aabbCache=new Xh(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(e,i,l,h){const m=1<<l.z,y=1/m,b=l.x/m,E=l.y/m;let P=2;return P=Math.min(P,du(e,i,b,E,y)),P=Math.min(P,du(e,i,b+.5,-E-y,y)),P=Math.min(P,du(e,i,b+.5,2-E-y,y)),P}getWrap(e,i,l){const h=1<<i.z,m=1/h,y=i.x/h,b=Wn(e.x,y,m),E=Wn(e.x,y-1,m),P=Wn(e.x,y+1,m),z=Math.min(b,E,P);return z===P?1:z===E?-1:0}allowVariableZoom(e,i){return Ze(e,i)>4}allowWorldCopies(){return!1}getTileAABB(e,i,l,h){return this._aabbCache.getTileAABB(e,i,l,h)}_computeTileAABB(e,i,l,h){if(e.z<=0)return new un([-1,-1,-1],[1,1,1]);if(e.z===1)return new un([e.x===0?-1:0,e.y===0?0:-1,-1],[e.x===0?0:1,e.y===0?1:0,1]);{const m=[$o(0,0,e.x,e.y,e.z),$o(c.Z,0,e.x,e.y,e.z),$o(c.Z,c.Z,e.x,e.y,e.z),$o(0,c.Z,e.x,e.y,e.z)],y=[1,1,1],b=[-1,-1,-1];for(const E of m)for(let P=0;P<3;P++)y[P]=Math.min(y[P],E[P]),b[P]=Math.max(b[P],E[P]);if(e.y===0||e.y===(1<<e.z)-1){const E=[0,e.y===0?1:-1,0];for(let P=0;P<3;P++)y[P]=Math.min(y[P],E[P]),b[P]=Math.max(b[P],E[P])}return new un(y,b)}}}class Wo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,l){return this._helper.interpolatePadding(e,i,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i){this._helper.resize(e,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=c.bk(),this._projectionMatrix=c.b1(),this._globeViewProjMatrix32f=c.b0(),this._globeViewProjMatrixNoCorrection=c.b1(),this._globeViewProjMatrixNoCorrectionInverted=c.b1(),this._globeProjMatrixInverted=c.b1(),this._cameraPosition=c.bh(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new ln({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._coveringTilesDetailsProvider=new vs}clone(){const e=new Wo;return e.apply(this),e}apply(e,i){this._globeLatitudeErrorCorrectionRadians=i||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=c.bh();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:i,applyGlobeMatrix:l}=e,h=this._helper.getMercatorTileCoordinates(i);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const i=this.pitchInRadians,l=this.cameraToCenterDistance/e,h=Math.sin(i)*l,m=Math.cos(i)*l+1,y=1/Math.sqrt(h*h+m*m)*1;let b=-h,E=m;const P=Math.sqrt(b*b+E*E);b/=P,E/=P;const z=[0,b,E];c.bl(z,z,[0,0,0],-this.bearingInRadians),c.bm(z,z,[0,0,0],-1*this.center.lat*Math.PI/180),c.bn(z,z,[0,0,0],this.center.lng*Math.PI/180);const F=1/c.bo(z);return c.aO(z,z,F),[...z,-y*F]}isLocationOccluded(e){return!this.isSurfacePointVisible(Bn(e))}transformLightDirection(e){const i=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,h=Math.cos(l),m=[Math.sin(i)*h,Math.sin(l),Math.cos(i)*h],y=[m[2],0,-m[0]],b=[0,0,0];c.aU(b,y,m),c.aT(y,y),c.aT(b,b);const E=[0,0,0];return c.aT(E,[y[0]*e[0]+b[0]*e[1]+m[0]*e[2],y[1]*e[0]+b[1]*e[1]+m[1]*e[2],y[2]*e[0]+b[2]*e[1]+m[2]*e[2]]),E}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,i,l){const h=function(b,E,P){const z=1/(1<<P.z);return new c.$(b/c.Z*z+P.x*z,E/c.Z*z+P.y*z)}(e,i,l.canonical),m=(y=h.y,[c.bg(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI]);var y;return this.getCircleRadiusCorrection()/Math.cos(m[1])}projectTileCoordinates(e,i,l,h){const m=l.canonical,y=$o(e,i,m.x,m.y,m.z),b=1+(h?h(e,i):0)/c.bu,E=[y[0]*b,y[1]*b,y[2]*b,1];c.at(E,E,this._globeViewProjMatrixNoCorrection);const P=this._cachedClippingPlane,z=P[0]*y[0]+P[1]*y[1]+P[2]*y[2]+P[3]<0;return{point:new c.P(E[0]/E[3],E[1]/E[3]),signedDistanceFromCamera:E[3],isOccluded:z}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Xo(this.worldSize,this.center.lat),i=c.b2(),l=c.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),c.aY(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;i[8]=2*-h.x/this._helper._width,i[9]=2*h.y/this._helper._height,this._projectionMatrix=c.aZ(i),this._globeProjMatrixInverted=c.b2(),c.an(this._globeProjMatrixInverted,i),c.L(i,i,[0,0,-this.cameraToCenterDistance]),c.a_(i,i,this.rollInRadians),c.a$(i,i,-this.pitchInRadians),c.a_(i,i,this.bearingInRadians),c.L(i,i,[0,0,-e]);const m=c.bh();m[0]=e,m[1]=e,m[2]=e,c.a$(l,i,this.center.lat*Math.PI/180),c.bp(l,l,-this.center.lng*Math.PI/180),c.M(l,l,m),this._globeViewProjMatrixNoCorrection=l,c.a$(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bp(i,i,-this.center.lng*Math.PI/180),c.M(i,i,m),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=c.b2(),c.an(this._globeViewProjMatrixNoCorrectionInverted,l);const y=c.bh();this._cameraPosition=c.bh(),this._cameraPosition[2]=this.cameraToCenterDistance/e,c.bl(this._cameraPosition,this._cameraPosition,y,-this.rollInRadians),c.bm(this._cameraPosition,this._cameraPosition,y,this.pitchInRadians),c.bl(this._cameraPosition,this._cameraPosition,y,-this.bearingInRadians),c.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bm(this._cameraPosition,this._cameraPosition,y,-this.center.lat*Math.PI/180),c.bn(this._cameraPosition,this._cameraPosition,y,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const b=c.aZ(this._globeViewProjMatrixNoCorrectionInverted);c.M(b,b,[1,1,-1]),this._cachedFrustum=Ri.fromInvProjectionMatrix(b)}calculateFogMatrix(e){c.w("calculateFogMatrix is not supported on globe projection.");const i=c.b2();return c.ad(i),i}getVisibleUnwrappedCoordinates(e){return[new c.aW(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=Bn(e);c.aO(l,l,1+i/c.bu);const h=c.bk();return c.at(h,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(e){}getBounds(){const e=.5*this.width,i=.5*this.height,l=[new c.P(0,0),new c.P(e,0),new c.P(this.width,0),new c.P(this.width,i),new c.P(this.width,this.height),new c.P(e,this.height),new c.P(0,this.height),new c.P(0,i)],h=[];for(const F of l)h.push(this.unprojectScreenPoint(F));let m=0,y=0,b=0,E=0;const P=this.center;for(const F of h){const N=c.bq(P.lng,F.lng),H=c.bq(P.lat,F.lat);N<y&&(y=N),N>m&&(m=N),H<E&&(E=H),H>b&&(b=H)}const z=[P.lng+y,P.lat+E,P.lng+m,P.lat+b];return this.isSurfacePointOnScreen([0,1,0])&&(z[3]=90,z[0]=-180,z[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(z[1]=-90,z[0]=-180,z[2]=180),new Dr(z)}getConstrained(e,i){const l=c.ae(e.lat,-85.051129,c.af),h=c.ae(+i,this.minZoom+On(0,l),this.maxZoom);return{center:new c.Q(e.lng,l),zoom:h}}calculateCenterFromCameraLngLatAlt(e,i,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,l,h)}setLocationAtPoint(e,i){const l=Bn(this.unprojectScreenPoint(i)),h=Bn(e),m=c.bh();c.br(m);const y=c.bh();c.bn(y,l,m,-this.center.lng*Math.PI/180),c.bm(y,y,m,this.center.lat*Math.PI/180);const b=h[0]*h[0]+h[2]*h[2],E=y[0]*y[0];if(b<E)return;const P=Math.sqrt(b-E),z=-P,F=c.bs(h[0],h[2],y[0],P),N=c.bs(h[0],h[2],y[0],z),H=c.bh();c.bn(H,h,m,-F);const $=c.bs(H[1],H[2],y[1],y[2]),ce=c.bh();c.bn(ce,h,m,-N);const le=c.bs(ce[1],ce[2],y[1],y[2]),he=.5*Math.PI,xe=$>=-he&&$<=he,Te=le>=-he&&le<=he;let we,Ae;if(xe&&Te){const dt=this.center.lng*Math.PI/180,nt=this.center.lat*Math.PI/180;c.bv(F,dt)+c.bv($,nt)<c.bv(N,dt)+c.bv(le,nt)?(we=F,Ae=$):(we=N,Ae=le)}else if(xe)we=F,Ae=$;else{if(!Te)return;we=N,Ae=le}const ke=we/Math.PI*180,De=Ae/Math.PI*180,Qe=this.center.lat;this.setCenter(new c.Q(ke,c.ae(De,-90,90))),this.setZoom(this.zoom+On(Qe,this.center.lat))}locationToScreenPoint(e,i){const l=Bn(e);if(i){const h=i.getElevationForLngLatZoom(e,this._helper._tileZoom);c.aO(l,l,1+h/c.bu)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(e){const i=c.bk();return c.at(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new c.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,i){if(i){const l=i.pointCoordinate(e);if(l)return l}return c.$.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,i){var l;return(l=this.screenPointToMercatorCoordinate(e,i))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(e,i){const l=this._cameraPosition,h=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(l,h)}getRayDirectionFromPixel(e){const i=c.bk();i[0]=e.x/this.width*2-1,i[1]=-1*(e.y/this.height*2-1),i[2]=1,i[3]=1,c.at(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];const l=c.bh();l[0]=i[0]-this._cameraPosition[0],l[1]=i[1]-this._cameraPosition[1],l[2]=i[2]-this._cameraPosition[2];const h=c.bh();return c.aT(h,l),h}isSurfacePointVisible(e){const i=this._cachedClippingPlane;return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const i=c.bk();return c.at(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(e,i){const l=c.aV(e,i),h=c.bh(),m=c.bh();c.aO(m,i,l),c.aS(h,e,m);const y=1-c.aV(h,h);if(y<0)return null;const b=c.aV(e,e)-1,E=-l+(l<0?1:-1)*Math.sqrt(y),P=b/E,z=E;return{tMin:Math.min(P,z),tMax:Math.max(P,z)}}unprojectScreenPoint(e){const i=this._cameraPosition,l=this.getRayDirectionFromPixel(e),h=this.rayPlanetIntersection(i,l);if(h){const z=c.bh();c.aP(z,i,[l[0]*h.tMin,l[1]*h.tMin,l[2]*h.tMin]);const F=c.bh();return c.aT(F,z),Yo(F)}const m=this._cachedClippingPlane,y=m[0]*l[0]+m[1]*l[1]+m[2]*l[2],b=-c.bt(m,i)/y,E=c.bh();if(b>0)c.aP(E,i,[l[0]*b,l[1]*b,l[2]*b]);else{const z=c.bh();c.aP(z,i,[2*l[0],2*l[1],2*l[2]]);const F=c.bt(this._cachedClippingPlane,z);c.aS(E,z,[this._cachedClippingPlane[0]*F,this._cachedClippingPlane[1]*F,this._cachedClippingPlane[2]*F])}const P=function(z){const F=c.bh();return F[0]=z[0]*-z[3],F[1]=z[1]*-z[3],F[2]=z[2]*-z[3],{center:F,radius:Math.sqrt(1-z[3]*z[3])}}(m);return Yo(function(z,F,N){const H=c.bh();c.aS(H,N,z);const $=c.bh();return c.bi($,z,H,F/c.bj(H)),$}(P.center,P.radius,E))}getMatrixForModel(e,i){const l=c.Q.convert(e),h=1/c.bu,m=c.b1();return c.bp(m,m,l.lng/180*Math.PI),c.a$(m,m,-l.lat/180*Math.PI),c.L(m,m,[0,0,1+i/c.bu]),c.a$(m,m,.5*Math.PI),c.M(m,m,[h,h,h]),m}getProjectionDataForCustomLayer(e=!0){const i=this.getProjectionData({overscaledTileID:new c.Y(0,0,0,0,0),applyGlobeMatrix:e});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(e){}}class Qo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,l){return this._helper.interpolatePadding(e,i,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,l=!0){this._helper.resize(e,i,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,i){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=i,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new ln({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._globeness=1,this._mercatorTransform=new ys,this._verticalPerspectiveTransform=new Wo}clone(){const e=new Qo;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const i=this._mercatorTransform.getProjectionData(e),l=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:i.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:i.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return c.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,i,l){const h=this._mercatorTransform.getPitchedTextCorrection(e,i,l),m=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,i,l);return c.bc(h,m,this._globeness)}projectTileCoordinates(e,i,l,h){return this.currentTransform.projectTileCoordinates(e,i,l,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){return this.currentTransform.lngLatToCameraDepth(e,i)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,i){return this.currentTransform.getConstrained(e,i)}calculateCenterFromCameraLngLatAlt(e,i,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,l,h)}setLocationAtPoint(e,i){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,i),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,i),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,i){return this.currentTransform.locationToScreenPoint(e,i)}screenPointToMercatorCoordinate(e,i){return this.currentTransform.screenPointToMercatorCoordinate(e,i)}screenPointToLocation(e,i){return this.currentTransform.screenPointToLocation(e,i)}isPointOnMapSurface(e,i){return this.currentTransform.isPointOnMapSurface(e,i)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,i){return this.currentTransform.getMatrixForModel(e,i)}getProjectionDataForCustomLayer(e=!0){const i=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return i;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return l.fallbackMatrix=i.mainMatrix,l}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Va{get useGlobeControls(){return!0}handlePanInertia(e,i){const l=Wu(e,i);return Math.abs(l.lng-i.center.lng)>180&&(l.lng=i.center.lng+179.5*Math.sign(l.lng-i.center.lng)),{easingCenter:l,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,i){const l=e.around,h=i.screenPointToLocation(l);e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta);const m=i.zoom;e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta);const y=i.zoom-m;if(y===0)return;const b=c.bq(i.center.lng,h.lng),E=b/(Math.abs(b/180)+1),P=c.bq(i.center.lat,h.lat),z=i.getRayDirectionFromPixel(l),F=i.cameraPosition,N=-1*c.aV(F,z),H=c.bh();c.aP(H,F,[z[0]*N,z[1]*N,z[2]*N]);const $=c.bo(H)-1,ce=Math.exp(.5*-Math.max($-.3,0)),le=Xo(i.worldSize,i.center.lat)/Math.min(i.width,i.height),he=c.bf(le,.9,.5,1,.25),xe=(1-c.ac(-y))*Math.min(ce,he),Te=i.center.lat,we=i.zoom,Ae=new c.Q(i.center.lng+E*xe,c.ae(i.center.lat+P*xe,-85.051129,c.af));i.setLocationAtPoint(h,l);const ke=i.center,De=c.bf(Math.abs(b),45,85,0,1),Qe=c.bf(le,.75,.35,0,1),dt=Math.pow(Math.max(De,Qe),.25),nt=c.bq(ke.lng,Ae.lng),it=c.bq(ke.lat,Ae.lat);i.setCenter(new c.Q(ke.lng+nt*dt,ke.lat+it*dt).wrap()),i.setZoom(we+On(Te,i.center.lat))}handleMapControlsPan(e,i,l){if(!e.panDelta)return;const h=i.center.lat,m=i.zoom;i.setCenter(Wu(e.panDelta,i).wrap()),i.setZoom(m+On(h,i.center.lat))}cameraForBoxAndBearing(e,i,l,h,m){const y=kn(e,i,l,h,m),b=i.left/m.width*2-1,E=(m.width-i.right)/m.width*2-1,P=i.top/m.height*-2+1,z=(m.height-i.bottom)/m.height*-2+1,F=c.bq(l.getWest(),l.getEast())<0,N=F?l.getEast():l.getWest(),H=F?l.getWest():l.getEast(),$=Math.max(l.getNorth(),l.getSouth()),ce=Math.min(l.getNorth(),l.getSouth()),le=N+.5*c.bq(N,H),he=$+.5*c.bq($,ce),xe=m.clone();xe.setCenter(y.center),xe.setBearing(y.bearing),xe.setPitch(0),xe.setRoll(0),xe.setZoom(y.zoom);const Te=xe.modelViewProjectionMatrix,we=[Bn(l.getNorthWest()),Bn(l.getNorthEast()),Bn(l.getSouthWest()),Bn(l.getSouthEast()),Bn(new c.Q(H,he)),Bn(new c.Q(N,he)),Bn(new c.Q(le,$)),Bn(new c.Q(le,ce))],Ae=Bn(y.center);let ke=Number.POSITIVE_INFINITY;for(const De of we)b<0&&(ke=Va.getLesserNonNegativeNonNull(ke,Va.solveVectorScale(De,Ae,Te,"x",b))),E>0&&(ke=Va.getLesserNonNegativeNonNull(ke,Va.solveVectorScale(De,Ae,Te,"x",E))),P>0&&(ke=Va.getLesserNonNegativeNonNull(ke,Va.solveVectorScale(De,Ae,Te,"y",P))),z<0&&(ke=Va.getLesserNonNegativeNonNull(ke,Va.solveVectorScale(De,Ae,Te,"y",z)));if(Number.isFinite(ke)&&ke!==0)return y.zoom=xe.zoom+c.ah(ke),y;en()}handleJumpToCenterZoom(e,i){const l=e.center.lat,h=e.getConstrained(i.center?c.Q.convert(i.center):e.center,e.zoom).center;e.setCenter(h.wrap());const m=i.zoom!==void 0?+i.zoom:e.zoom+On(l,h.lat);e.zoom!==m&&e.setZoom(m)}handleEaseTo(e,i){const l=e.zoom,h=e.center,m=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},b={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},E=i.zoom!==void 0,P=!e.isPaddingEqual(i.padding);let z=!1;const F=i.center?c.Q.convert(i.center):h,N=e.getConstrained(F,l).center;_s(e,N);const H=e.clone();H.setCenter(N),H.setZoom(E?+i.zoom:l+On(h.lat,F.lat)),H.setBearing(i.bearing);const $=new c.P(c.ae(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),c.ae(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));H.setLocationAtPoint(N,$);const ce=(i.offset&&i.offsetAsPoint.mag())>0?H.center:N,le=E?+i.zoom:l+On(h.lat,ce.lat),he=l+On(h.lat,0),xe=le+On(ce.lat,0),Te=c.bq(h.lng,ce.lng),we=c.bq(h.lat,ce.lat),Ae=c.ac(xe-he);return z=le!==l,{easeFunc:ke=>{if(c.b6(y,b)||ua({startEulerAngles:y,endEulerAngles:b,tr:e,k:ke,useSlerp:y.roll!=b.roll}),P&&e.interpolatePadding(m,i.padding,ke),i.around)c.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(i.around,i.aroundPoint);else{const De=xe>he?Math.min(2,Ae):Math.max(.5,Ae),Qe=Math.pow(De,1-ke),dt=$h(h,Te,we,ke*Qe);e.setCenter(dt.wrap())}if(z){const De=c.B.number(he,xe,ke)+On(0,e.center.lat);e.setZoom(De)}},isZooming:z,elevationCenter:ce}}handleFlyTo(e,i){const l=i.zoom!==void 0,h=e.center,m=e.zoom,y=e.padding,b=!e.isPaddingEqual(i.padding),E=e.getConstrained(c.Q.convert(i.center||i.locationAtOffset),m).center,P=l?+i.zoom:e.zoom+On(e.center.lat,E.lat),z=e.clone();z.setCenter(E),z.setZoom(P),z.setBearing(i.bearing);const F=new c.P(c.ae(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),c.ae(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));z.setLocationAtPoint(E,F);const N=z.center;_s(e,N);const H=function(we,Ae,ke){const De=Bn(Ae),Qe=Bn(ke),dt=c.aV(De,Qe),nt=Math.acos(dt),it=Ml(we);return nt/(2*Math.PI)*it}(e,h,N),$=m+On(h.lat,0),ce=P+On(N.lat,0),le=c.ac(ce-$);let he;if(typeof i.minZoom=="number"){const we=+i.minZoom+On(N.lat,0),Ae=Math.min(we,$,ce)+On(0,N.lat),ke=e.getConstrained(N,Ae).zoom+On(N.lat,0);he=c.ac(ke-$)}const xe=c.bq(h.lng,N.lng),Te=c.bq(h.lat,N.lat);return{easeFunc:(we,Ae,ke,De)=>{const Qe=$h(h,xe,Te,ke);b&&e.interpolatePadding(y,i.padding,we);const dt=we===1?N:Qe;e.setCenter(dt.wrap());const nt=$+c.ah(Ae);e.setZoom(we===1?P:nt+On(0,dt.lat))},scaleOfZoom:le,targetCenter:N,scaleOfMinZoom:he,pixelPathLength:H}}static solveVectorScale(e,i,l,h,m){const y=h==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],b=[l[3],l[7],l[11],l[15]],E=e[0]*y[0]+e[1]*y[1]+e[2]*y[2],P=e[0]*b[0]+e[1]*b[1]+e[2]*b[2],z=i[0]*y[0]+i[1]*y[1]+i[2]*y[2],F=i[0]*b[0]+i[1]*b[1]+i[2]*b[2];return z+m*P===E+m*F||b[3]*(E-z)+y[3]*(F-P)+E*F==z*P?null:(z+y[3]-m*F-m*b[3])/(z-E-m*F+m*P)}static getLesserNonNegativeNonNull(e,i){return i!==null&&i>=0&&i<e?i:e}}class Ko{constructor(e){this._globe=e,this._mercatorCameraHelper=new Ua,this._verticalPerspectiveCameraHelper=new Va}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,i){return this.currentHelper.handlePanInertia(e,i)}handleMapControlsRollPitchBearingZoom(e,i){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,i)}handleMapControlsPan(e,i,l){this.currentHelper.handleMapControlsPan(e,i,l)}cameraForBoxAndBearing(e,i,l,h,m){return this.currentHelper.cameraForBoxAndBearing(e,i,l,h,m)}handleJumpToCenterZoom(e,i){this.currentHelper.handleJumpToCenterZoom(e,i)}handleEaseTo(e,i){return this.currentHelper.handleEaseTo(e,i)}handleFlyTo(e,i){return this.currentHelper.handleFlyTo(e,i)}}const Ku=(d,e)=>c.x(d,e&&e.filter(i=>i.identifier!=="source.canvas")),Yh=c.bw();class Kc extends c.E{constructor(e,i={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const h=this.sourceCaches[l].getSource().type;h!=="vector"&&h!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new Xt(Ot(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,h)=>this.getGlyphs(l,h)),this.dispatcher.registerMessageHandler("GI",(l,h)=>this.getImages(l,h)),this.imageManager=new nr,this.imageManager.setEventedParent(this),this.glyphManager=new xr(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new ue(256,512),this.crossTileSymbolIndex=new Qr,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.bx,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.by()),ei().on(_i,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const h=this.sourceCaches[l.sourceId];if(!h)return;const m=h.getSource();if(m&&m.vectorLayerIds)for(const y in this._layers){const b=this._layers[y];b.source===m.id&&this._validateLayer(b)}})}loadURL(e,i={},l){this.fire(new c.l("dataloading",{dataType:"style"})),i.validate=typeof i.validate!="boolean"||i.validate;const h=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const m=this._loadStyleRequest;c.j(h,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,i,l)}).catch(y=>{this._loadStyleRequest=null,y&&!m.signal.aborted&&this.fire(new c.k(y))})}loadJSON(e,i={},l){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,_e.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,i.validate=i.validate!==!1,this._load(e,i,l)}).catch(()=>{})}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(Yh,{validate:!1})}_load(e,i,l){var h,m;const y=i.transformStyle?i.transformStyle(l,e):e;if(!i.validate||!Ku(this,c.y(y))){this._loaded=!0,this.stylesheet=y;for(const b in y.sources)this.addSource(b,y.sources[b],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new st(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new jt(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){const e=c.bz(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(i=>i.id),this._layers={},this._serializedLayers=null;for(const i of e){const l=c.bA(i);l.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=l}}_loadSprite(e,i=!1,l=void 0){let h;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(m,y,b,E){return c._(this,void 0,void 0,function*(){const P=Pe(m),z=b>1?"@2x":"",F={},N={};for(const{id:H,url:$}of P){const ce=y.transformRequest(gt($,z,".json"),"SpriteJSON");F[H]=c.j(ce,E);const le=y.transformRequest(gt($,z,".png"),"SpriteImage");N[H]=Rt.getImage(le,E)}return yield Promise.all([...Object.values(F),...Object.values(N)]),function(H,$){return c._(this,void 0,void 0,function*(){const ce={};for(const le in H){ce[le]={};const he=_e.getImageCanvasContext((yield $[le]).data),xe=(yield H[le]).data;for(const Te in xe){const{width:we,height:Ae,x:ke,y:De,sdf:Qe,pixelRatio:dt,stretchX:nt,stretchY:it,content:ut,textFitWidth:Zt,textFitHeight:Vt}=xe[Te];ce[le][Te]={data:null,pixelRatio:dt,sdf:Qe,stretchX:nt,stretchY:it,content:ut,textFitWidth:Zt,textFitHeight:Vt,spriteData:{width:we,height:Ae,x:ke,y:De,context:he}}}}return ce})}(F,N)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(m=>{if(this._spriteRequest=null,m)for(const y in m){this._spritesImagesIds[y]=[];const b=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter(E=>!(E in m)):[];for(const E of b)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in m[y]){const P=y==="default"?E:`${y}:${E}`;this._spritesImagesIds[y].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,m[y][E],!1):this.imageManager.addImage(P,m[y][E]),i&&(this._changedImages[P]=!0)}}}).catch(m=>{this._spriteRequest=null,h=m,this.fire(new c.k(h))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),l&&l(h)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const l=e.sourceLayer;if(!l)return;const h=i.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new c.k(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,i=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(i?c.bB(l):l);const h=[];for(const m of e)if(l[m]){const y=i?c.bB(l[m]):l[m];h.push(y)}return h}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const i=Object.keys(this._layers);for(const l of i){const h=this._layers[l];h.type!=="custom"&&(e[l]=h.serialize())}return e}hasTransitions(){var e,i,l;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((i=this.sky)===null||i===void 0)&&i.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(i){const h=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(h.length||m.length)&&this._updateWorkerLayers(h,m);for(const y in this._updatedSources){const b=this._updatedSources[y];if(b==="reload")this._reloadSource(y);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const h in this.sourceCaches){const m=this.sourceCaches[h];l[h]=m.used,m.used=!1}for(const h of this._order){const m=this._layers[h];m.recalculate(e,this._availableImages),!m.isHidden(e.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(const h in l){const m=this.sourceCaches[h];!!l[h]!=!!m.used&&m.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,i&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,i){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:i})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){var l;this._checkLoaded();const h=this.serialize();if(e=i.transformStyle?i.transformStyle(h,e):e,((l=i.validate)===null||l===void 0||l)&&Ku(this,c.y(e)))return!1;(e=c.bB(e)).layers=c.bz(e.layers);const m=c.bC(h,e),y=this._getOperationsToPerform(m);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const b of y.operations)b();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const i=[],l=[];for(const h of e)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":i.push(()=>this.addLayer.apply(this,h.args));break;case"removeLayer":i.push(()=>this.removeLayer.apply(this,h.args));break;case"setPaintProperty":i.push(()=>this.setPaintProperty.apply(this,h.args));break;case"setLayoutProperty":i.push(()=>this.setLayoutProperty.apply(this,h.args));break;case"setFilter":i.push(()=>this.setFilter.apply(this,h.args));break;case"addSource":i.push(()=>this.addSource.apply(this,h.args));break;case"removeSource":i.push(()=>this.removeSource.apply(this,h.args));break;case"setLayerZoomRange":i.push(()=>this.setLayerZoomRange.apply(this,h.args));break;case"setLight":i.push(()=>this.setLight.apply(this,h.args));break;case"setGeoJSONSourceData":i.push(()=>this.setGeoJSONSourceData.apply(this,h.args));break;case"setGlyphs":i.push(()=>this.setGlyphs.apply(this,h.args));break;case"setSprite":i.push(()=>this.setSprite.apply(this,h.args));break;case"setTerrain":i.push(()=>this.map.setTerrain.apply(this,h.args));break;case"setSky":i.push(()=>this.setSky.apply(this,h.args));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setTransition":i.push(()=>{});break;default:l.push(h.command)}return{operations:i,unimplemented:l}}addImage(e,i){if(this.getImage(e))return this.fire(new c.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(e,i){this.imageManager.updateImage(e,i)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(c.y.source,`sources.${e}`,i,null,l))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const h=this.sourceCaches[e]=new Oe(e,i,this.dispatcher);h.style=this,h.setEventedParent(this,()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:e})),h.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new c.k(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,i){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(i),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,i,l={}){this._checkLoaded();const h=e.id;if(this.getLayer(h))return void this.fire(new c.k(new Error(`Layer "${h}" already exists on this map.`)));let m;if(e.type==="custom"){if(Ku(this,c.bD(e)))return;m=c.bA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(h,e.source),e=c.bB(e),e=c.e(e,{source:h})),this._validate(c.y.layer,`layers.${h}`,e,{arrayIndex:-1},l))return;m=c.bA(e),this._validateLayer(m),m.setEventedParent(this,{layer:{id:h}})}const y=i?this._order.indexOf(i):this._order.length;if(i&&y===-1)this.fire(new c.k(new Error(`Cannot add layer "${h}" before non-existing layer "${i}".`)));else{if(this._order.splice(y,0,h),this._layerOrderChanged=!0,this._layers[h]=m,this._removedLayers[h]&&m.source&&m.type!=="custom"){const b=this._removedLayers[h];delete this._removedLayers[h],b.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const l=this._order.indexOf(e);this._order.splice(l,1);const h=i?this._order.indexOf(i):this._order.length;i&&h===-1?this.fire(new c.k(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(h,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,i,l){this._checkLoaded();const h=this.getLayer(e);h?h.minzoom===i&&h.maxzoom===l||(i!=null&&(h.minzoom=i),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,l={}){this._checkLoaded();const h=this.getLayer(e);if(h){if(!c.bE(h.filter,i))return i==null?(h.filter=void 0,void this._updateLayer(h)):void(this._validate(c.y.filter,`layers.${h.id}.filter`,i,null,l)||(h.filter=c.bB(i),this._updateLayer(h)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.bB(this.getLayer(e).filter)}setLayoutProperty(e,i,l,h={}){this._checkLoaded();const m=this.getLayer(e);m?c.bE(m.getLayoutProperty(i),l)||(m.setLayoutProperty(i,l,h),this._updateLayer(m)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const l=this.getLayer(e);if(l)return l.getLayoutProperty(i);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,l,h={}){this._checkLoaded();const m=this.getLayer(e);m?c.bE(m.getPaintProperty(i),l)||(m.setPaintProperty(i,l,h)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,i){return this.getLayer(e).getPaintProperty(i)}setFeatureState(e,i){this._checkLoaded();const l=e.source,h=e.sourceLayer,m=this.sourceCaches[l];if(m===void 0)return void this.fire(new c.k(new Error(`The source '${l}' does not exist in the map's style.`)));const y=m.getSource().type;y==="geojson"&&h?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||h?(e.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),m.setFeatureState(h,e.id,i)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const l=e.source,h=this.sourceCaches[l];if(h===void 0)return void this.fire(new c.k(new Error(`The source '${l}' does not exist in the map's style.`)));const m=h.getSource().type,y=m==="vector"?e.sourceLayer:void 0;m!=="vector"||y?i&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(y,e.id,i):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,l=e.sourceLayer,h=this.sourceCaches[i];if(h!==void 0)return h.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,e.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.bF(this.sourceCaches,m=>m.serialize()),i=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,h=this.stylesheet;return c.bG({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:e,layers:i,terrain:l},m=>m!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const i=y=>this._layers[y].type==="fill-extrusion",l={},h=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(i(b)){l[b]=y;for(const E of e){const P=E[b];if(P)for(const z of P)h.push(z)}}}h.sort((y,b)=>b.intersectionZ-y.intersectionZ);const m=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(i(b))for(let E=h.length-1;E>=0;E--){const P=h[E].feature;if(l[P.layer.id]<y)break;m.push(P),h.pop()}else for(const E of e){const P=E[b];if(P)for(const z of P)m.push(z.feature)}}return m}queryRenderedFeatures(e,i,l){i&&i.filter&&this._validate(c.y.filter,"queryRenderedFeatures.filter",i.filter,null,i);const h={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const P of i.layers){const z=this._layers[P];if(!z)return this.fire(new c.k(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];h[z.source]=!0}}const m=[];i.availableImages=this._availableImages;const y=this._serializedAllLayers(),b=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,E=Object.assign(Object.assign({},i),{layers:b});for(const P in this.sourceCaches)i.layers&&!h[P]||m.push(Si(this.sourceCaches[P],this._layers,y,e,E,l,this.map.terrain?(z,F,N)=>this.map.terrain.getElevation(z,F,N):void 0));return this.placement&&m.push(function(P,z,F,N,H,$,ce){const le={},he=$.queryRenderedSymbols(N),xe=[];for(const Te of Object.keys(he).map(Number))xe.push(ce[Te]);xe.sort(jr);for(const Te of xe){const we=Te.featureIndex.lookupSymbolFeatures(he[Te.bucketInstanceId],z,Te.bucketIndex,Te.sourceLayerIndex,H.filter,H.layers,H.availableImages,P);for(const Ae in we){const ke=le[Ae]=le[Ae]||[],De=we[Ae];De.sort((Qe,dt)=>{const nt=Te.featureSortOrder;if(nt){const it=nt.indexOf(Qe.featureIndex);return nt.indexOf(dt.featureIndex)-it}return dt.featureIndex-Qe.featureIndex});for(const Qe of De)ke.push(Qe)}}return function(Te,we,Ae){for(const ke in Te)for(const De of Te[ke])rr(De,Ae[we[ke].source]);return Te}(le,P,F)}(this._layers,y,this.sourceCaches,e,E,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(e,i){i&&i.filter&&this._validate(c.y.filter,"querySourceFeatures.filter",i.filter,null,i);const l=this.sourceCaches[e];return l?function(h,m){const y=h.getRenderableIds().map(P=>h.getTileByID(P)),b=[],E={};for(let P=0;P<y.length;P++){const z=y[P],F=z.tileID.canonical.key;E[F]||(E[F]=!0,z.querySourceFeatures(b,m))}return b}(l,i):[]}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const y in e)if(!c.bE(e[y],l[y])){h=!0;break}if(!h)return;const m={now:_e.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(m)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,i={}){this._checkLoaded();const l=this.getSky();let h=!1;if(!e&&!l)return;if(e&&!l)h=!0;else if(!e&&l)h=!0;else for(const y in e)if(!c.bE(e[y],l[y])){h=!0;break}if(!h)return;const m={now:_e.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,i),this.sky.updateTransitions(m)}_setProjectionInternal(e){const i=function(l){if(Array.isArray(l)){const h=new Ho({type:l});return{projection:h,transform:new Qo,cameraHelper:new Ko(h)}}switch(l){case"mercator":return{projection:new Vs,transform:new ys,cameraHelper:new Ua};case"globe":{const h=new Ho({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:h,transform:new Qo,cameraHelper:new Ko(h)}}case"vertical-perspective":return{projection:new Go,transform:new Wo,cameraHelper:new Va};default:return c.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new Vs,transform:new ys,cameraHelper:new Ua}}}(e);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(const l in this.sourceCaches)this.sourceCaches[l].reload()}_validate(e,i,l,h,m={}){return(!m||m.validate!==!1)&&Ku(this,e.call(c.y,c.e({key:i,style:this.serialize(),value:l,styleSpec:c.v},h)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ei().off(_i,this._rtlPluginLoaded);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this.sourceCaches){const l=this.sourceCaches[i];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const i in this.sourceCaches)this.sourceCaches[i].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,i,l,h,m=!1){let y=!1,b=!1;const E={};for(const P of this._order){const z=this._layers[P];if(z.type!=="symbol")continue;if(!E[z.source]){const N=this.sourceCaches[z.source];E[z.source]=N.getRenderableIds(!0).map(H=>N.getTileByID(H)).sort((H,$)=>$.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan($.tileID)?-1:1))}const F=this.crossTileSymbolIndex.addLayer(z,E[z.source],e.center.lng);y=y||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_e.now(),e.zoom))&&(this.pauseablePlacement=new qt(e,this.map.terrain,this._order,m,i,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(_e.now()),b=!0),y&&this.pauseablePlacement.placement.setStale()),b||y)for(const P of this._order){const z=this._layers[P];z.type==="symbol"&&this.placement.updateLayerOpacities(z,E[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_e.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,i){return c._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const h=this.sourceCaches[i.source];return h&&h.setDependencies(i.tileID.key,i.type,i.icons),l})}getGlyphs(e,i){return c._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(i.stacks),h=this.sourceCaches[i.source];return h&&h.setDependencies(i.tileID.key,i.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(c.y.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,l={},h){this._checkLoaded();const m=[{id:e,url:i}],y=[...Pe(this.stylesheet.sprite),...m];this._validate(c.y.sprite,"sprite",y,null,l)||(this.stylesheet.sprite=y,this._loadSprite(m,!0,h))}removeSprite(e){this._checkLoaded();const i=Pe(this.stylesheet.sprite);if(i.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;i.splice(i.findIndex(l=>l.id===e),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Pe(this.stylesheet.sprite)}setSprite(e,i={},l){this._checkLoaded(),e&&this._validate(c.y.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var dd=c.aG([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class pd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,i,l,h,m,y,b,E,P){this.context=e;let z=this.boundPaintVertexBuffers.length!==h.length;for(let F=0;!z&&F<h.length;F++)this.boundPaintVertexBuffers[F]!==h[F]&&(z=!0);!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==l||z||this.boundIndexBuffer!==m||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==P?this.freshBind(i,l,h,m,y,b,E,P):(e.bindVertexArray.set(this.vao),b&&b.bind(),m&&m.dynamicDraw&&m.bind(),E&&E.bind(),P&&P.bind())}freshBind(e,i,l,h,m,y,b,E){const P=e.numAttributes,z=this.context,F=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=E,i.enableAttributes(F,e);for(const N of l)N.enableAttributes(F,e);y&&y.enableAttributes(F,e),b&&b.enableAttributes(F,e),E&&E.enableAttributes(F,e),i.bind(),i.setVertexAttribPointers(F,e,m);for(const N of l)N.bind(),N.setVertexAttribPointers(F,e,m);y&&(y.bind(),y.setVertexAttribPointers(F,e,m)),h&&h.bind(),b&&(b.bind(),b.setVertexAttribPointers(F,e,m)),E&&(E.bind(),E.setVertexAttribPointers(F,e,m)),z.currentNumAttributes=P}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const md=(d,e,i,l,h)=>({u_texture:0,u_ele_delta:d,u_fog_matrix:e,u_fog_color:i?i.properties.get("fog-color"):c.b7.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:i?i.calculateFogBlendOpacity(l):0,u_horizon_color:i?i.properties.get("horizon-color"):c.b7.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),Ju={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Dl(d){const e=[];for(let i=0;i<d.length;i++){if(d[i]===null)continue;const l=d[i].split(" ");e.push(l.pop())}return e}class ec{constructor(e,i,l,h,m,y,b,E,P=[]){const z=e.gl;this.program=z.createProgram();const F=Dl(i.staticAttributes),N=l?l.getBinderAttributes():[],H=F.concat(N),$=Xr.prelude.staticUniforms?Dl(Xr.prelude.staticUniforms):[],ce=b.staticUniforms?Dl(b.staticUniforms):[],le=i.staticUniforms?Dl(i.staticUniforms):[],he=l?l.getBinderUniforms():[],xe=$.concat(ce).concat(le).concat(he),Te=[];for(const nt of xe)Te.indexOf(nt)<0&&Te.push(nt);const we=l?l.defines():[];cn(z)&&we.unshift("#version 300 es"),m&&we.push("#define OVERDRAW_INSPECTOR;"),y&&we.push("#define TERRAIN3D;"),E&&we.push(E),P&&we.push(...P);let Ae=we.concat(Xr.prelude.fragmentSource,b.fragmentSource,i.fragmentSource).join(`
`),ke=we.concat(Xr.prelude.vertexSource,b.vertexSource,i.vertexSource).join(`
`);cn(z)||(Ae=function(nt){return nt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(Ae),ke=function(nt){return nt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(ke));const De=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(De,Ae),z.compileShader(De),!z.getShaderParameter(De,z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${z.getShaderInfoLog(De)}`);z.attachShader(this.program,De);const Qe=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(Qe,ke),z.compileShader(Qe),!z.getShaderParameter(Qe,z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${z.getShaderInfoLog(Qe)}`);z.attachShader(this.program,Qe),this.attributes={};const dt={};this.numAttributes=H.length;for(let nt=0;nt<this.numAttributes;nt++)H[nt]&&(z.bindAttribLocation(this.program,nt,H[nt]),this.attributes[H[nt]]=nt);if(z.linkProgram(this.program),!z.getProgramParameter(this.program,z.LINK_STATUS))throw new Error(`Program failed to link: ${z.getProgramInfoLog(this.program)}`);z.deleteShader(Qe),z.deleteShader(De);for(let nt=0;nt<Te.length;nt++){const it=Te[nt];if(it&&!dt[it]){const ut=z.getUniformLocation(this.program,it);ut&&(dt[it]=ut)}}this.fixedUniforms=h(e,dt),this.terrainUniforms=((nt,it)=>({u_depth:new c.bH(nt,it.u_depth),u_terrain:new c.bH(nt,it.u_terrain),u_terrain_dim:new c.b8(nt,it.u_terrain_dim),u_terrain_matrix:new c.bJ(nt,it.u_terrain_matrix),u_terrain_unpack:new c.bK(nt,it.u_terrain_unpack),u_terrain_exaggeration:new c.b8(nt,it.u_terrain_exaggeration)}))(e,dt),this.projectionUniforms=((nt,it)=>({u_projection_matrix:new c.bJ(nt,it.u_projection_matrix),u_projection_tile_mercator_coords:new c.bK(nt,it.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.bK(nt,it.u_projection_clipping_plane),u_projection_transition:new c.b8(nt,it.u_projection_transition),u_projection_fallback_matrix:new c.bJ(nt,it.u_projection_fallback_matrix)}))(e,dt),this.binderUniforms=l?l.getUniforms(e,dt):[]}draw(e,i,l,h,m,y,b,E,P,z,F,N,H,$,ce,le,he,xe,Te){const we=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(h),e.setColorMode(m),e.setCullFace(y),E){e.activeTexture.set(we.TEXTURE2),we.bindTexture(we.TEXTURE_2D,E.depthTexture),e.activeTexture.set(we.TEXTURE3),we.bindTexture(we.TEXTURE_2D,E.texture);for(const ke in this.terrainUniforms)this.terrainUniforms[ke].set(E[ke])}if(P)for(const ke in P)this.projectionUniforms[Ju[ke]].set(P[ke]);if(b)for(const ke in this.fixedUniforms)this.fixedUniforms[ke].set(b[ke]);le&&le.setUniforms(e,this.binderUniforms,$,{zoom:ce});let Ae=0;switch(i){case we.LINES:Ae=2;break;case we.TRIANGLES:Ae=3;break;case we.LINE_STRIP:Ae=1}for(const ke of H.get()){const De=ke.vaos||(ke.vaos={});(De[z]||(De[z]=new pd)).bind(e,this,F,le?le.getPaintVertexBuffers():[],N,ke.vertexOffset,he,xe,Te),we.drawElements(i,ke.primitiveLength*Ae,we.UNSIGNED_SHORT,ke.primitiveOffset*Ae*2)}}}function tc(d,e,i){const l=1/c.az(i,1,e.transform.tileZoom),h=Math.pow(2,i.tileID.overscaledZ),m=i.tileSize*Math.pow(2,e.transform.tileZoom)/h,y=m*(i.tileID.canonical.x+i.tileID.wrap*h),b=m*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[l,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const rc=(d,e,i,l)=>{const h=d.style.light,m=h.properties.get("position"),y=[m.x,m.y,m.z],b=c.bN();h.properties.get("anchor")==="viewport"&&c.bO(b,d.transform.bearingInRadians),c.bP(y,y,b);const E=d.transform.transformLightDirection(y),P=h.properties.get("color");return{u_lightpos:y,u_lightpos_globe:E,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+e,u_opacity:i,u_fill_translate:l}},qa=(d,e,i,l,h,m,y)=>c.e(rc(d,e,i,l),tc(m,d,y),{u_height_factor:-Math.pow(2,h.overscaledZ)/y.tileSize/8}),Il=(d,e,i,l)=>c.e(tc(e,d,i),{u_fill_translate:l}),Jc=(d,e)=>({u_world:d,u_fill_translate:e}),Pl=(d,e,i,l,h)=>c.e(Il(d,e,i,h),{u_world:l}),Rl=(d,e,i,l,h)=>{const m=d.transform;let y,b,E=0;if(i.paint.get("circle-pitch-alignment")==="map"){const P=c.az(e,1,m.zoom);y=!0,b=[P,P],E=P/(c.Z*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*h}else y=!1,b=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(i.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+y,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:b,u_globe_extrude_scale:E,u_translate:l}},Wh=d=>({u_pixel_extrude_scale:[1/d.width,1/d.height]}),pu=d=>({u_viewport_size:[d.width,d.height]}),eh=(d,e=1)=>({u_color:d,u_overlay:0,u_overlay_scale:e}),Ga=(d,e,i,l)=>{const h=c.az(d,1,e)/(c.Z*Math.pow(2,d.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:c.az(d,1,e),u_intensity:i,u_globe_extrude_scale:h}},Qh=(d,e,i,l)=>{const h=c.K();c.bQ(h,0,d.width,d.height,0,0,1);const m=d.context.gl;return{u_matrix:h,u_world:[m.drawingBufferWidth,m.drawingBufferHeight],u_image:i,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}},Kh=(d,e,i)=>{const l=i.paint.get("hillshade-accent-color");let h;switch(i.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const m=i.getIlluminationProperties();for(let y=0;y<m.directionRadians.length;y++)i.paint.get("hillshade-illumination-anchor")==="viewport"&&(m.directionRadians[y]+=d.transform.bearingInRadians);return{u_image:0,u_latrange:th(0,e.tileID),u_exaggeration:i.paint.get("hillshade-exaggeration"),u_altitudes:m.altitudeRadians,u_azimuths:m.directionRadians,u_accent:l,u_method:h,u_highlights:m.highlightColor,u_shadows:m.shadowColor}},gd=(d,e)=>{const i=e.stride,l=c.K();return c.bQ(l,0,c.Z,-8192,0,0,1),c.L(l,l,[0,-8192,0]),{u_matrix:l,u_image:1,u_dimension:[i,i],u_zoom:d.overscaledZ,u_unpack:e.getUnpackVector()}};function th(d,e){const i=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new c.$(0,l/i).toLngLat().lat,new c.$(0,(l+1)/i).toLngLat().lat]}const zl=(d,e,i,l)=>{const h=d.transform;return{u_translation:Zs(d,e,i),u_ratio:l/c.az(e,1,h.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Ll=(d,e,i,l,h)=>c.e(zl(d,e,i,l),{u_image:0,u_image_height:h}),kl=(d,e,i,l,h)=>{const m=d.transform,y=Bl(e,m);return{u_translation:Zs(d,e,i),u_texsize:e.imageAtlasTexture.size,u_ratio:l/c.az(e,1,m.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[y,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Jh=(d,e,i,l,h,m)=>{const y=d.lineAtlas,b=Bl(e,d.transform),E=i.layout.get("line-cap")==="round",P=y.getDash(h.from,E),z=y.getDash(h.to,E),F=P.width*m.fromScale,N=z.width*m.toScale;return c.e(zl(d,e,i,l),{u_patternscale_a:[b/F,-P.height/2],u_patternscale_b:[b/N,-z.height/2],u_sdfgamma:y.width/(256*Math.min(F,N)*d.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:z.y,u_mix:m.t})};function Bl(d,e){return 1/c.az(d,1,e.tileZoom)}function Zs(d,e,i){return c.aA(d.transform,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const rh=(d,e,i,l,h)=>{return{u_tl_parent:d,u_scale_parent:e,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(y=l.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(m=l.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:ic(l.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var m,y};function ic(d){d*=Math.PI/180;const e=Math.sin(d),i=Math.cos(d);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const wo=(d,e,i,l,h,m,y,b,E,P,z,F,N)=>{const H=y.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:H.width/H.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_label_plane_matrix:b,u_coord_matrix:E,u_is_text:+z,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:m,u_texsize:F,u_texture:0,u_translation:P,u_pitched_scale:N}},ih=(d,e,i,l,h,m,y,b,E,P,z,F,N,H)=>{const $=y.transform;return c.e(wo(d,e,i,l,h,m,y,b,E,P,z,F,H),{u_gamma_scale:l?Math.cos($.pitch*Math.PI/180)*$.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:1})},mu=(d,e,i,l,h,m,y,b,E,P,z,F,N)=>c.e(ih(d,e,i,l,h,m,y,b,E,P,!0,z,0,N),{u_texsize_icon:F,u_texture_icon:1}),ef=(d,e)=>({u_opacity:d,u_color:e}),_d=(d,e,i,l,h)=>c.e(function(m,y,b,E){const P=b.imageManager.getPattern(m.from.toString()),z=b.imageManager.getPattern(m.to.toString()),{width:F,height:N}=b.imageManager.getPixelSize(),H=Math.pow(2,E.tileID.overscaledZ),$=E.tileSize*Math.pow(2,b.transform.tileZoom)/H,ce=$*(E.tileID.canonical.x+E.tileID.wrap*H),le=$*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[F,N],u_mix:y.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/c.az(E,1,b.transform.tileZoom),u_pixel_coord_upper:[ce>>16,le>>16],u_pixel_coord_lower:[65535&ce,65535&le]}}(i,h,e,l),{u_opacity:d}),nh=(d,e)=>{},tf={fillExtrusion:(d,e)=>({u_lightpos:new c.bL(d,e.u_lightpos),u_lightpos_globe:new c.bL(d,e.u_lightpos_globe),u_lightintensity:new c.b8(d,e.u_lightintensity),u_lightcolor:new c.bL(d,e.u_lightcolor),u_vertical_gradient:new c.b8(d,e.u_vertical_gradient),u_opacity:new c.b8(d,e.u_opacity),u_fill_translate:new c.bM(d,e.u_fill_translate)}),fillExtrusionPattern:(d,e)=>({u_lightpos:new c.bL(d,e.u_lightpos),u_lightpos_globe:new c.bL(d,e.u_lightpos_globe),u_lightintensity:new c.b8(d,e.u_lightintensity),u_lightcolor:new c.bL(d,e.u_lightcolor),u_vertical_gradient:new c.b8(d,e.u_vertical_gradient),u_height_factor:new c.b8(d,e.u_height_factor),u_opacity:new c.b8(d,e.u_opacity),u_fill_translate:new c.bM(d,e.u_fill_translate),u_image:new c.bH(d,e.u_image),u_texsize:new c.bM(d,e.u_texsize),u_pixel_coord_upper:new c.bM(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bM(d,e.u_pixel_coord_lower),u_scale:new c.bL(d,e.u_scale),u_fade:new c.b8(d,e.u_fade)}),fill:(d,e)=>({u_fill_translate:new c.bM(d,e.u_fill_translate)}),fillPattern:(d,e)=>({u_image:new c.bH(d,e.u_image),u_texsize:new c.bM(d,e.u_texsize),u_pixel_coord_upper:new c.bM(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bM(d,e.u_pixel_coord_lower),u_scale:new c.bL(d,e.u_scale),u_fade:new c.b8(d,e.u_fade),u_fill_translate:new c.bM(d,e.u_fill_translate)}),fillOutline:(d,e)=>({u_world:new c.bM(d,e.u_world),u_fill_translate:new c.bM(d,e.u_fill_translate)}),fillOutlinePattern:(d,e)=>({u_world:new c.bM(d,e.u_world),u_image:new c.bH(d,e.u_image),u_texsize:new c.bM(d,e.u_texsize),u_pixel_coord_upper:new c.bM(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bM(d,e.u_pixel_coord_lower),u_scale:new c.bL(d,e.u_scale),u_fade:new c.b8(d,e.u_fade),u_fill_translate:new c.bM(d,e.u_fill_translate)}),circle:(d,e)=>({u_camera_to_center_distance:new c.b8(d,e.u_camera_to_center_distance),u_scale_with_map:new c.bH(d,e.u_scale_with_map),u_pitch_with_map:new c.bH(d,e.u_pitch_with_map),u_extrude_scale:new c.bM(d,e.u_extrude_scale),u_device_pixel_ratio:new c.b8(d,e.u_device_pixel_ratio),u_globe_extrude_scale:new c.b8(d,e.u_globe_extrude_scale),u_translate:new c.bM(d,e.u_translate)}),collisionBox:(d,e)=>({u_pixel_extrude_scale:new c.bM(d,e.u_pixel_extrude_scale)}),collisionCircle:(d,e)=>({u_viewport_size:new c.bM(d,e.u_viewport_size)}),debug:(d,e)=>({u_color:new c.bI(d,e.u_color),u_overlay:new c.bH(d,e.u_overlay),u_overlay_scale:new c.b8(d,e.u_overlay_scale)}),depth:nh,clippingMask:nh,heatmap:(d,e)=>({u_extrude_scale:new c.b8(d,e.u_extrude_scale),u_intensity:new c.b8(d,e.u_intensity),u_globe_extrude_scale:new c.b8(d,e.u_globe_extrude_scale)}),heatmapTexture:(d,e)=>({u_matrix:new c.bJ(d,e.u_matrix),u_world:new c.bM(d,e.u_world),u_image:new c.bH(d,e.u_image),u_color_ramp:new c.bH(d,e.u_color_ramp),u_opacity:new c.b8(d,e.u_opacity)}),hillshade:(d,e)=>({u_image:new c.bH(d,e.u_image),u_latrange:new c.bM(d,e.u_latrange),u_exaggeration:new c.b8(d,e.u_exaggeration),u_altitudes:new c.bS(d,e.u_altitudes),u_azimuths:new c.bS(d,e.u_azimuths),u_accent:new c.bI(d,e.u_accent),u_method:new c.bH(d,e.u_method),u_shadows:new c.bR(d,e.u_shadows),u_highlights:new c.bR(d,e.u_highlights)}),hillshadePrepare:(d,e)=>({u_matrix:new c.bJ(d,e.u_matrix),u_image:new c.bH(d,e.u_image),u_dimension:new c.bM(d,e.u_dimension),u_zoom:new c.b8(d,e.u_zoom),u_unpack:new c.bK(d,e.u_unpack)}),line:(d,e)=>({u_translation:new c.bM(d,e.u_translation),u_ratio:new c.b8(d,e.u_ratio),u_device_pixel_ratio:new c.b8(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.bM(d,e.u_units_to_pixels)}),lineGradient:(d,e)=>({u_translation:new c.bM(d,e.u_translation),u_ratio:new c.b8(d,e.u_ratio),u_device_pixel_ratio:new c.b8(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.bM(d,e.u_units_to_pixels),u_image:new c.bH(d,e.u_image),u_image_height:new c.b8(d,e.u_image_height)}),linePattern:(d,e)=>({u_translation:new c.bM(d,e.u_translation),u_texsize:new c.bM(d,e.u_texsize),u_ratio:new c.b8(d,e.u_ratio),u_device_pixel_ratio:new c.b8(d,e.u_device_pixel_ratio),u_image:new c.bH(d,e.u_image),u_units_to_pixels:new c.bM(d,e.u_units_to_pixels),u_scale:new c.bL(d,e.u_scale),u_fade:new c.b8(d,e.u_fade)}),lineSDF:(d,e)=>({u_translation:new c.bM(d,e.u_translation),u_ratio:new c.b8(d,e.u_ratio),u_device_pixel_ratio:new c.b8(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.bM(d,e.u_units_to_pixels),u_patternscale_a:new c.bM(d,e.u_patternscale_a),u_patternscale_b:new c.bM(d,e.u_patternscale_b),u_sdfgamma:new c.b8(d,e.u_sdfgamma),u_image:new c.bH(d,e.u_image),u_tex_y_a:new c.b8(d,e.u_tex_y_a),u_tex_y_b:new c.b8(d,e.u_tex_y_b),u_mix:new c.b8(d,e.u_mix)}),raster:(d,e)=>({u_tl_parent:new c.bM(d,e.u_tl_parent),u_scale_parent:new c.b8(d,e.u_scale_parent),u_buffer_scale:new c.b8(d,e.u_buffer_scale),u_fade_t:new c.b8(d,e.u_fade_t),u_opacity:new c.b8(d,e.u_opacity),u_image0:new c.bH(d,e.u_image0),u_image1:new c.bH(d,e.u_image1),u_brightness_low:new c.b8(d,e.u_brightness_low),u_brightness_high:new c.b8(d,e.u_brightness_high),u_saturation_factor:new c.b8(d,e.u_saturation_factor),u_contrast_factor:new c.b8(d,e.u_contrast_factor),u_spin_weights:new c.bL(d,e.u_spin_weights),u_coords_top:new c.bK(d,e.u_coords_top),u_coords_bottom:new c.bK(d,e.u_coords_bottom)}),symbolIcon:(d,e)=>({u_is_size_zoom_constant:new c.bH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bH(d,e.u_is_size_feature_constant),u_size_t:new c.b8(d,e.u_size_t),u_size:new c.b8(d,e.u_size),u_camera_to_center_distance:new c.b8(d,e.u_camera_to_center_distance),u_pitch:new c.b8(d,e.u_pitch),u_rotate_symbol:new c.bH(d,e.u_rotate_symbol),u_aspect_ratio:new c.b8(d,e.u_aspect_ratio),u_fade_change:new c.b8(d,e.u_fade_change),u_label_plane_matrix:new c.bJ(d,e.u_label_plane_matrix),u_coord_matrix:new c.bJ(d,e.u_coord_matrix),u_is_text:new c.bH(d,e.u_is_text),u_pitch_with_map:new c.bH(d,e.u_pitch_with_map),u_is_along_line:new c.bH(d,e.u_is_along_line),u_is_variable_anchor:new c.bH(d,e.u_is_variable_anchor),u_texsize:new c.bM(d,e.u_texsize),u_texture:new c.bH(d,e.u_texture),u_translation:new c.bM(d,e.u_translation),u_pitched_scale:new c.b8(d,e.u_pitched_scale)}),symbolSDF:(d,e)=>({u_is_size_zoom_constant:new c.bH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bH(d,e.u_is_size_feature_constant),u_size_t:new c.b8(d,e.u_size_t),u_size:new c.b8(d,e.u_size),u_camera_to_center_distance:new c.b8(d,e.u_camera_to_center_distance),u_pitch:new c.b8(d,e.u_pitch),u_rotate_symbol:new c.bH(d,e.u_rotate_symbol),u_aspect_ratio:new c.b8(d,e.u_aspect_ratio),u_fade_change:new c.b8(d,e.u_fade_change),u_label_plane_matrix:new c.bJ(d,e.u_label_plane_matrix),u_coord_matrix:new c.bJ(d,e.u_coord_matrix),u_is_text:new c.bH(d,e.u_is_text),u_pitch_with_map:new c.bH(d,e.u_pitch_with_map),u_is_along_line:new c.bH(d,e.u_is_along_line),u_is_variable_anchor:new c.bH(d,e.u_is_variable_anchor),u_texsize:new c.bM(d,e.u_texsize),u_texture:new c.bH(d,e.u_texture),u_gamma_scale:new c.b8(d,e.u_gamma_scale),u_device_pixel_ratio:new c.b8(d,e.u_device_pixel_ratio),u_is_halo:new c.bH(d,e.u_is_halo),u_translation:new c.bM(d,e.u_translation),u_pitched_scale:new c.b8(d,e.u_pitched_scale)}),symbolTextAndIcon:(d,e)=>({u_is_size_zoom_constant:new c.bH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bH(d,e.u_is_size_feature_constant),u_size_t:new c.b8(d,e.u_size_t),u_size:new c.b8(d,e.u_size),u_camera_to_center_distance:new c.b8(d,e.u_camera_to_center_distance),u_pitch:new c.b8(d,e.u_pitch),u_rotate_symbol:new c.bH(d,e.u_rotate_symbol),u_aspect_ratio:new c.b8(d,e.u_aspect_ratio),u_fade_change:new c.b8(d,e.u_fade_change),u_label_plane_matrix:new c.bJ(d,e.u_label_plane_matrix),u_coord_matrix:new c.bJ(d,e.u_coord_matrix),u_is_text:new c.bH(d,e.u_is_text),u_pitch_with_map:new c.bH(d,e.u_pitch_with_map),u_is_along_line:new c.bH(d,e.u_is_along_line),u_is_variable_anchor:new c.bH(d,e.u_is_variable_anchor),u_texsize:new c.bM(d,e.u_texsize),u_texsize_icon:new c.bM(d,e.u_texsize_icon),u_texture:new c.bH(d,e.u_texture),u_texture_icon:new c.bH(d,e.u_texture_icon),u_gamma_scale:new c.b8(d,e.u_gamma_scale),u_device_pixel_ratio:new c.b8(d,e.u_device_pixel_ratio),u_is_halo:new c.bH(d,e.u_is_halo),u_translation:new c.bM(d,e.u_translation),u_pitched_scale:new c.b8(d,e.u_pitched_scale)}),background:(d,e)=>({u_opacity:new c.b8(d,e.u_opacity),u_color:new c.bI(d,e.u_color)}),backgroundPattern:(d,e)=>({u_opacity:new c.b8(d,e.u_opacity),u_image:new c.bH(d,e.u_image),u_pattern_tl_a:new c.bM(d,e.u_pattern_tl_a),u_pattern_br_a:new c.bM(d,e.u_pattern_br_a),u_pattern_tl_b:new c.bM(d,e.u_pattern_tl_b),u_pattern_br_b:new c.bM(d,e.u_pattern_br_b),u_texsize:new c.bM(d,e.u_texsize),u_mix:new c.b8(d,e.u_mix),u_pattern_size_a:new c.bM(d,e.u_pattern_size_a),u_pattern_size_b:new c.bM(d,e.u_pattern_size_b),u_scale_a:new c.b8(d,e.u_scale_a),u_scale_b:new c.b8(d,e.u_scale_b),u_pixel_coord_upper:new c.bM(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bM(d,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.b8(d,e.u_tile_units_to_pixels)}),terrain:(d,e)=>({u_texture:new c.bH(d,e.u_texture),u_ele_delta:new c.b8(d,e.u_ele_delta),u_fog_matrix:new c.bJ(d,e.u_fog_matrix),u_fog_color:new c.bI(d,e.u_fog_color),u_fog_ground_blend:new c.b8(d,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.b8(d,e.u_fog_ground_blend_opacity),u_horizon_color:new c.bI(d,e.u_horizon_color),u_horizon_fog_blend:new c.b8(d,e.u_horizon_fog_blend),u_is_globe_mode:new c.b8(d,e.u_is_globe_mode)}),terrainDepth:(d,e)=>({u_ele_delta:new c.b8(d,e.u_ele_delta)}),terrainCoords:(d,e)=>({u_texture:new c.bH(d,e.u_texture),u_terrain_coords_id:new c.b8(d,e.u_terrain_coords_id),u_ele_delta:new c.b8(d,e.u_ele_delta)}),projectionErrorMeasurement:(d,e)=>({u_input:new c.b8(d,e.u_input),u_output_expected:new c.b8(d,e.u_output_expected)}),atmosphere:(d,e)=>({u_sun_pos:new c.bL(d,e.u_sun_pos),u_atmosphere_blend:new c.b8(d,e.u_atmosphere_blend),u_globe_position:new c.bL(d,e.u_globe_position),u_globe_radius:new c.b8(d,e.u_globe_radius),u_inv_proj_matrix:new c.bJ(d,e.u_inv_proj_matrix)}),sky:(d,e)=>({u_sky_color:new c.bI(d,e.u_sky_color),u_horizon_color:new c.bI(d,e.u_horizon_color),u_horizon:new c.bM(d,e.u_horizon),u_horizon_normal:new c.bM(d,e.u_horizon_normal),u_sky_horizon_blend:new c.b8(d,e.u_sky_horizon_blend),u_sky_blend:new c.b8(d,e.u_sky_blend)})};class rf{constructor(e,i,l){this.context=e;const h=e.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const i=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ah={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ya{constructor(e,i,l,h){this.length=i.length,this.attributes=l,this.itemSize=i.bytesPerElement,this.dynamicDraw=h,this.context=e;const m=e.gl;this.buffer=m.createBuffer(),e.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,i){for(let l=0;l<this.attributes.length;l++){const h=i.attributes[this.attributes[l].name];h!==void 0&&e.enableVertexAttribArray(h)}}setVertexAttribPointers(e,i,l){for(let h=0;h<this.attributes.length;h++){const m=this.attributes[h],y=i.attributes[m.name];y!==void 0&&e.vertexAttribPointer(y,m.components,e[ah[m.type]],!1,this.itemSize,m.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class qr{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class xs extends qr{getDefault(){return c.b7.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class nc extends qr{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ac extends qr{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class sc extends qr{getDefault(){return[!0,!0,!0,!0]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class oc extends qr{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class sh extends qr{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Za extends qr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const i=this.current;(e.func!==i.func||e.ref!==i.ref||e.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class gu extends qr{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class _u extends qr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=e,this.dirty=!1}}class oh extends qr{getDefault(){return[0,1]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class nf extends qr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=e,this.dirty=!1}}class Jo extends qr{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class el extends qr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.BLEND):i.disable(i.BLEND),this.current=e,this.dirty=!1}}class lh extends qr{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class uh extends qr{getDefault(){return c.b7.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class bs extends qr{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class yu extends qr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=e,this.dirty=!1}}class vu extends qr{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class lc extends qr{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class tl extends qr{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class uc extends qr{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Ol extends qr{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Aa extends qr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class ch extends qr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class cc extends qr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Ca extends qr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class To extends qr{getDefault(){return null}set(e){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ca extends qr{getDefault(){return null}set(e){var i;if(e===this.current&&!this.dirty)return;const l=this.gl;cn(l)?l.bindVertexArray(e):(i=l.getExtension("OES_vertex_array_object"))===null||i===void 0||i.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class ha extends qr{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ws extends qr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Nl extends qr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class rl extends qr{constructor(e,i){super(e),this.context=e,this.parent=i}getDefault(){return null}}class Hs extends rl{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Eo extends rl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class il extends rl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const xu="Framebuffer is not complete";class Lr{constructor(e,i,l,h,m){this.context=e,this.width=i,this.height=l;const y=e.gl,b=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new Hs(e,b),h)this.depthAttachment=m?new il(e,b):new Eo(e,b);else if(m)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error(xu)}destroy(){const e=this.context.gl,i=this.colorAttachment.get();if(i&&e.deleteTexture(i),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class $s{constructor(e){var i,l;if(this.gl=e,this.clearColor=new xs(this),this.clearDepth=new nc(this),this.clearStencil=new ac(this),this.colorMask=new sc(this),this.depthMask=new oc(this),this.stencilMask=new sh(this),this.stencilFunc=new Za(this),this.stencilOp=new gu(this),this.stencilTest=new _u(this),this.depthRange=new oh(this),this.depthTest=new nf(this),this.depthFunc=new Jo(this),this.blend=new el(this),this.blendFunc=new lh(this),this.blendColor=new uh(this),this.blendEquation=new bs(this),this.cullFace=new yu(this),this.cullFaceSide=new vu(this),this.frontFace=new lc(this),this.program=new tl(this),this.activeTexture=new uc(this),this.viewport=new Ol(this),this.bindFramebuffer=new Aa(this),this.bindRenderbuffer=new ch(this),this.bindTexture=new cc(this),this.bindVertexBuffer=new Ca(this),this.bindElementBuffer=new To(this),this.bindVertexArray=new ca(this),this.pixelStoreUnpack=new ha(this),this.pixelStoreUnpackPremultiplyAlpha=new ws(this),this.pixelStoreUnpackFlipY=new Nl(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),cn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const h=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(i=e.RGBA16F)!==null&&i!==void 0?i:h==null?void 0:h.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:h==null?void 0:h.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const h=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=h==null?void 0:h.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i){return new rf(this,e,i)}createVertexBuffer(e,i,l){return new ya(this,e,i,l)}createRenderbuffer(e,i,l){const h=this.gl,m=h.createRenderbuffer();return this.bindRenderbuffer.set(m),h.renderbufferStorage(h.RENDERBUFFER,e,i,l),this.bindRenderbuffer.set(null),m}createFramebuffer(e,i,l,h){return new Lr(this,e,i,l,h)}clear({color:e,depth:i,stencil:l}){const h=this.gl;let m=0;e&&(m|=h.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(m|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),l!==void 0&&(m|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(m)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.bE(e.blendFunction,fi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return cn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var i;return cn(this.gl)?this.gl.deleteVertexArray(e):(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let hc;function fa(d,e,i,l,h){const m=d.context,y=d.transform,b=m.gl,E=d.useProgram("collisionBox"),P=[];let z=0,F=0;for(let he=0;he<l.length;he++){const xe=l[he],Te=e.getTile(xe).getBucket(i);if(!Te)continue;const we=h?Te.textCollisionBox:Te.iconCollisionBox,Ae=Te.collisionCircleArray;Ae.length>0&&(P.push({circleArray:Ae,circleOffset:F,coord:xe}),z+=Ae.length/4,F=z),we&&E.draw(m,b.LINES,br.disabled,Pr.disabled,d.colorModeForRenderPass(),Vr.disabled,Wh(d.transform),d.style.map.terrain&&d.style.map.terrain.getTerrainData(xe),y.getProjectionData({overscaledTileID:xe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,null,d.transform.zoom,null,null,we.collisionVertexBuffer)}if(!h||!P.length)return;const N=d.useProgram("collisionCircle"),H=new c.bT;H.resize(4*z),H._trim();let $=0;for(const he of P)for(let xe=0;xe<he.circleArray.length/4;xe++){const Te=4*xe,we=he.circleArray[Te+0],Ae=he.circleArray[Te+1],ke=he.circleArray[Te+2],De=he.circleArray[Te+3];H.emplace($++,we,Ae,ke,De,0),H.emplace($++,we,Ae,ke,De,1),H.emplace($++,we,Ae,ke,De,2),H.emplace($++,we,Ae,ke,De,3)}(!hc||hc.length<2*z)&&(hc=function(he){const xe=2*he,Te=new c.bV;Te.resize(xe),Te._trim();for(let we=0;we<xe;we++){const Ae=6*we;Te.uint16[Ae+0]=4*we+0,Te.uint16[Ae+1]=4*we+1,Te.uint16[Ae+2]=4*we+2,Te.uint16[Ae+3]=4*we+2,Te.uint16[Ae+4]=4*we+3,Te.uint16[Ae+5]=4*we+0}return Te}(z));const ce=m.createIndexBuffer(hc,!0),le=m.createVertexBuffer(H,c.bU.members,!0);for(const he of P){const xe=pu(d.transform);N.draw(m,b.TRIANGLES,br.disabled,Pr.disabled,d.colorModeForRenderPass(),Vr.disabled,xe,d.style.map.terrain&&d.style.map.terrain.getTerrainData(he.coord),null,i.id,le,ce,c.aJ.simpleSegment(0,2*he.circleOffset,he.circleArray.length,he.circleArray.length/2),null,d.transform.zoom,null,null,null)}le.destroy(),ce.destroy()}const nl=c.ad(new Float32Array(16));function Xs(d,e,i,l,h,m){const{horizontalAlign:y,verticalAlign:b}=c.aE(d);return new c.P((-(y-.5)*e/h+l[0])*m,(-(b-.5)*i/h+l[1])*m)}function af(d,e,i,l,h,m){const y=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let b=l.mult(m);i||(b=b.rotate(-h));const E=y.add(b);return O(E.x,E.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(i){const b=ar(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(d),E=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return d.add(l.rotate(E))}return d.add(l)}function bu(d,e,i,l,h,m,y,b,E,P,z,F){const N=d.text.placedSymbolArray,H=d.text.dynamicLayoutVertexArray,$=d.icon.dynamicLayoutVertexArray,ce={};H.clear();for(let le=0;le<N.length;le++){const he=N.get(le),xe=he.hidden||!he.crossTileID||d.allowVerticalPlacement&&!he.placedOrientation?null:l[he.crossTileID];if(xe){const Te=new c.P(he.anchorX,he.anchorY),we={getElevation:F,width:h.width,height:h.height,pitchedLabelPlaneMatrix:m,pitchWithMap:i,transform:h,tileAnchorPoint:Te,translation:P,unwrappedTileID:z},Ae=i?Qt(Te.x,Te.y,we):ar(Te.x,Te.y,we),ke=me(h.cameraToCenterDistance,Ae.signedDistanceFromCamera);let De=c.am(d.textSizeData,b,he)*ke/c.ay;i&&(De*=d.tilePixelRatio/y);const{width:Qe,height:dt,anchor:nt,textOffset:it,textBoxScale:ut}=xe,Zt=Xs(nt,Qe,dt,it,ut,De),Vt=h.getPitchedTextCorrection(Te.x+P[0],Te.y+P[1],z),St=af(Ae.point,we,e,Zt,-h.bearingInRadians,Vt),sr=d.allowVerticalPlacement&&he.placedOrientation===c.al.vertical?Math.PI/2:0;for(let Rr=0;Rr<he.numGlyphs;Rr++)c.as(H,St,sr);E&&he.associatedIconIndex>=0&&(ce[he.associatedIconIndex]={shiftedAnchor:St,angle:sr})}else bi(he.numGlyphs,H)}if(E){$.clear();const le=d.icon.placedSymbolArray;for(let he=0;he<le.length;he++){const xe=le.get(he);if(xe.hidden)bi(xe.numGlyphs,$);else{const Te=ce[he];if(Te)for(let we=0;we<xe.numGlyphs;we++)c.as($,Te.shiftedAnchor,Te.angle);else bi(xe.numGlyphs,$)}}d.icon.dynamicLayoutVertexBuffer.updateData($)}d.text.dynamicLayoutVertexBuffer.updateData(H)}function al(d,e,i){return i.iconsInText&&e?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Fl(d,e,i,l,h,m,y,b,E,P,z,F,N){const H=d.context,$=H.gl,ce=d.transform,le=b==="map",he=E==="map",xe=b!=="viewport"&&i.layout.get("symbol-placement")!=="point",Te=le&&!he&&!xe,we=!i.layout.get("symbol-sort-key").isConstant();let Ae=!1;const ke=d.getDepthModeForSublayer(0,br.ReadOnly),De=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Qe=[],dt=ce.getCircleRadiusCorrection();for(const nt of l){const it=e.getTile(nt),ut=it.getBucket(i);if(!ut)continue;const Zt=h?ut.text:ut.icon;if(!Zt||!Zt.segments.get().length||!Zt.hasVisibleVertices)continue;const Vt=Zt.programConfigurations.get(i.id),St=h||ut.sdfIcons,sr=h?ut.textSizeData:ut.iconSizeData,Rr=he||ce.pitch!==0,Gr=d.useProgram(al(St,h,ut),Vt),Hi=c.ak(sr,ce.zoom),Ti=d.style.map.terrain&&d.style.map.terrain.getTerrainData(nt);let $i,Ni,Mi,ai,vn=[0,0],In=null;if(h)Ni=it.glyphAtlasTexture,Mi=$.LINEAR,$i=it.glyphAtlasTexture.size,ut.iconsInText&&(vn=it.imageAtlasTexture.size,In=it.imageAtlasTexture,ai=Rr||d.options.rotating||d.options.zooming||sr.kind==="composite"||sr.kind==="camera"?$.LINEAR:$.NEAREST);else{const rn=i.layout.get("icon-size").constantOr(0)!==1||ut.iconsNeedLinear;Ni=it.imageAtlasTexture,Mi=St||d.options.rotating||d.options.zooming||rn||Rr?$.LINEAR:$.NEAREST,$i=it.imageAtlasTexture.size}const Fn=c.az(it,1,d.transform.zoom),si=tr(le,d.transform,Fn),zs=c.K();c.an(zs,si);const os=ir(he,le,d.transform,Fn),no=c.aA(ce,it,m,y),ao=ce.getProjectionData({overscaledTileID:nt,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),Xl=De&&ut.hasTextData(),so=i.layout.get("icon-text-fit")!=="none"&&Xl&&ut.hasIconData();if(xe){const rn=d.style.map.terrain?(ra,Ei)=>d.style.map.terrain.getElevation(nt,ra,Ei):null,xn=i.layout.get("text-rotation-alignment")==="map";ze(ut,d,h,si,zs,he,P,xn,nt.toUnwrapped(),ce.width,ce.height,no,rn)}const pl=h&&De||so,Ia=xe||pl?nl:he?si:d.transform.clipSpaceToPixelsMatrix,oo=St&&i.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Pa;Pa=St?ut.iconsInText?mu(sr.kind,Hi,Te,he,xe,pl,d,Ia,os,no,$i,vn,dt):ih(sr.kind,Hi,Te,he,xe,pl,d,Ia,os,no,h,$i,0,dt):wo(sr.kind,Hi,Te,he,xe,pl,d,Ia,os,no,h,$i,dt);const Ls={program:Gr,buffers:Zt,uniformValues:Pa,projectionData:ao,atlasTexture:Ni,atlasTextureIcon:In,atlasInterpolation:Mi,atlasInterpolationIcon:ai,isSDF:St,hasHalo:oo};if(we&&ut.canOverlap){Ae=!0;const rn=Zt.segments.get();for(const xn of rn)Qe.push({segments:new c.aJ([xn]),sortKey:xn.sortKey,state:Ls,terrainData:Ti})}else Qe.push({segments:Zt.segments,sortKey:0,state:Ls,terrainData:Ti})}Ae&&Qe.sort((nt,it)=>nt.sortKey-it.sortKey);for(const nt of Qe){const it=nt.state;if(H.activeTexture.set($.TEXTURE0),it.atlasTexture.bind(it.atlasInterpolation,$.CLAMP_TO_EDGE),it.atlasTextureIcon&&(H.activeTexture.set($.TEXTURE1),it.atlasTextureIcon&&it.atlasTextureIcon.bind(it.atlasInterpolationIcon,$.CLAMP_TO_EDGE)),it.isSDF){const ut=it.uniformValues;it.hasHalo&&(ut.u_is_halo=1,sl(it.buffers,nt.segments,i,d,it.program,ke,z,F,ut,it.projectionData,nt.terrainData)),ut.u_is_halo=0}sl(it.buffers,nt.segments,i,d,it.program,ke,z,F,it.uniformValues,it.projectionData,nt.terrainData)}}function sl(d,e,i,l,h,m,y,b,E,P,z){const F=l.context;h.draw(F,F.gl.TRIANGLES,m,y,b,Vr.backCCW,E,z,P,i.id,d.layoutVertexBuffer,d.indexBuffer,e,i.paint,l.transform.zoom,d.programConfigurations.get(i.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Ys(d,e,i,l,h){const m=d.context,y=m.gl,b=Pr.disabled,E=new fi([y.ONE,y.ONE],c.b7.transparent,[!0,!0,!0,!0]),P=e.getBucket(i);if(!P)return;const z=l.key;let F=i.heatmapFbos.get(z);F||(F=ol(m,e.tileSize,e.tileSize),i.heatmapFbos.set(z,F)),m.bindFramebuffer.set(F.framebuffer),m.viewport.set([0,0,e.tileSize,e.tileSize]),m.clear({color:c.b7.transparent});const N=P.programConfigurations.get(i.id),H=d.useProgram("heatmap",N,!h),$=d.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ce=d.style.map.terrain.getTerrainData(l);H.draw(m,y.TRIANGLES,br.disabled,b,E,Vr.disabled,Ga(e,d.transform.zoom,i.paint.get("heatmap-intensity"),1),ce,$,i.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,i.paint,d.transform.zoom,N)}function So(d,e,i,l,h){const m=d.context,y=m.gl,b=d.transform;m.setColorMode(d.colorModeForRenderPass());const E=jl(m,e),P=i.key,z=e.heatmapFbos.get(P);if(!z)return;m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,z.colorAttachment.get()),m.activeTexture.set(y.TEXTURE1),E.bind(y.LINEAR,y.CLAMP_TO_EDGE);const F=b.getProjectionData({overscaledTileID:i,applyTerrainMatrix:h,applyGlobeMatrix:!l});d.useProgram("heatmapTexture").draw(m,y.TRIANGLES,br.disabled,Pr.disabled,d.colorModeForRenderPass(),Vr.disabled,Qh(d,e,0,1),null,F,e.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments,e.paint,b.zoom),z.destroy(),e.heatmapFbos.delete(P)}function ol(d,e,i){var l,h;const m=d.gl,y=m.createTexture();m.bindTexture(m.TEXTURE_2D,y),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR);const b=(l=d.HALF_FLOAT)!==null&&l!==void 0?l:m.UNSIGNED_BYTE,E=(h=d.RGBA16F)!==null&&h!==void 0?h:m.RGBA;m.texImage2D(m.TEXTURE_2D,0,E,e,i,0,m.RGBA,b,null);const P=d.createFramebuffer(e,i,!1,!1);return P.colorAttachment.set(y),P}function jl(d,e){return e.colorRampTexture||(e.colorRampTexture=new bt(d,e.colorRamp,d.gl.RGBA)),e.colorRampTexture}function Qn(d,e,i,l,h){if(!i||!l||!l.imageAtlas)return;const m=l.imageAtlas.patternPositions;let y=m[i.to.toString()],b=m[i.from.toString()];if(!y&&b&&(y=b),!b&&y&&(b=y),!y||!b){const E=h.getPaintProperty(e);y=m[E],b=m[E]}y&&b&&d.setConstantPatternPositions(y,b)}function Kn(d,e,i,l,h,m,y,b){const E=d.context.gl,P="fill-pattern",z=i.paint.get(P),F=z&&z.constantOr(1),N=i.getCrossfadeParameters();let H,$,ce,le,he;const xe=d.transform,Te=i.paint.get("fill-translate"),we=i.paint.get("fill-translate-anchor");y?($=F&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=E.LINES):($=F?"fillPattern":"fill",H=E.TRIANGLES);const Ae=z.constantOr(null);for(const ke of l){const De=e.getTile(ke);if(F&&!De.patternsLoaded())continue;const Qe=De.getBucket(i);if(!Qe)continue;const dt=Qe.programConfigurations.get(i.id),nt=d.useProgram($,dt),it=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ke);F&&(d.context.activeTexture.set(E.TEXTURE0),De.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),dt.updatePaintBuffers(N)),Qn(dt,P,Ae,De,i);const ut=xe.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!b,applyTerrainMatrix:!0}),Zt=c.aA(xe,De,Te,we);if(y){le=Qe.indexBuffer2,he=Qe.segments2;const St=[E.drawingBufferWidth,E.drawingBufferHeight];ce=$==="fillOutlinePattern"&&F?Pl(d,N,De,St,Zt):Jc(St,Zt)}else le=Qe.indexBuffer,he=Qe.segments,ce=F?Il(d,N,De,Zt):{u_fill_translate:Zt};const Vt=d.stencilModeForClipping(ke);nt.draw(d.context,H,h,Vt,m,Vr.backCCW,ce,it,ut,i.id,Qe.layoutVertexBuffer,le,he,i.paint,d.transform.zoom,dt)}}function Ja(d,e,i,l,h,m,y,b){const E=d.context,P=E.gl,z="fill-extrusion-pattern",F=i.paint.get(z),N=F.constantOr(1),H=i.getCrossfadeParameters(),$=i.paint.get("fill-extrusion-opacity"),ce=F.constantOr(null),le=d.transform;for(const he of l){const xe=e.getTile(he),Te=xe.getBucket(i);if(!Te)continue;const we=d.style.map.terrain&&d.style.map.terrain.getTerrainData(he),Ae=Te.programConfigurations.get(i.id),ke=d.useProgram(N?"fillExtrusionPattern":"fillExtrusion",Ae);N&&(d.context.activeTexture.set(P.TEXTURE0),xe.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Ae.updatePaintBuffers(H));const De=le.getProjectionData({overscaledTileID:he,applyGlobeMatrix:!b,applyTerrainMatrix:!0});Qn(Ae,z,ce,xe,i);const Qe=c.aA(le,xe,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),dt=i.paint.get("fill-extrusion-vertical-gradient"),nt=N?qa(d,dt,$,Qe,he,H,xe):rc(d,dt,$,Qe);ke.draw(E,E.gl.TRIANGLES,h,m,y,Vr.backCCW,nt,we,De,i.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,i.paint,d.transform.zoom,Ae,d.style.map.terrain&&Te.centroidVertexBuffer)}}function es(d,e,i,l,h,m,y,b,E){var P;const z=d.style.projection,F=d.context,N=d.transform,H=F.gl,$=[`#define NUM_ILLUMINATION_SOURCES ${i.paint.get("hillshade-highlight-color").values.length}`],ce=d.useProgram("hillshade",null,!1,$),le=!d.options.moving;for(const he of l){const xe=e.getTile(he),Te=xe.fbo;if(!Te)continue;const we=z.getMeshFromTileID(F,he.canonical,b,!0,"raster"),Ae=(P=d.style.map.terrain)===null||P===void 0?void 0:P.getTerrainData(he);F.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,Te.colorAttachment.get());const ke=N.getProjectionData({overscaledTileID:he,aligned:le,applyGlobeMatrix:!E,applyTerrainMatrix:!0});ce.draw(F,H.TRIANGLES,m,h[he.overscaledZ],y,Vr.backCCW,Kh(d,xe,i),Ae,ke,i.id,we.vertexBuffer,we.indexBuffer,we.segments)}}const Ma=[new c.P(0,0),new c.P(c.Z,0),new c.P(c.Z,c.Z),new c.P(0,c.Z)];function Ts(d,e,i,l,h,m,y,b,E=!1,P=!1){const z=l[l.length-1].overscaledZ,F=d.context,N=F.gl,H=d.useProgram("raster"),$=d.transform,ce=d.style.projection,le=d.colorModeForRenderPass(),he=!d.options.moving;for(const xe of l){const Te=d.getDepthModeForSublayer(xe.overscaledZ-z,i.paint.get("raster-opacity")===1?br.ReadWrite:br.ReadOnly,N.LESS),we=e.getTile(xe);we.registerFadeDuration(i.paint.get("raster-fade-duration"));const Ae=e.findLoadedParent(xe,0),ke=e.findLoadedSibling(xe),De=hh(we,Ae||ke||null,e,i,d.transform,d.style.map.terrain);let Qe,dt;const nt=i.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR;F.activeTexture.set(N.TEXTURE0),we.texture.bind(nt,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(N.TEXTURE1),Ae?(Ae.texture.bind(nt,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),Qe=Math.pow(2,Ae.tileID.overscaledZ-we.tileID.overscaledZ),dt=[we.tileID.canonical.x*Qe%1,we.tileID.canonical.y*Qe%1]):we.texture.bind(nt,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),we.texture.useMipmap&&F.extTextureFilterAnisotropic&&d.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax);const it=d.style.map.terrain&&d.style.map.terrain.getTerrainData(xe),ut=$.getProjectionData({overscaledTileID:xe,aligned:he,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),Zt=rh(dt||[0,0],Qe||1,De,i,b),Vt=ce.getMeshFromTileID(F,xe.canonical,m,y,"raster");H.draw(F,N.TRIANGLES,Te,h?h[xe.overscaledZ]:Pr.disabled,le,E?Vr.frontCCW:Vr.backCCW,Zt,it,ut,i.id,Vt.vertexBuffer,Vt.indexBuffer,Vt.segments)}}function hh(d,e,i,l,h,m){const y=l.paint.get("raster-fade-duration");if(!m&&y>0){const b=_e.now(),E=(b-d.timeAdded)/y,P=e?(b-e.timeAdded)/y:-1,z=i.getSource(),F=Ze(h,{tileSize:z.tileSize,roundZoom:z.roundZoom}),N=!e||Math.abs(e.tileID.overscaledZ-F)>Math.abs(d.tileID.overscaledZ-F),H=N&&d.refreshedUponExpiration?1:c.ae(N?E:1-P,0,1);return d.refreshedUponExpiration&&E>=1&&(d.refreshedUponExpiration=!1),e?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}const Ul=new c.b7(1,0,0,1),wu=new c.b7(0,1,0,1),Jn=new c.b7(0,0,1,1),tn=new c.b7(1,0,1,1),ni=new c.b7(0,1,1,1);function Es(d,e,i,l){ll(d,0,e+i/2,d.transform.width,i,l)}function ts(d,e,i,l){ll(d,e-i/2,0,i,d.transform.height,l)}function ll(d,e,i,l,h,m){const y=d.context,b=y.gl;b.enable(b.SCISSOR_TEST),b.scissor(e*d.pixelRatio,i*d.pixelRatio,l*d.pixelRatio,h*d.pixelRatio),y.clear({color:m}),b.disable(b.SCISSOR_TEST)}function Ci(d,e,i){const l=d.context,h=l.gl,m=d.useProgram("debug"),y=br.disabled,b=Pr.disabled,E=d.colorModeForRenderPass(),P="$debug",z=d.style.map.terrain&&d.style.map.terrain.getTerrainData(i);l.activeTexture.set(h.TEXTURE0);const F=e.getTileByID(i.key).latestRawTileData,N=Math.floor((F&&F.byteLength||0)/1024),H=e.getTile(i).tileSize,$=512/Math.min(H,512)*(i.overscaledZ/d.transform.zoom)*.5;let ce=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(ce+=` => ${i.overscaledZ}`),function(he,xe){he.initDebugOverlayCanvas();const Te=he.debugOverlayCanvas,we=he.context.gl,Ae=he.debugOverlayCanvas.getContext("2d");Ae.clearRect(0,0,Te.width,Te.height),Ae.shadowColor="white",Ae.shadowBlur=2,Ae.lineWidth=1.5,Ae.strokeStyle="white",Ae.textBaseline="top",Ae.font="bold 36px Open Sans, sans-serif",Ae.fillText(xe,5,5),Ae.strokeText(xe,5,5),he.debugOverlayTexture.update(Te),he.debugOverlayTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE)}(d,`${ce} ${N}kB`);const le=d.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(l,h.TRIANGLES,y,b,fi.alphaBlended,Vr.disabled,eh(c.b7.transparent,$),null,le,P,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),m.draw(l,h.LINE_STRIP,y,b,E,Vr.disabled,eh(c.b7.red),z,le,P,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function Ws(d,e,i,l){const{isRenderingGlobe:h}=l,m=d.context,y=m.gl,b=d.transform,E=d.colorModeForRenderPass(),P=d.getDepthModeFor3D(),z=d.useProgram("terrain");m.bindFramebuffer.set(null),m.viewport.set([0,0,d.width,d.height]);for(const F of i){const N=e.getTerrainMesh(F.tileID),H=d.renderToTexture.getTexture(F),$=e.getTerrainData(F.tileID);m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,H.texture);const ce=e.getMeshFrameDelta(b.zoom),le=b.calculateFogMatrix(F.tileID.toUnwrapped()),he=md(ce,le,d.style.sky,b.pitch,h),xe=b.getProjectionData({overscaledTileID:F.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});z.draw(m,y.TRIANGLES,P,Pr.disabled,E,Vr.backCCW,he,$,xe,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}}function va(d,e){if(!e.mesh){const i=new c.aI;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);const l=new c.aK;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),e.mesh=new Sa(d.createVertexBuffer(i,yn.members),d.createIndexBuffer(l),c.aJ.simpleSegment(0,0,i.length,l.length))}return e.mesh}class ul{constructor(e,i){this.context=new $s(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ad(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Oe.maxUnderzooming+Oe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Qr}resize(e,i,l){if(this.width=Math.floor(e*l),this.height=Math.floor(i*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const e=this.context,i=new c.aI;i.emplaceBack(0,0),i.emplaceBack(c.Z,0),i.emplaceBack(0,c.Z),i.emplaceBack(c.Z,c.Z),this.tileExtentBuffer=e.createVertexBuffer(i,yn.members),this.tileExtentSegments=c.aJ.simpleSegment(0,0,4,2);const l=new c.aI;l.emplaceBack(0,0),l.emplaceBack(c.Z,0),l.emplaceBack(0,c.Z),l.emplaceBack(c.Z,c.Z),this.debugBuffer=e.createVertexBuffer(l,yn.members),this.debugSegments=c.aJ.simpleSegment(0,0,4,5);const h=new c.b_;h.emplaceBack(0,0,0,0),h.emplaceBack(c.Z,0,c.Z,0),h.emplaceBack(0,c.Z,0,c.Z),h.emplaceBack(c.Z,c.Z,c.Z,c.Z),this.rasterBoundsBuffer=e.createVertexBuffer(h,dd.members),this.rasterBoundsSegments=c.aJ.simpleSegment(0,0,4,2);const m=new c.aI;m.emplaceBack(0,0),m.emplaceBack(c.Z,0),m.emplaceBack(0,c.Z),m.emplaceBack(c.Z,c.Z),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(m,yn.members),this.rasterBoundsSegmentsPosOnly=c.aJ.simpleSegment(0,0,4,5);const y=new c.aI;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,yn.members),this.viewportSegments=c.aJ.simpleSegment(0,0,4,2);const b=new c.b$;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(b);const E=new c.aK;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(E);const P=this.context.gl;this.stencilClearMode=new Pr({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.tileExtentMesh=new Sa(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=c.K();c.bQ(l,0,this.width,this.height,0,0,1),c.M(l,l,[i.drawingBufferWidth,i.drawingBufferHeight,0]);const h={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(e,i.TRIANGLES,br.disabled,this.stencilClearMode,fi.disabled,Vr.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,i,l){if(this.currentStencilSource===e.source||!e.isTileClipped()||!i||!i.length)return;this.currentStencilSource=e.source,this.nextStencilID+i.length>256&&this.clearStencil();const h=this.context;h.setColorMode(fi.disabled),h.setDepthMode(br.disabled);const m={};for(const y of i)m[y.key]=this.nextStencilID++;this._renderTileMasks(m,i,l,!0),this._renderTileMasks(m,i,l,!1),this._tileClippingMaskIDs=m}_renderTileMasks(e,i,l,h){const m=this.context,y=m.gl,b=this.style.projection,E=this.transform,P=this.useProgram("clippingMask");for(const z of i){const F=e[z.key],N=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),H=b.getMeshFromTileID(this.context,z.canonical,h,!0,"stencil"),$=E.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!l,applyTerrainMatrix:!0});P.draw(m,y.TRIANGLES,br.disabled,new Pr({func:y.ALWAYS,mask:0},F,255,y.KEEP,y.KEEP,y.REPLACE),fi.disabled,l?Vr.disabled:Vr.backCCW,null,N,$,"$clipping",H.vertexBuffer,H.indexBuffer,H.segments)}}_renderTilesDepthBuffer(){const e=this.context,i=e.gl,l=this.style.projection,h=this.transform,m=this.useProgram("depth"),y=this.getDepthModeFor3D(),b=Be(h,{tileSize:h.tileSize});for(const E of b){const P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E),z=l.getMeshFromTileID(this.context,E.canonical,!0,!0,"raster"),F=h.getProjectionData({overscaledTileID:E,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(e,i.TRIANGLES,y,Pr.disabled,fi.disabled,Vr.backCCW,null,P,F,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new Pr({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){const i=this.context.gl;return new Pr({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const i=this.context.gl,l=e.sort((y,b)=>b.overscaledZ-y.overscaledZ),h=l[l.length-1].overscaledZ,m=l[0].overscaledZ-h+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const y={};for(let b=0;b<m;b++)y[b+h]=new Pr({func:i.GEQUAL,mask:255},b+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=m,[y,l]}return[{[h]:Pr.disabled},l]}stencilConfigForOverlapTwoPass(e){const i=this.context.gl,l=e.sort((y,b)=>b.overscaledZ-y.overscaledZ),h=l[l.length-1].overscaledZ,m=l[0].overscaledZ-h+1;if(this.clearStencil(),m>1){const y={},b={};for(let E=0;E<m;E++)y[E+h]=new Pr({func:i.GREATER,mask:255},m+1+E,255,i.KEEP,i.KEEP,i.REPLACE),b[E+h]=new Pr({func:i.GREATER,mask:255},1+E,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID=2*m+1,[y,b,l]}return this.nextStencilID=3,[{[h]:new Pr({func:i.GREATER,mask:255},2,255,i.KEEP,i.KEEP,i.REPLACE)},{[h]:new Pr({func:i.GREATER,mask:255},1,255,i.KEEP,i.KEEP,i.REPLACE)},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new fi([e.CONSTANT_COLOR,e.ONE],new c.b7(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?fi.unblended:fi.alphaBlended}getDepthModeForSublayer(e,i,l){if(!this.opaquePassEnabledForLayer())return br.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new br(l||this.context.gl.LEQUAL,i,[h,h])}getDepthModeFor3D(){return new br(this.context.gl.LEQUAL,br.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){var l,h;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(_e.now()),this.imageManager.beginFrame();const m=this.style._order,y=this.style.sourceCaches,b={},E={},P={},z={isRenderingToTexture:!1,isRenderingGlobe:((l=e.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const N in y){const H=y[N];H.used&&H.prepare(this.context),b[N]=H.getVisibleCoordinates(!1),E[N]=b[N].slice().reverse(),P[N]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<m.length;N++)if(this.style._layers[m[N]].is3D()){this.opaquePassCutoff=N;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const N of m){const H=this.style._layers[N];if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const $=E[H.source];(H.type==="custom"||$.length)&&this.renderLayer(this,y[H.source],H,$,z)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:N=>this.useProgram(N)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?c.b7.black:c.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(N,H){const $=N.context,ce=$.gl,le=((ke,De,Qe)=>{const dt=Math.cos(De.rollInRadians),nt=Math.sin(De.rollInRadians),it=Ne(De),ut=De.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ke.properties.get("sky-color"),u_horizon_color:ke.properties.get("horizon-color"),u_horizon:[(De.width/2-it*nt)*Qe,(De.height/2+it*dt)*Qe],u_horizon_normal:[-nt,dt],u_sky_horizon_blend:ke.properties.get("sky-horizon-blend")*De.height/2*Qe,u_sky_blend:ut}})(H,N.style.map.transform,N.pixelRatio),he=new br(ce.LEQUAL,br.ReadWrite,[0,1]),xe=Pr.disabled,Te=N.colorModeForRenderPass(),we=N.useProgram("sky"),Ae=va($,H);we.draw($,ce.TRIANGLES,he,xe,Te,Vr.disabled,le,null,void 0,"sky",Ae.vertexBuffer,Ae.indexBuffer,Ae.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[m[this.currentLayer]],H=y[N.source],$=b[N.source];this._renderTileClippingMasks(N,$,!1),this.renderLayer(this,H,N,$,z)}this.renderPass="translucent";let F=!1;for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const N=this.style._layers[m[this.currentLayer]],H=y[N.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(N,z))continue;this.opaquePassEnabledForLayer()||F||(F=!0,z.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const $=(N.type==="symbol"?P:E)[N.source];this._renderTileClippingMasks(N,b[N.source],!!this.renderToTexture),this.renderLayer(this,H,N,$,z)}if(z.isRenderingGlobe&&function(N,H,$){const ce=N.context,le=ce.gl,he=N.useProgram("atmosphere"),xe=new br(le.LEQUAL,br.ReadOnly,[0,1]),Te=N.transform,we=function(ut,Zt){const Vt=ut.properties.get("position"),St=[-Vt.x,-Vt.y,-Vt.z],sr=c.ad(new Float64Array(16));return ut.properties.get("anchor")==="map"&&(c.a_(sr,sr,Zt.rollInRadians),c.a$(sr,sr,-Zt.pitchInRadians),c.a_(sr,sr,Zt.bearingInRadians),c.a$(sr,sr,Zt.center.lat*Math.PI/180),c.bp(sr,sr,-Zt.center.lng*Math.PI/180)),c.bZ(St,St,sr),St}($,N.transform),Ae=Te.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ke=H.properties.get("atmosphere-blend")*Ae.projectionTransition;if(ke===0)return;const De=Xo(Te.worldSize,Te.center.lat),Qe=Te.inverseProjectionMatrix,dt=new Float64Array(4);dt[3]=1,c.at(dt,dt,Te.modelViewProjectionMatrix),dt[0]/=dt[3],dt[1]/=dt[3],dt[2]/=dt[3],dt[3]=1,c.at(dt,dt,Qe),dt[0]/=dt[3],dt[1]/=dt[3],dt[2]/=dt[3],dt[3]=1;const nt=((ut,Zt,Vt,St,sr)=>({u_sun_pos:ut,u_atmosphere_blend:Zt,u_globe_position:Vt,u_globe_radius:St,u_inv_proj_matrix:sr}))(we,ke,[dt[0],dt[1],dt[2]],De,Qe),it=va(ce,H);he.draw(ce,le.TRIANGLES,xe,Pr.disabled,fi.alphaBlended,Vr.disabled,nt,null,null,"atmosphere",it.vertexBuffer,it.indexBuffer,it.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const N=function(H,$){let ce=null;const le=Object.values(H._layers).flatMap(we=>we.source&&!we.isHidden($)?[H.sourceCaches[we.source]]:[]),he=le.filter(we=>we.getSource().type==="vector"),xe=le.filter(we=>we.getSource().type!=="vector"),Te=we=>{(!ce||ce.getSource().maxzoom<we.getSource().maxzoom)&&(ce=we)};return he.forEach(we=>Te(we)),ce||xe.forEach(we=>Te(we)),ce}(this.style,this.transform.zoom);N&&function(H,$,ce){for(let le=0;le<ce.length;le++)Ci(H,$,ce[le])}(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const H=N.transform.padding;Es(N,N.transform.height-(H.top||0),3,Ul),Es(N,H.bottom||0,3,wu),ts(N,H.left||0,3,Jn),ts(N,N.transform.width-(H.right||0),3,tn);const $=N.transform.centerPoint;(function(ce,le,he,xe){ll(ce,le-1,he-10,2,20,xe),ll(ce,le-10,he-1,20,2,xe)})(N,$.x,N.transform.height-$.y,ni)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=e?!c.c0(i,l):!c.c1(i,l)),h||(h=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(c.c2(i,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(m,y){const b=m.context,E=b.gl,P=m.transform,z=fi.unblended,F=new br(E.LEQUAL,br.ReadWrite,[0,1]),N=y.sourceCache.getRenderableTiles(),H=m.useProgram("terrainDepth");b.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),b.clear({color:c.b7.transparent,depth:1});for(const $ of N){const ce=y.getTerrainMesh($.tileID),le=y.getTerrainData($.tileID),he=P.getProjectionData({overscaledTileID:$.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),xe={u_ele_delta:y.getMeshFrameDelta(P.zoom)};H.draw(b,E.TRIANGLES,F,Pr.disabled,z,Vr.backCCW,xe,le,he,"terrain",ce.vertexBuffer,ce.indexBuffer,ce.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain),function(m,y){const b=m.context,E=b.gl,P=m.transform,z=fi.unblended,F=new br(E.LEQUAL,br.ReadWrite,[0,1]),N=y.getCoordsTexture(),H=y.sourceCache.getRenderableTiles(),$=m.useProgram("terrainCoords");b.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),b.clear({color:c.b7.transparent,depth:1}),y.coordsIndex=[];for(const ce of H){const le=y.getTerrainMesh(ce.tileID),he=y.getTerrainData(ce.tileID);b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,N.texture);const xe={u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(P.zoom)},Te=P.getProjectionData({overscaledTileID:ce.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});$.draw(b,E.TRIANGLES,F,Pr.disabled,z,Vr.backCCW,xe,he,Te,"terrain",le.vertexBuffer,le.indexBuffer,le.segments),y.coordsIndex.push(ce.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain))}renderLayer(e,i,l,h,m){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(h||[]).length)&&(this.id=l.id,c.c3(l)?function(y,b,E,P,z,F){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:N}=F,H=Pr.disabled,$=y.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ce,le,he,xe,Te,we,Ae,ke,De){const Qe=le.transform,dt=le.style.map.terrain,nt=Te==="map",it=we==="map";for(const ut of ce){const Zt=xe.getTile(ut),Vt=Zt.getBucket(he);if(!Vt||!Vt.text||!Vt.text.segments.get().length)continue;const St=c.ak(Vt.textSizeData,Qe.zoom),sr=c.az(Zt,1,le.transform.zoom),Rr=tr(nt,le.transform,sr),Gr=he.layout.get("icon-text-fit")!=="none"&&Vt.hasIconData();if(St){const Hi=Math.pow(2,Qe.zoom-Zt.tileID.overscaledZ),Ti=dt?($i,Ni)=>dt.getElevation(ut,$i,Ni):null;bu(Vt,nt,it,De,Qe,Rr,Hi,St,Gr,c.aA(Qe,Zt,Ae,ke),ut.toUnwrapped(),Ti)}}}(P,y,E,b,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),z),E.paint.get("icon-opacity").constantOr(1)!==0&&Fl(y,b,E,P,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),H,$,N),E.paint.get("text-opacity").constantOr(1)!==0&&Fl(y,b,E,P,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),H,$,N),b.map.showCollisionBoxes&&(fa(y,b,E,P,!0),fa(y,b,E,P,!1))}(e,i,l,h,this.style.placement.variableOffsets,m):c.c4(l)?function(y,b,E,P,z){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:F}=z,N=E.paint.get("circle-opacity"),H=E.paint.get("circle-stroke-width"),$=E.paint.get("circle-stroke-opacity"),ce=!E.layout.get("circle-sort-key").isConstant();if(N.constantOr(1)===0&&(H.constantOr(1)===0||$.constantOr(1)===0))return;const le=y.context,he=le.gl,xe=y.transform,Te=y.getDepthModeForSublayer(0,br.ReadOnly),we=Pr.disabled,Ae=y.colorModeForRenderPass(),ke=[],De=xe.getCircleRadiusCorrection();for(let Qe=0;Qe<P.length;Qe++){const dt=P[Qe],nt=b.getTile(dt),it=nt.getBucket(E);if(!it)continue;const ut=E.paint.get("circle-translate"),Zt=E.paint.get("circle-translate-anchor"),Vt=c.aA(xe,nt,ut,Zt),St=it.programConfigurations.get(E.id),sr=y.useProgram("circle",St),Rr=it.layoutVertexBuffer,Gr=it.indexBuffer,Hi=y.style.map.terrain&&y.style.map.terrain.getTerrainData(dt),Ti={programConfiguration:St,program:sr,layoutVertexBuffer:Rr,indexBuffer:Gr,uniformValues:Rl(y,nt,E,Vt,De),terrainData:Hi,projectionData:xe.getProjectionData({overscaledTileID:dt,applyGlobeMatrix:!F,applyTerrainMatrix:!0})};if(ce){const $i=it.segments.get();for(const Ni of $i)ke.push({segments:new c.aJ([Ni]),sortKey:Ni.sortKey,state:Ti})}else ke.push({segments:it.segments,sortKey:0,state:Ti})}ce&&ke.sort((Qe,dt)=>Qe.sortKey-dt.sortKey);for(const Qe of ke){const{programConfiguration:dt,program:nt,layoutVertexBuffer:it,indexBuffer:ut,uniformValues:Zt,terrainData:Vt,projectionData:St}=Qe.state;nt.draw(le,he.TRIANGLES,Te,we,Ae,Vr.backCCW,Zt,Vt,St,E.id,it,ut,Qe.segments,E.paint,y.transform.zoom,dt)}}(e,i,l,h,m):c.c5(l)?function(y,b,E,P,z){if(E.paint.get("heatmap-opacity")===0)return;const F=y.context,{isRenderingToTexture:N,isRenderingGlobe:H}=z;if(y.style.map.terrain){for(const $ of P){const ce=b.getTile($);b.hasRenderableParent($)||(y.renderPass==="offscreen"?Ys(y,ce,E,$,H):y.renderPass==="translucent"&&So(y,E,$,N,H))}F.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?function($,ce,le,he){const xe=$.context,Te=xe.gl,we=$.transform,Ae=Pr.disabled,ke=new fi([Te.ONE,Te.ONE],c.b7.transparent,[!0,!0,!0,!0]);(function(De,Qe,dt){const nt=De.gl;De.activeTexture.set(nt.TEXTURE1),De.viewport.set([0,0,Qe.width/4,Qe.height/4]);let it=dt.heatmapFbos.get(c.bW);it?(nt.bindTexture(nt.TEXTURE_2D,it.colorAttachment.get()),De.bindFramebuffer.set(it.framebuffer)):(it=ol(De,Qe.width/4,Qe.height/4),dt.heatmapFbos.set(c.bW,it))})(xe,$,le),xe.clear({color:c.b7.transparent});for(let De=0;De<he.length;De++){const Qe=he[De];if(ce.hasRenderableParent(Qe))continue;const dt=ce.getTile(Qe),nt=dt.getBucket(le);if(!nt)continue;const it=nt.programConfigurations.get(le.id),ut=$.useProgram("heatmap",it),Zt=we.getProjectionData({overscaledTileID:Qe,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Vt=we.getCircleRadiusCorrection();ut.draw(xe,Te.TRIANGLES,br.disabled,Ae,ke,Vr.backCCW,Ga(dt,we.zoom,le.paint.get("heatmap-intensity"),Vt),null,Zt,le.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,le.paint,we.zoom,it)}xe.viewport.set([0,0,$.width,$.height])}(y,b,E,P):y.renderPass==="translucent"&&function($,ce){const le=$.context,he=le.gl;le.setColorMode($.colorModeForRenderPass());const xe=ce.heatmapFbos.get(c.bW);xe&&(le.activeTexture.set(he.TEXTURE0),he.bindTexture(he.TEXTURE_2D,xe.colorAttachment.get()),le.activeTexture.set(he.TEXTURE1),jl(le,ce).bind(he.LINEAR,he.CLAMP_TO_EDGE),$.useProgram("heatmapTexture").draw(le,he.TRIANGLES,br.disabled,Pr.disabled,$.colorModeForRenderPass(),Vr.disabled,Qh($,ce,0,1),null,null,ce.id,$.viewportBuffer,$.quadTriangleIndexBuffer,$.viewportSegments,ce.paint,$.transform.zoom))}(y,E)}(e,i,l,h,m):c.c6(l)?function(y,b,E,P,z){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:F}=z,N=E.paint.get("line-opacity"),H=E.paint.get("line-width");if(N.constantOr(1)===0||H.constantOr(1)===0)return;const $=y.getDepthModeForSublayer(0,br.ReadOnly),ce=y.colorModeForRenderPass(),le=E.paint.get("line-dasharray"),he=E.paint.get("line-pattern"),xe=he.constantOr(1),Te=E.paint.get("line-gradient"),we=E.getCrossfadeParameters(),Ae=xe?"linePattern":le?"lineSDF":Te?"lineGradient":"line",ke=y.context,De=ke.gl,Qe=y.transform;let dt=!0;for(const nt of P){const it=b.getTile(nt);if(xe&&!it.patternsLoaded())continue;const ut=it.getBucket(E);if(!ut)continue;const Zt=ut.programConfigurations.get(E.id),Vt=y.context.program.get(),St=y.useProgram(Ae,Zt),sr=dt||St.program!==Vt,Rr=y.style.map.terrain&&y.style.map.terrain.getTerrainData(nt),Gr=he.constantOr(null);if(Gr&&it.imageAtlas){const Mi=it.imageAtlas,ai=Mi.patternPositions[Gr.to.toString()],vn=Mi.patternPositions[Gr.from.toString()];ai&&vn&&Zt.setConstantPatternPositions(ai,vn)}const Hi=Qe.getProjectionData({overscaledTileID:nt,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),Ti=Qe.getPixelScale(),$i=xe?kl(y,it,E,Ti,we):le?Jh(y,it,E,Ti,le,we):Te?Ll(y,it,E,Ti,ut.lineClipsArray.length):zl(y,it,E,Ti);if(xe)ke.activeTexture.set(De.TEXTURE0),it.imageAtlasTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE),Zt.updatePaintBuffers(we);else if(le&&(sr||y.lineAtlas.dirty))ke.activeTexture.set(De.TEXTURE0),y.lineAtlas.bind(ke);else if(Te){const Mi=ut.gradients[E.id];let ai=Mi.texture;if(E.gradientVersion!==Mi.version){let vn=256;if(E.stepInterpolant){const In=b.getSource().maxzoom,Fn=nt.canonical.z===In?Math.ceil(1<<y.transform.maxZoom-nt.canonical.z):1;vn=c.ae(c.bX(ut.maxLineLength/c.Z*1024*Fn),256,ke.maxTextureSize)}Mi.gradient=c.bY({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:vn,image:Mi.gradient||void 0,clips:ut.lineClipsArray}),Mi.texture?Mi.texture.update(Mi.gradient):Mi.texture=new bt(ke,Mi.gradient,De.RGBA),Mi.version=E.gradientVersion,ai=Mi.texture}ke.activeTexture.set(De.TEXTURE0),ai.bind(E.stepInterpolant?De.NEAREST:De.LINEAR,De.CLAMP_TO_EDGE)}const Ni=y.stencilModeForClipping(nt);St.draw(ke,De.TRIANGLES,$,Ni,ce,Vr.disabled,$i,Rr,Hi,E.id,ut.layoutVertexBuffer,ut.indexBuffer,ut.segments,E.paint,y.transform.zoom,Zt,ut.layoutVertexBuffer2),dt=!1}}(e,i,l,h,m):c.c7(l)?function(y,b,E,P,z){const F=E.paint.get("fill-color"),N=E.paint.get("fill-opacity");if(N.constantOr(1)===0)return;const{isRenderingToTexture:H}=z,$=y.colorModeForRenderPass(),ce=E.paint.get("fill-pattern"),le=y.opaquePassEnabledForLayer()&&!ce.constantOr(1)&&F.constantOr(c.b7.transparent).a===1&&N.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===le){const he=y.getDepthModeForSublayer(1,y.renderPass==="opaque"?br.ReadWrite:br.ReadOnly);Kn(y,b,E,P,he,$,!1,H)}if(y.renderPass==="translucent"&&E.paint.get("fill-antialias")){const he=y.getDepthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,br.ReadOnly);Kn(y,b,E,P,he,$,!0,H)}}(e,i,l,h,m):c.c8(l)?function(y,b,E,P,z){const F=E.paint.get("fill-extrusion-opacity");if(F===0)return;const{isRenderingToTexture:N}=z;if(y.renderPass==="translucent"){const H=new br(y.context.gl.LEQUAL,br.ReadWrite,y.depthRangeFor3D);if(F!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))Ja(y,b,E,P,H,Pr.disabled,fi.disabled,N),Ja(y,b,E,P,H,y.stencilModeFor3D(),y.colorModeForRenderPass(),N);else{const $=y.colorModeForRenderPass();Ja(y,b,E,P,H,Pr.disabled,$,N)}}}(e,i,l,h,m):c.c9(l)?function(y,b,E,P,z){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const{isRenderingToTexture:F}=z,N=y.context,H=y.style.projection.useSubdivision,$=y.getDepthModeForSublayer(0,br.ReadOnly),ce=y.colorModeForRenderPass();if(y.renderPass==="offscreen")(function(le,he,xe,Te,we,Ae,ke){const De=le.context,Qe=De.gl;for(const dt of xe){const nt=he.getTile(dt),it=nt.dem;if(!it||!it.data||!nt.needsHillshadePrepare)continue;const ut=it.dim,Zt=it.stride,Vt=it.getPixels();if(De.activeTexture.set(Qe.TEXTURE1),De.pixelStoreUnpackPremultiplyAlpha.set(!1),nt.demTexture=nt.demTexture||le.getTileTexture(Zt),nt.demTexture){const sr=nt.demTexture;sr.update(Vt,{premultiply:!1}),sr.bind(Qe.NEAREST,Qe.CLAMP_TO_EDGE)}else nt.demTexture=new bt(De,Vt,Qe.RGBA,{premultiply:!1}),nt.demTexture.bind(Qe.NEAREST,Qe.CLAMP_TO_EDGE);De.activeTexture.set(Qe.TEXTURE0);let St=nt.fbo;if(!St){const sr=new bt(De,{width:ut,height:ut,data:null},Qe.RGBA);sr.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE),St=nt.fbo=De.createFramebuffer(ut,ut,!0,!1),St.colorAttachment.set(sr.texture)}De.bindFramebuffer.set(St.framebuffer),De.viewport.set([0,0,ut,ut]),le.useProgram("hillshadePrepare").draw(De,Qe.TRIANGLES,we,Ae,ke,Vr.disabled,gd(nt.tileID,it),null,null,Te.id,le.rasterBoundsBuffer,le.quadTriangleIndexBuffer,le.rasterBoundsSegments),nt.needsHillshadePrepare=!1}})(y,b,P,E,$,Pr.disabled,ce),N.viewport.set([0,0,y.width,y.height]);else if(y.renderPass==="translucent")if(H){const[le,he,xe]=y.stencilConfigForOverlapTwoPass(P);es(y,b,E,xe,le,$,ce,!1,F),es(y,b,E,xe,he,$,ce,!0,F)}else{const[le,he]=y.getStencilConfigForOverlapAndUpdateStencilID(P);es(y,b,E,he,le,$,ce,!1,F)}}(e,i,l,h,m):c.ca(l)?function(y,b,E,P,z){if(y.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!P.length)return;const{isRenderingToTexture:F}=z,N=b.getSource(),H=y.style.projection.useSubdivision;if(N instanceof gi)Ts(y,b,E,P,null,!1,!1,N.tileCoords,N.flippedWindingOrder,F);else if(H){const[$,ce,le]=y.stencilConfigForOverlapTwoPass(P);Ts(y,b,E,le,$,!1,!0,Ma,!1,F),Ts(y,b,E,le,ce,!0,!0,Ma,!1,F)}else{const[$,ce]=y.getStencilConfigForOverlapAndUpdateStencilID(P);Ts(y,b,E,ce,$,!1,!0,Ma,!1,F)}}(e,i,l,h,m):c.cb(l)?function(y,b,E,P,z){const F=E.paint.get("background-color"),N=E.paint.get("background-opacity");if(N===0)return;const{isRenderingToTexture:H}=z,$=y.context,ce=$.gl,le=y.style.projection,he=y.transform,xe=he.tileSize,Te=E.paint.get("background-pattern");if(y.isPatternMissing(Te))return;const we=!Te&&F.a===1&&N===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==we)return;const Ae=Pr.disabled,ke=y.getDepthModeForSublayer(0,we==="opaque"?br.ReadWrite:br.ReadOnly),De=y.colorModeForRenderPass(),Qe=y.useProgram(Te?"backgroundPattern":"background"),dt=P||Be(he,{tileSize:xe,terrain:y.style.map.terrain});Te&&($.activeTexture.set(ce.TEXTURE0),y.imageManager.bind(y.context));const nt=E.getCrossfadeParameters();for(const it of dt){const ut=he.getProjectionData({overscaledTileID:it,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),Zt=Te?_d(N,y,Te,{tileID:it,tileSize:xe},nt):ef(N,F),Vt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(it),St=le.getMeshFromTileID($,it.canonical,!1,!0,"raster");Qe.draw($,ce.TRIANGLES,ke,Ae,De,Vr.backCCW,Zt,Vt,ut,E.id,St.vertexBuffer,St.indexBuffer,St.segments)}}(e,0,l,h,m):c.cc(l)&&function(y,b,E,P){const{isRenderingGlobe:z}=P,F=y.context,N=E.implementation,H=y.style.projection,$=y.transform,ce=$.getProjectionDataForCustomLayer(z),le={farZ:$.farZ,nearZ:$.nearZ,fov:$.fov*Math.PI/180,modelViewProjectionMatrix:$.modelViewProjectionMatrix,projectionMatrix:$.projectionMatrix,shaderData:{variantName:H.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${H.shaderPreludeCode.vertexSource}`,define:H.shaderDefine},defaultProjectionData:ce},he=N.renderingMode?N.renderingMode:"2d";if(y.renderPass==="offscreen"){const xe=N.prerender;xe&&(y.setCustomLayerDefaults(),F.setColorMode(y.colorModeForRenderPass()),xe.call(N,F.gl,le),F.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),F.setColorMode(y.colorModeForRenderPass()),F.setStencilMode(Pr.disabled);const xe=he==="3d"?y.getDepthModeFor3D():y.getDepthModeForSublayer(0,br.ReadOnly);F.setDepthMode(xe),N.render(F.gl,le),F.setDirty(),y.setBaseState(),F.bindFramebuffer.set(null)}}(e,0,l,m))}saveTileTexture(e){const i=this._tileTextures[e.size[0]];i?i.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const i=this._tileTextures[e];return i&&i.length>0?i.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const i=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!i||!l}useProgram(e,i,l=!1,h=[]){this.cache=this.cache||{};const m=!!this.style.map.terrain,y=this.style.projection,b=l?Xr.projectionMercator:y.shaderPreludeCode,E=l?Us:y.shaderDefine,P=e+(i?i.cacheKey:"")+`/${l?Or:y.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(m?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[P]||(this.cache[P]=new ec(this.context,Xr[e],i,tf[e],this._showOverdrawInspector,m,b,E,h)),this.cache[P]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new bt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:i}=this.context.gl;return this.width!==e||this.height!==i}}function Qs(d,e){let i,l=!1,h=null,m=null;const y=()=>{h=null,l&&(d.apply(m,i),h=setTimeout(y,e),l=!1)};return(...b)=>(l=!0,m=this,i=b,h||y(),h)}class fc{constructor(e){this._getCurrentHash=()=>{const i=window.location.hash.replace("#","");if(this._hashName){let l;return i.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(l=h)}),(l&&l[1]||"").split("/")}return i.split("/")},this._onHashChange=()=>{const i=this._getCurrentHash();if(!this._isValidHash(i))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:l,pitch:+(i[4]||0)}),!0},this._updateHashUnthrottled=()=>{const i=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,i)},this._removeHash=()=>{const i=this._getCurrentHash();if(i.length===0)return;const l=i.join("/");let h=l;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${l}`);let m=window.location.hash.replace(h,"");m.startsWith("#&")?m=m.slice(0,1)+m.slice(2):m==="#"&&(m="");let y=window.location.href.replace(/(#.+)?$/,m);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=Qs(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const i=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,h),y=Math.round(i.lng*m)/m,b=Math.round(i.lat*m)/m,E=this._map.getBearing(),P=this._map.getPitch();let z="";if(z+=e?`/${y}/${b}/${l}`:`${l}/${b}/${y}`,(E||P)&&(z+="/"+Math.round(10*E)/10),P&&(z+=`/${Math.round(P)}`),this._hashName){const F=this._hashName;let N=!1;const H=window.location.hash.slice(1).split("&").map($=>{const ce=$.split("=")[0];return ce===F?(N=!0,`${ce}=${z}`):$}).filter($=>$);return N||H.push(`${F}=${z}`),`#${H.join("&")}`}return`#${z}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new c.Q(+e[2],+e[1])}catch{return!1}const i=+e[0],l=+(e[3]||0),h=+(e[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&l>=-180&&l<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const xa={linearity:.3,easing:c.cd(0,0,.3,1)},Tu=c.e({deceleration:2500,maxSpeed:1400},xa),rs=c.e({deceleration:20,maxSpeed:1400},xa),is=c.e({deceleration:1e3,maxSpeed:360},xa),Ks=c.e({deceleration:1e3,maxSpeed:90},xa),Ss=c.e({deceleration:1e3,maxSpeed:360},xa);class dc{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:_e.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=_e.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)i.zoom+=m.zoomDelta||0,i.bearing+=m.bearingDelta||0,i.pitch+=m.pitchDelta||0,i.roll+=m.rollDelta||0,m.panDelta&&i.pan._add(m.panDelta),m.around&&(i.around=m.around),m.pinchAround&&(i.pinchAround=m.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(i.pan.mag()){const m=As(i.pan.mag(),l,c.e({},Tu,e||{})),y=i.pan.mult(m.amount/i.pan.mag()),b=this._map.cameraHelper.handlePanInertia(y,this._map.transform);h.center=b.easingCenter,h.offset=b.easingOffset,Ao(h,m)}if(i.zoom){const m=As(i.zoom,l,rs);h.zoom=this._map.transform.zoom+m.amount,Ao(h,m)}if(i.bearing){const m=As(i.bearing,l,is);h.bearing=this._map.transform.bearing+c.ae(m.amount,-179,179),Ao(h,m)}if(i.pitch){const m=As(i.pitch,l,Ks);h.pitch=this._map.transform.pitch+m.amount,Ao(h,m)}if(i.roll){const m=As(i.roll,l,Ss);h.roll=this._map.transform.roll+c.ae(m.amount,-179,179),Ao(h,m)}if(h.zoom||h.bearing){const m=i.pinchAround===void 0?i.around:i.pinchAround;h.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),c.e(h,{noMoveStart:!0})}}function Ao(d,e){(!d.duration||d.duration<e.duration)&&(d.duration=e.duration,d.easing=e.easing)}function As(d,e,i){const{maxSpeed:l,linearity:h,deceleration:m}=i,y=c.ae(d*h/(e/1e3),-l,l),b=Math.abs(y)/(m*h);return{easing:i.easing,duration:1e3*b,amount:y*(b/2)}}class hn extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,l,h={}){l=l instanceof MouseEvent?l:new MouseEvent(e,l);const m=se.mousePos(i.getCanvas(),l),y=i.unproject(m);super(e,c.e({point:m,lngLat:y,originalEvent:l},h)),this._defaultPrevented=!1,this.target=i}}class Ha extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,l){const h=e==="touchend"?l.changedTouches:l.touches,m=se.touchPos(i.getCanvasContainer(),h),y=m.map(E=>i.unproject(E)),b=m.reduce((E,P,z,F)=>E.add(P.div(F.length)),new c.P(0,0));super(e,{points:m,point:b,lngLats:y,lngLat:i.unproject(b),originalEvent:l}),this._defaultPrevented=!1}}class Nn extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class Eu{constructor(e,i){this._map=e,this._clickTolerance=i.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Nn(e.type,this._map,e))}mousedown(e,i){return this._mousedownPos=i,this._firePreventable(new hn(e.type,this._map,e))}mouseup(e){this._map.fire(new hn(e.type,this._map,e))}click(e,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||this._map.fire(new hn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new hn(e.type,this._map,e))}mouseover(e){this._map.fire(new hn(e.type,this._map,e))}mouseout(e){this._map.fire(new hn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ha(e.type,this._map,e))}touchmove(e){this._map.fire(new Ha(e.type,this._map,e))}touchend(e){this._map.fire(new Ha(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ha(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fh{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new hn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new hn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new hn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vl{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(c.P.convert(e),this._map.terrain)}}class dh{constructor(e,i){this._map=e,this._tr=new Vl(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,i){this.isEnabled()&&e.shiftKey&&e.button===0&&(se.disableDrag(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(e,i){if(!this._active)return;const l=i;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=se.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const m=Math.min(h.x,l.x),y=Math.max(h.x,l.x),b=Math.min(h.y,l.y),E=Math.max(h.y,l.y);se.setTransform(this._box,`translate(${m}px,${b}px)`),this._box.style.width=y-m+"px",this._box.style.height=E-b+"px"}mouseupWindow(e,i){if(!this._active||e.button!==0)return;const l=this._startPos,h=i;if(this.reset(),se.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:e})),{cameraAnimation:m=>m.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(se.remove(this._box),this._box=null),se.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new c.l(e,{originalEvent:i}))}}function pc(d,e){if(d.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${e.length}`);const i={};for(let l=0;l<d.length;l++)i[d[l].identifier]=e[l];return i}class Sn{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(h){const m=new c.P(0,0);for(const y of h)m._add(y);return m.div(h.length)}(i),this.touches=pc(l,i)))}touchmove(e,i,l){if(this.aborted||!this.centroid)return;const h=pc(l,i);for(const m in this.touches){const y=h[m];(!y||y.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(e,i,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class Co{constructor(e){this.singleTap=new Sn(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,i,l){this.singleTap.touchstart(e,i,l)}touchmove(e,i,l){this.singleTap.touchmove(e,i,l)}touchend(e,i,l){const h=this.singleTap.touchend(e,i,l);if(h){const m=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(h)<30;if(m&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class ql{constructor(e){this._tr=new Vl(e),this._zoomIn=new Co({numTouches:1,numTaps:2}),this._zoomOut=new Co({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,i,l){this._zoomIn.touchstart(e,i,l),this._zoomOut.touchstart(e,i,l)}touchmove(e,i,l){this._zoomIn.touchmove(e,i,l),this._zoomOut.touchmove(e,i,l)}touchend(e,i,l){const h=this._zoomIn.touchend(e,i,l),m=this._zoomOut.touchend(e,i,l),y=this._tr;return h?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(h)},{originalEvent:e})}):m?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(m)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class An{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const i=this._moveFunction(...e);if(i.bearingDelta||i.pitchDelta||i.rollDelta||i.around||i.panDelta)return this._active=!0,i}dragStart(e,i){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(i)?i[0]:i,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,i){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const h=Array.isArray(i)?i[0]:i;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&se.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Da={0:1,2:2};class ns{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const i=se.mouseButton(e);this._eventButton=i}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(i,l){const h=Da[l];return i.buttons===void 0||(i.buttons&h)!==h}(e,this._eventButton)}isValidEndEvent(e){return se.mouseButton(e)===this._eventButton}}class ea{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Gl{constructor(e=new ns({checkCorrectEvent:()=>!0}),i=new ea){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=i}_executeRelevantHandler(e,i,l){return e instanceof MouseEvent?i(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?l(e):void 0}startMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.startMove(i),i=>this.oneFingerTouchMoveStateManager.startMove(i))}endMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.endMove(i),i=>this.oneFingerTouchMoveStateManager.endMove(i))}isValidStartEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidStartEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidStartEvent(i))}isValidMoveEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidMoveEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(i))}isValidEndEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidEndEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidEndEvent(i))}}const Su=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=e=>{e.preventDefault()}};class yd{constructor(e,i){this._clickTolerance=e.clickTolerance||1,this._map=i,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,i,l){return this._calculateTransform(e,i,l)}touchmove(e,i,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,i,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,i,l){this._calculateTransform(e,i,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,l){l.length>0&&(this._active=!0);const h=pc(l,i),m=new c.P(0,0),y=new c.P(0,0);let b=0;for(const P in h){const z=h[P],F=this._touches[P];F&&(m._add(z),y._add(z.sub(F)),b++,h[P]=z)}if(this._touches=h,this._shouldBePrevented(b)||!y.mag())return;const E=y.div(b);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(b),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,i,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([i[0],i[1]]))}touchmove(e,i,l){if(!this._firstTwoTouches)return;e.preventDefault();const[h,m]=this._firstTwoTouches,y=Cs(l,i,h),b=Cs(l,i,m);if(!y||!b)return;const E=this._aroundCenter?null:y.add(b).div(2);return this._move([y,b],E,e)}touchend(e,i,l){if(!this._firstTwoTouches)return;const[h,m]=this._firstTwoTouches,y=Cs(l,i,h),b=Cs(l,i,m);y&&b||(this._active&&se.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Cs(d,e,i){for(let l=0;l<d.length;l++)if(d[l].identifier===i)return e[l]}function Au(d,e){return Math.log(d/e)/Math.LN2}class Js extends mc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,i){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Au(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Au(this._distance,l),pinchAround:i}}}function as(d,e){return 180*d.angleWith(e)/Math.PI}class Wt extends mc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,i,l){const h=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:as(this._vector,h),pinchAround:i}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const i=25/(Math.PI*this._minDiameter)*360,l=as(e,this._startVector);return Math.abs(l)<i}}function Cu(d){return Math.abs(d.y)>Math.abs(d.x)}class cl extends mc{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,i,l){super.touchstart(e,i,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,Cu(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,i,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=e[0].sub(this._lastPoints[0]),m=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,m,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(h.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(e,i,l){if(this._valid!==void 0)return this._valid;const h=e.mag()>=2,m=i.mag()>=2;if(!h&&!m)return;if(!h||!m)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const y=e.y>0==i.y>0;return Cu(e)&&Cu(i)&&y}}const gc={panStep:100,bearingStep:15,pitchStep:10};class hl{constructor(e){this._tr=new Vl(e);const i=gc;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let i=0,l=0,h=0,m=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),m=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),m=1);break;case 38:e.shiftKey?h=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?h=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:b=>{const E=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:Mo,zoom:i?Math.round(E.zoom)+i*(e.shiftKey?2:1):E.zoom,bearing:E.bearing+l*this._bearingStep,pitch:E.pitch+h*this._pitchStep,offset:[-m*this._panStep,-y*this._panStep],center:E.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Mo(d){return d*(2-d)}const _c=4.000244140625;class zr{constructor(e,i){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new Vl(e),this._triggerRenderFrame=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=_e.now(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,i!==0&&i%_c==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(h*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=se.mousePos(this._map.getCanvas(),e),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(c.Q.convert(l.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const b=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=b),typeof this._targetZoom=="number"&&(this._targetZoom+=b)}if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>_c?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&E!==0&&(E=1/E);const P=typeof this._targetZoom!="number"?e.scale:c.ac(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),c.ah(P*E)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,l=this._startZoom,h=this._easing;let m,y=!1;if(this._type==="wheel"&&l&&h){const b=_e.now()-this._lastWheelEventTime,E=Math.min((b+5)/200,1),P=h(E);m=c.B.number(l,i,P),E<1?this._frameId||(this._frameId=!0):y=!0}else m=i,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=m,{noInertia:!0,needsRenderFrame:!y,zoomDelta:m-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=c.cf;if(this._prevEase){const l=this._prevEase,h=(_e.now()-l.start)/l.duration,m=l.easing(h+.01)-l.easing(h),y=.27/Math.sqrt(m*m+1e-4)*.01,b=Math.sqrt(.0729-y*y);i=c.cd(y,b,.25,1)}return this._prevEase={start:_e.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Mu{constructor(e,i){this._clickZoom=e,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class sf{constructor(e){this._tr=new Vl(e),this.reset()}reset(){this._active=!1}dblclick(e,i){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ms{constructor(){this._tap=new Co({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,i,l){if(!this._swipePoint)if(this._tapTime){const h=i[0],m=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(h)<30;m&&y?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,i,l)}touchmove(e,i,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=i[0],m=h.y-this._swipePoint.y;return this._swipePoint=h,e.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(e,i,l)}touchend(e,i,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(e,i,l);h&&(this._tapTime=e.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yc{constructor(e,i,l){this._el=e,this._mousePan=i,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vc{constructor(e,i,l,h){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=i,this._mousePitch=l,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Ds{constructor(e,i,l,h){this._el=e,this._touchZoom=i,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ss{constructor(e,i){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=i,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=se.create("div","maplibregl-cooperative-gesture-screen",e);let i=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(i=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=i,this._container.appendChild(h);const m=document.createElement("div");m.className="maplibregl-mobile-message",m.textContent=l,this._container.appendChild(m),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(se.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,i){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:e,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const eo=d=>d.zoom||d.drag||d.roll||d.pitch||d.rotate;class ph extends c.l{}function Zl(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta||d.rollDelta}class Du{constructor(e,i){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,m)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=h.type==="renderFrame"?void 0:h,b={needsRenderFrame:!1},E={},P={};for(const{handlerName:N,handler:H,allowed:$}of this._handlers){if(!H.isEnabled())continue;let ce;if(this._blockedByActive(P,$,N))H.reset();else if(H[m||h.type]){if(c.cg(h,m||h.type)){const le=se.mousePos(this._map.getCanvas(),h);ce=H[m||h.type](h,le)}else if(c.ch(h,m||h.type)){const le=this._getMapTouches(h.touches),he=se.touchPos(this._map.getCanvas(),le);ce=H[m||h.type](h,he,le)}else c.ci(m||h.type)||(ce=H[m||h.type](h));this.mergeHandlerResult(b,E,ce,N,y),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()}(ce||H.isActive())&&(P[N]=H)}const z={};for(const N in this._previousActiveHandlers)P[N]||(z[N]=y);this._previousActiveHandlers=P,(Object.keys(z).length||Zl(b))&&(this._changes.push([b,E,z]),this._triggerRenderFrame()),(Object.keys(P).length||Zl(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=b;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dc(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,m,y]of this._listeners)se.addEventListener(h,m,h===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,i,l]of this._listeners)se.removeEventListener(e,i,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const i=this._map,l=i.getCanvasContainer();this._add("mapEvent",new Eu(i,e));const h=i.boxZoom=new dh(i,e);this._add("boxZoom",h),e.interactive&&e.boxZoom&&h.enable();const m=i.cooperativeGestures=new ss(i,e.cooperativeGestures);this._add("cooperativeGestures",m),e.cooperativeGestures&&m.enable();const y=new ql(i),b=new sf(i);i.doubleClickZoom=new Mu(b,y),this._add("tapZoom",y),this._add("clickZoom",b),e.interactive&&e.doubleClickZoom&&i.doubleClickZoom.enable();const E=new Ms;this._add("tapDragZoom",E);const P=i.touchPitch=new cl(i);this._add("touchPitch",P),e.interactive&&e.touchPitch&&i.touchPitch.enable(e.touchPitch);const z=()=>i.project(i.getCenter()),F=function({enable:we,clickTolerance:Ae,aroundCenter:ke=!0,minPixelCenterThreshold:De=100,rotateDegreesPerPixelMoved:Qe=.8},dt){const nt=new ns({checkCorrectEvent:it=>se.mouseButton(it)===0&&it.ctrlKey||se.mouseButton(it)===2&&!it.ctrlKey});return new An({clickTolerance:Ae,move:(it,ut)=>{const Zt=dt();if(ke&&Math.abs(Zt.y-it.y)>De)return{bearingDelta:c.ce(new c.P(it.x,ut.y),ut,Zt)};let Vt=(ut.x-it.x)*Qe;return ke&&ut.y<Zt.y&&(Vt=-Vt),{bearingDelta:Vt}},moveStateManager:nt,enable:we,assignEvents:Su})}(e,z),N=function({enable:we,clickTolerance:Ae,pitchDegreesPerPixelMoved:ke=-.5}){const De=new ns({checkCorrectEvent:Qe=>se.mouseButton(Qe)===0&&Qe.ctrlKey||se.mouseButton(Qe)===2});return new An({clickTolerance:Ae,move:(Qe,dt)=>({pitchDelta:(dt.y-Qe.y)*ke}),moveStateManager:De,enable:we,assignEvents:Su})}(e),H=function({enable:we,clickTolerance:Ae,rollDegreesPerPixelMoved:ke=.3},De){const Qe=new ns({checkCorrectEvent:dt=>se.mouseButton(dt)===2&&dt.ctrlKey});return new An({clickTolerance:Ae,move:(dt,nt)=>{const it=De();let ut=(nt.x-dt.x)*ke;return nt.y<it.y&&(ut=-ut),{rollDelta:ut}},moveStateManager:Qe,enable:we,assignEvents:Su})}(e,z);i.dragRotate=new vc(e,F,N,H),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",N,["mouseRotate","mouseRoll"]),this._add("mouseRoll",H,["mousePitch"]),e.interactive&&e.dragRotate&&i.dragRotate.enable();const $=function({enable:we,clickTolerance:Ae}){const ke=new ns({checkCorrectEvent:De=>se.mouseButton(De)===0&&!De.ctrlKey});return new An({clickTolerance:Ae,move:(De,Qe)=>({around:Qe,panDelta:Qe.sub(De)}),activateOnStart:!0,moveStateManager:ke,enable:we,assignEvents:Su})}(e),ce=new yd(e,i);i.dragPan=new yc(l,$,ce),this._add("mousePan",$),this._add("touchPan",ce,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&i.dragPan.enable(e.dragPan);const le=new Wt,he=new Js;i.touchZoomRotate=new Ds(l,he,le,E),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",he,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&i.touchZoomRotate.enable(e.touchZoomRotate);const xe=i.scrollZoom=new zr(i,()=>this._triggerRenderFrame());this._add("scrollZoom",xe,["mousePan"]),e.interactive&&e.scrollZoom&&i.scrollZoom.enable(e.scrollZoom);const Te=i.keyboard=new hl(i);this._add("keyboard",Te),e.interactive&&e.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new fh(i))}_add(e,i,l){this._handlers.push({handlerName:e,handler:i,allowed:l}),this._handlersById[e]=i}stop(e){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!eo(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,i,l){for(const h in e)if(h!==l&&(!i||i.indexOf(h)<0))return!0;return!1}_getMapTouches(e){const i=[];for(const l of e)this._el.contains(l.target)&&i.push(l);return i}mergeHandlerResult(e,i,l,h,m){if(!l)return;c.e(e,l);const y={handlerName:h,originalEvent:l.originalEvent||m};l.zoomDelta!==void 0&&(i.zoom=y),l.panDelta!==void 0&&(i.drag=y),l.rollDelta!==void 0&&(i.roll=y),l.pitchDelta!==void 0&&(i.pitch=y),l.bearingDelta!==void 0&&(i.rotate=y)}_applyChanges(){const e={},i={},l={};for(const[h,m,y]of this._changes)h.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(h.panDelta)),h.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(e.rollDelta=(e.rollDelta||0)+h.rollDelta),h.around!==void 0&&(e.around=h.around),h.pinchAround!==void 0&&(e.pinchAround=h.pinchAround),h.noInertia&&(e.noInertia=h.noInertia),c.e(i,m),c.e(l,y);this._updateMapTransform(e,i,l),this._changes=[]}_updateMapTransform(e,i,l){const h=this._map,m=h._getTransformForUpdate(),y=h.terrain;if(!(Zl(e)||y&&this._terrainMovement))return this._fireEvents(i,l,!0);h._stop(!0);let{panDelta:b,zoomDelta:E,bearingDelta:P,pitchDelta:z,rollDelta:F,around:N,pinchAround:H}=e;H!==void 0&&(N=H),N=N||h.transform.centerPoint,y&&!m.isPointOnMapSurface(N)&&(N=m.centerPoint);const $={panDelta:b,zoomDelta:E,rollDelta:F,pitchDelta:z,bearingDelta:P,around:N};this._map.cameraHelper.useGlobeControls&&!m.isPointOnMapSurface(N)&&(N=m.centerPoint);const ce=N.distSqr(m.centerPoint)<.01?m.center:m.screenPointToLocation(b?N.sub(b):N);y?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom($,m),this._terrainMovement||!i.drag&&!i.zoom?i.drag&&this._terrainMovement?m.setCenter(m.screenPointToLocation(m.centerPoint.sub(b))):this._map.cameraHelper.handleMapControlsPan($,m,ce):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan($,m,ce))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom($,m),this._map.cameraHelper.handleMapControlsPan($,m,ce)),h._applyUpdatedTransform(m),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,l,!0)}_fireEvents(e,i,l){const h=eo(this._eventsInProgress),m=eo(e),y={};for(const F in e){const{originalEvent:N}=e[F];this._eventsInProgress[F]||(y[`${F}start`]=N),this._eventsInProgress[F]=e[F]}!h&&m&&this._fireEvent("movestart",m.originalEvent);for(const F in y)this._fireEvent(F,y[F]);m&&this._fireEvent("move",m.originalEvent);for(const F in e){const{originalEvent:N}=e[F];this._fireEvent(F,N)}const b={};let E;for(const F in this._eventsInProgress){const{handlerName:N,originalEvent:H}=this._eventsInProgress[F];this._handlersById[N].isActive()||(delete this._eventsInProgress[F],E=i[N]||H,b[`${F}end`]=E)}for(const F in b)this._fireEvent(F,b[F]);const P=eo(this._eventsInProgress),z=(h||m)&&!P;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const F=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&F.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(F)}if(l&&z){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;!F||!F.essential&&_e.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:E})),N(this._map.getBearing())&&this._map.resetNorth()):(N(F.bearing||this._map.getBearing())&&(F.bearing=0),F.freezeElevation=!0,this._map.easeTo(F,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new c.l(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new ph("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Iu extends c.E{constructor(e,i,l){super(),this._renderFrameCallback=()=>{const h=Math.min((_e.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=l.bearingSnap,this.cameraHelper=i,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,i){e.apply(this.transform),this.transform=e,this.cameraHelper=i}getCenter(){return new c.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(e,i){return this.jumpTo({center:e},i)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,i){return this.jumpTo({elevation:e},i),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,i,l){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},i),l)}panTo(e,i,l){return this.easeTo(c.e({center:e},i),l)}getZoom(){return this.transform.zoom}setZoom(e,i){return this.jumpTo({zoom:e},i),this}zoomTo(e,i,l){return this.easeTo(c.e({zoom:e},i),l)}zoomIn(e,i){return this.zoomTo(this.getZoom()+1,e,i),this}zoomOut(e,i){return this.zoomTo(this.getZoom()-1,e,i),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,i){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new c.l("movestart",i)).fire(new c.l("move",i)).fire(new c.l("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(e,i){return this.jumpTo({bearing:e},i),this}getPadding(){return this.transform.padding}setPadding(e,i){return this.jumpTo({padding:e},i),this}rotateTo(e,i,l){return this.easeTo(c.e({bearing:e},i),l)}resetNorth(e,i){return this.rotateTo(0,c.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},e),i),this}snapToNorth(e,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,i):this}getPitch(){return this.transform.pitch}setPitch(e,i){return this.jumpTo({pitch:e},i),this}getRoll(){return this.transform.roll}setRoll(e,i){return this.jumpTo({roll:e},i),this}cameraForBounds(e,i){e=Dr.convert(e).adjustAntiMeridian();const l=i&&i.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,i)}_cameraForBoxAndBearing(e,i,l,h){const m={top:0,bottom:0,right:0,left:0};if(typeof(h=c.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const P=h.padding;h.padding={top:P,bottom:P,right:P,left:P}}const y=c.e(m,h.padding);h.padding=y;const b=this.transform,E=new Dr(e,i);return this.cameraHelper.cameraForBoxAndBearing(h,y,E,l,b)}fitBounds(e,i,l){return this._fitInternal(this.cameraForBounds(e,i),i,l)}fitScreenCoordinates(e,i,l,h,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(e)),this.transform.screenPointToLocation(c.P.convert(i)),l,h),h,m)}_fitInternal(e,i,l){return e?(delete(i=c.e(e,i)).padding,i.linear?this.easeTo(i,l):this.flyTo(i,l)):this}jumpTo(e,i){this.stop();const l=this._getTransformForUpdate();let h=!1,m=!1,y=!1;const b=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,e);const E=l.zoom!==b;return"elevation"in e&&l.elevation!==+e.elevation&&l.setElevation(+e.elevation),"bearing"in e&&l.bearing!==+e.bearing&&(h=!0,l.setBearing(+e.bearing)),"pitch"in e&&l.pitch!==+e.pitch&&(m=!0,l.setPitch(+e.pitch)),"roll"in e&&l.roll!==+e.roll&&(y=!0,l.setRoll(+e.roll)),e.padding==null||l.isPaddingEqual(e.padding)||l.setPadding(e.padding),this._applyUpdatedTransform(l),this.fire(new c.l("movestart",i)).fire(new c.l("move",i)),E&&this.fire(new c.l("zoomstart",i)).fire(new c.l("zoom",i)).fire(new c.l("zoomend",i)),h&&this.fire(new c.l("rotatestart",i)).fire(new c.l("rotate",i)).fire(new c.l("rotateend",i)),m&&this.fire(new c.l("pitchstart",i)).fire(new c.l("pitch",i)).fire(new c.l("pitchend",i)),y&&this.fire(new c.l("rollstart",i)).fire(new c.l("roll",i)).fire(new c.l("rollend",i)),this.fire(new c.l("moveend",i))}calculateCameraOptionsFromTo(e,i,l,h=0){const m=c.$.fromLngLat(e,i),y=c.$.fromLngLat(l,h),b=y.x-m.x,E=y.y-m.y,P=y.z-m.z,z=Math.hypot(b,E,P);if(z===0)throw new Error("Can't calculate camera options with same From and To");const F=Math.hypot(b,E),N=c.ah(this.transform.cameraToCenterDistance/z/this.transform.tileSize),H=180*Math.atan2(b,-E)/Math.PI;let $=180*Math.acos(F/z)/Math.PI;return $=P<0?90-$:90+$,{center:y.toLngLat(),elevation:h,zoom:N,pitch:$,bearing:H}}calculateCameraOptionsFromCameraLngLatAltRotation(e,i,l,h,m){const y=this.transform.calculateCenterFromCameraLngLatAlt(e,i,l,h);return{center:y.center,elevation:y.elevation,zoom:y.zoom,bearing:l,pitch:h,roll:m}}easeTo(e,i){this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.cf},e)).animate===!1||!e.essential&&_e.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),h=this.getBearing(),m=l.pitch,y=l.roll,b="bearing"in e?this._normalizeBearing(e.bearing,h):h,E="pitch"in e?+e.pitch:m,P="roll"in e?this._normalizeBearing(e.roll,y):y,z="padding"in e?e.padding:l.padding,F=c.P.convert(e.offset);let N,H;e.around&&(N=c.Q.convert(e.around),H=l.locationToScreenPoint(N));const $={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ce=this.cameraHelper.handleEaseTo(l,{bearing:b,pitch:E,roll:P,padding:z,around:N,aroundPoint:H,offsetAsPoint:F,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||h!==b,this._pitching=this._pitching||E!==m,this._rolling=this._rolling||P!==y,this._padding=!l.isPaddingEqual(z),this._zooming=this._zooming||ce.isZooming,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,$),this.terrain&&this._prepareElevation(ce.elevationCenter),this._ease(le=>{ce.easeFunc(le),this.terrain&&!e.freezeElevation&&this._updateElevation(le),this._applyUpdatedTransform(l),this._fireMoveEvents(i)},le=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i,le)},e),this}_prepareEase(e,i,l={}){this._moving=!0,i||l.moving||this.fire(new c.l("movestart",e)),this._zooming&&!l.zooming&&this.fire(new c.l("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new c.l("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new c.l("pitchstart",e)),this._rolling&&!l.rolling&&this.fire(new c.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(i-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.setElevation(c.B.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const i=e.getCameraLngLat(),l=e.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(i,e.zoom):0;if(l<h){const m=this.calculateCameraOptionsFromTo(i,h,e.center,e.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(e){const i=[];if(i.push(h=>this._elevateCameraIfInsideTerrain(h)),this.transformCameraUpdate&&i.push(h=>this.transformCameraUpdate(h)),!i.length)return;const l=e.clone();for(const h of i){const m=l.clone(),{center:y,zoom:b,roll:E,pitch:P,bearing:z,elevation:F}=h(m);y&&m.setCenter(y),F!==void 0&&m.setElevation(F),b!==void 0&&m.setZoom(b),E!==void 0&&m.setRoll(E),P!==void 0&&m.setPitch(P),z!==void 0&&m.setBearing(z),l.apply(m)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new c.l("move",e)),this._zooming&&this.fire(new c.l("zoom",e)),this._rotating&&this.fire(new c.l("rotate",e)),this._pitching&&this.fire(new c.l("pitch",e)),this._rolling&&this.fire(new c.l("roll",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const l=this._zooming,h=this._rotating,m=this._pitching,y=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new c.l("zoomend",e)),h&&this.fire(new c.l("rotateend",e)),m&&this.fire(new c.l("pitchend",e)),y&&this.fire(new c.l("rollend",e)),this.fire(new c.l("moveend",e))}flyTo(e,i){if(!e.essential&&_e.prefersReducedMotion){const ut=c.O(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(ut,i)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.cf},e);const l=this._getTransformForUpdate(),h=l.bearing,m=l.pitch,y=l.roll,b=l.padding,E="bearing"in e?this._normalizeBearing(e.bearing,h):h,P="pitch"in e?+e.pitch:m,z="roll"in e?this._normalizeBearing(e.roll,y):y,F="padding"in e?e.padding:l.padding,N=c.P.convert(e.offset);let H=l.centerPoint.add(N);const $=l.screenPointToLocation(H),ce=this.cameraHelper.handleFlyTo(l,{bearing:E,pitch:P,roll:z,padding:F,locationAtOffset:$,offsetAsPoint:N,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let le=e.curve;const he=Math.max(l.width,l.height),xe=he/ce.scaleOfZoom,Te=ce.pixelPathLength;typeof ce.scaleOfMinZoom=="number"&&(le=Math.sqrt(he/ce.scaleOfMinZoom/Te*2));const we=le*le;function Ae(ut){const Zt=(xe*xe-he*he+(ut?-1:1)*we*we*Te*Te)/(2*(ut?xe:he)*we*Te);return Math.log(Math.sqrt(Zt*Zt+1)-Zt)}function ke(ut){return(Math.exp(ut)-Math.exp(-ut))/2}function De(ut){return(Math.exp(ut)+Math.exp(-ut))/2}const Qe=Ae(!1);let dt=function(ut){return De(Qe)/De(Qe+le*ut)},nt=function(ut){return he*((De(Qe)*(ke(Zt=Qe+le*ut)/De(Zt))-ke(Qe))/we)/Te;var Zt},it=(Ae(!0)-Qe)/le;if(Math.abs(Te)<2e-6||!isFinite(it)){if(Math.abs(he-xe)<1e-6)return this.easeTo(e,i);const ut=xe<he?-1:1;it=Math.abs(Math.log(xe/he))/le,nt=()=>0,dt=Zt=>Math.exp(ut*le*Zt)}return e.duration="duration"in e?+e.duration:1e3*it/("screenSpeed"in e?+e.screenSpeed/le:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=h!==E,this._pitching=P!==m,this._rolling=z!==y,this._padding=!l.isPaddingEqual(F),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(ce.targetCenter),this._ease(ut=>{const Zt=ut*it,Vt=1/dt(Zt),St=nt(Zt);this._rotating&&l.setBearing(c.B.number(h,E,ut)),this._pitching&&l.setPitch(c.B.number(m,P,ut)),this._rolling&&l.setRoll(c.B.number(y,z,ut)),this._padding&&(l.interpolatePadding(b,F,ut),H=l.centerPoint.add(N)),ce.easeFunc(ut,Vt,St,H),this.terrain&&!e.freezeElevation&&this._updateElevation(ut),this._applyUpdatedTransform(l),this._fireMoveEvents(i)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,i){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,i)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,i,l){l.animate===!1||l.duration===0?(e(1),i()):(this._easeStart=_e.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=c.aL(e,-180,180);const l=Math.abs(e-i);return Math.abs(e-360-i)<l&&(e-=360),Math.abs(e+360-i)<l&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.Q.convert(e),this.transform.tileZoom):null}}const Is={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class zi{constructor(e=Is){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=i=>{!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"&&i.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=se.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=se.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=se.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){se.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,i){const l=this._map._getUIString(`AttributionControl.${i}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(h=>typeof h!="string"?"":h)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const i=this._map.style.sourceCaches;for(const h in i){const m=i[h];if(m.used||m.usedForTerrain){const y=m.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(h=>String(h).trim()),e.sort((h,m)=>h.length-m.length),e=e.filter((h,m)=>{for(let y=m+1;y<e.length;y++)if(e[y].indexOf(h)>=0)return!1;return!0});const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=se.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ps{constructor(e={}){this._updateCompact=()=>{const i=this._container.children;if(i.length){const l=i[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=se.create("div","maplibregl-ctrl");const i=se.create("a","maplibregl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://maplibre.org/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){se.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Hl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const i=++this._id;return this._queue.push({callback:e,id:i,cancelled:!1}),i}remove(e){const i=this._currentlyRunning,l=i?this._queue.concat(i):this._queue;for(const h of l)if(h.id===e)return void(h.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const i=this._currentlyRunning=this._queue;this._queue=[];for(const l of i)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var mh=c.aG([{name:"a_pos3d",type:"Int16",components:3}]);class xc extends c.E{constructor(e){super(),this._lastTilesetChange=_e.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const l={};for(const h of Be(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),c.bQ(h.terrainRttPosMatrix32f,0,c.Z,c.Z,0,0,1),this._tiles[h.key]=new ii(h,this.tileSize),this._lastTilesetChange=_e.now());for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(e){for(const i in this._tiles){const l=this._tiles[i];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,i){return i?this._getTerrainCoordsForTileRanges(e,i):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const i={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID,m=e.clone(),y=c.b2();if(h.canonical.equals(e.canonical))c.bQ(y,0,c.Z,c.Z,0,0,1);else if(h.canonical.isChildOf(e.canonical)){const b=h.canonical.z-e.canonical.z,E=h.canonical.x-(h.canonical.x>>b<<b),P=h.canonical.y-(h.canonical.y>>b<<b),z=c.Z>>b;c.bQ(y,0,z,z,0,0,1),c.L(y,y,[-E*z,-P*z,0])}else{if(!e.canonical.isChildOf(h.canonical))continue;{const b=e.canonical.z-h.canonical.z,E=e.canonical.x-(e.canonical.x>>b<<b),P=e.canonical.y-(e.canonical.y>>b<<b),z=c.Z>>b;c.bQ(y,0,c.Z,c.Z,0,0,1),c.L(y,y,[E*z,P*z,0]),c.M(y,y,[1/2**b,1/2**b,0])}}m.terrainRttPosMatrix32f=new Float32Array(y),i[l]=m}return i}_getTerrainCoordsForTileRanges(e,i){const l={};for(const h of this._renderableTilesKeys){const m=this._tiles[h].tileID;if(!this._isWithinTileRanges(m,i))continue;const y=e.clone(),b=c.b2();if(m.canonical.z===e.canonical.z){const E=e.canonical.x-m.canonical.x,P=e.canonical.y-m.canonical.y;c.bQ(b,0,c.Z,c.Z,0,0,1),c.L(b,b,[E*c.Z,P*c.Z,0])}else if(m.canonical.z>e.canonical.z){const E=m.canonical.z-e.canonical.z,P=m.canonical.x-(m.canonical.x>>E<<E),z=m.canonical.y-(m.canonical.y>>E<<E),F=e.canonical.x-(m.canonical.x>>E),N=e.canonical.y-(m.canonical.y>>E),H=c.Z>>E;c.bQ(b,0,H,H,0,0,1),c.L(b,b,[-P*H+F*c.Z,-z*H+N*c.Z,0])}else{const E=e.canonical.z-m.canonical.z,P=e.canonical.x-(e.canonical.x>>E<<E),z=e.canonical.y-(e.canonical.y>>E<<E),F=(e.canonical.x>>E)-m.canonical.x,N=(e.canonical.y>>E)-m.canonical.y,H=c.Z<<E;c.bQ(b,0,H,H,0,0,1),c.L(b,b,[P*c.Z+F*H,z*c.Z+N*H,0])}y.terrainRttPosMatrix32f=new Float32Array(b),l[h]=y}return l}getSourceTile(e,i){const l=this.sourceCache._source;let h=e.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(h).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!m||!m.dem)&&i)for(;h>=l.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(e.scaledTo(h--).key);return m}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,i){return i[e.canonical.z]&&e.canonical.x>=i[e.canonical.z].minTileX&&e.canonical.x<=i[e.canonical.z].maxTileX&&e.canonical.y>=i[e.canonical.z].minTileY&&e.canonical.y<=i[e.canonical.z].maxTileY}}class bc{constructor(e,i,l){this._meshCache={},this.painter=e,this.sourceCache=new xc(i),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,l,h=c.Z){var m;if(!(i>=0&&i<h&&l>=0&&l<h))return 0;const y=this.getTerrainData(e),b=(m=y.tile)===null||m===void 0?void 0:m.dem;if(!b)return 0;const E=c.cj([],[i/h*c.Z,l/h*c.Z],y.u_terrain_matrix),P=[E[0]*b.dim,E[1]*b.dim],z=Math.floor(P[0]),F=Math.floor(P[1]),N=P[0]-z,H=P[1]-F;return b.get(z,F)*(1-N)*(1-H)+b.get(z+1,F)*N*(1-H)+b.get(z,F+1)*(1-N)*H+b.get(z+1,F+1)*N*H}getElevationForLngLatZoom(e,i){if(!c.ck(i,e.wrap()))return 0;const{tileID:l,mercatorX:h,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(l,h%c.Z,m%c.Z,c.Z)}getElevation(e,i,l,h=c.Z){return this.getDEMElevation(e,i,l,h)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const h=this.painter.context,m=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new bt(h,m,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new bt(h,new c.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ad([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const h=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new bt(h,i.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),i.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const l=i&&i+i.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const h=this.sourceCache.sourceCache._source.maxzoom;let m=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=h?m=e.canonical.z-h:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>m<<m),b=e.canonical.y-(e.canonical.y>>m<<m),E=c.cl(new Float64Array(16),[1/(c.Z<<m),1/(c.Z<<m),0]);c.L(E,E,[y*c.Z,b*c.Z,0]),this._demMatrixCache[e.key]={matrix:E,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(e){const i=this.painter,l=i.width/devicePixelRatio,h=i.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new bt(i.context,{width:l,height:h,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new bt(i.context,{width:l,height:h,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=i.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(i.context.createRenderbuffer(i.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,y=0;m<this._coordsTextureSize;m++)for(let b=0;b<this._coordsTextureSize;b++,y+=4)i[y+0]=255&b,i[y+1]=255&m,i[y+2]=b>>8<<4|m>>8,i[y+3]=0;const l=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),h=new bt(e,l,e.gl.RGBA,{premultiply:!1});return h.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),l=this.painter.context,h=l.gl,m=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(m,b-y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,i),l.bindFramebuffer.set(null);const E=i[0]+(i[2]>>4<<8),P=i[1]+((15&i[2])<<8),z=this.coordsIndex[255-i[3]],F=z&&this.sourceCache.getTileByID(z);if(!F)return null;const N=this._coordsTextureSize,H=(1<<F.tileID.canonical.z)*N;return new c.$((F.tileID.canonical.x*N+E)/H+F.tileID.wrap,(F.tileID.canonical.y*N+P)/H,this.getElevation(F.tileID,E,P,N))}depthAtPoint(e){const i=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,i),l.bindFramebuffer.set(null),(i[0]/16777216+i[1]/65536+i[2]/256+i[3])/256}getTerrainMesh(e){var i;const l=((i=this.painter.style.projection)===null||i===void 0?void 0:i.transitionState)>0,h=l&&e.canonical.y===0,m=l&&e.canonical.y===(1<<e.canonical.z)-1,y=`m_${h?"n":""}_${m?"s":""}`;if(this._meshCache[y])return this._meshCache[y];const b=this.painter.context,E=new c.cm,P=new c.aK,z=this.meshSize,F=c.Z/z,N=z*z;for(let De=0;De<=z;De++)for(let Qe=0;Qe<=z;Qe++)E.emplaceBack(Qe*F,De*F,0);for(let De=0;De<N;De+=z+1)for(let Qe=0;Qe<z;Qe++)P.emplaceBack(Qe+De,z+Qe+De+1,z+Qe+De+2),P.emplaceBack(Qe+De,z+Qe+De+2,Qe+De+1);const H=E.length,$=H+(z+1),ce=(z+1)*z,le=h?c.b9:0,he=h?0:1,xe=m?c.ba:c.Z,Te=m?0:1;for(let De=0;De<=z;De++)E.emplaceBack(De*F,le,he);for(let De=0;De<=z;De++)E.emplaceBack(De*F,xe,Te);for(let De=0;De<z;De++)P.emplaceBack(ce+De,$+De,$+De+1),P.emplaceBack(ce+De,$+De+1,ce+De+1),P.emplaceBack(0+De,H+De+1,H+De),P.emplaceBack(0+De,0+De+1,H+De+1);const we=E.length,Ae=we+2*(z+1);for(const De of[0,1])for(let Qe=0;Qe<=z;Qe++)for(const dt of[0,1])E.emplaceBack(De*c.Z,Qe*F,dt);for(let De=0;De<2*z;De+=2)P.emplaceBack(we+De,we+De+1,we+De+3),P.emplaceBack(we+De,we+De+3,we+De+2),P.emplaceBack(Ae+De,Ae+De+3,Ae+De+1),P.emplaceBack(Ae+De,Ae+De+2,Ae+De+3);const ke=new Sa(b.createVertexBuffer(E,mh.members),b.createIndexBuffer(P),c.aJ.simpleSegment(0,0,E.length,P.length));return this._meshCache[y]=ke,ke}getMeshFrameDelta(e){return 2*Math.PI*c.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,i){var l;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(e,i);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const i=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return i&&i.dem&&(l.minElevation=i.dem.min*this.exaggeration,l.maxElevation=i.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,i){const l=c.$.fromLngLat(e.wrap()),h=(1<<i)*c.Z,m=l.x*h,y=l.y*h,b=Math.floor(m/c.Z),E=Math.floor(y/c.Z);return{tileID:new c.Y(i,0,i,b,E),mercatorX:m,mercatorY:y}}}class Do{constructor(e,i,l){this._context=e,this._size=i,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const i=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new bt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),i.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),i.colorAttachment.set(l.texture),{id:e,fbo:i,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(i=>e.id!==i),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const i of this._recentlyUsed)if(!this._objects[i].inUse)return this._objects[i];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const vr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class di{constructor(e,i){this.painter=e,this.terrain=i,this.pool=new Do(e.context,30,i.sourceCache.tileSize*i.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,i){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(i)),this._coordsAscending={};for(const l in e.sourceCaches){this._coordsAscending[l]={};const h=e.sourceCaches[l].getVisibleCoordinates(),m=e.sourceCaches[l].getSource(),y=m instanceof gi?m.terrainTileRanges:null;for(const b of h){const E=this.terrain.sourceCache.getTerrainCoords(b,y);for(const P in E)this._coordsAscending[l][P]||(this._coordsAscending[l][P]=[]),this._coordsAscending[l][P].push(E[P])}}this._coordsAscendingStr={};for(const l of e._order){const h=e._layers[l],m=h.source;if(vr[h.type]&&!this._coordsAscendingStr[m]){this._coordsAscendingStr[m]={};for(const y in this._coordsAscending[m])this._coordsAscendingStr[m][y]=this._coordsAscending[m][y].map(b=>b.key).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsAscendingStr){const m=this._coordsAscendingStr[h][l.tileID.key];m&&m!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(e,i){if(e.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),h=e.type,m=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(vr[h]&&(this._prevType&&vr[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(e.id),!y))return!0;if(vr[this._prevType]||vr[h]&&y){this._prevType=h;const b=this._stacks.length-1,E=this._stacks[b]||[];for(const P of this._renderableTiles){if(this.pool.isFull()&&(Ws(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[b]){const F=this.pool.getObjectForId(P.rtt[b].id);if(F.stamp===P.rtt[b].stamp){this.pool.useObject(F);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),P.rtt[b]={id:z.id,stamp:z.stamp},m.context.bindFramebuffer.set(z.fbo.framebuffer),m.context.clear({color:c.b7.transparent,stencil:0}),m.currentStencilSource=void 0;for(let F=0;F<E.length;F++){const N=m.style._layers[E[F]],H=N.source?this._coordsAscending[N.source][P.tileID.key]:[P.tileID];m.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),m._renderTileClippingMasks(N,H,!0),m.renderLayer(m,m.style.sourceCaches[N.source],N,H,l),N.source&&(P.rttCoords[N.source]=this._coordsAscendingStr[N.source][P.tileID.key])}}return Ws(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),vr[h]}return!1}}const $t={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},pr=J,Rs={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Is,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},to={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class $l{constructor(e,i,l=!1){this.mousedown=m=>{this.startMove(m,se.mousePos(this.element,m)),se.addEventListener(window,"mousemove",this.mousemove),se.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=m=>{this.move(m,se.mousePos(this.element,m))},this.mouseup=m=>{this._rotatePitchHanlder.dragEnd(m),this.offTemp()},this.touchstart=m=>{m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=se.touchPos(this.element,m.targetTouches)[0],this.startMove(m,this._startPos),se.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),se.addEventListener(window,"touchend",this.touchend))},this.touchmove=m=>{m.targetTouches.length!==1?this.reset():(this._lastPos=se.touchPos(this.element,m.targetTouches)[0],this.move(m,this._lastPos))},this.touchend=m=>{m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;const h=new Gl;this._rotatePitchHanlder=new An({clickTolerance:3,move:(m,y)=>{const b=i.getBoundingClientRect(),E=new c.P((b.bottom-b.top)/2,(b.right-b.left)/2);return{bearingDelta:c.ce(new c.P(m.x,y.y),y,E),pitchDelta:l?-.5*(y.y-m.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=e,se.addEventListener(i,"mousedown",this.mousedown),se.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),se.addEventListener(i,"touchcancel",this.reset)}startMove(e,i){this._rotatePitchHanlder.dragStart(e,i),se.disableDrag()}move(e,i){const l=this.map,{bearingDelta:h,pitchDelta:m}=this._rotatePitchHanlder.dragMove(e,i)||{};h&&l.setBearing(l.getBearing()+h),m&&l.setPitch(l.getPitch()+m)}off(){const e=this.element;se.removeEventListener(e,"mousedown",this.mousedown),se.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),se.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),se.removeEventListener(window,"touchend",this.touchend),se.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){se.enableDrag(),se.removeEventListener(window,"mousemove",this.mousemove),se.removeEventListener(window,"mouseup",this.mouseup),se.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),se.removeEventListener(window,"touchend",this.touchend)}}let Wi;function Io(d,e,i,l=!1){if(l||!i.getCoveringTilesDetailsProvider().allowWorldCopies())return d==null?void 0:d.wrap();const h=new c.Q(d.lng,d.lat);if(d=new c.Q(d.lng,d.lat),e){const m=new c.Q(d.lng-360,d.lat),y=new c.Q(d.lng+360,d.lat),b=i.locationToScreenPoint(d).distSqr(e);i.locationToScreenPoint(m).distSqr(e)<b?d=m:i.locationToScreenPoint(y).distSqr(e)<b&&(d=y)}for(;Math.abs(d.lng-i.center.lng)>180;){const m=i.locationToScreenPoint(d);if(m.x>=0&&m.y>=0&&m.x<=i.width&&m.y<=i.height)break;d.lng>i.center.lng?d.lng-=360:d.lng+=360}return d.lng!==h.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(d))?d:h}const $a={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function fn(d,e,i){const l=d.classList;for(const h in $a)l.remove(`maplibregl-${i}-anchor-${h}`);l.add(`maplibregl-${i}-anchor-${e}`)}class ro extends c.E{constructor(e){if(super(),this._onKeyPress=i=>{const l=i.code,h=i.charCode||i.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=i=>{const l=i.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=i=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((i==null?void 0:i.type)==="terrain"||(i==null?void 0:i.type)==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=Io(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?m="rotateX(0deg)":this._pitchAlignment==="map"&&(m=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||i&&i.type!=="moveend"||(this._pos=this._pos.round()),se.setTransform(this._element,`${$a[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${h}`),_e.frameAsync(new AbortController).then(()=>{this._updateOpacity(i&&i.type==="moveend")}).catch(()=>{})},this._onMove=i=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=i=>{this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=se.create("div");const i=se.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${l}px`),i.setAttributeNS(null,"width",`${h}px`),i.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const m=se.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const y=se.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const b=se.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const he of E){const xe=se.createNS("http://www.w3.org/2000/svg","ellipse");xe.setAttributeNS(null,"opacity","0.04"),xe.setAttributeNS(null,"cx","10.5"),xe.setAttributeNS(null,"cy","5.80029008"),xe.setAttributeNS(null,"rx",he.rx),xe.setAttributeNS(null,"ry",he.ry),b.appendChild(xe)}const P=se.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);const z=se.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(z);const F=se.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"opacity","0.25"),F.setAttributeNS(null,"fill","#000000");const N=se.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),F.appendChild(N);const H=se.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(6.0, 7.0)"),H.setAttributeNS(null,"fill","#FFFFFF");const $=se.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ce=se.createNS("http://www.w3.org/2000/svg","circle");ce.setAttributeNS(null,"fill","#000000"),ce.setAttributeNS(null,"opacity","0.25"),ce.setAttributeNS(null,"cx","5.5"),ce.setAttributeNS(null,"cy","5.5"),ce.setAttributeNS(null,"r","5.4999962");const le=se.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#FFFFFF"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962"),$.appendChild(ce),$.appendChild(le),y.appendChild(b),y.appendChild(P),y.appendChild(F),y.appendChild(H),y.appendChild($),i.appendChild(y),i.setAttributeNS(null,"height",l*this._scale+"px"),i.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(i),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",i=>{i.preventDefault()}),this._element.addEventListener("mousedown",i=>{i.preventDefault()}),fn(this._element,this._anchor,"marker"),e&&e.className)for(const i of e.className.split(" "))this._element.classList.add(i);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),se.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.Q.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const h=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var i,l;const h=(i=this._map)===null||i===void 0?void 0:i.terrain,m=this._map.transform.isLocationOccluded(this._lngLat);if(!h||m){const H=m?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==H&&(this._element.style.opacity=H))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,b=y.terrain.depthAtPoint(this._pos),E=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,E)-b<.006)return void(this._element.style.opacity=this._opacity);const P=-this._offset.y/y.transform.pixelsPerMeter,z=Math.sin(y.getPitch()*Math.PI/180)*P,F=y.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),N=y.transform.lngLatToCameraDepth(this._lngLat,E+z)-F>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&N&&this._popup.remove(),this._element.style.opacity=N?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,i){return(this._opacity===void 0||e===void 0&&i===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),i!==void 0&&(this._opacityWhenCovered=i),this._map&&this._updateOpacity(!0),this}}const qi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Gi=0,fl=!1;const Pu={maxWidth:100,unit:"metric"};function dl(d,e,i){const l=i&&i.maxWidth||100,h=d._container.clientHeight/2,m=d._container.clientWidth/2,y=d.unproject([m-l/2,h]),b=d.unproject([m+l/2,h]),E=Math.round(d.project(b).x-d.project(y).x),P=Math.min(l,E,d._container.clientWidth),z=y.distanceTo(b);if(i&&i.unit==="imperial"){const F=3.2808*z;F>5280?io(e,P,F/5280,d._getUIString("ScaleControl.Miles")):io(e,P,F,d._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?io(e,P,z/1852,d._getUIString("ScaleControl.NauticalMiles")):z>=1e3?io(e,P,z/1e3,d._getUIString("ScaleControl.Kilometers")):io(e,P,z,d._getUIString("ScaleControl.Meters"))}function io(d,e,i,l){const h=function(m){const y=Math.pow(10,`${Math.floor(m)}`.length-1);let b=m/y;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(E){const P=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*P)/P}(b),y*b}(i);d.style.width=e*(h/i)+"px",d.innerHTML=`${h}&nbsp;${l}`}const Ru={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},ta=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Zi(d){if(d){if(typeof d=="number"){const e=Math.round(Math.abs(d)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,d),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-d),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(d,0),right:new c.P(-d,0)}}if(d instanceof c.P||Array.isArray(d)){const e=c.P.convert(d);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(d.center||[0,0]),top:c.P.convert(d.top||[0,0]),"top-left":c.P.convert(d["top-left"]||[0,0]),"top-right":c.P.convert(d["top-right"]||[0,0]),bottom:c.P.convert(d.bottom||[0,0]),"bottom-left":c.P.convert(d["bottom-left"]||[0,0]),"bottom-right":c.P.convert(d["bottom-right"]||[0,0]),left:c.P.convert(d.left||[0,0]),right:c.P.convert(d.right||[0,0])}}return Zi(new c.P(0,0))}const zu=J;I.AJAXError=c.cq,I.Event=c.l,I.Evented=c.E,I.LngLat=c.Q,I.MercatorCoordinate=c.$,I.Point=c.P,I.addProtocol=c.cr,I.config=c.a,I.removeProtocol=c.cs,I.AttributionControl=zi,I.BoxZoomHandler=dh,I.CanvasSource=Ai,I.CooperativeGesturesHandler=ss,I.DoubleClickZoomHandler=Mu,I.DragPanHandler=yc,I.DragRotateHandler=vc,I.EdgeInsets=qs,I.FullscreenControl=class extends c.E{constructor(d={}){super(),this._onFullscreenChange=()=>{var e;let i=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=i==null?void 0:i.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)i=i.shadowRoot.fullscreenElement;i===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){se.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const d=this._fullscreenButton=se.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);se.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},I.GeoJSONSource=sn,I.GeolocateControl=class extends c.E{constructor(d){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new c.Q(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,h=this._map.getBearing(),m=c.e({bearing:h},this.options.fitBoundsOptions),y=Dr.fromLngLat(i,l);this._map.fitBounds(y,m,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new c.Q(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&fl)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=se.create("button","maplibregl-ctrl-geolocate",this._container),se.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=se.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ro({element:this._dotElement}),this._circleElement=se.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ro({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))})}},this.options=c.e({},qi,d)}onAdd(d){return this._map=d,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(Wi!==void 0&&!e)return Wi;if(window.navigator.permissions===void 0)return Wi=!!window.navigator.geolocation,Wi;try{Wi=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Wi=!!window.navigator.geolocation}return Wi})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),se.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Gi=0,fl=!1}_isOutOfMapMaxBounds(d){const e=this._map.getMaxBounds(),i=d.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const d=this._map.getBounds(),e=d.getSouthEast(),i=d.getNorthEast(),l=e.distanceTo(i),h=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Gi--,fl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Gi++,Gi>1?(d={maximumAge:6e5,timeout:0},fl=!0):(d=this.options.positionOptions,fl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},I.GlobeControl=class{constructor(){this._toggleProjection=()=>{var d;const e=(d=this._map.getProjection())===null||d===void 0?void 0:d.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var d;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((d=this._map.getProjection())===null||d===void 0?void 0:d.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(d){return this._map=d,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=se.create("button","maplibregl-ctrl-globe",this._container),se.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){se.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},I.Hash=fc,I.ImageSource=gi,I.KeyboardHandler=hl,I.LngLatBounds=Dr,I.LogoControl=Ps,I.Map=class extends Iu{constructor(d){var e,i;c.cn.mark(c.co.create);const l=Object.assign(Object.assign(Object.assign({},Rs),d),{canvasContextAttributes:Object.assign(Object.assign({},Rs.canvasContextAttributes),d.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new ys,m=new Ua;if(l.minZoom!==void 0&&h.setMinZoom(l.minZoom),l.maxZoom!==void 0&&h.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&h.setMinPitch(l.minPitch),l.maxPitch!==void 0&&h.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&h.setRenderWorldCopies(l.renderWorldCopies),super(h,m,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Hl,this._controls=[],this._mapId=c.a4(),this._contextLost=b=>{b.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.l("webglcontextlost",{originalEvent:b}))},this._contextRestored=b=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.l("webglcontextrestored",{originalEvent:b}))},this._onMapScroll=b=>{if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},$t),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this.transformCameraUpdate=l.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Rt.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ge(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let b=!1;const E=Qs(P=>{this._trackResize&&!this._removed&&(this.resize(P),this.redraw())},50);this._resizeObserver=new ResizeObserver(P=>{b?E(P):b=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Du(this,l),this._hash=l.hash&&new fc(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,c.e({},l.fitBoundsOptions,{duration:0}))));const y=typeof l.style=="string"||((i=(e=l.style)===null||e===void 0?void 0:e.projection)===null||i===void 0?void 0:i.type)!=="globe";this.resize(null,y),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new zi(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new Ps,l.logoPosition),this.on("style.load",()=>{if(y||this._resizeTransform(),this.transform.unmodified){const b=c.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(b)}}),this.on("data",b=>{this._update(b.dataType==="style"),this.fire(new c.l(`${b.dataType}data`,b))}),this.on("dataloading",b=>{this.fire(new c.l(`${b.dataType}dataloading`,b))}),this.on("dataabort",b=>{this.fire(new c.l("sourcedataabort",b))})}_getMapId(){return this._mapId}addControl(d,e){if(e===void 0&&(e=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=d.onAdd(this);this._controls.push(d);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(i,l.firstChild):l.appendChild(i),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(d);return e>-1&&this._controls.splice(e,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,e,i,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(d,e,i,l)}resize(d,e=!0){const[i,l]=this._containerDimensions(),h=this._getClampedPixelRatio(i,l);if(this._resizeCanvas(i,l,h),this.painter.resize(i,l,h),this.painter.overLimit()){const y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];const b=this._getClampedPixelRatio(i,l);this._resizeCanvas(i,l,b),this.painter.resize(i,l,b)}this._resizeTransform(e);const m=!this._moving;return m&&(this.stop(),this.fire(new c.l("movestart",d)).fire(new c.l("move",d))),this.fire(new c.l("resize",d)),m&&this.fire(new c.l("moveend",d)),this}_resizeTransform(d=!0){var e;const[i,l]=this._containerDimensions();this.transform.resize(i,l,d),(e=this._requestedCameraState)===null||e===void 0||e.resize(i,l,d)}_getClampedPixelRatio(d,e){const{0:i,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),m=d*h,y=e*h;return Math.min(m>i?i/m:1,y>l?l/y:1)*h}getPixelRatio(){var d;return(d=this._overridePixelRatio)!==null&&d!==void 0?d:devicePixelRatio}setPixelRatio(d){this._overridePixelRatio=d,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(Dr.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.setMinZoom(d),this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.setMaxZoom(d),this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.setMinPitch(d),this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(d>=this.transform.minPitch)return this.transform.setMaxPitch(d),this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.setRenderWorldCopies(d),this._update()}project(d){return this.transform.locationToScreenPoint(c.Q.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.screenPointToLocation(c.P.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,e,i){if(d==="mouseenter"||d==="mouseover"){let l=!1;return{layers:e,listener:i,delegates:{mousemove:m=>{const y=e.filter(E=>this.getLayer(E)),b=y.length!==0?this.queryRenderedFeatures(m.point,{layers:y}):[];b.length?l||(l=!0,i.call(this,new hn(d,this,m.originalEvent,{features:b}))):l=!1},mouseout:()=>{l=!1}}}}if(d==="mouseleave"||d==="mouseout"){let l=!1;return{layers:e,listener:i,delegates:{mousemove:y=>{const b=e.filter(E=>this.getLayer(E));(b.length!==0?this.queryRenderedFeatures(y.point,{layers:b}):[]).length?l=!0:l&&(l=!1,i.call(this,new hn(d,this,y.originalEvent)))},mouseout:y=>{l&&(l=!1,i.call(this,new hn(d,this,y.originalEvent)))}}}}{const l=h=>{const m=e.filter(b=>this.getLayer(b)),y=m.length!==0?this.queryRenderedFeatures(h.point,{layers:m}):[];y.length&&(h.features=y,i.call(this,h),delete h.features)};return{layers:e,listener:i,delegates:{[d]:l}}}}_saveDelegatedListener(d,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(e)}_removeDelegatedListener(d,e,i){if(!this._delegatedListeners||!this._delegatedListeners[d])return;const l=this._delegatedListeners[d];for(let h=0;h<l.length;h++){const m=l[h];if(m.listener===i&&m.layers.length===e.length&&m.layers.every(y=>e.includes(y))){for(const y in m.delegates)this.off(y,m.delegates[y]);return void l.splice(h,1)}}}on(d,e,i){if(i===void 0)return super.on(d,e);const l=typeof e=="string"?[e]:e,h=this._createDelegatedListener(d,l,i);this._saveDelegatedListener(d,h);for(const m in h.delegates)this.on(m,h.delegates[m]);return{unsubscribe:()=>{this._removeDelegatedListener(d,l,i)}}}once(d,e,i){if(i===void 0)return super.once(d,e);const l=typeof e=="string"?[e]:e,h=this._createDelegatedListener(d,l,i);for(const m in h.delegates){const y=h.delegates[m];h.delegates[m]=(...b)=>{this._removeDelegatedListener(d,l,i),y(...b)}}this._saveDelegatedListener(d,h);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(d,e,i){return i===void 0?super.off(d,e):(this._removeDelegatedListener(d,typeof e=="string"?[e]:e,i),this)}queryRenderedFeatures(d,e){if(!this.style)return[];let i;const l=d instanceof c.P||Array.isArray(d),h=l?d:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:d)||{},h instanceof c.P||typeof h[0]=="number")i=[c.P.convert(h)];else{const m=c.P.convert(h[0]),y=c.P.convert(h[1]);i=[m,new c.P(y.x,m.y),y,new c.P(m.x,y.y),m]}return this.style.queryRenderedFeatures(i,e,this.transform)}querySourceFeatures(d,e){return this.style.querySourceFeatures(d,e)}setStyle(d,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(d,e))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const e=this._locale[d];if(e==null)throw new Error(`Missing UI string '${d}'`);return e}_updateStyle(d,e){var i,l;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(d,e));const h=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new Kc(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,e,h):this.style.loadJSON(d,e,h),this):((l=(i=this.style)===null||i===void 0?void 0:i.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Kc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,e){if(typeof d=="string"){const i=this._requestManager.transformRequest(d,"Style");c.j(i,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new c.k(l))})}else typeof d=="object"&&this._updateDiff(d,e)}_updateDiff(d,e){try{this.style.setState(d,e)&&this._update(!0)}catch(i){c.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(d,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(d,e){return this._lazyInitEmptyStyle(),this.style.addSource(d,e),this._update(!0)}isSourceLoaded(d){const e=this.style&&this.style.sourceCaches[d];if(e!==void 0)return e.loaded();this.fire(new c.k(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){const e=this.style.sourceCaches[d.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);this.terrain===null&&e.reload();for(const i in this.style._layers){const l=this.style._layers[i];l.type==="hillshade"&&l.source===d.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new bc(this.painter,e,d),this.painter.renderToTexture=new di(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=i=>{var l;i.dataType==="style"?this.terrain.sourceCache.freeRtt():i.dataType==="source"&&i.tile&&(i.sourceId!==d.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=i.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(i.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:d})),this}getTerrain(){var d,e;return(e=(d=this.terrain)===null||d===void 0?void 0:d.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const d=this.style&&this.style.sourceCaches;for(const e in d){const i=d[e]._tiles;for(const l in i){const h=i[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}}return!0}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}setSourceTileLodParams(d,e,i){if(i){const l=this.getSource(i);if(!l)throw new Error(`There is no source with ID "${i}", cannot set LOD parameters`);l.calculateTileZoom=Ee(Math.max(1,d),Math.max(1,e))}else for(const l in this.style.sourceCaches)this.style.sourceCaches[l].getSource().calculateTileZoom=Ee(Math.max(1,d),Math.max(1,e));return this._update(!0),this}refreshTiles(d,e){const i=this.style.sourceCaches[d];if(!i)throw new Error(`There is no source cache with ID "${d}", cannot refresh tile`);e===void 0?i.reload():i.refreshTiles(e.map(l=>new c.a1(l.z,l.x,l.y)))}addImage(d,e,i={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:m,stretchY:y,content:b,textFitWidth:E,textFitHeight:P}=i;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:F,data:N}=e,H=e;return this.style.addImage(d,{data:new c.R({width:z,height:F},new Uint8Array(N)),pixelRatio:l,stretchX:m,stretchY:y,content:b,textFitWidth:E,textFitHeight:P,sdf:h,version:0,userImage:H}),H.onAdd&&H.onAdd(this,d),this}}{const{width:z,height:F,data:N}=_e.getImageData(e);this.style.addImage(d,{data:new c.R({width:z,height:F},N),pixelRatio:l,stretchX:m,stretchY:y,content:b,textFitWidth:E,textFitHeight:P,sdf:h,version:0})}}updateImage(d,e){const i=this.style.getImage(d);if(!i)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||c.b(e)?_e.getImageData(e):e,{width:h,height:m,data:y}=l;if(h===void 0||m===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==i.data.width||m!==i.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(e instanceof HTMLImageElement||c.b(e));return i.data.replace(y,b),this.style.updateImage(d,i),this}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d){return Rt.getImage(this._requestManager.transformRequest(d,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(d,e){return this._lazyInitEmptyStyle(),this.style.addLayer(d,e),this._update(!0)}moveLayer(d,e){return this.style.moveLayer(d,e),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(d,e,i){return this.style.setLayerZoomRange(d,e,i),this._update(!0)}setFilter(d,e,i={}){return this.style.setFilter(d,e,i),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,e,i,l={}){return this.style.setPaintProperty(d,e,i,l),this._update(!0)}getPaintProperty(d,e){return this.style.getPaintProperty(d,e)}setLayoutProperty(d,e,i,l={}){return this.style.setLayoutProperty(d,e,i,l),this._update(!0)}getLayoutProperty(d,e){return this.style.getLayoutProperty(d,e)}setGlyphs(d,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,e,i,l=>{l||this._update(!0)}),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,e,i=>{i||this._update(!0)}),this}setLight(d,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(d,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(d,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(d,e){return this.style.setFeatureState(d,e),this._update()}removeFeatureState(d,e){return this.style.removeFeatureState(d,e),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,e=0;return this._container&&(d=this._container.clientWidth||400,e=this._container.clientHeight||300),[d,e]}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map");const e=this._canvasContainer=se.create("div","maplibregl-canvas-container",d);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=se.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),l=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],l);const h=this._controlContainer=se.create("div","maplibregl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=se.create("div",`maplibregl-ctrl-${y} `,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,e,i){this._canvas.width=Math.floor(i*d),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const d=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:d},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,d):this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d),!i){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new ul(i,this.transform),Me.testSupport(i)}migrateProjection(d,e){super.migrateProjection(d,e),this.painter.transform=d,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){var e,i,l,h,m;const y=this._idleTriggered?this._fadeDuration:0,b=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let E=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,N=_e.now();this.style.zoomHistory.update(F,N);const H=new c.C(F,{now:N,fadeDuration:y,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),$=H.crossFadingFactor();$===1&&$===this._crossFadingFactor||(E=!0,this._crossFadingFactor=$),this.style.update(H)}const P=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0!==b;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(m=this.style.projection)===null||m===void 0?void 0:m.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||P)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,P),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cn.mark(c.co.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||E)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const z=this._sourcesDirty||this._styleDirty||this._placementDirty;return z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,c.cn.mark(c.co.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Rt.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),se.remove(this._canvasContainer),se.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cn.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,_e.frame(this._frameRequest,d=>{c.cn.frame(d),this._frameRequest=null;try{this._render(d)}catch(e){if(!c.cp(e)&&!function(i){return i.message===xu}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return pr}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(d){return this._lazyInitEmptyStyle(),this.style.setProjection(d),this._update(!0)}},I.MapMouseEvent=hn,I.MapTouchEvent=Ha,I.MapWheelEvent=Nn,I.Marker=ro,I.NavigationControl=class{constructor(d){this._updateZoomButtons=()=>{const e=this._map.getZoom(),i=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,i)=>{const l=this._map._getUIString(`NavigationControl.${i}`);e.title=l,e.setAttribute("aria-label",l)},this.options=c.e({},to,d),this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),se.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),se.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=se.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $l(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){se.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,e){const i=se.create("button",d,this._container);return i.type="button",i.addEventListener("click",e),i}},I.Popup=class extends c.E{constructor(d){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&se.remove(this._content),this._container&&(se.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=se.create("div","maplibregl-popup",this._map.getContainer()),this._tip=se.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const y of this.options.className.split(" "))this._container.classList.add(y);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Io(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const i=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const h=Zi(this.options.offset);if(!l){const y=this._container.offsetWidth,b=this._container.offsetHeight;let E;E=i.y+h.bottom.y<b?["top"]:i.y>this._map.transform.height-b?["bottom"]:[],i.x<y/2?E.push("left"):i.x>this._map.transform.width-y/2&&E.push("right"),l=E.length===0?"bottom":E.join("-")}let m=i.add(h[l]);this.options.subpixelPositioning||(m=m.round()),se.setTransform(this._container,`${$a[l]} translate(${m.x}px,${m.y}px)`),fn(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Ru),d)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=c.Q.convert(d),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const e=document.createDocumentFragment(),i=document.createElement("body");let l;for(i.innerHTML=d;l=i.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var d;return(d=this._container)===null||d===void 0?void 0:d.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=se.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){return this._container&&this._container.classList.add(d),this}removeClassName(d){return this._container&&this._container.classList.remove(d),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}setSubpixelPositioning(d){this.options.subpixelPositioning=d}_createCloseButton(){this.options.closeButton&&(this._closeButton=se.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(ta);d&&d.focus()}},I.RasterDEMTileSource=xi,I.RasterTileSource=_r,I.ScaleControl=class{constructor(d){this._onMove=()=>{dl(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,dl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Pu),d)}getDefaultPosition(){return"bottom-left"}onAdd(d){return this._map=d,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){se.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},I.ScrollZoomHandler=zr,I.Style=Kc,I.TerrainControl=class{constructor(d){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=d}onAdd(d){return this._map=d,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=se.create("button","maplibregl-ctrl-terrain",this._container),se.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){se.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},I.TwoFingersTouchPitchHandler=cl,I.TwoFingersTouchRotateHandler=Wt,I.TwoFingersTouchZoomHandler=Js,I.TwoFingersTouchZoomRotateHandler=Ds,I.VectorTileSource=Ui,I.VideoSource=oi,I.addSourceType=(d,e)=>c._(void 0,void 0,void 0,function*(){if(Yi(d))throw new Error(`A source type called "${d}" already exists.`);((i,l)=>{Nr[i]=l})(d,e)}),I.clearPrewarmedResources=function(){const d=vt;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(Ye),vt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},I.createTileMesh=fu,I.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},I.getRTLTextPluginStatus=function(){return ei().getRTLTextPluginStatus()},I.getVersion=function(){return zu},I.getWorkerCount=function(){return Mt.workerCount},I.getWorkerUrl=function(){return c.a.WORKER_URL},I.importScriptInWorkers=function(d){return mr().broadcast("IS",d)},I.prewarm=function(){Ot().acquire(Ye)},I.setMaxParallelImageRequests=function(d){c.a.MAX_PARALLEL_IMAGE_REQUESTS=d},I.setRTLTextPlugin=function(d,e){return ei().setRTLTextPlugin(d,e)},I.setWorkerCount=function(d){Mt.workerCount=d},I.setWorkerUrl=function(d){c.a.WORKER_URL=d}});var U=M;return U})}(om)),om.exports}var Ky=Qy();const dp=vp(Ky);function Jy(w){return w}function e0(w){if(w==null)return Jy;var S,M,D=w.scale[0],B=w.scale[1],U=w.translate[0],I=w.translate[1];return function(c,J){J||(S=M=0);var K=2,oe=c.length,X=new Array(oe);for(X[0]=(S+=c[0])*D+U,X[1]=(M+=c[1])*B+I;K<oe;)X[K]=c[K],++K;return X}}function t0(w,S){for(var M,D=w.length,B=D-S;B<--D;)M=w[B],w[B++]=w[D],w[D]=M}function r0(w,S){return typeof S=="string"&&(S=w.objects[S]),S.type==="GeometryCollection"?{type:"FeatureCollection",features:S.geometries.map(function(M){return Lg(w,M)})}:Lg(w,S)}function Lg(w,S){var M=S.id,D=S.bbox,B=S.properties==null?{}:S.properties,U=i0(w,S);return M==null&&D==null?{type:"Feature",properties:B,geometry:U}:D==null?{type:"Feature",id:M,properties:B,geometry:U}:{type:"Feature",id:M,bbox:D,properties:B,geometry:U}}function i0(w,S){var M=e0(w.transform),D=w.arcs;function B(oe,X){X.length&&X.pop();for(var _e=D[oe<0?~oe:oe],se=0,Me=_e.length;se<Me;++se)X.push(M(_e[se],se));oe<0&&t0(X,Me)}function U(oe){return M(oe)}function I(oe){for(var X=[],_e=0,se=oe.length;_e<se;++_e)B(oe[_e],X);return X.length<2&&X.push(X[0]),X}function c(oe){for(var X=I(oe);X.length<4;)X.push(X[0]);return X}function J(oe){return oe.map(c)}function K(oe){var X=oe.type,_e;switch(X){case"GeometryCollection":return{type:X,geometries:oe.geometries.map(K)};case"Point":_e=U(oe.coordinates);break;case"MultiPoint":_e=oe.coordinates.map(U);break;case"LineString":_e=I(oe.arcs);break;case"MultiLineString":_e=oe.arcs.map(I);break;case"Polygon":_e=J(oe.arcs);break;case"MultiPolygon":_e=oe.arcs.map(J);break;default:return null}return{type:X,coordinates:_e}}return K(S)}var yo=63710088e-1,n0={centimeters:yo*100,centimetres:yo*100,degrees:360/(2*Math.PI),feet:yo*3.28084,inches:yo*39.37,kilometers:yo/1e3,kilometres:yo/1e3,meters:yo,metres:yo,miles:yo/1609.344,millimeters:yo*1e3,millimetres:yo*1e3,nauticalmiles:yo/1852,radians:1,yards:yo*1.0936};function hm(w,S,M={}){const D={type:"Feature"};return(M.id===0||M.id)&&(D.id=M.id),M.bbox&&(D.bbox=M.bbox),D.properties=S||{},D.geometry=w,D}function tm(w,S,M={}){if(!w)throw new Error("coordinates is required");if(!Array.isArray(w))throw new Error("coordinates must be an Array");if(w.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Bg(w[0])||!Bg(w[1]))throw new Error("coordinates must contain numbers");return hm({type:"Point",coordinates:w},S,M)}function fm(w,S,M={}){if(w.length<2)throw new Error("coordinates must be an array of two or more positions");return hm({type:"LineString",coordinates:w},S,M)}function dm(w,S={}){const M={type:"FeatureCollection"};return S.id&&(M.id=S.id),S.bbox&&(M.bbox=S.bbox),M.features=w,M}function a0(w,S="kilometers"){const M=n0[S];if(!M)throw new Error(S+" units is invalid");return w*M}function kg(w){return w%(2*Math.PI)*180/Math.PI}function sd(w){return w%360*Math.PI/180}function Bg(w){return!isNaN(w)&&w!==null&&!Array.isArray(w)}function s0(w){return w!==null&&typeof w=="object"&&!Array.isArray(w)}function Gh(w){if(!w)throw new Error("coord is required");if(!Array.isArray(w)){if(w.type==="Feature"&&w.geometry!==null&&w.geometry.type==="Point")return[...w.geometry.coordinates];if(w.type==="Point")return[...w.coordinates]}if(Array.isArray(w)&&w.length>=2&&!Array.isArray(w[0])&&!Array.isArray(w[1]))return[...w];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Yc(w){if(Array.isArray(w))return w;if(w.type==="Feature"){if(w.geometry!==null)return w.geometry.coordinates}else if(w.coordinates)return w.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Hc(w,S,M={}){var D=Gh(w),B=Gh(S),U=sd(B[1]-D[1]),I=sd(B[0]-D[0]),c=sd(D[1]),J=sd(B[1]),K=Math.pow(Math.sin(U/2),2)+Math.pow(Math.sin(I/2),2)*Math.cos(c)*Math.cos(J);return a0(2*Math.atan2(Math.sqrt(K),Math.sqrt(1-K)),M.units)}function ng(w,S,M){if(w!==null)for(var D,B,U,I,c,J,K,oe=0,X=0,_e,se=w.type,Me=se==="FeatureCollection",qe=se==="Feature",at=Me?w.features.length:1,ft=0;ft<at;ft++){K=Me?w.features[ft].geometry:qe?w.geometry:w,_e=K?K.type==="GeometryCollection":!1,c=_e?K.geometries.length:1;for(var pt=0;pt<c;pt++){var zt=0,Rt=0;if(I=_e?K.geometries[pt]:K,I!==null){J=I.coordinates;var Ge=I.type;switch(oe=0,Ge){case null:break;case"Point":if(S(J,X,ft,zt,Rt)===!1)return!1;X++,zt++;break;case"LineString":case"MultiPoint":for(D=0;D<J.length;D++){if(S(J[D],X,ft,zt,Rt)===!1)return!1;X++,Ge==="MultiPoint"&&zt++}Ge==="LineString"&&zt++;break;case"Polygon":case"MultiLineString":for(D=0;D<J.length;D++){for(B=0;B<J[D].length-oe;B++){if(S(J[D][B],X,ft,zt,Rt)===!1)return!1;X++}Ge==="MultiLineString"&&zt++,Ge==="Polygon"&&Rt++}Ge==="Polygon"&&zt++;break;case"MultiPolygon":for(D=0;D<J.length;D++){for(Rt=0,B=0;B<J[D].length;B++){for(U=0;U<J[D][B].length-oe;U++){if(S(J[D][B][U],X,ft,zt,Rt)===!1)return!1;X++}Rt++}zt++}break;case"GeometryCollection":for(D=0;D<I.geometries.length;D++)if(ng(I.geometries[D],S)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function __(w,S){if(w.type==="Feature")S(w,0);else if(w.type==="FeatureCollection")for(var M=0;M<w.features.length&&S(w.features[M],M)!==!1;M++);}function o0(w,S){var M,D,B,U,I,c,J,K,oe,X,_e=0,se=w.type==="FeatureCollection",Me=w.type==="Feature",qe=se?w.features.length:1;for(M=0;M<qe;M++){for(c=se?w.features[M].geometry:Me?w.geometry:w,K=se?w.features[M].properties:Me?w.properties:{},oe=se?w.features[M].bbox:Me?w.bbox:void 0,X=se?w.features[M].id:Me?w.id:void 0,J=c?c.type==="GeometryCollection":!1,I=J?c.geometries.length:1,B=0;B<I;B++){if(U=J?c.geometries[B]:c,U===null){if(S(null,_e,K,oe,X)===!1)return!1;continue}switch(U.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(S(U,_e,K,oe,X)===!1)return!1;break}case"GeometryCollection":{for(D=0;D<U.geometries.length;D++)if(S(U.geometries[D],_e,K,oe,X)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}_e++}}function ag(w,S){o0(w,function(M,D,B,U,I){var c=M===null?null:M.type;switch(c){case null:case"Point":case"LineString":case"Polygon":return S(hm(M,B,{bbox:U,id:I}),D,0)===!1?!1:void 0}var J;switch(c){case"MultiPoint":J="Point";break;case"MultiLineString":J="LineString";break;case"MultiPolygon":J="Polygon";break}for(var K=0;K<M.coordinates.length;K++){var oe=M.coordinates[K],X={type:J,coordinates:oe};if(S(hm(X,B),D,K)===!1)return!1}})}function y_(w,S){ag(w,function(M,D,B){var U=0;if(M.geometry){var I=M.geometry.type;if(!(I==="Point"||I==="MultiPoint")){var c,J=0,K=0,oe=0;if(ng(M,function(X,_e,se,Me,qe){if(c===void 0||D>J||Me>K||qe>oe){c=X,J=D,K=Me,oe=qe,U=0;return}var at=fm([c,X],M.properties);if(S(at,D,B,qe,U)===!1)return!1;U++,c=X})===!1)return!1}}})}function l0(w,S,M){var D=M,B=!1;return y_(w,function(U,I,c,J,K){B===!1&&M===void 0?D=U:D=S(D,U,I,c,J,K),B=!0}),D}function u0(w,S={}){return l0(w,(M,D)=>{const B=D.geometry.coordinates;return M+Hc(B[0],B[1],S)},0)}var Og=u0;function c0(w,S,M,D,B){v_(w,S,M||0,D||w.length-1,B||h0)}function v_(w,S,M,D,B){for(;D>M;){if(D-M>600){var U=D-M+1,I=S-M+1,c=Math.log(U),J=.5*Math.exp(2*c/3),K=.5*Math.sqrt(c*J*(U-J)/U)*(I-U/2<0?-1:1),oe=Math.max(M,Math.floor(S-I*J/U+K)),X=Math.min(D,Math.floor(S+(U-I)*J/U+K));v_(w,S,oe,X,B)}var _e=w[S],se=M,Me=D;for(up(w,M,S),B(w[D],_e)>0&&up(w,M,D);se<Me;){for(up(w,se,Me),se++,Me--;B(w[se],_e)<0;)se++;for(;B(w[Me],_e)>0;)Me--}B(w[M],_e)===0?up(w,M,Me):(Me++,up(w,Me,D)),Me<=S&&(M=Me+1),S<=Me&&(D=Me-1)}}function up(w,S,M){var D=w[S];w[S]=w[M],w[M]=D}function h0(w,S){return w<S?-1:w>S?1:0}class hu{constructor(S=9){this._maxEntries=Math.max(4,S),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(S){let M=this.data;const D=[];if(!im(S,M))return D;const B=this.toBBox,U=[];for(;M;){for(let I=0;I<M.children.length;I++){const c=M.children[I],J=M.leaf?B(c):c;im(S,J)&&(M.leaf?D.push(c):Vm(S,J)?this._all(c,D):U.push(c))}M=U.pop()}return D}collides(S){let M=this.data;if(!im(S,M))return!1;const D=[];for(;M;){for(let B=0;B<M.children.length;B++){const U=M.children[B],I=M.leaf?this.toBBox(U):U;if(im(S,I)){if(M.leaf||Vm(S,I))return!0;D.push(U)}}M=D.pop()}return!1}load(S){if(!(S&&S.length))return this;if(S.length<this._minEntries){for(let D=0;D<S.length;D++)this.insert(S[D]);return this}let M=this._build(S.slice(),0,S.length-1,0);if(!this.data.children.length)this.data=M;else if(this.data.height===M.height)this._splitRoot(this.data,M);else{if(this.data.height<M.height){const D=this.data;this.data=M,M=D}this._insert(M,this.data.height-M.height-1,!0)}return this}insert(S){return S&&this._insert(S,this.data.height-1),this}clear(){return this.data=ad([]),this}remove(S,M){if(!S)return this;let D=this.data;const B=this.toBBox(S),U=[],I=[];let c,J,K;for(;D||U.length;){if(D||(D=U.pop(),J=U[U.length-1],c=I.pop(),K=!0),D.leaf){const oe=f0(S,D.children,M);if(oe!==-1)return D.children.splice(oe,1),U.push(D),this._condense(U),this}!K&&!D.leaf&&Vm(D,B)?(U.push(D),I.push(c),c=0,J=D,D=D.children[0]):J?(c++,D=J.children[c],K=!1):D=null}return this}toBBox(S){return S}compareMinX(S,M){return S.minX-M.minX}compareMinY(S,M){return S.minY-M.minY}toJSON(){return this.data}fromJSON(S){return this.data=S,this}_all(S,M){const D=[];for(;S;)S.leaf?M.push(...S.children):D.push(...S.children),S=D.pop();return M}_build(S,M,D,B){const U=D-M+1;let I=this._maxEntries,c;if(U<=I)return c=ad(S.slice(M,D+1)),td(c,this.toBBox),c;B||(B=Math.ceil(Math.log(U)/Math.log(I)),I=Math.ceil(U/Math.pow(I,B-1))),c=ad([]),c.leaf=!1,c.height=B;const J=Math.ceil(U/I),K=J*Math.ceil(Math.sqrt(I));Ng(S,M,D,K,this.compareMinX);for(let oe=M;oe<=D;oe+=K){const X=Math.min(oe+K-1,D);Ng(S,oe,X,J,this.compareMinY);for(let _e=oe;_e<=X;_e+=J){const se=Math.min(_e+J-1,X);c.children.push(this._build(S,_e,se,B-1))}}return td(c,this.toBBox),c}_chooseSubtree(S,M,D,B){for(;B.push(M),!(M.leaf||B.length-1===D);){let U=1/0,I=1/0,c;for(let J=0;J<M.children.length;J++){const K=M.children[J],oe=Um(K),X=m0(S,K)-oe;X<I?(I=X,U=oe<U?oe:U,c=K):X===I&&oe<U&&(U=oe,c=K)}M=c||M.children[0]}return M}_insert(S,M,D){const B=D?S:this.toBBox(S),U=[],I=this._chooseSubtree(B,this.data,M,U);for(I.children.push(S),mp(I,B);M>=0&&U[M].children.length>this._maxEntries;)this._split(U,M),M--;this._adjustParentBBoxes(B,U,M)}_split(S,M){const D=S[M],B=D.children.length,U=this._minEntries;this._chooseSplitAxis(D,U,B);const I=this._chooseSplitIndex(D,U,B),c=ad(D.children.splice(I,D.children.length-I));c.height=D.height,c.leaf=D.leaf,td(D,this.toBBox),td(c,this.toBBox),M?S[M-1].children.push(c):this._splitRoot(D,c)}_splitRoot(S,M){this.data=ad([S,M]),this.data.height=S.height+1,this.data.leaf=!1,td(this.data,this.toBBox)}_chooseSplitIndex(S,M,D){let B,U=1/0,I=1/0;for(let c=M;c<=D-M;c++){const J=pp(S,0,c,this.toBBox),K=pp(S,c,D,this.toBBox),oe=g0(J,K),X=Um(J)+Um(K);oe<U?(U=oe,B=c,I=X<I?X:I):oe===U&&X<I&&(I=X,B=c)}return B||D-M}_chooseSplitAxis(S,M,D){const B=S.leaf?this.compareMinX:d0,U=S.leaf?this.compareMinY:p0,I=this._allDistMargin(S,M,D,B),c=this._allDistMargin(S,M,D,U);I<c&&S.children.sort(B)}_allDistMargin(S,M,D,B){S.children.sort(B);const U=this.toBBox,I=pp(S,0,M,U),c=pp(S,D-M,D,U);let J=rm(I)+rm(c);for(let K=M;K<D-M;K++){const oe=S.children[K];mp(I,S.leaf?U(oe):oe),J+=rm(I)}for(let K=D-M-1;K>=M;K--){const oe=S.children[K];mp(c,S.leaf?U(oe):oe),J+=rm(c)}return J}_adjustParentBBoxes(S,M,D){for(let B=D;B>=0;B--)mp(M[B],S)}_condense(S){for(let M=S.length-1,D;M>=0;M--)S[M].children.length===0?M>0?(D=S[M-1].children,D.splice(D.indexOf(S[M]),1)):this.clear():td(S[M],this.toBBox)}}function f0(w,S,M){if(!M)return S.indexOf(w);for(let D=0;D<S.length;D++)if(M(w,S[D]))return D;return-1}function td(w,S){pp(w,0,w.children.length,S,w)}function pp(w,S,M,D,B){B||(B=ad(null)),B.minX=1/0,B.minY=1/0,B.maxX=-1/0,B.maxY=-1/0;for(let U=S;U<M;U++){const I=w.children[U];mp(B,w.leaf?D(I):I)}return B}function mp(w,S){return w.minX=Math.min(w.minX,S.minX),w.minY=Math.min(w.minY,S.minY),w.maxX=Math.max(w.maxX,S.maxX),w.maxY=Math.max(w.maxY,S.maxY),w}function d0(w,S){return w.minX-S.minX}function p0(w,S){return w.minY-S.minY}function Um(w){return(w.maxX-w.minX)*(w.maxY-w.minY)}function rm(w){return w.maxX-w.minX+(w.maxY-w.minY)}function m0(w,S){return(Math.max(S.maxX,w.maxX)-Math.min(S.minX,w.minX))*(Math.max(S.maxY,w.maxY)-Math.min(S.minY,w.minY))}function g0(w,S){const M=Math.max(w.minX,S.minX),D=Math.max(w.minY,S.minY),B=Math.min(w.maxX,S.maxX),U=Math.min(w.maxY,S.maxY);return Math.max(0,B-M)*Math.max(0,U-D)}function Vm(w,S){return w.minX<=S.minX&&w.minY<=S.minY&&S.maxX<=w.maxX&&S.maxY<=w.maxY}function im(w,S){return S.minX<=w.maxX&&S.minY<=w.maxY&&S.maxX>=w.minX&&S.maxY>=w.minY}function ad(w){return{children:w,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ng(w,S,M,D,B){const U=[S,M];for(;U.length;){if(M=U.pop(),S=U.pop(),M-S<=D)continue;const I=S+Math.ceil((M-S)/D/2)*D;c0(w,I,S,M,B),U.push(S,I,I,M)}}function rd(w,S={}){if(w.bbox!=null&&S.recompute!==!0)return w.bbox;const M=[1/0,1/0,-1/0,-1/0];return ng(w,D=>{M[0]>D[0]&&(M[0]=D[0]),M[1]>D[1]&&(M[1]=D[1]),M[2]<D[0]&&(M[2]=D[0]),M[3]<D[1]&&(M[3]=D[1])}),M}function _0(w){var S=new hu(w);return S.insert=function(M){if(M.type!=="Feature")throw new Error("invalid feature");return M.bbox=M.bbox?M.bbox:rd(M),hu.prototype.insert.call(this,M)},S.load=function(M){var D=[];return Array.isArray(M)?M.forEach(function(B){if(B.type!=="Feature")throw new Error("invalid features");B.bbox=B.bbox?B.bbox:rd(B),D.push(B)}):__(M,function(B){if(B.type!=="Feature")throw new Error("invalid features");B.bbox=B.bbox?B.bbox:rd(B),D.push(B)}),hu.prototype.load.call(this,D)},S.remove=function(M,D){if(M.type!=="Feature")throw new Error("invalid feature");return M.bbox=M.bbox?M.bbox:rd(M),hu.prototype.remove.call(this,M,D)},S.clear=function(){return hu.prototype.clear.call(this)},S.search=function(M){var D=hu.prototype.search.call(this,this.toBBox(M));return dm(D)},S.collides=function(M){return hu.prototype.collides.call(this,this.toBBox(M))},S.all=function(){var M=hu.prototype.all.call(this);return dm(M)},S.toJSON=function(){return hu.prototype.toJSON.call(this)},S.fromJSON=function(M){return hu.prototype.fromJSON.call(this,M)},S.toBBox=function(M){var D;if(M.bbox)D=M.bbox;else if(Array.isArray(M)&&M.length===4)D=M;else if(Array.isArray(M)&&M.length===6)D=[M[0],M[1],M[3],M[4]];else if(M.type==="Feature")D=rd(M);else if(M.type==="FeatureCollection")D=rd(M);else throw new Error("invalid geojson");return{minX:D[0],minY:D[1],maxX:D[2],maxY:D[3]}},S}function y0(w){if(!w)throw new Error("geojson is required");const S=[];return ag(w,M=>{v0(M,S)}),dm(S)}function v0(w,S){let M=[];const D=w.geometry;if(D!==null){switch(D.type){case"Polygon":M=Yc(D);break;case"LineString":M=[Yc(D)]}M.forEach(B=>{x0(B,w.properties).forEach(I=>{I.id=S.length,S.push(I)})})}}function x0(w,S){const M=[];return w.reduce((D,B)=>{const U=fm([D,B],S);return U.bbox=b0(D,B),M.push(U),B}),M}function b0(w,S){const M=w[0],D=w[1],B=S[0],U=S[1],I=M<B?M:B,c=D<U?D:U,J=M>B?M:B,K=D>U?D:U;return[I,c,J,K]}var w0=Object.defineProperty,T0=Object.defineProperties,E0=Object.getOwnPropertyDescriptors,Fg=Object.getOwnPropertySymbols,S0=Object.prototype.hasOwnProperty,A0=Object.prototype.propertyIsEnumerable,jg=(w,S,M)=>S in w?w0(w,S,{enumerable:!0,configurable:!0,writable:!0,value:M}):w[S]=M,Ug=(w,S)=>{for(var M in S||(S={}))S0.call(S,M)&&jg(w,M,S[M]);if(Fg)for(var M of Fg(S))A0.call(S,M)&&jg(w,M,S[M]);return w},Vg=(w,S)=>T0(w,E0(S));function nm(w,S,M={}){if(!w||!S)throw new Error("lines and pt are required arguments");const D=Gh(S);let B=tm([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),U=0;return ag(w,function(I,c,J){const K=Yc(I);for(let oe=0;oe<K.length-1;oe++){const X=tm(K[oe]);X.properties.dist=Hc(S,X,M);const _e=Gh(X),se=tm(K[oe+1]);se.properties.dist=Hc(S,se,M);const Me=Gh(se),qe=Hc(X,se,M);let at,ft;_e[0]===D[0]&&_e[1]===D[1]?[at,,ft]=[_e,void 0,!1]:Me[0]===D[0]&&Me[1]===D[1]?[at,,ft]=[Me,void 0,!0]:[at,,ft]=D0(X.geometry.coordinates,se.geometry.coordinates,Gh(S));let pt;at&&(pt=tm(at,{dist:Hc(S,at,M),multiFeatureIndex:J,location:U+Hc(X,at,M)})),pt&&pt.properties.dist<B.properties.dist&&(B=Vg(Ug({},pt),{properties:Vg(Ug({},pt.properties),{index:ft?oe+1:oe})})),U+=qe}}),B}function C0(w,S){const[M,D,B]=w,[U,I,c]=S;return M*U+D*I+B*c}function M0(w,S){const[M,D,B]=w,[U,I,c]=S;return[D*c-B*I,B*U-M*c,M*I-D*U]}function qg(w){return Math.sqrt(Math.pow(w[0],2)+Math.pow(w[1],2)+Math.pow(w[2],2))}function jh(w,S){const M=C0(w,S)/(qg(w)*qg(S));return Math.acos(Math.min(Math.max(M,-1),1))}function qm(w){const S=sd(w[1]),M=sd(w[0]);return[Math.cos(S)*Math.cos(M),Math.cos(S)*Math.sin(M),Math.sin(S)]}function Uh(w){const[S,M,D]=w,B=kg(Math.asin(D));return[kg(Math.atan2(M,S)),B]}function D0(w,S,M){const D=qm(w),B=qm(S),U=qm(M),[I,c,J]=U,[K,oe,X]=M0(D,B),_e=oe*J-X*c,se=X*I-K*J,Me=K*c-oe*I,qe=Me*oe-se*X,at=_e*X-Me*K,ft=se*K-_e*oe,pt=1/Math.sqrt(Math.pow(qe,2)+Math.pow(at,2)+Math.pow(ft,2)),zt=[qe*pt,at*pt,ft*pt],Rt=[-1*qe*pt,-1*at*pt,-1*ft*pt],Ge=jh(D,B),Pe=jh(D,zt),gt=jh(B,zt),bt=jh(D,Rt),Yt=jh(B,Rt);let nr;return Pe<bt&&Pe<Yt||gt<bt&&gt<Yt?nr=zt:nr=Rt,jh(D,nr)>Ge||jh(B,nr)>Ge?Hc(Uh(nr),Uh(D))<=Hc(Uh(nr),Uh(B))?[Uh(D),!0,!1]:[Uh(B),!1,!0]:[Uh(nr),!1,!1]}function am(w,S,M={}){const D=Gh(w),B=Yc(S);for(let U=0;U<B.length-1;U++){let I=!1;if(M.ignoreEndVertices&&(U===0&&(I="start"),U===B.length-2&&(I="end"),U===0&&U+1===B.length-1&&(I="both")),I0(B[U],B[U+1],D,I,typeof M.epsilon>"u"?null:M.epsilon))return!0}return!1}function I0(w,S,M,D,B){const U=M[0],I=M[1],c=w[0],J=w[1],K=S[0],oe=S[1],X=M[0]-c,_e=M[1]-J,se=K-c,Me=oe-J,qe=X*Me-_e*se;if(B!==null){if(Math.abs(qe)>B)return!1}else if(qe!==0)return!1;if(Math.abs(se)===Math.abs(Me)&&Math.abs(se)===0)return D?!1:M[0]===w[0]&&M[1]===w[1];if(D){if(D==="start")return Math.abs(se)>=Math.abs(Me)?se>0?c<U&&U<=K:K<=U&&U<c:Me>0?J<I&&I<=oe:oe<=I&&I<J;if(D==="end")return Math.abs(se)>=Math.abs(Me)?se>0?c<=U&&U<K:K<U&&U<=c:Me>0?J<=I&&I<oe:oe<I&&I<=J;if(D==="both")return Math.abs(se)>=Math.abs(Me)?se>0?c<U&&U<K:K<U&&U<c:Me>0?J<I&&I<oe:oe<I&&I<J}else return Math.abs(se)>=Math.abs(Me)?se>0?c<=U&&U<=K:K<=U&&U<=c:Me>0?J<=I&&I<=oe:oe<=I&&I<=J;return!1}var Gm,Gg;function P0(){return Gg||(Gg=1,Gm=function w(S,M){if(S===M)return!0;if(S&&M&&typeof S=="object"&&typeof M=="object"){if(S.constructor!==M.constructor)return!1;var D,B,U;if(Array.isArray(S)){if(D=S.length,D!=M.length)return!1;for(B=D;B--!==0;)if(!w(S[B],M[B]))return!1;return!0}if(S.constructor===RegExp)return S.source===M.source&&S.flags===M.flags;if(S.valueOf!==Object.prototype.valueOf)return S.valueOf()===M.valueOf();if(S.toString!==Object.prototype.toString)return S.toString()===M.toString();if(U=Object.keys(S),D=U.length,D!==Object.keys(M).length)return!1;for(B=D;B--!==0;)if(!Object.prototype.hasOwnProperty.call(M,U[B]))return!1;for(B=D;B--!==0;){var I=U[B];if(!w(S[I],M[I]))return!1}return!0}return S!==S&&M!==M}),Gm}var R0=P0();const gp=vp(R0);function z0(w,S,M={}){if(M=M||{},!s0(M))throw new Error("options is invalid");var D=M.tolerance||0,B=[],U=_0();const I=y0(w);U.load(I);var c;let J=[];return y_(S,function(K){var oe=!1;K&&(__(U.search(K),function(X){if(oe===!1){var _e=Yc(K).sort(),se=Yc(X).sort();if(gp(_e,se))oe=!0,c?c=Zm(c,K)||c:c=K;else if(D===0?am(_e[0],X)&&am(_e[1],X):nm(X,_e[0]).properties.dist<=D&&nm(X,_e[1]).properties.dist<=D)oe=!0,c?c=Zm(c,K)||c:c=K;else if(D===0?am(se[0],K)&&am(se[1],K):nm(K,se[0]).properties.dist<=D&&nm(K,se[1]).properties.dist<=D)if(c){const Me=Zm(c,X);Me?c=Me:J.push(X)}else c=X}}),oe===!1&&c&&(B.push(c),J.length&&(B=B.concat(J),J=[]),c=void 0))}),c&&B.push(c),dm(B)}function Zm(w,S){var M=Yc(S),D=Yc(w),B=D[0],U=D[D.length-1],I=w.geometry.coordinates;if(gp(M[0],B))I.unshift(M[1]);else if(gp(M[0],U))I.push(M[1]);else if(gp(M[1],B))I.unshift(M[0]);else if(gp(M[1],U))I.push(M[0]);else return;return w}var L0=z0;function sm(w){throw new Error('Could not dynamically require "'+w+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Hm={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/var Zg;function k0(){return Zg||(Zg=1,function(w,S){(function(M){w.exports=M()})(function(){return function M(D,B,U){function I(K,oe){if(!B[K]){if(!D[K]){var X=typeof sm=="function"&&sm;if(!oe&&X)return X(K,!0);if(c)return c(K,!0);var _e=new Error("Cannot find module '"+K+"'");throw _e.code="MODULE_NOT_FOUND",_e}var se=B[K]={exports:{}};D[K][0].call(se.exports,function(Me){var qe=D[K][1][Me];return I(qe||Me)},se,se.exports,M,D,B,U)}return B[K].exports}for(var c=typeof sm=="function"&&sm,J=0;J<U.length;J++)I(U[J]);return I}({1:[function(M,D,B){(function(U){var I=U.MutationObserver||U.WebKitMutationObserver,c;if(I){var J=0,K=new I(Me),oe=U.document.createTextNode("");K.observe(oe,{characterData:!0}),c=function(){oe.data=J=++J%2}}else if(!U.setImmediate&&typeof U.MessageChannel<"u"){var X=new U.MessageChannel;X.port1.onmessage=Me,c=function(){X.port2.postMessage(0)}}else"document"in U&&"onreadystatechange"in U.document.createElement("script")?c=function(){var at=U.document.createElement("script");at.onreadystatechange=function(){Me(),at.onreadystatechange=null,at.parentNode.removeChild(at),at=null},U.document.documentElement.appendChild(at)}:c=function(){setTimeout(Me,0)};var _e,se=[];function Me(){_e=!0;for(var at,ft,pt=se.length;pt;){for(ft=se,se=[],at=-1;++at<pt;)ft[at]();pt=se.length}_e=!1}D.exports=qe;function qe(at){se.push(at)===1&&!_e&&c()}}).call(this,typeof em<"u"?em:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(M,D,B){var U=M(1);function I(){}var c={},J=["REJECTED"],K=["FULFILLED"],oe=["PENDING"];D.exports=X;function X(Ge){if(typeof Ge!="function")throw new TypeError("resolver must be a function");this.state=oe,this.queue=[],this.outcome=void 0,Ge!==I&&qe(this,Ge)}X.prototype.catch=function(Ge){return this.then(null,Ge)},X.prototype.then=function(Ge,Pe){if(typeof Ge!="function"&&this.state===K||typeof Pe!="function"&&this.state===J)return this;var gt=new this.constructor(I);if(this.state!==oe){var bt=this.state===K?Ge:Pe;se(gt,bt,this.outcome)}else this.queue.push(new _e(gt,Ge,Pe));return gt};function _e(Ge,Pe,gt){this.promise=Ge,typeof Pe=="function"&&(this.onFulfilled=Pe,this.callFulfilled=this.otherCallFulfilled),typeof gt=="function"&&(this.onRejected=gt,this.callRejected=this.otherCallRejected)}_e.prototype.callFulfilled=function(Ge){c.resolve(this.promise,Ge)},_e.prototype.otherCallFulfilled=function(Ge){se(this.promise,this.onFulfilled,Ge)},_e.prototype.callRejected=function(Ge){c.reject(this.promise,Ge)},_e.prototype.otherCallRejected=function(Ge){se(this.promise,this.onRejected,Ge)};function se(Ge,Pe,gt){U(function(){var bt;try{bt=Pe(gt)}catch(Yt){return c.reject(Ge,Yt)}bt===Ge?c.reject(Ge,new TypeError("Cannot resolve promise with itself")):c.resolve(Ge,bt)})}c.resolve=function(Ge,Pe){var gt=at(Me,Pe);if(gt.status==="error")return c.reject(Ge,gt.value);var bt=gt.value;if(bt)qe(Ge,bt);else{Ge.state=K,Ge.outcome=Pe;for(var Yt=-1,nr=Ge.queue.length;++Yt<nr;)Ge.queue[Yt].callFulfilled(Pe)}return Ge},c.reject=function(Ge,Pe){Ge.state=J,Ge.outcome=Pe;for(var gt=-1,bt=Ge.queue.length;++gt<bt;)Ge.queue[gt].callRejected(Pe);return Ge};function Me(Ge){var Pe=Ge&&Ge.then;if(Ge&&(typeof Ge=="object"||typeof Ge=="function")&&typeof Pe=="function")return function(){Pe.apply(Ge,arguments)}}function qe(Ge,Pe){var gt=!1;function bt(dr){gt||(gt=!0,c.reject(Ge,dr))}function Yt(dr){gt||(gt=!0,c.resolve(Ge,dr))}function nr(){Pe(Yt,bt)}var lr=at(nr);lr.status==="error"&&bt(lr.value)}function at(Ge,Pe){var gt={};try{gt.value=Ge(Pe),gt.status="success"}catch(bt){gt.status="error",gt.value=bt}return gt}X.resolve=ft;function ft(Ge){return Ge instanceof this?Ge:c.resolve(new this(I),Ge)}X.reject=pt;function pt(Ge){var Pe=new this(I);return c.reject(Pe,Ge)}X.all=zt;function zt(Ge){var Pe=this;if(Object.prototype.toString.call(Ge)!=="[object Array]")return this.reject(new TypeError("must be an array"));var gt=Ge.length,bt=!1;if(!gt)return this.resolve([]);for(var Yt=new Array(gt),nr=0,lr=-1,dr=new this(I);++lr<gt;)Kt(Ge[lr],lr);return dr;function Kt(xr,tt){Pe.resolve(xr).then(Re,function(st){bt||(bt=!0,c.reject(dr,st))});function Re(st){Yt[tt]=st,++nr===gt&&!bt&&(bt=!0,c.resolve(dr,Yt))}}}X.race=Rt;function Rt(Ge){var Pe=this;if(Object.prototype.toString.call(Ge)!=="[object Array]")return this.reject(new TypeError("must be an array"));var gt=Ge.length,bt=!1;if(!gt)return this.resolve([]);for(var Yt=-1,nr=new this(I);++Yt<gt;)lr(Ge[Yt]);return nr;function lr(dr){Pe.resolve(dr).then(function(Kt){bt||(bt=!0,c.resolve(nr,Kt))},function(Kt){bt||(bt=!0,c.reject(nr,Kt))})}}},{1:1}],3:[function(M,D,B){(function(U){typeof U.Promise!="function"&&(U.Promise=M(2))}).call(this,typeof em<"u"?em:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(M,D,B){var U=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ie){return typeof ie}:function(ie){return ie&&typeof Symbol=="function"&&ie.constructor===Symbol&&ie!==Symbol.prototype?"symbol":typeof ie};function I(ie,Ce){if(!(ie instanceof Ce))throw new TypeError("Cannot call a class as a function")}function c(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var J=c();function K(){try{if(!J||!J.open)return!1;var ie=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),Ce=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!ie||Ce)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function oe(ie,Ce){ie=ie||[],Ce=Ce||{};try{return new Blob(ie,Ce)}catch(Ue){if(Ue.name!=="TypeError")throw Ue;for(var pe=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,Ve=new pe,$e=0;$e<ie.length;$e+=1)Ve.append(ie[$e]);return Ve.getBlob(Ce.type)}}typeof Promise>"u"&&M(3);var X=Promise;function _e(ie,Ce){Ce&&ie.then(function(pe){Ce(null,pe)},function(pe){Ce(pe)})}function se(ie,Ce,pe){typeof Ce=="function"&&ie.then(Ce),typeof pe=="function"&&ie.catch(pe)}function Me(ie){return typeof ie!="string"&&(console.warn(ie+" used as a key, but it is not a string."),ie=String(ie)),ie}function qe(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var at="local-forage-detect-blob-support",ft=void 0,pt={},zt=Object.prototype.toString,Rt="readonly",Ge="readwrite";function Pe(ie){for(var Ce=ie.length,pe=new ArrayBuffer(Ce),Ve=new Uint8Array(pe),$e=0;$e<Ce;$e++)Ve[$e]=ie.charCodeAt($e);return pe}function gt(ie){return new X(function(Ce){var pe=ie.transaction(at,Ge),Ve=oe([""]);pe.objectStore(at).put(Ve,"key"),pe.onabort=function($e){$e.preventDefault(),$e.stopPropagation(),Ce(!1)},pe.oncomplete=function(){var $e=navigator.userAgent.match(/Chrome\/(\d+)/),Ue=navigator.userAgent.match(/Edge\//);Ce(Ue||!$e||parseInt($e[1],10)>=43)}}).catch(function(){return!1})}function bt(ie){return typeof ft=="boolean"?X.resolve(ft):gt(ie).then(function(Ce){return ft=Ce,ft})}function Yt(ie){var Ce=pt[ie.name],pe={};pe.promise=new X(function(Ve,$e){pe.resolve=Ve,pe.reject=$e}),Ce.deferredOperations.push(pe),Ce.dbReady?Ce.dbReady=Ce.dbReady.then(function(){return pe.promise}):Ce.dbReady=pe.promise}function nr(ie){var Ce=pt[ie.name],pe=Ce.deferredOperations.pop();if(pe)return pe.resolve(),pe.promise}function lr(ie,Ce){var pe=pt[ie.name],Ve=pe.deferredOperations.pop();if(Ve)return Ve.reject(Ce),Ve.promise}function dr(ie,Ce){return new X(function(pe,Ve){if(pt[ie.name]=pt[ie.name]||Mt(),ie.db)if(Ce)Yt(ie),ie.db.close();else return pe(ie.db);var $e=[ie.name];Ce&&$e.push(ie.version);var Ue=J.open.apply(J,$e);Ce&&(Ue.onupgradeneeded=function(Tt){var kt=Ue.result;try{kt.createObjectStore(ie.storeName),Tt.oldVersion<=1&&kt.createObjectStore(at)}catch(Bt){if(Bt.name==="ConstraintError")console.warn('The database "'+ie.name+'" has been upgraded from version '+Tt.oldVersion+" to version "+Tt.newVersion+', but the storage "'+ie.storeName+'" already exists.');else throw Bt}}),Ue.onerror=function(Tt){Tt.preventDefault(),Ve(Ue.error)},Ue.onsuccess=function(){var Tt=Ue.result;Tt.onversionchange=function(kt){kt.target.close()},pe(Tt),nr(ie)}})}function Kt(ie){return dr(ie,!1)}function xr(ie){return dr(ie,!0)}function tt(ie,Ce){if(!ie.db)return!0;var pe=!ie.db.objectStoreNames.contains(ie.storeName),Ve=ie.version<ie.db.version,$e=ie.version>ie.db.version;if(Ve&&(ie.version!==Ce&&console.warn('The database "'+ie.name+`" can't be downgraded from version `+ie.db.version+" to version "+ie.version+"."),ie.version=ie.db.version),$e||pe){if(pe){var Ue=ie.db.version+1;Ue>ie.version&&(ie.version=Ue)}return!0}return!1}function Re(ie){return new X(function(Ce,pe){var Ve=new FileReader;Ve.onerror=pe,Ve.onloadend=function($e){var Ue=btoa($e.target.result||"");Ce({__local_forage_encoded_blob:!0,data:Ue,type:ie.type})},Ve.readAsBinaryString(ie)})}function st(ie){var Ce=Pe(atob(ie.data));return oe([Ce],{type:ie.type})}function ot(ie){return ie&&ie.__local_forage_encoded_blob}function jt(ie){var Ce=this,pe=Ce._initReady().then(function(){var Ve=pt[Ce._dbInfo.name];if(Ve&&Ve.dbReady)return Ve.dbReady});return se(pe,ie,ie),pe}function ue(ie){Yt(ie);for(var Ce=pt[ie.name],pe=Ce.forages,Ve=0;Ve<pe.length;Ve++){var $e=pe[Ve];$e._dbInfo.db&&($e._dbInfo.db.close(),$e._dbInfo.db=null)}return ie.db=null,Kt(ie).then(function(Ue){return ie.db=Ue,tt(ie)?xr(ie):Ue}).then(function(Ue){ie.db=Ce.db=Ue;for(var Tt=0;Tt<pe.length;Tt++)pe[Tt]._dbInfo.db=Ue}).catch(function(Ue){throw lr(ie,Ue),Ue})}function Ye(ie,Ce,pe,Ve){Ve===void 0&&(Ve=1);try{var $e=ie.db.transaction(ie.storeName,Ce);pe(null,$e)}catch(Ue){if(Ve>0&&(!ie.db||Ue.name==="InvalidStateError"||Ue.name==="NotFoundError"))return X.resolve().then(function(){if(!ie.db||Ue.name==="NotFoundError"&&!ie.db.objectStoreNames.contains(ie.storeName)&&ie.version<=ie.db.version)return ie.db&&(ie.version=ie.db.version+1),xr(ie)}).then(function(){return ue(ie).then(function(){Ye(ie,Ce,pe,Ve-1)})}).catch(pe);pe(Ue)}}function Mt(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function yt(ie){var Ce=this,pe={db:null};if(ie)for(var Ve in ie)pe[Ve]=ie[Ve];var $e=pt[pe.name];$e||($e=Mt(),pt[pe.name]=$e),$e.forages.push(Ce),Ce._initReady||(Ce._initReady=Ce.ready,Ce.ready=jt);var Ue=[];function Tt(){return X.resolve()}for(var kt=0;kt<$e.forages.length;kt++){var Bt=$e.forages[kt];Bt!==Ce&&Ue.push(Bt._initReady().catch(Tt))}var qt=$e.forages.slice(0);return X.all(Ue).then(function(){return pe.db=$e.db,Kt(pe)}).then(function(Ht){return pe.db=Ht,tt(pe,Ce._defaultConfig.version)?xr(pe):Ht}).then(function(Ht){pe.db=$e.db=Ht,Ce._dbInfo=pe;for(var ur=0;ur<qt.length;ur++){var Ir=qt[ur];Ir!==Ce&&(Ir._dbInfo.db=pe.db,Ir._dbInfo.version=pe.version)}})}function vt(ie,Ce){var pe=this;ie=Me(ie);var Ve=new X(function($e,Ue){pe.ready().then(function(){Ye(pe._dbInfo,Rt,function(Tt,kt){if(Tt)return Ue(Tt);try{var Bt=kt.objectStore(pe._dbInfo.storeName),qt=Bt.get(ie);qt.onsuccess=function(){var Ht=qt.result;Ht===void 0&&(Ht=null),ot(Ht)&&(Ht=st(Ht)),$e(Ht)},qt.onerror=function(){Ue(qt.error)}}catch(Ht){Ue(Ht)}})}).catch(Ue)});return _e(Ve,Ce),Ve}function It(ie,Ce){var pe=this,Ve=new X(function($e,Ue){pe.ready().then(function(){Ye(pe._dbInfo,Rt,function(Tt,kt){if(Tt)return Ue(Tt);try{var Bt=kt.objectStore(pe._dbInfo.storeName),qt=Bt.openCursor(),Ht=1;qt.onsuccess=function(){var ur=qt.result;if(ur){var Ir=ur.value;ot(Ir)&&(Ir=st(Ir));var $r=ie(Ir,ur.key,Ht++);$r!==void 0?$e($r):ur.continue()}else $e()},qt.onerror=function(){Ue(qt.error)}}catch(ur){Ue(ur)}})}).catch(Ue)});return _e(Ve,Ce),Ve}function Ot(ie,Ce,pe){var Ve=this;ie=Me(ie);var $e=new X(function(Ue,Tt){var kt;Ve.ready().then(function(){return kt=Ve._dbInfo,zt.call(Ce)==="[object Blob]"?bt(kt.db).then(function(Bt){return Bt?Ce:Re(Ce)}):Ce}).then(function(Bt){Ye(Ve._dbInfo,Ge,function(qt,Ht){if(qt)return Tt(qt);try{var ur=Ht.objectStore(Ve._dbInfo.storeName);Bt===null&&(Bt=void 0);var Ir=ur.put(Bt,ie);Ht.oncomplete=function(){Bt===void 0&&(Bt=null),Ue(Bt)},Ht.onabort=Ht.onerror=function(){var $r=Ir.error?Ir.error:Ir.transaction.error;Tt($r)}}catch($r){Tt($r)}})}).catch(Tt)});return _e($e,pe),$e}function Xt(ie,Ce){var pe=this;ie=Me(ie);var Ve=new X(function($e,Ue){pe.ready().then(function(){Ye(pe._dbInfo,Ge,function(Tt,kt){if(Tt)return Ue(Tt);try{var Bt=kt.objectStore(pe._dbInfo.storeName),qt=Bt.delete(ie);kt.oncomplete=function(){$e()},kt.onerror=function(){Ue(qt.error)},kt.onabort=function(){var Ht=qt.error?qt.error:qt.transaction.error;Ue(Ht)}}catch(Ht){Ue(Ht)}})}).catch(Ue)});return _e(Ve,Ce),Ve}function mr(ie){var Ce=this,pe=new X(function(Ve,$e){Ce.ready().then(function(){Ye(Ce._dbInfo,Ge,function(Ue,Tt){if(Ue)return $e(Ue);try{var kt=Tt.objectStore(Ce._dbInfo.storeName),Bt=kt.clear();Tt.oncomplete=function(){Ve()},Tt.onabort=Tt.onerror=function(){var qt=Bt.error?Bt.error:Bt.transaction.error;$e(qt)}}catch(qt){$e(qt)}})}).catch($e)});return _e(pe,ie),pe}function hi(ie){var Ce=this,pe=new X(function(Ve,$e){Ce.ready().then(function(){Ye(Ce._dbInfo,Rt,function(Ue,Tt){if(Ue)return $e(Ue);try{var kt=Tt.objectStore(Ce._dbInfo.storeName),Bt=kt.count();Bt.onsuccess=function(){Ve(Bt.result)},Bt.onerror=function(){$e(Bt.error)}}catch(qt){$e(qt)}})}).catch($e)});return _e(pe,ie),pe}function Si(ie,Ce){var pe=this,Ve=new X(function($e,Ue){if(ie<0){$e(null);return}pe.ready().then(function(){Ye(pe._dbInfo,Rt,function(Tt,kt){if(Tt)return Ue(Tt);try{var Bt=kt.objectStore(pe._dbInfo.storeName),qt=!1,Ht=Bt.openKeyCursor();Ht.onsuccess=function(){var ur=Ht.result;if(!ur){$e(null);return}ie===0||qt?$e(ur.key):(qt=!0,ur.advance(ie))},Ht.onerror=function(){Ue(Ht.error)}}catch(ur){Ue(ur)}})}).catch(Ue)});return _e(Ve,Ce),Ve}function jr(ie){var Ce=this,pe=new X(function(Ve,$e){Ce.ready().then(function(){Ye(Ce._dbInfo,Rt,function(Ue,Tt){if(Ue)return $e(Ue);try{var kt=Tt.objectStore(Ce._dbInfo.storeName),Bt=kt.openKeyCursor(),qt=[];Bt.onsuccess=function(){var Ht=Bt.result;if(!Ht){Ve(qt);return}qt.push(Ht.key),Ht.continue()},Bt.onerror=function(){$e(Bt.error)}}catch(Ht){$e(Ht)}})}).catch($e)});return _e(pe,ie),pe}function rr(ie,Ce){Ce=qe.apply(this,arguments);var pe=this.config();ie=typeof ie!="function"&&ie||{},ie.name||(ie.name=ie.name||pe.name,ie.storeName=ie.storeName||pe.storeName);var Ve=this,$e;if(!ie.name)$e=X.reject("Invalid arguments");else{var Ue=ie.name===pe.name&&Ve._dbInfo.db,Tt=Ue?X.resolve(Ve._dbInfo.db):Kt(ie).then(function(kt){var Bt=pt[ie.name],qt=Bt.forages;Bt.db=kt;for(var Ht=0;Ht<qt.length;Ht++)qt[Ht]._dbInfo.db=kt;return kt});ie.storeName?$e=Tt.then(function(kt){if(kt.objectStoreNames.contains(ie.storeName)){var Bt=kt.version+1;Yt(ie);var qt=pt[ie.name],Ht=qt.forages;kt.close();for(var ur=0;ur<Ht.length;ur++){var Ir=Ht[ur];Ir._dbInfo.db=null,Ir._dbInfo.version=Bt}var $r=new X(function(Qr,wi){var Xr=J.open(ie.name,Bt);Xr.onerror=function(wr){var Sa=Xr.result;Sa.close(),wi(wr)},Xr.onupgradeneeded=function(){var wr=Xr.result;wr.deleteObjectStore(ie.storeName)},Xr.onsuccess=function(){var wr=Xr.result;wr.close(),Qr(wr)}});return $r.then(function(Qr){qt.db=Qr;for(var wi=0;wi<Ht.length;wi++){var Xr=Ht[wi];Xr._dbInfo.db=Qr,nr(Xr._dbInfo)}}).catch(function(Qr){throw(lr(ie,Qr)||X.resolve()).catch(function(){}),Qr})}}):$e=Tt.then(function(kt){Yt(ie);var Bt=pt[ie.name],qt=Bt.forages;kt.close();for(var Ht=0;Ht<qt.length;Ht++){var ur=qt[Ht];ur._dbInfo.db=null}var Ir=new X(function($r,Qr){var wi=J.deleteDatabase(ie.name);wi.onerror=function(){var Xr=wi.result;Xr&&Xr.close(),Qr(wi.error)},wi.onblocked=function(){console.warn('dropInstance blocked for database "'+ie.name+'" until all open connections are closed')},wi.onsuccess=function(){var Xr=wi.result;Xr&&Xr.close(),$r(Xr)}});return Ir.then(function($r){Bt.db=$r;for(var Qr=0;Qr<qt.length;Qr++){var wi=qt[Qr];nr(wi._dbInfo)}}).catch(function($r){throw(lr(ie,$r)||X.resolve()).catch(function(){}),$r})})}return _e($e,Ce),$e}var mi={_driver:"asyncStorage",_initStorage:yt,_support:K(),iterate:It,getItem:vt,setItem:Ot,removeItem:Xt,clear:mr,length:hi,key:Si,keys:jr,dropInstance:rr};function Dr(){return typeof openDatabase=="function"}var kr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ui="~~local_forage_type~",_r=/^~~local_forage_type~([^~]+)~/,xi="__lfsc__:",sn=xi.length,gi="arbf",oi="blob",Ai="si08",Nr="ui08",Yi="uic8",_i="si16",Vi="si32",ri="ur16",ei="ui32",ii="fl32",yr="fl64",Ar=sn+gi.length,Zr=Object.prototype.toString;function Ur(ie){var Ce=ie.length*.75,pe=ie.length,Ve,$e=0,Ue,Tt,kt,Bt;ie[ie.length-1]==="="&&(Ce--,ie[ie.length-2]==="="&&Ce--);var qt=new ArrayBuffer(Ce),Ht=new Uint8Array(qt);for(Ve=0;Ve<pe;Ve+=4)Ue=kr.indexOf(ie[Ve]),Tt=kr.indexOf(ie[Ve+1]),kt=kr.indexOf(ie[Ve+2]),Bt=kr.indexOf(ie[Ve+3]),Ht[$e++]=Ue<<2|Tt>>4,Ht[$e++]=(Tt&15)<<4|kt>>2,Ht[$e++]=(kt&3)<<6|Bt&63;return qt}function li(ie){var Ce=new Uint8Array(ie),pe="",Ve;for(Ve=0;Ve<Ce.length;Ve+=3)pe+=kr[Ce[Ve]>>2],pe+=kr[(Ce[Ve]&3)<<4|Ce[Ve+1]>>4],pe+=kr[(Ce[Ve+1]&15)<<2|Ce[Ve+2]>>6],pe+=kr[Ce[Ve+2]&63];return Ce.length%3===2?pe=pe.substring(0,pe.length-1)+"=":Ce.length%3===1&&(pe=pe.substring(0,pe.length-2)+"=="),pe}function Ne(ie,Ce){var pe="";if(ie&&(pe=Zr.call(ie)),ie&&(pe==="[object ArrayBuffer]"||ie.buffer&&Zr.call(ie.buffer)==="[object ArrayBuffer]")){var Ve,$e=xi;ie instanceof ArrayBuffer?(Ve=ie,$e+=gi):(Ve=ie.buffer,pe==="[object Int8Array]"?$e+=Ai:pe==="[object Uint8Array]"?$e+=Nr:pe==="[object Uint8ClampedArray]"?$e+=Yi:pe==="[object Int16Array]"?$e+=_i:pe==="[object Uint16Array]"?$e+=ri:pe==="[object Int32Array]"?$e+=Vi:pe==="[object Uint32Array]"?$e+=ei:pe==="[object Float32Array]"?$e+=ii:pe==="[object Float64Array]"?$e+=yr:Ce(new Error("Failed to get type for BinaryArray"))),Ce($e+li(Ve))}else if(pe==="[object Blob]"){var Ue=new FileReader;Ue.onload=function(){var Tt=Ui+ie.type+"~"+li(this.result);Ce(xi+oi+Tt)},Ue.readAsArrayBuffer(ie)}else try{Ce(JSON.stringify(ie))}catch(Tt){console.error("Couldn't convert value into a JSON string: ",ie),Ce(null,Tt)}}function W(ie){if(ie.substring(0,sn)!==xi)return JSON.parse(ie);var Ce=ie.substring(Ar),pe=ie.substring(sn,Ar),Ve;if(pe===oi&&_r.test(Ce)){var $e=Ce.match(_r);Ve=$e[1],Ce=Ce.substring($e[0].length)}var Ue=Ur(Ce);switch(pe){case gi:return Ue;case oi:return oe([Ue],{type:Ve});case Ai:return new Int8Array(Ue);case Nr:return new Uint8Array(Ue);case Yi:return new Uint8ClampedArray(Ue);case _i:return new Int16Array(Ue);case ri:return new Uint16Array(Ue);case Vi:return new Int32Array(Ue);case ei:return new Uint32Array(Ue);case ii:return new Float32Array(Ue);case yr:return new Float64Array(Ue);default:throw new Error("Unkown type: "+pe)}}var Q={serialize:Ne,deserialize:W,stringToBuffer:Ur,bufferToString:li};function ae(ie,Ce,pe,Ve){ie.executeSql("CREATE TABLE IF NOT EXISTS "+Ce.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],pe,Ve)}function ye(ie){var Ce=this,pe={db:null};if(ie)for(var Ve in ie)pe[Ve]=typeof ie[Ve]!="string"?ie[Ve].toString():ie[Ve];var $e=new X(function(Ue,Tt){try{pe.db=openDatabase(pe.name,String(pe.version),pe.description,pe.size)}catch(kt){return Tt(kt)}pe.db.transaction(function(kt){ae(kt,pe,function(){Ce._dbInfo=pe,Ue()},function(Bt,qt){Tt(qt)})},Tt)});return pe.serializer=Q,$e}function Ee(ie,Ce,pe,Ve,$e,Ue){ie.executeSql(pe,Ve,$e,function(Tt,kt){kt.code===kt.SYNTAX_ERR?Tt.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[Ce.storeName],function(Bt,qt){qt.rows.length?Ue(Bt,kt):ae(Bt,Ce,function(){Bt.executeSql(pe,Ve,$e,Ue)},Ue)},Ue):Ue(Tt,kt)},Ue)}function re(ie,Ce){var pe=this;ie=Me(ie);var Ve=new X(function($e,Ue){pe.ready().then(function(){var Tt=pe._dbInfo;Tt.db.transaction(function(kt){Ee(kt,Tt,"SELECT * FROM "+Tt.storeName+" WHERE key = ? LIMIT 1",[ie],function(Bt,qt){var Ht=qt.rows.length?qt.rows.item(0).value:null;Ht&&(Ht=Tt.serializer.deserialize(Ht)),$e(Ht)},function(Bt,qt){Ue(qt)})})}).catch(Ue)});return _e(Ve,Ce),Ve}function Ze(ie,Ce){var pe=this,Ve=new X(function($e,Ue){pe.ready().then(function(){var Tt=pe._dbInfo;Tt.db.transaction(function(kt){Ee(kt,Tt,"SELECT * FROM "+Tt.storeName,[],function(Bt,qt){for(var Ht=qt.rows,ur=Ht.length,Ir=0;Ir<ur;Ir++){var $r=Ht.item(Ir),Qr=$r.value;if(Qr&&(Qr=Tt.serializer.deserialize(Qr)),Qr=ie(Qr,$r.key,Ir+1),Qr!==void 0){$e(Qr);return}}$e()},function(Bt,qt){Ue(qt)})})}).catch(Ue)});return _e(Ve,Ce),Ve}function Be(ie,Ce,pe,Ve){var $e=this;ie=Me(ie);var Ue=new X(function(Tt,kt){$e.ready().then(function(){Ce===void 0&&(Ce=null);var Bt=Ce,qt=$e._dbInfo;qt.serializer.serialize(Ce,function(Ht,ur){ur?kt(ur):qt.db.transaction(function(Ir){Ee(Ir,qt,"INSERT OR REPLACE INTO "+qt.storeName+" (key, value) VALUES (?, ?)",[ie,Ht],function(){Tt(Bt)},function($r,Qr){kt(Qr)})},function(Ir){if(Ir.code===Ir.QUOTA_ERR){if(Ve>0){Tt(Be.apply($e,[ie,Bt,pe,Ve-1]));return}kt(Ir)}})})}).catch(kt)});return _e(Ue,pe),Ue}function Oe(ie,Ce,pe){return Be.apply(this,[ie,Ce,pe,1])}function He(ie,Ce){var pe=this;ie=Me(ie);var Ve=new X(function($e,Ue){pe.ready().then(function(){var Tt=pe._dbInfo;Tt.db.transaction(function(kt){Ee(kt,Tt,"DELETE FROM "+Tt.storeName+" WHERE key = ?",[ie],function(){$e()},function(Bt,qt){Ue(qt)})})}).catch(Ue)});return _e(Ve,Ce),Ve}function je(ie){var Ce=this,pe=new X(function(Ve,$e){Ce.ready().then(function(){var Ue=Ce._dbInfo;Ue.db.transaction(function(Tt){Ee(Tt,Ue,"DELETE FROM "+Ue.storeName,[],function(){Ve()},function(kt,Bt){$e(Bt)})})}).catch($e)});return _e(pe,ie),pe}function _t(ie){var Ce=this,pe=new X(function(Ve,$e){Ce.ready().then(function(){var Ue=Ce._dbInfo;Ue.db.transaction(function(Tt){Ee(Tt,Ue,"SELECT COUNT(key) as c FROM "+Ue.storeName,[],function(kt,Bt){var qt=Bt.rows.item(0).c;Ve(qt)},function(kt,Bt){$e(Bt)})})}).catch($e)});return _e(pe,ie),pe}function Ut(ie,Ce){var pe=this,Ve=new X(function($e,Ue){pe.ready().then(function(){var Tt=pe._dbInfo;Tt.db.transaction(function(kt){Ee(kt,Tt,"SELECT key FROM "+Tt.storeName+" WHERE id = ? LIMIT 1",[ie+1],function(Bt,qt){var Ht=qt.rows.length?qt.rows.item(0).key:null;$e(Ht)},function(Bt,qt){Ue(qt)})})}).catch(Ue)});return _e(Ve,Ce),Ve}function Gt(ie){var Ce=this,pe=new X(function(Ve,$e){Ce.ready().then(function(){var Ue=Ce._dbInfo;Ue.db.transaction(function(Tt){Ee(Tt,Ue,"SELECT key FROM "+Ue.storeName,[],function(kt,Bt){for(var qt=[],Ht=0;Ht<Bt.rows.length;Ht++)qt.push(Bt.rows.item(Ht).key);Ve(qt)},function(kt,Bt){$e(Bt)})})}).catch($e)});return _e(pe,ie),pe}function tr(ie){return new X(function(Ce,pe){ie.transaction(function(Ve){Ve.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function($e,Ue){for(var Tt=[],kt=0;kt<Ue.rows.length;kt++)Tt.push(Ue.rows.item(kt).name);Ce({db:ie,storeNames:Tt})},function($e,Ue){pe(Ue)})},function(Ve){pe(Ve)})})}function ir(ie,Ce){Ce=qe.apply(this,arguments);var pe=this.config();ie=typeof ie!="function"&&ie||{},ie.name||(ie.name=ie.name||pe.name,ie.storeName=ie.storeName||pe.storeName);var Ve=this,$e;return ie.name?$e=new X(function(Ue){var Tt;ie.name===pe.name?Tt=Ve._dbInfo.db:Tt=openDatabase(ie.name,"","",0),ie.storeName?Ue({db:Tt,storeNames:[ie.storeName]}):Ue(tr(Tt))}).then(function(Ue){return new X(function(Tt,kt){Ue.db.transaction(function(Bt){function qt($r){return new X(function(Qr,wi){Bt.executeSql("DROP TABLE IF EXISTS "+$r,[],function(){Qr()},function(Xr,wr){wi(wr)})})}for(var Ht=[],ur=0,Ir=Ue.storeNames.length;ur<Ir;ur++)Ht.push(qt(Ue.storeNames[ur]));X.all(Ht).then(function(){Tt()}).catch(function($r){kt($r)})},function(Bt){kt(Bt)})})}):$e=X.reject("Invalid arguments"),_e($e,Ce),$e}var k={_driver:"webSQLStorage",_initStorage:ye,_support:Dr(),iterate:Ze,getItem:re,setItem:Oe,removeItem:He,clear:je,length:_t,key:Ut,keys:Gt,dropInstance:ir};function O(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function me(ie,Ce){var pe=ie.name+"/";return ie.storeName!==Ce.storeName&&(pe+=ie.storeName+"/"),pe}function de(){var ie="_localforage_support_test";try{return localStorage.setItem(ie,!0),localStorage.removeItem(ie),!1}catch{return!0}}function ze(){return!de()||localStorage.length>0}function We(ie){var Ce=this,pe={};if(ie)for(var Ve in ie)pe[Ve]=ie[Ve];return pe.keyPrefix=me(ie,Ce._defaultConfig),ze()?(Ce._dbInfo=pe,pe.serializer=Q,X.resolve()):X.reject()}function Le(ie){var Ce=this,pe=Ce.ready().then(function(){for(var Ve=Ce._dbInfo.keyPrefix,$e=localStorage.length-1;$e>=0;$e--){var Ue=localStorage.key($e);Ue.indexOf(Ve)===0&&localStorage.removeItem(Ue)}});return _e(pe,ie),pe}function wt(ie,Ce){var pe=this;ie=Me(ie);var Ve=pe.ready().then(function(){var $e=pe._dbInfo,Ue=localStorage.getItem($e.keyPrefix+ie);return Ue&&(Ue=$e.serializer.deserialize(Ue)),Ue});return _e(Ve,Ce),Ve}function Nt(ie,Ce){var pe=this,Ve=pe.ready().then(function(){for(var $e=pe._dbInfo,Ue=$e.keyPrefix,Tt=Ue.length,kt=localStorage.length,Bt=1,qt=0;qt<kt;qt++){var Ht=localStorage.key(qt);if(Ht.indexOf(Ue)===0){var ur=localStorage.getItem(Ht);if(ur&&(ur=$e.serializer.deserialize(ur)),ur=ie(ur,Ht.substring(Tt),Bt++),ur!==void 0)return ur}}});return _e(Ve,Ce),Ve}function Jt(ie,Ce){var pe=this,Ve=pe.ready().then(function(){var $e=pe._dbInfo,Ue;try{Ue=localStorage.key(ie)}catch{Ue=null}return Ue&&(Ue=Ue.substring($e.keyPrefix.length)),Ue});return _e(Ve,Ce),Ve}function ar(ie){var Ce=this,pe=Ce.ready().then(function(){for(var Ve=Ce._dbInfo,$e=localStorage.length,Ue=[],Tt=0;Tt<$e;Tt++){var kt=localStorage.key(Tt);kt.indexOf(Ve.keyPrefix)===0&&Ue.push(kt.substring(Ve.keyPrefix.length))}return Ue});return _e(pe,ie),pe}function Hr(ie){var Ce=this,pe=Ce.keys().then(function(Ve){return Ve.length});return _e(pe,ie),pe}function Qt(ie,Ce){var pe=this;ie=Me(ie);var Ve=pe.ready().then(function(){var $e=pe._dbInfo;localStorage.removeItem($e.keyPrefix+ie)});return _e(Ve,Ce),Ve}function Pi(ie,Ce,pe){var Ve=this;ie=Me(ie);var $e=Ve.ready().then(function(){Ce===void 0&&(Ce=null);var Ue=Ce;return new X(function(Tt,kt){var Bt=Ve._dbInfo;Bt.serializer.serialize(Ce,function(qt,Ht){if(Ht)kt(Ht);else try{localStorage.setItem(Bt.keyPrefix+ie,qt),Tt(Ue)}catch(ur){(ur.name==="QuotaExceededError"||ur.name==="NS_ERROR_DOM_QUOTA_REACHED")&&kt(ur),kt(ur)}})})});return _e($e,pe),$e}function _n(ie,Ce){if(Ce=qe.apply(this,arguments),ie=typeof ie!="function"&&ie||{},!ie.name){var pe=this.config();ie.name=ie.name||pe.name,ie.storeName=ie.storeName||pe.storeName}var Ve=this,$e;return ie.name?$e=new X(function(Ue){ie.storeName?Ue(me(ie,Ve._defaultConfig)):Ue(ie.name+"/")}).then(function(Ue){for(var Tt=localStorage.length-1;Tt>=0;Tt--){var kt=localStorage.key(Tt);kt.indexOf(Ue)===0&&localStorage.removeItem(kt)}}):$e=X.reject("Invalid arguments"),_e($e,Ce),$e}var ui={_driver:"localStorageWrapper",_initStorage:We,_support:O(),iterate:Nt,getItem:wt,setItem:Pi,removeItem:Qt,clear:Le,length:Hr,key:Jt,keys:ar,dropInstance:_n},ti=function(Ce,pe){return Ce===pe||typeof Ce=="number"&&typeof pe=="number"&&isNaN(Ce)&&isNaN(pe)},bi=function(Ce,pe){for(var Ve=Ce.length,$e=0;$e<Ve;){if(ti(Ce[$e],pe))return!0;$e++}return!1},Ln=Array.isArray||function(ie){return Object.prototype.toString.call(ie)==="[object Array]"},Sr={},Cn={},Br={INDEXEDDB:mi,WEBSQL:k,LOCALSTORAGE:ui},ms=[Br.INDEXEDDB._driver,Br.WEBSQL._driver,Br.LOCALSTORAGE._driver],Mn=["dropInstance"],js=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Mn),gs={description:"",driver:ms.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Yn(ie,Ce){ie[Ce]=function(){var pe=arguments;return ie.ready().then(function(){return ie[Ce].apply(ie,pe)})}}function vo(){for(var ie=1;ie<arguments.length;ie++){var Ce=arguments[ie];if(Ce)for(var pe in Ce)Ce.hasOwnProperty(pe)&&(Ln(Ce[pe])?arguments[0][pe]=Ce[pe].slice():arguments[0][pe]=Ce[pe])}return arguments[0]}var Vo=function(){function ie(Ce){I(this,ie);for(var pe in Br)if(Br.hasOwnProperty(pe)){var Ve=Br[pe],$e=Ve._driver;this[pe]=$e,Sr[$e]||this.defineDriver(Ve)}this._defaultConfig=vo({},gs),this._config=vo({},this._defaultConfig,Ce),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return ie.prototype.config=function(pe){if((typeof pe>"u"?"undefined":U(pe))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var Ve in pe){if(Ve==="storeName"&&(pe[Ve]=pe[Ve].replace(/\W/g,"_")),Ve==="version"&&typeof pe[Ve]!="number")return new Error("Database version must be a number.");this._config[Ve]=pe[Ve]}return"driver"in pe&&pe.driver?this.setDriver(this._config.driver):!0}else return typeof pe=="string"?this._config[pe]:this._config},ie.prototype.defineDriver=function(pe,Ve,$e){var Ue=new X(function(Tt,kt){try{var Bt=pe._driver,qt=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!pe._driver){kt(qt);return}for(var Ht=js.concat("_initStorage"),ur=0,Ir=Ht.length;ur<Ir;ur++){var $r=Ht[ur],Qr=!bi(Mn,$r);if((Qr||pe[$r])&&typeof pe[$r]!="function"){kt(qt);return}}var wi=function(){for(var Sa=function(qs){return function(){var _s=new Error("Method "+qs+" is not implemented by the current driver"),on=X.reject(_s);return _e(on,arguments[arguments.length-1]),on}},yn=0,Us=Mn.length;yn<Us;yn++){var Or=Mn[yn];pe[Or]||(pe[Or]=Sa(Or))}};wi();var Xr=function(Sa){Sr[Bt]&&console.info("Redefining LocalForage driver: "+Bt),Sr[Bt]=pe,Cn[Bt]=Sa,Tt()};"_support"in pe?pe._support&&typeof pe._support=="function"?pe._support().then(Xr,kt):Xr(!!pe._support):Xr(!0)}catch(wr){kt(wr)}});return se(Ue,Ve,$e),Ue},ie.prototype.driver=function(){return this._driver||null},ie.prototype.getDriver=function(pe,Ve,$e){var Ue=Sr[pe]?X.resolve(Sr[pe]):X.reject(new Error("Driver not found."));return se(Ue,Ve,$e),Ue},ie.prototype.getSerializer=function(pe){var Ve=X.resolve(Q);return se(Ve,pe),Ve},ie.prototype.ready=function(pe){var Ve=this,$e=Ve._driverSet.then(function(){return Ve._ready===null&&(Ve._ready=Ve._initDriver()),Ve._ready});return se($e,pe,pe),$e},ie.prototype.setDriver=function(pe,Ve,$e){var Ue=this;Ln(pe)||(pe=[pe]);var Tt=this._getSupportedDrivers(pe);function kt(){Ue._config.driver=Ue.driver()}function Bt(ur){return Ue._extend(ur),kt(),Ue._ready=Ue._initStorage(Ue._config),Ue._ready}function qt(ur){return function(){var Ir=0;function $r(){for(;Ir<ur.length;){var Qr=ur[Ir];return Ir++,Ue._dbInfo=null,Ue._ready=null,Ue.getDriver(Qr).then(Bt).catch($r)}kt();var wi=new Error("No available storage method found.");return Ue._driverSet=X.reject(wi),Ue._driverSet}return $r()}}var Ht=this._driverSet!==null?this._driverSet.catch(function(){return X.resolve()}):X.resolve();return this._driverSet=Ht.then(function(){var ur=Tt[0];return Ue._dbInfo=null,Ue._ready=null,Ue.getDriver(ur).then(function(Ir){Ue._driver=Ir._driver,kt(),Ue._wrapLibraryMethodsWithReady(),Ue._initDriver=qt(Tt)})}).catch(function(){kt();var ur=new Error("No available storage method found.");return Ue._driverSet=X.reject(ur),Ue._driverSet}),se(this._driverSet,Ve,$e),this._driverSet},ie.prototype.supports=function(pe){return!!Cn[pe]},ie.prototype._extend=function(pe){vo(this,pe)},ie.prototype._getSupportedDrivers=function(pe){for(var Ve=[],$e=0,Ue=pe.length;$e<Ue;$e++){var Tt=pe[$e];this.supports(Tt)&&Ve.push(Tt)}return Ve},ie.prototype._wrapLibraryMethodsWithReady=function(){for(var pe=0,Ve=js.length;pe<Ve;pe++)Yn(this,js[pe])},ie.prototype.createInstance=function(pe){return new ie(pe)},ie}(),Yu=new Vo;D.exports=Yu},{3:3}]},{},[4])(4)})}(Hm)),Hm.exports}var B0=k0();const od=vp(B0);function O0(w,S,M=1e-4){var I;const D=(I=w.geometry)==null?void 0:I.coordinates;if(!Array.isArray(D)||D.length<2||D.some(c=>!Array.isArray(c)||c.length!==2||isNaN(c[0])||isNaN(c[1])))return!1;const B=fm(D),U=Og(B);return!U||isNaN(U)?!1:S.some(c=>{var _e;const J=(_e=c.geometry)==null?void 0:_e.coordinates;if(!Array.isArray(J)||J.length<2||J.some(se=>!Array.isArray(se)||se.length!==2||isNaN(se[0])||isNaN(se[1])))return!1;const K=fm(J);return L0(B,K,{tolerance:.002}).features.reduce((se,Me)=>se+Og(Me),0)/U>=M})}function N0({showTracks:w,showNames:S,showWaypoints:M,showWaypointLabels:D,showPublicTracks:B,liveTrack:U,userTracks:I,onGeolocateControlReady:c,mapRef:J}){const K=xt.useRef(null),oe=xt.useRef(null),[X,_e]=xt.useState([]),[se,Me]=xt.useState([]);return xt.useEffect(()=>{const qe=new AbortController,at=qe.signal;return fetch("/tracks/manifest.json",{signal:at}).then(ft=>ft.json()).then(_e).catch(ft=>{ft.name!=="AbortError"&&console.error(" Failed to load main track manifest:",ft)}),()=>qe.abort()},[]),xt.useEffect(()=>{const qe=new AbortController,at=qe.signal;return fetch("/public-tracks/manifest.json",{signal:at}).then(ft=>ft.json()).then(Me).catch(ft=>{ft.name!=="AbortError"&&console.error(" Failed to load public track manifest:",ft)}),()=>qe.abort()},[]),xt.useEffect(()=>{if(!J.current)return;const qe=new dp.Map({container:J.current,style:"https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json",center:JSON.parse(localStorage.getItem("mapCenter")||"[-84.3, 36.5]"),zoom:parseFloat(localStorage.getItem("mapZoom")||"9")});K.current=qe,qe.addControl(new dp.NavigationControl,"top-right");const at=new dp.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0,showAccuracyCircle:!1});qe.addControl(at);const ft=new Set,pt=[],zt=async(Rt,Ge,Pe=!1)=>{const gt=Rt.replace(/\.(geojson|topojson)$/i,"").toLowerCase(),bt=`${Ge}-${gt}`,Yt=Pe?`/public-tracks/${Rt}`:`/tracks/${Rt}`,nr=`${Pe?"public":"main"}-track:${Rt}`;let lr;try{const Kt=await fetch(Yt);if(!Kt.ok)throw new Error(`HTTP ${Kt.status}`);lr=await Kt.json(),await od.setItem(nr,lr)}catch(Kt){if(console.warn(` Fetch failed for ${Rt}, loading from cache...`,Kt),lr=await od.getItem(nr),!lr){console.error(` No cached copy for ${Rt}`);return}}let dr=Rt.endsWith(".topojson")?r0(lr,lr.objects[Object.keys(lr.objects)[0]]):lr;dr.features=dr.features.map((Kt,xr)=>(Kt.properties||(Kt.properties={}),{...Kt,id:xr,properties:{...Kt.properties}})),Pe?dr.features=dr.features.filter(Kt=>{var xr,tt,Re,st;if(((xr=Kt.geometry)==null?void 0:xr.type)==="LineString")return!O0(Kt,pt);if(((tt=Kt.geometry)==null?void 0:tt.type)==="Point"){const ot=(st=(Re=Kt.properties)==null?void 0:Re.name)==null?void 0:st.trim();return!ft.has(ot)}return!0}):dr.features.forEach(Kt=>{var xr,tt,Re;((xr=Kt.geometry)==null?void 0:xr.type)==="Point"&&((tt=Kt.properties)!=null&&tt.name)?ft.add(Kt.properties.name.trim()):((Re=Kt.geometry)==null?void 0:Re.type)==="LineString"&&pt.push(Kt)}),qe.addSource(bt,{type:"geojson",data:dr}),qe.addLayer({id:`${bt}-label`,type:"symbol",source:bt,filter:["==","$type","LineString"],layout:{"symbol-placement":"line","text-field":["get","name"],"text-font":["Open Sans Bold"],"text-size":["interpolate",["linear"],["zoom"],10,10,14,14],visibility:Pe&&!B?"none":S?"visible":"none"},paint:{"text-color":"#333","text-halo-color":"#fff","text-halo-width":2},minzoom:10}),qe.addLayer({id:`${bt}-waypoints`,type:"circle",source:bt,filter:["==","$type","Point"],layout:{visibility:Pe&&!B?"none":M?"visible":"none"},paint:{"circle-radius":["interpolate",["linear"],["zoom"],8,4,14,6],"circle-color":"#ff6600","circle-stroke-width":1,"circle-stroke-color":"#fff"},minzoom:9}),qe.addLayer({id:`${bt}-waypoint-labels`,type:"symbol",source:bt,filter:["==","$type","Point"],layout:{"text-field":["get","name"],"text-font":["Open Sans Regular"],"text-size":["interpolate",["linear"],["zoom"],10,10,14,14],"text-offset":[0,1.2],visibility:Pe&&!B?"none":D?"visible":"none"},paint:{"text-color":"#333","text-halo-color":"#fff","text-halo-width":1.5},minzoom:12}),qe.addLayer({id:`${bt}-file-label`,type:"symbol",source:bt,filter:["==",["get","type"],"file-label"],layout:{"text-field":["get","label"],"text-font":["Open Sans Bold"],"text-size":["interpolate",["linear"],["zoom"],6,8,14,14],"text-anchor":"center","text-allow-overlap":!0,"text-ignore-placement":!0,"symbol-placement":"point"},paint:{"text-color":"#000","text-halo-color":"#fff","text-halo-width":2},minzoom:6}),qe.addLayer({id:`${bt}-line`,type:"line",source:bt,filter:["==","$type","LineString"],paint:{"line-color":["coalesce",["get","stroke"],"#666"],"line-opacity":["case",["boolean",["feature-state","highlighted"],!1],1,Pe?.2:1],"line-width":["interpolate",["linear"],["zoom"],5,1,10,2,15,3]},layout:{"line-cap":"round","line-join":"round",visibility:Pe&&!B?"none":"visible"}}),qe.moveLayer(`${bt}-file-label`)};return qe.on("load",async()=>{J&&typeof J=="object"&&(J.current=qe),await Promise.all([...X.map(Rt=>zt(Rt,"track",!1)),...se.map(Rt=>zt(Rt,"public",!0))]),qe.once("idle",()=>{var Rt;typeof c=="function"&&c(()=>{at!=null&&at.trigger&&at.trigger()});try{(Rt=qe.getStyle().layers)==null||Rt.forEach(Ge=>{const Pe=Ge.id;Pe.startsWith("public-")&&Pe.endsWith("-line")&&qe.setLayoutProperty(Pe,"visibility",B?"visible":"none"),Pe.startsWith("public-")&&Pe.endsWith("-label")&&qe.setLayoutProperty(Pe,"visibility",B&&S?"visible":"none"),Pe.startsWith("public-")&&Pe.endsWith("-waypoints")&&qe.setLayoutProperty(Pe,"visibility",B&&M?"visible":"none"),Pe.startsWith("public-")&&Pe.endsWith("-waypoint-labels")&&qe.setLayoutProperty(Pe,"visibility",B&&D?"visible":"none"),!Pe.startsWith("public-")&&Pe.endsWith("-line")&&qe.setLayoutProperty(Pe,"visibility",w?"visible":"none"),!Pe.startsWith("public-")&&Pe.endsWith("-label")&&qe.setLayoutProperty(Pe,"visibility",S?"visible":"none"),!Pe.startsWith("public-")&&Pe.endsWith("-waypoints")&&qe.setLayoutProperty(Pe,"visibility",M?"visible":"none"),!Pe.startsWith("public-")&&Pe.endsWith("-waypoint-labels")&&qe.setLayoutProperty(Pe,"visibility",D?"visible":"none")})}catch(Ge){console.warn(" Failed to apply initial layer visibility:",Ge.message)}}),qe.on("click",Rt=>{const Ge=qe.getStyle().layers.filter(gt=>gt.id.endsWith("-line")).map(gt=>gt.id),Pe=qe.queryRenderedFeatures(Rt.point,{layers:Ge});if(Pe.length>0){const gt=Pe[0],bt=gt.layer.source,Yt=gt.id;oe.current&&qe.setFeatureState(oe.current,{highlighted:!1}),Yt!==void 0&&(oe.current={source:bt,id:Yt},qe.setFeatureState({source:bt,id:Yt},{highlighted:!0}));const nr=gt.properties;new dp.Popup().setLngLat(Rt.lngLat).setHTML(`
          <div class="track-popup">
            <h3>${nr.name||"Unnamed Track"}</h3>
            <p>${nr.desc||nr.description||"No description available."}</p>
          </div>
        `).addTo(qe)}})}),qe.on("moveend",()=>{const Rt=qe.getCenter();localStorage.setItem("mapCenter",JSON.stringify([Rt.lng,Rt.lat])),localStorage.setItem("mapZoom",qe.getZoom())}),()=>{if(K.current)try{K.current.remove()}catch(Rt){console.warn("Map removal failed:",Rt.message)}}},[X,se]),xt.useEffect(()=>{var at;const qe=K.current;if(!(!qe||!qe.isStyleLoaded()))try{(at=qe.getStyle().layers)==null||at.forEach(ft=>{const pt=ft.id;pt.startsWith("public-")&&pt.endsWith("-line")&&qe.setLayoutProperty(pt,"visibility",B?"visible":"none"),pt.startsWith("public-")&&pt.endsWith("-label")&&qe.setLayoutProperty(pt,"visibility",B&&S?"visible":"none"),pt.startsWith("public-")&&pt.endsWith("-waypoints")&&qe.setLayoutProperty(pt,"visibility",B&&M?"visible":"none"),pt.startsWith("public-")&&pt.endsWith("-waypoint-labels")&&qe.setLayoutProperty(pt,"visibility",B&&D?"visible":"none"),!pt.startsWith("public-")&&pt.endsWith("-line")&&qe.setLayoutProperty(pt,"visibility",w?"visible":"none"),!pt.startsWith("public-")&&pt.endsWith("-label")&&qe.setLayoutProperty(pt,"visibility",S?"visible":"none"),!pt.startsWith("public-")&&pt.endsWith("-waypoints")&&qe.setLayoutProperty(pt,"visibility",M?"visible":"none"),!pt.startsWith("public-")&&pt.endsWith("-waypoint-labels")&&qe.setLayoutProperty(pt,"visibility",D?"visible":"none")})}catch(ft){console.warn(" Failed to update layer visibility:",ft.message)}},[w,S,M,D,B]),xt.useEffect(()=>{const qe=K.current;if(!qe||!qe.isStyleLoaded())return;const at="user-tracks",ft="user-tracks-line";qe.getLayer(ft)&&qe.removeLayer(ft),qe.getSource(at)&&qe.removeSource(at),I&&I.length>0&&(qe.addSource(at,{type:"geojson",data:{type:"FeatureCollection",features:I}}),qe.addLayer({id:ft,type:"line",source:at,paint:{"line-color":"#FF0000","line-width":4,"line-opacity":.9}}))},[I]),xt.useEffect(()=>{const qe=K.current;if(!qe||!qe.isStyleLoaded())return;const at="live-track",ft="live-track-line";qe.getLayer(ft)&&qe.removeLayer(ft),qe.getSource(at)&&qe.removeSource(at),U&&U.length>1&&(qe.addSource(at,{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:U}}}),qe.addLayer({id:ft,type:"line",source:at,paint:{"line-color":"#0074D9","line-width":4,"line-opacity":.8}}))},[U]),ge.jsx("div",{ref:J,style:{height:"100vh",width:"100%"}})}function cp({checked:w,onChange:S}){return ge.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[ge.jsx("input",{type:"checkbox",checked:w,onChange:S,className:"sr-only peer"}),ge.jsx("div",{className:"w-11 h-6 bg-gray-300 peer-focus:ring-2 peer-focus:ring-green-500 rounded-full peer peer-checked:bg-green-600 transition-all duration-200"}),ge.jsx("div",{className:"absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-all duration-200 peer-checked:translate-x-full"})]})}var x_={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Hg=Xu.createContext&&Xu.createContext(x_),F0=["attr","size","title"];function j0(w,S){if(w==null)return{};var M=U0(w,S),D,B;if(Object.getOwnPropertySymbols){var U=Object.getOwnPropertySymbols(w);for(B=0;B<U.length;B++)D=U[B],!(S.indexOf(D)>=0)&&Object.prototype.propertyIsEnumerable.call(w,D)&&(M[D]=w[D])}return M}function U0(w,S){if(w==null)return{};var M={};for(var D in w)if(Object.prototype.hasOwnProperty.call(w,D)){if(S.indexOf(D)>=0)continue;M[D]=w[D]}return M}function pm(){return pm=Object.assign?Object.assign.bind():function(w){for(var S=1;S<arguments.length;S++){var M=arguments[S];for(var D in M)Object.prototype.hasOwnProperty.call(M,D)&&(w[D]=M[D])}return w},pm.apply(this,arguments)}function $g(w,S){var M=Object.keys(w);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(w);S&&(D=D.filter(function(B){return Object.getOwnPropertyDescriptor(w,B).enumerable})),M.push.apply(M,D)}return M}function mm(w){for(var S=1;S<arguments.length;S++){var M=arguments[S]!=null?arguments[S]:{};S%2?$g(Object(M),!0).forEach(function(D){V0(w,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(M)):$g(Object(M)).forEach(function(D){Object.defineProperty(w,D,Object.getOwnPropertyDescriptor(M,D))})}return w}function V0(w,S,M){return S=q0(S),S in w?Object.defineProperty(w,S,{value:M,enumerable:!0,configurable:!0,writable:!0}):w[S]=M,w}function q0(w){var S=G0(w,"string");return typeof S=="symbol"?S:S+""}function G0(w,S){if(typeof w!="object"||!w)return w;var M=w[Symbol.toPrimitive];if(M!==void 0){var D=M.call(w,S);if(typeof D!="object")return D;throw new TypeError("@@toPrimitive must return a primitive value.")}return(S==="string"?String:Number)(w)}function b_(w){return w&&w.map((S,M)=>Xu.createElement(S.tag,mm({key:M},S.attr),b_(S.child)))}function hd(w){return S=>Xu.createElement(Z0,pm({attr:mm({},w.attr)},S),b_(w.child))}function Z0(w){var S=M=>{var{attr:D,size:B,title:U}=w,I=j0(w,F0),c=B||M.size||"1em",J;return M.className&&(J=M.className),w.className&&(J=(J?J+" ":"")+w.className),Xu.createElement("svg",pm({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},M.attr,D,I,{className:J,style:mm(mm({color:w.color||M.color},M.style),w.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),U&&Xu.createElement("title",null,U),w.children)};return Hg!==void 0?Xu.createElement(Hg.Consumer,null,M=>S(M)):S(x_)}function H0(w){return hd({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(w)}function Xg(w){return hd({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"},child:[]}]})(w)}function $0(w){return hd({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M288 0c-69.59 0-126 56.41-126 126 0 56.26 82.35 158.8 113.9 196.02 6.39 7.54 17.82 7.54 24.2 0C331.65 284.8 414 182.26 414 126 414 56.41 357.59 0 288 0zm0 168c-23.2 0-42-18.8-42-42s18.8-42 42-42 42 18.8 42 42-18.8 42-42 42zM20.12 215.95A32.006 32.006 0 0 0 0 245.66v250.32c0 11.32 11.43 19.06 21.94 14.86L160 448V214.92c-8.84-15.98-16.07-31.54-21.25-46.42L20.12 215.95zM288 359.67c-14.07 0-27.38-6.18-36.51-16.96-19.66-23.2-40.57-49.62-59.49-76.72v182l192 64V266c-18.92 27.09-39.82 53.52-59.49 76.72-9.13 10.77-22.44 16.95-36.51 16.95zm266.06-198.51L416 224v288l139.88-55.95A31.996 31.996 0 0 0 576 426.34V176.02c0-11.32-11.43-19.06-21.94-14.86z"},child:[]}]})(w)}function X0(w){return hd({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M0 117.66v346.32c0 11.32 11.43 19.06 21.94 14.86L160 416V32L20.12 87.95A32.006 32.006 0 0 0 0 117.66zM192 416l192 64V96L192 32v384zM554.06 33.16L416 96v384l139.88-55.95A31.996 31.996 0 0 0 576 394.34V48.02c0-11.32-11.43-19.06-21.94-14.86z"},child:[]}]})(w)}function Y0(w){return hd({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 320h-96c-17.6 0-32-14.4-32-32s14.4-32 32-32h96s96-107 96-160-43-96-96-96-96 43-96 96c0 25.5 22.2 63.4 45.3 96H320c-52.9 0-96 43.1-96 96s43.1 96 96 96h96c17.6 0 32 14.4 32 32s-14.4 32-32 32H185.5c-16 24.8-33.8 47.7-47.3 64H416c52.9 0 96-43.1 96-96s-43.1-96-96-96zm0-256c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zM96 256c-53 0-96 43-96 96s96 160 96 160 96-107 96-160-43-96-96-96zm0 128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(w)}function W0(w){return hd({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 2 7 12 12 22 7 12 2"},child:[]},{tag:"polyline",attr:{points:"2 17 12 22 22 17"},child:[]},{tag:"polyline",attr:{points:"2 12 12 17 22 12"},child:[]}]})(w)}function Fa(w,S){return Array.from(w.getElementsByTagName(S))}function gm(w){return w[0]==="#"?w:`#${w}`}function Q0(w,S,M){return Array.from(w.getElementsByTagNameNS(M,S))}function ja(w){return w==null||w.normalize(),(w==null?void 0:w.textContent)||""}function Xn(w,S,M){const D=w.getElementsByTagName(S);return D.length?D[0]:null}function Uo(w,S,M){const D={};if(!w)return D;const B=w.getElementsByTagName(S),U=B.length?B[0]:null;return U&&M?M(U,D):D}function Zh(w,S,M){const D=ja(Xn(w,S));return D&&M?M(D)||{}:{}}function Yg(w,S,M){const D=Number.parseFloat(ja(Xn(w,S)));if(!Number.isNaN(D))return D&&M?M(D)||{}:{}}function ps(w,S,M){const D=Number.parseFloat(ja(Xn(w,S)));if(!Number.isNaN(D))return M&&M(D),D}function Hh(w,S){const M={};for(const D of S)Zh(w,D,B=>{M[D]=B});return M}function sg(w){return(w==null?void 0:w.nodeType)===1}function w_(w){let S=[];if(w===null)return S;for(const M of Array.from(w.childNodes)){if(!sg(M))continue;const D=K0(M.nodeName);if(D==="gpxtpx:TrackPointExtension")S=S.concat(w_(M));else{const B=ja(M);S.push([D,J0(B)])}}return S}function K0(w){return["heart","gpxtpx:hr","hr"].includes(w)?"heart":w}function J0(w){const S=Number.parseFloat(w);return Number.isNaN(S)?w:S}function T_(w){const S=[Number.parseFloat(w.getAttribute("lon")||""),Number.parseFloat(w.getAttribute("lat")||"")];if(Number.isNaN(S[0])||Number.isNaN(S[1]))return null;ps(w,"ele",D=>{S.push(D)});const M=Xn(w,"time");return{coordinates:S,time:M?ja(M):null,extendedValues:w_(Xn(w,"extensions"))}}function E_(w){return Uo(w,"line",S=>Object.assign({},Zh(S,"color",D=>({stroke:`#${D}`})),Yg(S,"opacity",D=>({"stroke-opacity":D})),Yg(S,"width",D=>({"stroke-width":D*96/25.4}))))}function og(w,S){var B;const M=Hh(S,["name","cmt","desc","type","time","keywords"]);for(const[U,I]of w)for(const c of Array.from(S.getElementsByTagNameNS(I,"*")))M[c.tagName.replace(":","_")]=(B=ja(c))==null?void 0:B.trim();const D=Fa(S,"link");return D.length&&(M.links=D.map(U=>Object.assign({href:U.getAttribute("href")},Hh(U,["text","type"])))),M}function S_(w,S){const M=Fa(w,S),D=[],B=[],U={};for(let I=0;I<M.length;I++){const c=T_(M[I]);if(c){D.push(c.coordinates),c.time&&B.push(c.time);for(const[J,K]of c.extendedValues){const oe=J==="heart"?J:`${J.replace("gpxtpx:","")}s`;U[oe]||(U[oe]=Array(M.length).fill(null)),U[oe][I]=K}}}if(!(D.length<2))return{line:D,times:B,extendedValues:U}}function ev(w,S){const M=S_(S,"rtept");if(M)return{type:"Feature",properties:Object.assign({_gpxType:"rte"},og(w,S),E_(Xn(S,"extensions"))),geometry:{type:"LineString",coordinates:M.line}}}function tv(w,S){var J;const M=Fa(S,"trkseg"),D=[],B=[],U=[];for(const K of M){const oe=S_(K,"trkpt");oe&&(U.push(oe),(J=oe.times)!=null&&J.length&&B.push(oe.times))}if(U.length===0)return null;const I=U.length>1,c=Object.assign({_gpxType:"trk"},og(w,S),E_(Xn(S,"extensions")),B.length?{coordinateProperties:{times:I?B:B[0]}}:{});for(const K of U){D.push(K.line),c.coordinateProperties||(c.coordinateProperties={});const oe=c.coordinateProperties,X=Object.entries(K.extendedValues);for(let _e=0;_e<X.length;_e++){const[se,Me]=X[_e];I?(oe[se]||(oe[se]=U.map(qe=>new Array(qe.line.length).fill(null))),oe[se][_e]=Me):oe[se]=Me}}return{type:"Feature",properties:c,geometry:I?{type:"MultiLineString",coordinates:D}:{type:"LineString",coordinates:D[0]}}}function rv(w,S){const M=Object.assign(og(w,S),Hh(S,["sym"])),D=T_(S);return D?{type:"Feature",properties:M,geometry:{type:"Point",coordinates:D.coordinates}}:null}function*iv(w){var I,c;const S=w,M="gpxx",D="http://www.garmin.com/xmlschemas/GpxExtensions/v3",B=[[M,D]],U=(I=S.getElementsByTagName("gpx")[0])==null?void 0:I.attributes;if(U)for(const J of Array.from(U))(c=J.name)!=null&&c.startsWith("xmlns:")&&J.value!==D&&B.push([J.name,J.value]);for(const J of Fa(S,"trk")){const K=tv(B,J);K&&(yield K)}for(const J of Fa(S,"rte")){const K=ev(B,J);K&&(yield K)}for(const J of Fa(S,"wpt")){const K=rv(B,J);K&&(yield K)}}function nv(w){return{type:"FeatureCollection",features:Array.from(iv(w))}}function A_(w,S){const M={},D=S==="stroke"||S==="fill"?S:`${S}-color`;return w[0]==="#"&&(w=w.substring(1)),w.length===6||w.length===3?M[D]=`#${w}`:w.length===8&&(M[`${S}-opacity`]=Number.parseInt(w.substring(0,2),16)/255,M[D]=`#${w.substring(6,8)}${w.substring(4,6)}${w.substring(2,4)}`),M}function _m(w,S,M){const D={};return ps(w,S,B=>{D[M]=B}),D}function lg(w,S){return Uo(w,"color",M=>A_(ja(M),S))}function ug(w){return Uo(w,"Icon",(S,M)=>(Zh(S,"href",D=>{M.icon=D}),M))}function av(w){return Uo(w,"IconStyle",S=>Object.assign(lg(S,"icon"),_m(S,"scale","icon-scale"),_m(S,"heading","icon-heading"),Uo(S,"hotSpot",M=>{const D=Number.parseFloat(M.getAttribute("x")||""),B=Number.parseFloat(M.getAttribute("y")||""),U=M.getAttribute("xunits")||"",I=M.getAttribute("yunits")||"";return!Number.isNaN(D)&&!Number.isNaN(B)?{"icon-offset":[D,B],"icon-offset-units":[U,I]}:{}}),ug(S)))}function sv(w){return Uo(w,"LabelStyle",S=>Object.assign(lg(S,"label"),_m(S,"scale","label-scale")))}function ov(w){return Uo(w,"LineStyle",S=>Object.assign(lg(S,"stroke"),_m(S,"width","stroke-width")))}function lv(w){return Uo(w,"PolyStyle",(S,M)=>Object.assign(M,Uo(S,"color",D=>A_(ja(D),"fill")),Zh(S,"fill",D=>{if(D==="0")return{"fill-opacity":0}}),Zh(S,"outline",D=>{if(D==="0")return{"stroke-opacity":0}})))}function vm(w){return Object.assign({},lv(w),ov(w),sv(w),av(w))}const uv=/\s*/g,cv=/^\s*|\s*$/g,hv=/\s+/;function C_(w){return w.replace(uv,"").split(",").map(Number.parseFloat).filter(S=>!Number.isNaN(S)).slice(0,3)}function Qm(w){return w.replace(cv,"").split(hv).map(C_).filter(S=>S.length>=2)}function fv(w){let S=Fa(w,"coord");S.length===0&&(S=Q0(w,"coord","*"));const M=S.map(D=>ja(D).split(" ").map(Number.parseFloat));return M.length===0?null:{geometry:M.length>2?{type:"LineString",coordinates:M}:{type:"Point",coordinates:M[0]},times:Fa(w,"when").map(D=>ja(D))}}function M_(w){if(w.length===0)return w;const S=w[0],M=w[w.length-1];let D=!0;for(let B=0;B<Math.max(S.length,M.length);B++)if(S[B]!==M[B]){D=!1;break}return D?w:w.concat([w[0]])}function lm(w){return ja(Xn(w,"coordinates"))}function D_(w){let S=[],M=[];for(let D=0;D<w.childNodes.length;D++){const B=w.childNodes.item(D);if(sg(B))switch(B.tagName){case"MultiGeometry":case"MultiTrack":case"gx:MultiTrack":{const U=D_(B);S=S.concat(U.geometries),M=M.concat(U.coordTimes);break}case"Point":{const U=C_(lm(B));U.length>=2&&S.push({type:"Point",coordinates:U});break}case"LinearRing":case"LineString":{const U=Qm(lm(B));U.length>=2&&S.push({type:"LineString",coordinates:U});break}case"Polygon":{const U=[];for(const I of Fa(B,"LinearRing")){const c=M_(Qm(lm(I)));c.length>=4&&U.push(c)}U.length&&S.push({type:"Polygon",coordinates:U});break}case"Track":case"gx:Track":{const U=fv(B);if(!U)break;const{times:I,geometry:c}=U;S.push(c),I.length&&M.push(I);break}}}return{geometries:S,coordTimes:M}}const id=w=>Number(w),Km={string:w=>w,int:id,uint:id,short:id,ushort:id,float:id,double:id,bool:w=>!!w};function cg(w,S){return Uo(w,"ExtendedData",(M,D)=>{for(const B of Fa(M,"Data"))D[B.getAttribute("name")||""]=ja(Xn(B,"value"));for(const B of Fa(M,"SimpleData")){const U=B.getAttribute("name")||"",I=S[U]||Km.string;D[U]=I(ja(B))}return D})}function hg(w){const S=Xn(w,"description");for(const M of Array.from((S==null?void 0:S.childNodes)||[]))if(M.nodeType===4)return{description:{"@type":"html",value:ja(M)}};return{}}function fg(w){return Uo(w,"TimeSpan",S=>({timespan:{begin:ja(Xn(S,"begin")),end:ja(Xn(S,"end"))}}))}function dg(w){return Uo(w,"TimeStamp",S=>({timestamp:ja(Xn(S,"when"))}))}function pg(w,S){return Zh(w,"styleUrl",M=>(M=gm(M),S[M]?Object.assign({styleUrl:M},S[M]):{styleUrl:M}))}var jo;(function(w){w.ABSOLUTE="absolute",w.RELATIVE_TO_GROUND="relativeToGround",w.CLAMP_TO_GROUND="clampToGround",w.CLAMP_TO_SEAFLOOR="clampToSeaFloor",w.RELATIVE_TO_SEAFLOOR="relativeToSeaFloor"})(jo||(jo={}));function dv(w){switch(w==null?void 0:w.textContent){case jo.ABSOLUTE:return jo.ABSOLUTE;case jo.CLAMP_TO_GROUND:return jo.CLAMP_TO_GROUND;case jo.CLAMP_TO_SEAFLOOR:return jo.CLAMP_TO_SEAFLOOR;case jo.RELATIVE_TO_GROUND:return jo.RELATIVE_TO_GROUND;case jo.RELATIVE_TO_SEAFLOOR:return jo.RELATIVE_TO_SEAFLOOR}return null}function pv(w){return Xn(w,"gx:LatLonQuad")?{geometry:{type:"Polygon",coordinates:[M_(Qm(lm(w)))]}}:_v(w)}const mv=Math.PI/180;function gv(w,S,M){const D=[(w[0]+w[2])/2,(w[1]+w[3])/2];return[S[0].map(B=>{const U=B[1]-D[1],I=B[0]-D[0],c=Math.sqrt(U**2+I**2),J=Math.atan2(U,I)+M*mv;return[D[0]+Math.cos(J)*c,D[1]+Math.sin(J)*c]})]}function _v(w){const S=Xn(w,"LatLonBox");if(S){const M=ps(S,"north"),D=ps(S,"west"),B=ps(S,"east"),U=ps(S,"south"),I=ps(S,"rotation");if(typeof M=="number"&&typeof U=="number"&&typeof D=="number"&&typeof B=="number"){const c=[D,U,B,M];let J=[[[D,M],[B,M],[B,U],[D,U],[D,M]]];return typeof I=="number"&&(J=gv(c,J,I)),{bbox:c,geometry:{type:"Polygon",coordinates:J}}}}return null}function yv(w,S,M,D){var J;const B=pv(w),U=(B==null?void 0:B.geometry)||null;if(!U&&D.skipNullGeometry)return null;const I={type:"Feature",geometry:U,properties:Object.assign({"@geometry-type":"groundoverlay"},Hh(w,["name","address","visibility","open","phoneNumber","description"]),hg(w),pg(w,S),vm(w),ug(w),cg(w,M),fg(w),dg(w))};B!=null&&B.bbox&&(I.bbox=B.bbox),((J=I.properties)==null?void 0:J.visibility)!==void 0&&(I.properties.visibility=I.properties.visibility!=="0");const c=w.getAttribute("id");return c!==null&&c!==""&&(I.id=c),I}function vv(w){const S=Xn(w,"Region");return S?{coordinateBox:bv(S),lod:xv(w)}:null}function xv(w){const S=Xn(w,"Lod");return S?[ps(S,"minLodPixels")??-1,ps(S,"maxLodPixels")??-1,ps(S,"minFadeExtent")??null,ps(S,"maxFadeExtent")??null]:null}function bv(w){const S=Xn(w,"LatLonAltBox");if(S){const M=ps(S,"north"),D=ps(S,"west"),B=ps(S,"east"),U=ps(S,"south");if(dv(Xn(S,"altitudeMode")||Xn(S,"gx:altitudeMode"))&&console.debug("Encountered an unsupported feature of KML for togeojson: please contact developers for support of altitude mode."),typeof M=="number"&&typeof U=="number"&&typeof D=="number"&&typeof B=="number")return{bbox:[D,U,B,M],geometry:{type:"Polygon",coordinates:[[[D,M],[B,M],[B,U],[D,U],[D,M]]]}}}return null}function wv(w){const S=Xn(w,"Link");return S?Hh(S,["href","refreshMode","refreshInterval","viewRefreshMode","viewRefreshTime","viewBoundScale","viewFormat","httpQuery"]):{}}function Tv(w,S,M,D){var J,K,oe;const B=vv(w),U=((J=B==null?void 0:B.coordinateBox)==null?void 0:J.geometry)||null;if(!U&&D.skipNullGeometry)return null;const I={type:"Feature",geometry:U,properties:Object.assign({"@geometry-type":"networklink"},Hh(w,["name","address","visibility","open","phoneNumber","styleUrl","refreshVisibility","flyToView","description"]),hg(w),pg(w,S),vm(w),ug(w),cg(w,M),fg(w),dg(w),wv(w),B!=null&&B.lod?{lod:B.lod}:{})};(K=B==null?void 0:B.coordinateBox)!=null&&K.bbox&&(I.bbox=B.coordinateBox.bbox),((oe=I.properties)==null?void 0:oe.visibility)!==void 0&&(I.properties.visibility=I.properties.visibility!=="0");const c=w.getAttribute("id");return c!==null&&c!==""&&(I.id=c),I}function Ev(w){return w.length===0?null:w.length===1?w[0]:{type:"GeometryCollection",geometries:w}}function Sv(w,S,M,D){var K;const{coordTimes:B,geometries:U}=D_(w),I=Ev(U);if(!I&&D.skipNullGeometry)return null;const c={type:"Feature",geometry:I,properties:Object.assign(Hh(w,["name","address","visibility","open","phoneNumber","description"]),hg(w),pg(w,S),vm(w),cg(w,M),fg(w),dg(w),B.length?{coordinateProperties:{times:B.length===1?B[0]:B}}:{})};((K=c.properties)==null?void 0:K.visibility)!==void 0&&(c.properties.visibility=c.properties.visibility!=="0");const J=w.getAttribute("id");return J!==null&&J!==""&&(c.id=J),c}function Av(w){let S=w.getAttribute("id");const M=w.parentNode;return!S&&sg(M)&&M.localName==="CascadingStyle"&&(S=M.getAttribute("kml:id")||M.getAttribute("id")),gm(S||"")}function Cv(w){const S={};for(const M of Fa(w,"Style"))S[Av(M)]=vm(M);for(const M of Fa(w,"StyleMap")){const D=gm(M.getAttribute("id")||"");Zh(M,"styleUrl",B=>{B=gm(B),S[B]&&(S[D]=S[B])})}return S}function Mv(w){const S={};for(const M of Fa(w,"SimpleField"))S[M.getAttribute("name")||""]=Km[M.getAttribute("type")||""]||Km.string;return S}function*Dv(w,S={skipNullGeometry:!1}){const M=w,D=Cv(M),B=Mv(M);for(const U of Fa(M,"Placemark")){const I=Sv(U,D,B,S);I&&(yield I)}for(const U of Fa(M,"GroundOverlay")){const I=yv(U,D,B,S);I&&(yield I)}for(const U of Fa(M,"NetworkLink")){const I=Tv(U,D,B,S);I&&(yield I)}}function Iv(w,S={skipNullGeometry:!1}){return{type:"FeatureCollection",features:Array.from(Dv(w,S))}}var pi={},Ea={},Wg;function fd(){if(Wg)return Ea;Wg=1;function w(ft,pt,zt){if(zt===void 0&&(zt=Array.prototype),ft&&typeof zt.find=="function")return zt.find.call(ft,pt);for(var Rt=0;Rt<ft.length;Rt++)if(M(ft,Rt)){var Ge=ft[Rt];if(pt.call(void 0,Ge,Rt,ft))return Ge}}function S(ft,pt){return pt===void 0&&(pt=Object),pt&&typeof pt.getOwnPropertyDescriptors=="function"&&(ft=pt.create(null,pt.getOwnPropertyDescriptors(ft))),pt&&typeof pt.freeze=="function"?pt.freeze(ft):ft}function M(ft,pt){return Object.prototype.hasOwnProperty.call(ft,pt)}function D(ft,pt){if(ft===null||typeof ft!="object")throw new TypeError("target is not an object");for(var zt in pt)M(pt,zt)&&(ft[zt]=pt[zt]);return ft}var B=S({allowfullscreen:!0,async:!0,autofocus:!0,autoplay:!0,checked:!0,controls:!0,default:!0,defer:!0,disabled:!0,formnovalidate:!0,hidden:!0,ismap:!0,itemscope:!0,loop:!0,multiple:!0,muted:!0,nomodule:!0,novalidate:!0,open:!0,playsinline:!0,readonly:!0,required:!0,reversed:!0,selected:!0});function U(ft){return M(B,ft.toLowerCase())}var I=S({area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function c(ft){return M(I,ft.toLowerCase())}var J=S({script:!1,style:!1,textarea:!0,title:!0});function K(ft){var pt=ft.toLowerCase();return M(J,pt)&&!J[pt]}function oe(ft){var pt=ft.toLowerCase();return M(J,pt)&&J[pt]}function X(ft){return ft===se.HTML}function _e(ft){return X(ft)||ft===se.XML_XHTML_APPLICATION}var se=S({HTML:"text/html",XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),Me=Object.keys(se).map(function(ft){return se[ft]});function qe(ft){return Me.indexOf(ft)>-1}var at=S({HTML:"http://www.w3.org/1999/xhtml",SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});return Ea.assign=D,Ea.find=w,Ea.freeze=S,Ea.HTML_BOOLEAN_ATTRIBUTES=B,Ea.HTML_RAW_TEXT_ELEMENTS=J,Ea.HTML_VOID_ELEMENTS=I,Ea.hasDefaultHTMLNamespace=_e,Ea.hasOwn=M,Ea.isHTMLBooleanAttribute=U,Ea.isHTMLRawTextElement=K,Ea.isHTMLEscapableRawTextElement=oe,Ea.isHTMLMimeType=X,Ea.isHTMLVoidElement=c,Ea.isValidMimeType=qe,Ea.MIME_TYPE=se,Ea.NAMESPACE=at,Ea}var nd={},Qg;function xm(){if(Qg)return nd;Qg=1;var w=fd();function S(_e,se){_e.prototype=Object.create(Error.prototype,{constructor:{value:_e},name:{value:_e.name,enumerable:!0,writable:se}})}var M=w.freeze({Error:"Error",IndexSizeError:"IndexSizeError",DomstringSizeError:"DomstringSizeError",HierarchyRequestError:"HierarchyRequestError",WrongDocumentError:"WrongDocumentError",InvalidCharacterError:"InvalidCharacterError",NoDataAllowedError:"NoDataAllowedError",NoModificationAllowedError:"NoModificationAllowedError",NotFoundError:"NotFoundError",NotSupportedError:"NotSupportedError",InUseAttributeError:"InUseAttributeError",InvalidStateError:"InvalidStateError",SyntaxError:"SyntaxError",InvalidModificationError:"InvalidModificationError",NamespaceError:"NamespaceError",InvalidAccessError:"InvalidAccessError",ValidationError:"ValidationError",TypeMismatchError:"TypeMismatchError",SecurityError:"SecurityError",NetworkError:"NetworkError",AbortError:"AbortError",URLMismatchError:"URLMismatchError",QuotaExceededError:"QuotaExceededError",TimeoutError:"TimeoutError",InvalidNodeTypeError:"InvalidNodeTypeError",DataCloneError:"DataCloneError",EncodingError:"EncodingError",NotReadableError:"NotReadableError",UnknownError:"UnknownError",ConstraintError:"ConstraintError",DataError:"DataError",TransactionInactiveError:"TransactionInactiveError",ReadOnlyError:"ReadOnlyError",VersionError:"VersionError",OperationError:"OperationError",NotAllowedError:"NotAllowedError",OptOutError:"OptOutError"}),D=Object.keys(M);function B(_e){return typeof _e=="number"&&_e>=1&&_e<=25}function U(_e){return typeof _e=="string"&&_e.substring(_e.length-M.Error.length)===M.Error}function I(_e,se){B(_e)?(this.name=D[_e],this.message=se||""):(this.message=_e,this.name=U(se)?se:M.Error),Error.captureStackTrace&&Error.captureStackTrace(this,I)}S(I,!0),Object.defineProperties(I.prototype,{code:{enumerable:!0,get:function(){var _e=D.indexOf(this.name);return B(_e)?_e:0}}});for(var c={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25},J=Object.entries(c),K=0;K<J.length;K++){var oe=J[K][0];I[oe]=J[K][1]}function X(_e,se){this.message=_e,this.locator=se,Error.captureStackTrace&&Error.captureStackTrace(this,X)}return S(X),nd.DOMException=I,nd.DOMExceptionName=M,nd.ExceptionCode=c,nd.ParseError=X,nd}var Vn={},Wr={},Kg;function I_(){if(Kg)return Wr;Kg=1;function w(Oe){try{typeof Oe!="function"&&(Oe=RegExp);var He=new Oe("","u").exec("");return!!He&&He[0].length===2}catch{}return!1}var S=w();function M(Oe){if(Oe.source[0]!=="[")throw new Error(Oe+" can not be used with chars");return Oe.source.slice(1,Oe.source.lastIndexOf("]"))}function D(Oe,He){if(Oe.source[0]!=="[")throw new Error("/"+Oe.source+"/ can not be used with chars_without");if(!He||typeof He!="string")throw new Error(JSON.stringify(He)+" is not a valid search");if(Oe.source.indexOf(He)===-1)throw new Error('"'+He+'" is not is /'+Oe.source+"/");if(He==="-"&&Oe.source.indexOf(He)!==1)throw new Error('"'+He+'" is not at the first postion of /'+Oe.source+"/");return new RegExp(Oe.source.replace(He,""),S?"u":"")}function B(Oe){var He=this;return new RegExp(Array.prototype.slice.call(arguments).map(function(je){var _t=typeof je=="string";if(_t&&He===void 0&&je==="|")throw new Error("use regg instead of reg to wrap expressions with `|`!");return _t?je:je.source}).join(""),S?"mu":"m")}function U(Oe){if(arguments.length===0)throw new Error("no parameters provided");return B.apply(U,["(?:"].concat(Array.prototype.slice.call(arguments),[")"]))}var I="",c=/[-\x09\x0A\x0D\x20-\x2C\x2E-\uD7FF\uE000-\uFFFD]/;S&&(c=B("[",M(c),"\\u{10000}-\\u{10FFFF}","]"));var J=/[\x20\x09\x0D\x0A]/,K=M(J),oe=B(J,"+"),X=B(J,"*"),_e=/[:_a-zA-Z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/;S&&(_e=B("[",M(_e),"\\u{10000}-\\u{10FFFF}","]"));var se=M(_e),Me=B("[",se,M(/[-.0-9\xB7]/),M(/[\u0300-\u036F\u203F-\u2040]/),"]"),qe=B(_e,Me,"*"),at=B(Me,"+"),ft=B("&",qe,";"),pt=U(/&#[0-9]+;|&#x[0-9a-fA-F]+;/),zt=U(ft,"|",pt),Rt=B("%",qe,";"),Ge=U(B('"',U(/[^%&"]/,"|",Rt,"|",zt),"*",'"'),"|",B("'",U(/[^%&']/,"|",Rt,"|",zt),"*","'")),Pe=U('"',U(/[^<&"]/,"|",zt),"*",'"',"|","'",U(/[^<&']/,"|",zt),"*","'"),gt=D(_e,":"),bt=D(Me,":"),Yt=B(gt,bt,"*"),nr=B(Yt,U(":",Yt),"?"),lr=B("^",nr,"$"),dr=B("(",nr,")"),Kt=U(/"[^"]*"|'[^']*'/),xr=B(/^<\?/,"(",qe,")",U(oe,"(",c,"*?)"),"?",/\?>/),tt=/[\x20\x0D\x0Aa-zA-Z0-9-'()+,./:=?;!*#@$_%]/,Re=U('"',tt,'*"',"|","'",D(tt,"'"),"*'"),st="<!--",ot="-->",jt=B(st,U(D(c,"-"),"|",B("-",D(c,"-"))),"*",ot),ue="#PCDATA",Ye=U(B(/\(/,X,ue,U(X,/\|/,X,nr),"*",X,/\)\*/),"|",B(/\(/,X,ue,X,/\)/)),Mt=/[?*+]?/,yt=B(/\([^>]+\)/,Mt),vt=U("EMPTY","|","ANY","|",Ye,"|",yt),It="<!ELEMENT",Ot=B(It,oe,U(nr,"|",Rt),oe,U(vt,"|",Rt),X,">"),Xt=B("NOTATION",oe,/\(/,X,qe,U(X,/\|/,X,qe),"*",X,/\)/),mr=B(/\(/,X,at,U(X,/\|/,X,at),"*",X,/\)/),hi=U(Xt,"|",mr),Si=U(/CDATA|ID|IDREF|IDREFS|ENTITY|ENTITIES|NMTOKEN|NMTOKENS/,"|",hi),jr=U(/#REQUIRED|#IMPLIED/,"|",U(U("#FIXED",oe),"?",Pe)),rr=U(oe,qe,oe,Si,oe,jr),mi="<!ATTLIST",Dr=B(mi,oe,qe,rr,"*",X,">"),kr="about:legacy-compat",Ui=U('"'+kr+'"',"|","'"+kr+"'"),_r="SYSTEM",xi="PUBLIC",sn=U(U(_r,oe,Kt),"|",U(xi,oe,Re,oe,Kt)),gi=B("^",U(U(_r,oe,"(?<SystemLiteralOnly>",Kt,")"),"|",U(xi,oe,"(?<PubidLiteral>",Re,")",oe,"(?<SystemLiteral>",Kt,")"))),oi=U(oe,"NDATA",oe,qe),Ai=U(Ge,"|",U(sn,oi,"?")),Nr="<!ENTITY",Yi=B(Nr,oe,qe,oe,Ai,X,">"),_i=U(Ge,"|",sn),Vi=B(Nr,oe,"%",oe,qe,oe,_i,X,">"),ri=U(Yi,"|",Vi),ei=B(xi,oe,Re),ii=B("<!NOTATION",oe,qe,oe,U(sn,"|",ei),X,">"),yr=B(X,"=",X),Ar=/1[.]\d+/,Zr=B(oe,"version",yr,U("'",Ar,"'","|",'"',Ar,'"')),Ur=/[A-Za-z][-A-Za-z0-9._]*/,li=U(oe,"encoding",yr,U('"',Ur,'"',"|","'",Ur,"'")),Ne=U(oe,"standalone",yr,U("'",U("yes","|","no"),"'","|",'"',U("yes","|","no"),'"')),W=B(/^<\?xml/,Zr,li,"?",Ne,"?",X,/\?>/),Q="<!DOCTYPE",ae="<![CDATA[",ye="]]>",Ee=/<!\[CDATA\[/,re=/\]\]>/,Ze=B(c,"*?",re),Be=B(Ee,Ze);return Wr.chars=M,Wr.chars_without=D,Wr.detectUnicodeSupport=w,Wr.reg=B,Wr.regg=U,Wr.ABOUT_LEGACY_COMPAT=kr,Wr.ABOUT_LEGACY_COMPAT_SystemLiteral=Ui,Wr.AttlistDecl=Dr,Wr.CDATA_START=ae,Wr.CDATA_END=ye,Wr.CDSect=Be,Wr.Char=c,Wr.Comment=jt,Wr.COMMENT_START=st,Wr.COMMENT_END=ot,Wr.DOCTYPE_DECL_START=Q,Wr.elementdecl=Ot,Wr.EntityDecl=ri,Wr.EntityValue=Ge,Wr.ExternalID=sn,Wr.ExternalID_match=gi,Wr.Name=qe,Wr.NotationDecl=ii,Wr.Reference=zt,Wr.PEReference=Rt,Wr.PI=xr,Wr.PUBLIC=xi,Wr.PubidLiteral=Re,Wr.QName=nr,Wr.QName_exact=lr,Wr.QName_group=dr,Wr.S=oe,Wr.SChar_s=K,Wr.S_OPT=X,Wr.SYSTEM=_r,Wr.SystemLiteral=Kt,Wr.UNICODE_REPLACEMENT_CHARACTER=I,Wr.UNICODE_SUPPORT=S,Wr.XMLDecl=W,Wr}var Jg;function P_(){if(Jg)return Vn;Jg=1;var w=fd(),S=w.find,M=w.hasDefaultHTMLNamespace,D=w.hasOwn,B=w.isHTMLMimeType,U=w.isHTMLRawTextElement,I=w.isHTMLVoidElement,c=w.MIME_TYPE,J=w.NAMESPACE,K=Symbol(),oe=xm(),X=oe.DOMException,_e=oe.DOMExceptionName,se=I_();function Me(k){if(k!==K)throw new TypeError("Illegal constructor")}function qe(k){return k!==""}function at(k){return k?k.split(/[\t\n\f\r ]+/).filter(qe):[]}function ft(k,O){return D(k,O)||(k[O]=!0),k}function pt(k){if(!k)return[];var O=at(k);return Object.keys(O.reduce(ft,{}))}function zt(k){return function(O){return k&&k.indexOf(O)!==-1}}function Rt(k){if(!se.QName_exact.test(k))throw new X(X.INVALID_CHARACTER_ERR,'invalid character in qualified name "'+k+'"')}function Ge(k,O){Rt(O),k=k||null;var me=null,de=O;if(O.indexOf(":")>=0){var ze=O.split(":");me=ze[0],de=ze[1]}if(me!==null&&k===null)throw new X(X.NAMESPACE_ERR,"prefix is non-null and namespace is null");if(me==="xml"&&k!==w.NAMESPACE.XML)throw new X(X.NAMESPACE_ERR,'prefix is "xml" and namespace is not the XML namespace');if((me==="xmlns"||O==="xmlns")&&k!==w.NAMESPACE.XMLNS)throw new X(X.NAMESPACE_ERR,'either qualifiedName or prefix is "xmlns" and namespace is not the XMLNS namespace');if(k===w.NAMESPACE.XMLNS&&me!=="xmlns"&&O!=="xmlns")throw new X(X.NAMESPACE_ERR,'namespace is the XMLNS namespace and neither qualifiedName nor prefix is "xmlns"');return[k,me,de]}function Pe(k,O){for(var me in k)D(k,me)&&(O[me]=k[me])}function gt(k,O){var me=k.prototype;if(!(me instanceof O)){let ze=function(){};var de=ze;ze.prototype=O.prototype,ze=new ze,Pe(me,ze),k.prototype=me=ze}me.constructor!=k&&(typeof k!="function"&&console.error("unknown Class:"+k),me.constructor=k)}var bt={},Yt=bt.ELEMENT_NODE=1,nr=bt.ATTRIBUTE_NODE=2,lr=bt.TEXT_NODE=3,dr=bt.CDATA_SECTION_NODE=4,Kt=bt.ENTITY_REFERENCE_NODE=5,xr=bt.ENTITY_NODE=6,tt=bt.PROCESSING_INSTRUCTION_NODE=7,Re=bt.COMMENT_NODE=8,st=bt.DOCUMENT_NODE=9,ot=bt.DOCUMENT_TYPE_NODE=10,jt=bt.DOCUMENT_FRAGMENT_NODE=11,ue=bt.NOTATION_NODE=12,Ye=w.freeze({DOCUMENT_POSITION_DISCONNECTED:1,DOCUMENT_POSITION_PRECEDING:2,DOCUMENT_POSITION_FOLLOWING:4,DOCUMENT_POSITION_CONTAINS:8,DOCUMENT_POSITION_CONTAINED_BY:16,DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC:32});function Mt(k,O){if(O.length<k.length)return Mt(O,k);var me=null;for(var de in k){if(k[de]!==O[de])return me;me=k[de]}return me}function yt(k){return k.guid||(k.guid=Math.random()),k.guid}function vt(){}vt.prototype={length:0,item:function(k){return k>=0&&k<this.length?this[k]:null},toString:function(k){for(var O=[],me=0;me<this.length;me++)_t(this[me],O,k);return O.join("")},filter:function(k){return Array.prototype.filter.call(this,k)},indexOf:function(k){return Array.prototype.indexOf.call(this,k)}},vt.prototype[Symbol.iterator]=function(){var k=this,O=0;return{next:function(){return O<k.length?{value:k[O++],done:!1}:{done:!0}},return:function(){return{done:!0}}}};function It(k,O){this._node=k,this._refresh=O,Ot(this)}function Ot(k){var O=k._node._inc||k._node.ownerDocument._inc;if(k._inc!==O){var me=k._refresh(k._node);if(tr(k,"length",me.length),!k.$$length||me.length<k.$$length)for(var de=me.length;de in k;de++)D(k,de)&&delete k[de];Pe(me,k),k._inc=O}}It.prototype.item=function(k){return Ot(this),this[k]||null},gt(It,vt);function Xt(){}function mr(k,O){for(var me=0;me<k.length;){if(k[me]===O)return me;me++}}function hi(k,O,me,de){if(de?O[mr(O,de)]=me:(O[O.length]=me,O.length++),k){me.ownerElement=k;var ze=k.ownerDocument;ze&&(de&&_r(ze,k,de),Ui(ze,k,me))}}function Si(k,O,me){var de=mr(O,me);if(de>=0){for(var ze=O.length-1;de<=ze;)O[de]=O[++de];if(O.length=ze,k){var We=k.ownerDocument;We&&_r(We,k,me),me.ownerElement=null}}}Xt.prototype={length:0,item:vt.prototype.item,getNamedItem:function(k){this._ownerElement&&this._ownerElement._isInHTMLDocumentAndNamespace()&&(k=k.toLowerCase());for(var O=0;O<this.length;){var me=this[O];if(me.nodeName===k)return me;O++}return null},setNamedItem:function(k){var O=k.ownerElement;if(O&&O!==this._ownerElement)throw new X(X.INUSE_ATTRIBUTE_ERR);var me=this.getNamedItemNS(k.namespaceURI,k.localName);return me===k?k:(hi(this._ownerElement,this,k,me),me)},setNamedItemNS:function(k){return this.setNamedItem(k)},removeNamedItem:function(k){var O=this.getNamedItem(k);if(!O)throw new X(X.NOT_FOUND_ERR,k);return Si(this._ownerElement,this,O),O},removeNamedItemNS:function(k,O){var me=this.getNamedItemNS(k,O);if(!me)throw new X(X.NOT_FOUND_ERR,k?k+" : "+O:O);return Si(this._ownerElement,this,me),me},getNamedItemNS:function(k,O){k||(k=null);for(var me=0;me<this.length;){var de=this[me];if(de.localName===O&&de.namespaceURI===k)return de;me++}return null}},Xt.prototype[Symbol.iterator]=function(){var k=this,O=0;return{next:function(){return O<k.length?{value:k[O++],done:!1}:{done:!0}},return:function(){return{done:!0}}}};function jr(){}jr.prototype={hasFeature:function(k,O){return!0},createDocument:function(k,O,me){var de=c.XML_APPLICATION;k===J.HTML?de=c.XML_XHTML_APPLICATION:k===J.SVG&&(de=c.XML_SVG_IMAGE);var ze=new kr(K,{contentType:de});if(ze.implementation=this,ze.childNodes=new vt,ze.doctype=me||null,me&&ze.appendChild(me),O){var We=ze.createElementNS(k,O);ze.appendChild(We)}return ze},createDocumentType:function(k,O,me,de){Rt(k);var ze=new Q(K);return ze.name=k,ze.nodeName=k,ze.publicId=O||"",ze.systemId=me||"",ze.internalSubset=de||"",ze.childNodes=new vt,ze},createHTMLDocument:function(k){var O=new kr(K,{contentType:c.HTML});if(O.implementation=this,O.childNodes=new vt,k!==!1){O.doctype=this.createDocumentType("html"),O.doctype.ownerDocument=O,O.appendChild(O.doctype);var me=O.createElement("html");O.appendChild(me);var de=O.createElement("head");if(me.appendChild(de),typeof k=="string"){var ze=O.createElement("title");ze.appendChild(O.createTextNode(k)),de.appendChild(ze)}me.appendChild(O.createElement("body"))}return O}};function rr(k){Me(k)}rr.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,parentNode:null,get parentElement(){return this.parentNode&&this.parentNode.nodeType===this.ELEMENT_NODE?this.parentNode:null},childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,baseURI:"about:blank",get isConnected(){var k=this.getRootNode();return k&&k.nodeType===k.DOCUMENT_NODE},contains:function(k){if(!k)return!1;var O=k;do{if(this===O)return!0;O=k.parentNode}while(O);return!1},getRootNode:function(k){var O=this;do{if(!O.parentNode)return O;O=O.parentNode}while(O)},isEqualNode:function(k){if(!k||this.nodeType!==k.nodeType)return!1;switch(this.nodeType){case this.DOCUMENT_TYPE_NODE:if(this.name!==k.name||this.publicId!==k.publicId||this.systemId!==k.systemId)return!1;break;case this.ELEMENT_NODE:if(this.namespaceURI!==k.namespaceURI||this.prefix!==k.prefix||this.localName!==k.localName||this.attributes.length!==k.attributes.length)return!1;for(var O=0;O<this.attributes.length;O++){var me=this.attributes.item(O);if(!me.isEqualNode(k.getAttributeNodeNS(me.namespaceURI,me.localName)))return!1}break;case this.ATTRIBUTE_NODE:if(this.namespaceURI!==k.namespaceURI||this.localName!==k.localName||this.value!==k.value)return!1;break;case this.PROCESSING_INSTRUCTION_NODE:if(this.target!==k.target||this.data!==k.data)return!1;break;case this.TEXT_NODE:case this.COMMENT_NODE:if(this.data!==k.data)return!1;break}if(this.childNodes.length!==k.childNodes.length)return!1;for(var O=0;O<this.childNodes.length;O++)if(!this.childNodes[O].isEqualNode(k.childNodes[O]))return!1;return!0},isSameNode:function(k){return this===k},insertBefore:function(k,O){return yr(this,k,O)},replaceChild:function(k,O){yr(this,k,O,ii),O&&this.removeChild(O)},removeChild:function(k){return sn(this,k)},appendChild:function(k){return this.insertBefore(k,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(k){return Gt(this.ownerDocument||this,this,k)},normalize:function(){for(var k=this.firstChild;k;){var O=k.nextSibling;O&&O.nodeType==lr&&k.nodeType==lr?(this.removeChild(O),k.appendData(O.data)):(k.normalize(),k=O)}},isSupported:function(k,O){return this.ownerDocument.implementation.hasFeature(k,O)},lookupPrefix:function(k){for(var O=this;O;){var me=O._nsMap;if(me){for(var de in me)if(D(me,de)&&me[de]===k)return de}O=O.nodeType==nr?O.ownerDocument:O.parentNode}return null},lookupNamespaceURI:function(k){for(var O=this;O;){var me=O._nsMap;if(me&&D(me,k))return me[k];O=O.nodeType==nr?O.ownerDocument:O.parentNode}return null},isDefaultNamespace:function(k){var O=this.lookupPrefix(k);return O==null},compareDocumentPosition:function(k){if(this===k)return 0;var O=k,me=this,de=null,ze=null;if(O instanceof Zr&&(de=O,O=de.ownerElement),me instanceof Zr&&(ze=me,me=ze.ownerElement,de&&O&&me===O))for(var We=0,Le;Le=me.attributes[We];We++){if(Le===de)return Ye.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC+Ye.DOCUMENT_POSITION_PRECEDING;if(Le===ze)return Ye.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC+Ye.DOCUMENT_POSITION_FOLLOWING}if(!O||!me||me.ownerDocument!==O.ownerDocument)return Ye.DOCUMENT_POSITION_DISCONNECTED+Ye.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC+(yt(me.ownerDocument)>yt(O.ownerDocument)?Ye.DOCUMENT_POSITION_FOLLOWING:Ye.DOCUMENT_POSITION_PRECEDING);if(ze&&O===me)return Ye.DOCUMENT_POSITION_CONTAINS+Ye.DOCUMENT_POSITION_PRECEDING;if(de&&O===me)return Ye.DOCUMENT_POSITION_CONTAINED_BY+Ye.DOCUMENT_POSITION_FOLLOWING;for(var wt=[],Nt=O.parentNode;Nt;){if(!ze&&Nt===me)return Ye.DOCUMENT_POSITION_CONTAINED_BY+Ye.DOCUMENT_POSITION_FOLLOWING;wt.push(Nt),Nt=Nt.parentNode}wt.reverse();for(var Jt=[],ar=me.parentNode;ar;){if(!de&&ar===O)return Ye.DOCUMENT_POSITION_CONTAINS+Ye.DOCUMENT_POSITION_PRECEDING;Jt.push(ar),ar=ar.parentNode}Jt.reverse();var Hr=Mt(wt,Jt);for(var Qt in Hr.childNodes){var Pi=Hr.childNodes[Qt];if(Pi===me)return Ye.DOCUMENT_POSITION_FOLLOWING;if(Pi===O)return Ye.DOCUMENT_POSITION_PRECEDING;if(Jt.indexOf(Pi)>=0)return Ye.DOCUMENT_POSITION_FOLLOWING;if(wt.indexOf(Pi)>=0)return Ye.DOCUMENT_POSITION_PRECEDING}return 0}};function mi(k){return k=="<"&&"&lt;"||k==">"&&"&gt;"||k=="&"&&"&amp;"||k=='"'&&"&quot;"||"&#"+k.charCodeAt()+";"}Pe(bt,rr),Pe(bt,rr.prototype),Pe(Ye,rr),Pe(Ye,rr.prototype);function Dr(k,O){if(O(k))return!0;if(k=k.firstChild)do if(Dr(k,O))return!0;while(k=k.nextSibling)}function kr(k,O){Me(k);var me=O||{};this.ownerDocument=this,this.contentType=me.contentType||c.XML_APPLICATION,this.type=B(this.contentType)?"html":"xml"}function Ui(k,O,me){k&&k._inc++;var de=me.namespaceURI;de===J.XMLNS&&(O._nsMap[me.prefix?me.localName:""]=me.value)}function _r(k,O,me,de){k&&k._inc++;var ze=me.namespaceURI;ze===J.XMLNS&&delete O._nsMap[me.prefix?me.localName:""]}function xi(k,O,me){if(k&&k._inc){k._inc++;var de=O.childNodes;if(me&&!me.nextSibling)de[de.length++]=me;else{for(var ze=O.firstChild,We=0;ze;)de[We++]=ze,ze=ze.nextSibling;de.length=We,delete de[de.length]}}}function sn(k,O){if(k!==O.parentNode)throw new X(X.NOT_FOUND_ERR,"child's parent is not parent");var me=O.previousSibling,de=O.nextSibling;return me?me.nextSibling=de:k.firstChild=de,de?de.previousSibling=me:k.lastChild=me,xi(k.ownerDocument,k),O.parentNode=null,O.previousSibling=null,O.nextSibling=null,O}function gi(k){return k&&(k.nodeType===rr.DOCUMENT_NODE||k.nodeType===rr.DOCUMENT_FRAGMENT_NODE||k.nodeType===rr.ELEMENT_NODE)}function oi(k){return k&&(k.nodeType===rr.CDATA_SECTION_NODE||k.nodeType===rr.COMMENT_NODE||k.nodeType===rr.DOCUMENT_FRAGMENT_NODE||k.nodeType===rr.DOCUMENT_TYPE_NODE||k.nodeType===rr.ELEMENT_NODE||k.nodeType===rr.PROCESSING_INSTRUCTION_NODE||k.nodeType===rr.TEXT_NODE)}function Ai(k){return k&&k.nodeType===rr.DOCUMENT_TYPE_NODE}function Nr(k){return k&&k.nodeType===rr.ELEMENT_NODE}function Yi(k){return k&&k.nodeType===rr.TEXT_NODE}function _i(k,O){var me=k.childNodes||[];if(S(me,Nr)||Ai(O))return!1;var de=S(me,Ai);return!(O&&de&&me.indexOf(de)>me.indexOf(O))}function Vi(k,O){var me=k.childNodes||[];function de(We){return Nr(We)&&We!==O}if(S(me,de))return!1;var ze=S(me,Ai);return!(O&&ze&&me.indexOf(ze)>me.indexOf(O))}function ri(k,O,me){if(!gi(k))throw new X(X.HIERARCHY_REQUEST_ERR,"Unexpected parent node type "+k.nodeType);if(me&&me.parentNode!==k)throw new X(X.NOT_FOUND_ERR,"child not in parent");if(!oi(O)||Ai(O)&&k.nodeType!==rr.DOCUMENT_NODE)throw new X(X.HIERARCHY_REQUEST_ERR,"Unexpected node type "+O.nodeType+" for parent node type "+k.nodeType)}function ei(k,O,me){var de=k.childNodes||[],ze=O.childNodes||[];if(O.nodeType===rr.DOCUMENT_FRAGMENT_NODE){var We=ze.filter(Nr);if(We.length>1||S(ze,Yi))throw new X(X.HIERARCHY_REQUEST_ERR,"More than one element or text in fragment");if(We.length===1&&!_i(k,me))throw new X(X.HIERARCHY_REQUEST_ERR,"Element in fragment can not be inserted before doctype")}if(Nr(O)&&!_i(k,me))throw new X(X.HIERARCHY_REQUEST_ERR,"Only one element can be added and only after doctype");if(Ai(O)){if(S(de,Ai))throw new X(X.HIERARCHY_REQUEST_ERR,"Only one doctype is allowed");var Le=S(de,Nr);if(me&&de.indexOf(Le)<de.indexOf(me))throw new X(X.HIERARCHY_REQUEST_ERR,"Doctype can only be inserted before an element");if(!me&&Le)throw new X(X.HIERARCHY_REQUEST_ERR,"Doctype can not be appended since element is present")}}function ii(k,O,me){var de=k.childNodes||[],ze=O.childNodes||[];if(O.nodeType===rr.DOCUMENT_FRAGMENT_NODE){var We=ze.filter(Nr);if(We.length>1||S(ze,Yi))throw new X(X.HIERARCHY_REQUEST_ERR,"More than one element or text in fragment");if(We.length===1&&!Vi(k,me))throw new X(X.HIERARCHY_REQUEST_ERR,"Element in fragment can not be inserted before doctype")}if(Nr(O)&&!Vi(k,me))throw new X(X.HIERARCHY_REQUEST_ERR,"Only one element can be added and only after doctype");if(Ai(O)){let Nt=function(Jt){return Ai(Jt)&&Jt!==me};var wt=Nt;if(S(de,Nt))throw new X(X.HIERARCHY_REQUEST_ERR,"Only one doctype is allowed");var Le=S(de,Nr);if(me&&de.indexOf(Le)<de.indexOf(me))throw new X(X.HIERARCHY_REQUEST_ERR,"Doctype can only be inserted before an element")}}function yr(k,O,me,de){ri(k,O,me),k.nodeType===rr.DOCUMENT_NODE&&(de||ei)(k,O,me);var ze=O.parentNode;if(ze&&ze.removeChild(O),O.nodeType===jt){var We=O.firstChild;if(We==null)return O;var Le=O.lastChild}else We=Le=O;var wt=me?me.previousSibling:k.lastChild;We.previousSibling=wt,Le.nextSibling=me,wt?wt.nextSibling=We:k.firstChild=We,me==null?k.lastChild=Le:me.previousSibling=Le;do We.parentNode=k;while(We!==Le&&(We=We.nextSibling));return xi(k.ownerDocument||k,k,O),O.nodeType==jt&&(O.firstChild=O.lastChild=null),O}kr.prototype={implementation:null,nodeName:"#document",nodeType:st,doctype:null,documentElement:null,_inc:1,insertBefore:function(k,O){if(k.nodeType===jt){for(var me=k.firstChild;me;){var de=me.nextSibling;this.insertBefore(me,O),me=de}return k}return yr(this,k,O),k.ownerDocument=this,this.documentElement===null&&k.nodeType===Yt&&(this.documentElement=k),k},removeChild:function(k){var O=sn(this,k);return O===this.documentElement&&(this.documentElement=null),O},replaceChild:function(k,O){yr(this,k,O,ii),k.ownerDocument=this,O&&this.removeChild(O),Nr(k)&&(this.documentElement=k)},importNode:function(k,O){return Ut(this,k,O)},getElementById:function(k){var O=null;return Dr(this.documentElement,function(me){if(me.nodeType==Yt&&me.getAttribute("id")==k)return O=me,!0}),O},createElement:function(k){var O=new Ar(K);O.ownerDocument=this,this.type==="html"&&(k=k.toLowerCase()),M(this.contentType)&&(O.namespaceURI=J.HTML),O.nodeName=k,O.tagName=k,O.localName=k,O.childNodes=new vt;var me=O.attributes=new Xt;return me._ownerElement=O,O},createDocumentFragment:function(){var k=new re(K);return k.ownerDocument=this,k.childNodes=new vt,k},createTextNode:function(k){var O=new li(K);return O.ownerDocument=this,O.childNodes=new vt,O.appendData(k),O},createComment:function(k){var O=new Ne(K);return O.ownerDocument=this,O.childNodes=new vt,O.appendData(k),O},createCDATASection:function(k){var O=new W(K);return O.ownerDocument=this,O.childNodes=new vt,O.appendData(k),O},createProcessingInstruction:function(k,O){var me=new Ze(K);return me.ownerDocument=this,me.childNodes=new vt,me.nodeName=me.target=k,me.nodeValue=me.data=O,me},createAttribute:function(k){if(!se.QName_exact.test(k))throw new X(X.INVALID_CHARACTER_ERR,'invalid character in name "'+k+'"');return this.type==="html"&&(k=k.toLowerCase()),this._createAttribute(k)},_createAttribute:function(k){var O=new Zr(K);return O.ownerDocument=this,O.childNodes=new vt,O.name=k,O.nodeName=k,O.localName=k,O.specified=!0,O},createEntityReference:function(k){if(!se.Name.test(k))throw new X(X.INVALID_CHARACTER_ERR,'not a valid xml name "'+k+'"');if(this.type==="html")throw new X("document is an html document",_e.NotSupportedError);var O=new Ee(K);return O.ownerDocument=this,O.childNodes=new vt,O.nodeName=k,O},createElementNS:function(k,O){var me=Ge(k,O),de=new Ar(K),ze=de.attributes=new Xt;return de.childNodes=new vt,de.ownerDocument=this,de.nodeName=O,de.tagName=O,de.namespaceURI=me[0],de.prefix=me[1],de.localName=me[2],ze._ownerElement=de,de},createAttributeNS:function(k,O){var me=Ge(k,O),de=new Zr(K);return de.ownerDocument=this,de.childNodes=new vt,de.nodeName=O,de.name=O,de.specified=!0,de.namespaceURI=me[0],de.prefix=me[1],de.localName=me[2],de}},gt(kr,rr);function Ar(k){Me(k),this._nsMap=Object.create(null)}Ar.prototype={nodeType:Yt,attributes:null,getQualifiedName:function(){return this.prefix?this.prefix+":"+this.localName:this.localName},_isInHTMLDocumentAndNamespace:function(){return this.ownerDocument.type==="html"&&this.namespaceURI===J.HTML},hasAttributes:function(){return!!(this.attributes&&this.attributes.length)},hasAttribute:function(k){return!!this.getAttributeNode(k)},getAttribute:function(k){var O=this.getAttributeNode(k);return O?O.value:null},getAttributeNode:function(k){return this._isInHTMLDocumentAndNamespace()&&(k=k.toLowerCase()),this.attributes.getNamedItem(k)},setAttribute:function(k,O){this._isInHTMLDocumentAndNamespace()&&(k=k.toLowerCase());var me=this.getAttributeNode(k);me?me.value=me.nodeValue=""+O:(me=this.ownerDocument._createAttribute(k),me.value=me.nodeValue=""+O,this.setAttributeNode(me))},removeAttribute:function(k){var O=this.getAttributeNode(k);O&&this.removeAttributeNode(O)},setAttributeNode:function(k){return this.attributes.setNamedItem(k)},setAttributeNodeNS:function(k){return this.attributes.setNamedItemNS(k)},removeAttributeNode:function(k){return this.attributes.removeNamedItem(k.nodeName)},removeAttributeNS:function(k,O){var me=this.getAttributeNodeNS(k,O);me&&this.removeAttributeNode(me)},hasAttributeNS:function(k,O){return this.getAttributeNodeNS(k,O)!=null},getAttributeNS:function(k,O){var me=this.getAttributeNodeNS(k,O);return me?me.value:null},setAttributeNS:function(k,O,me){var de=Ge(k,O),ze=de[2],We=this.getAttributeNodeNS(k,ze);We?We.value=We.nodeValue=""+me:(We=this.ownerDocument.createAttributeNS(k,O),We.value=We.nodeValue=""+me,this.setAttributeNode(We))},getAttributeNodeNS:function(k,O){return this.attributes.getNamedItemNS(k,O)},getElementsByClassName:function(k){var O=pt(k);return new It(this,function(me){var de=[];return O.length>0&&Dr(me,function(ze){if(ze!==me&&ze.nodeType===Yt){var We=ze.getAttribute("class");if(We){var Le=k===We;if(!Le){var wt=pt(We);Le=O.every(zt(wt))}Le&&de.push(ze)}}}),de})},getElementsByTagName:function(k){var O=(this.nodeType===st?this:this.ownerDocument).type==="html",me=k.toLowerCase();return new It(this,function(de){var ze=[];return Dr(de,function(We){if(!(We===de||We.nodeType!==Yt))if(k==="*")ze.push(We);else{var Le=We.getQualifiedName(),wt=O&&We.namespaceURI===J.HTML?me:k;Le===wt&&ze.push(We)}}),ze})},getElementsByTagNameNS:function(k,O){return new It(this,function(me){var de=[];return Dr(me,function(ze){ze!==me&&ze.nodeType===Yt&&(k==="*"||ze.namespaceURI===k)&&(O==="*"||ze.localName==O)&&de.push(ze)}),de})}},kr.prototype.getElementsByClassName=Ar.prototype.getElementsByClassName,kr.prototype.getElementsByTagName=Ar.prototype.getElementsByTagName,kr.prototype.getElementsByTagNameNS=Ar.prototype.getElementsByTagNameNS,gt(Ar,rr);function Zr(k){Me(k),this.namespaceURI=null,this.prefix=null,this.ownerElement=null}Zr.prototype.nodeType=nr,gt(Zr,rr);function Ur(k){Me(k)}Ur.prototype={data:"",substringData:function(k,O){return this.data.substring(k,k+O)},appendData:function(k){k=this.data+k,this.nodeValue=this.data=k,this.length=k.length},insertData:function(k,O){this.replaceData(k,0,O)},deleteData:function(k,O){this.replaceData(k,O,"")},replaceData:function(k,O,me){var de=this.data.substring(0,k),ze=this.data.substring(k+O);me=de+me+ze,this.nodeValue=this.data=me,this.length=me.length}},gt(Ur,rr);function li(k){Me(k)}li.prototype={nodeName:"#text",nodeType:lr,splitText:function(k){var O=this.data,me=O.substring(k);O=O.substring(0,k),this.data=this.nodeValue=O,this.length=O.length;var de=this.ownerDocument.createTextNode(me);return this.parentNode&&this.parentNode.insertBefore(de,this.nextSibling),de}},gt(li,Ur);function Ne(k){Me(k)}Ne.prototype={nodeName:"#comment",nodeType:Re},gt(Ne,Ur);function W(k){Me(k)}W.prototype={nodeName:"#cdata-section",nodeType:dr},gt(W,li);function Q(k){Me(k)}Q.prototype.nodeType=ot,gt(Q,rr);function ae(k){Me(k)}ae.prototype.nodeType=ue,gt(ae,rr);function ye(k){Me(k)}ye.prototype.nodeType=xr,gt(ye,rr);function Ee(k){Me(k)}Ee.prototype.nodeType=Kt,gt(Ee,rr);function re(k){Me(k)}re.prototype.nodeName="#document-fragment",re.prototype.nodeType=jt,gt(re,rr);function Ze(k){Me(k)}Ze.prototype.nodeType=tt,gt(Ze,Ur);function Be(){}Be.prototype.serializeToString=function(k,O){return Oe.call(k,O)},rr.prototype.toString=Oe;function Oe(k){var O=[],me=this.nodeType===st&&this.documentElement||this,de=me.prefix,ze=me.namespaceURI;if(ze&&de==null){var de=me.lookupPrefix(ze);if(de==null)var We=[{namespace:ze,prefix:null}]}return _t(this,O,k,We),O.join("")}function He(k,O,me){var de=k.prefix||"",ze=k.namespaceURI;if(!ze||de==="xml"&&ze===J.XML||ze===J.XMLNS)return!1;for(var We=me.length;We--;){var Le=me[We];if(Le.prefix===de)return Le.namespace!==ze}return!0}function je(k,O,me){k.push(" ",O,'="',me.replace(/[<>&"\t\n\r]/g,mi),'"')}function _t(k,O,me,de){de||(de=[]);var ze=k.nodeType===st?k:k.ownerDocument,We=ze.type==="html";if(me)if(k=me(k),k){if(typeof k=="string"){O.push(k);return}}else return;switch(k.nodeType){case Yt:var Le=k.attributes,wt=Le.length,Sr=k.firstChild,Nt=k.tagName,Jt=Nt;if(!We&&!k.prefix&&k.namespaceURI){for(var ar,Hr=0;Hr<Le.length;Hr++)if(Le.item(Hr).name==="xmlns"){ar=Le.item(Hr).value;break}if(!ar)for(var Qt=de.length-1;Qt>=0;Qt--){var Pi=de[Qt];if(Pi.prefix===""&&Pi.namespace===k.namespaceURI){ar=Pi.namespace;break}}if(ar!==k.namespaceURI)for(var Qt=de.length-1;Qt>=0;Qt--){var Pi=de[Qt];if(Pi.namespace===k.namespaceURI){Pi.prefix&&(Jt=Pi.prefix+":"+Nt);break}}}O.push("<",Jt);for(var _n=0;_n<wt;_n++){var ui=Le.item(_n);ui.prefix=="xmlns"?de.push({prefix:ui.localName,namespace:ui.value}):ui.nodeName=="xmlns"&&de.push({prefix:"",namespace:ui.value})}for(var _n=0;_n<wt;_n++){var ui=Le.item(_n);if(He(ui,We,de)){var ti=ui.prefix||"",bi=ui.namespaceURI;je(O,ti?"xmlns:"+ti:"xmlns",bi),de.push({prefix:ti,namespace:bi})}_t(ui,O,me,de)}if(Nt===Jt&&He(k,We,de)){var ti=k.prefix||"",bi=k.namespaceURI;je(O,ti?"xmlns:"+ti:"xmlns",bi),de.push({prefix:ti,namespace:bi})}var Ln=!Sr;if(Ln&&(We||k.namespaceURI===J.HTML)&&(Ln=I(Nt)),Ln)O.push("/>");else{if(O.push(">"),We&&U(Nt))for(;Sr;)Sr.data?O.push(Sr.data):_t(Sr,O,me,de.slice()),Sr=Sr.nextSibling;else for(;Sr;)_t(Sr,O,me,de.slice()),Sr=Sr.nextSibling;O.push("</",Jt,">")}return;case st:case jt:for(var Sr=k.firstChild;Sr;)_t(Sr,O,me,de.slice()),Sr=Sr.nextSibling;return;case nr:return je(O,k.name,k.value);case lr:return O.push(k.data.replace(/[<&>]/g,mi));case dr:return O.push(se.CDATA_START,k.data,se.CDATA_END);case Re:return O.push(se.COMMENT_START,k.data,se.COMMENT_END);case ot:var Cn=k.publicId,Br=k.systemId;O.push(se.DOCTYPE_DECL_START," ",k.name),Cn?(O.push(" ",se.PUBLIC," ",Cn),Br&&Br!=="."&&O.push(" ",Br)):Br&&Br!=="."&&O.push(" ",se.SYSTEM," ",Br),k.internalSubset&&O.push(" [",k.internalSubset,"]"),O.push(">");return;case tt:return O.push("<?",k.target," ",k.data,"?>");case Kt:return O.push("&",k.nodeName,";");default:O.push("??",k.nodeName)}}function Ut(k,O,me){var de;switch(O.nodeType){case Yt:de=O.cloneNode(!1),de.ownerDocument=k;case jt:break;case nr:me=!0;break}if(de||(de=O.cloneNode(!1)),de.ownerDocument=k,de.parentNode=null,me)for(var ze=O.firstChild;ze;)de.appendChild(Ut(k,ze,me)),ze=ze.nextSibling;return de}function Gt(k,O,me){var de=new O.constructor(K);for(var ze in O)if(D(O,ze)){var We=O[ze];typeof We!="object"&&We!=de[ze]&&(de[ze]=We)}switch(O.childNodes&&(de.childNodes=new vt),de.ownerDocument=k,de.nodeType){case Yt:var Le=O.attributes,wt=de.attributes=new Xt,Nt=Le.length;wt._ownerElement=de;for(var Jt=0;Jt<Nt;Jt++)de.setAttributeNode(Gt(k,Le.item(Jt),!0));break;case nr:me=!0}if(me)for(var ar=O.firstChild;ar;)de.appendChild(Gt(k,ar,me)),ar=ar.nextSibling;return de}function tr(k,O,me){k[O]=me}try{if(Object.defineProperty){let k=function(O){switch(O.nodeType){case Yt:case jt:var me=[];for(O=O.firstChild;O;)O.nodeType!==7&&O.nodeType!==8&&me.push(k(O)),O=O.nextSibling;return me.join("");default:return O.nodeValue}};var ir=k;Object.defineProperty(It.prototype,"length",{get:function(){return Ot(this),this.$$length}}),Object.defineProperty(rr.prototype,"textContent",{get:function(){return k(this)},set:function(O){switch(this.nodeType){case Yt:case jt:for(;this.firstChild;)this.removeChild(this.firstChild);(O||String(O))&&this.appendChild(this.ownerDocument.createTextNode(O));break;default:this.data=O,this.value=O,this.nodeValue=O}}}),tr=function(O,me,de){O["$$"+me]=de}}}catch{}return Vn._updateLiveList=Ot,Vn.Attr=Zr,Vn.CDATASection=W,Vn.CharacterData=Ur,Vn.Comment=Ne,Vn.Document=kr,Vn.DocumentFragment=re,Vn.DocumentType=Q,Vn.DOMImplementation=jr,Vn.Element=Ar,Vn.Entity=ye,Vn.EntityReference=Ee,Vn.LiveNodeList=It,Vn.NamedNodeMap=Xt,Vn.Node=rr,Vn.NodeList=vt,Vn.Notation=ae,Vn.Text=li,Vn.ProcessingInstruction=Ze,Vn.XMLSerializer=Be,Vn}var Vh={},$m={},e_;function Pv(){return e_||(e_=1,function(w){var S=fd().freeze;w.XML_ENTITIES=S({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),w.HTML_ENTITIES=S({Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",AMP:"&",amp:"&",And:"",and:"",andand:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsd:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",ap:"",apacir:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",Barwed:"",barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",Because:"",because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxDL:"",boxDl:"",boxdL:"",boxdl:"",boxDR:"",boxDr:"",boxdR:"",boxdr:"",boxH:"",boxh:"",boxHD:"",boxHd:"",boxhD:"",boxhd:"",boxHU:"",boxHu:"",boxhU:"",boxhu:"",boxminus:"",boxplus:"",boxtimes:"",boxUL:"",boxUl:"",boxuL:"",boxul:"",boxUR:"",boxUr:"",boxuR:"",boxur:"",boxV:"",boxv:"",boxVH:"",boxVh:"",boxvH:"",boxvh:"",boxVL:"",boxVl:"",boxvL:"",boxvl:"",boxVR:"",boxVr:"",boxvR:"",boxvr:"",bprime:"",Breve:"",breve:"",brvbar:"",Bscr:"",bscr:"",bsemi:"",bsim:"",bsime:"",bsol:"\\",bsolb:"",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",Cap:"",cap:"",capand:"",capbrcup:"",capcap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",CenterDot:"",centerdot:"",Cfr:"",cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",cir:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",Colon:"",colon:":",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",Conint:"",conint:"",ContourIntegral:"",Copf:"",copf:"",coprod:"",Coproduct:"",COPY:"",copy:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",Cross:"",cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",Cup:"",cup:"",cupbrcap:"",CupCap:"",cupcap:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",Dagger:"",dagger:"",daleth:"",Darr:"",dArr:"",darr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",DD:"",dd:"",ddagger:"",ddarr:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",Diamond:"",diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrow:"",Downarrow:"",downarrow:"",DownArrowBar:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVector:"",DownLeftVectorBar:"",DownRightTeeVector:"",DownRightVector:"",DownRightVectorBar:"",DownTee:"",DownTeeArrow:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",ecir:"",Ecirc:"",ecirc:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",eDot:"",edot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp:"",emsp13:"",emsp14:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",Escr:"",escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",ExponentialE:"",exponentiale:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",ForAll:"",forall:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",Fscr:"",fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",gE:"",ge:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",ges:"",gescc:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",Gg:"",gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gl:"",gla:"",glE:"",glj:"",gnap:"",gnapprox:"",gnE:"",gne:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",Gt:"",GT:">",gt:">",gtcc:"",gtcir:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",hArr:"",harr:"",harrcir:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",Hfr:"",hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",Hopf:"",hopf:"",horbar:"",HorizontalLine:"",Hscr:"",hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",Ifr:"",ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Im:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",imof:"",imped:"",Implies:"",in:"",incare:"",infin:"",infintie:"",inodot:"",Int:"",int:"",intcal:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",Iscr:"",iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",Lang:"",lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",Larr:"",lArr:"",larr:"",larrb:"",larrbfs:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",lat:"",lAtail:"",latail:"",late:"",lates:"",lBarr:"",lbarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",lE:"",le:"",LeftAngleBracket:"",LeftArrow:"",Leftarrow:"",leftarrow:"",LeftArrowBar:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVector:"",LeftDownVectorBar:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTee:"",LeftTeeArrow:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangle:"",LeftTriangleBar:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVector:"",LeftUpVectorBar:"",LeftVector:"",LeftVectorBar:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",les:"",lescc:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",Ll:"",ll:"",llarr:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoust:"",lmoustache:"",lnap:"",lnapprox:"",lnE:"",lne:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",LongLeftArrow:"",Longleftarrow:"",longleftarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longleftrightarrow:"",longmapsto:"",LongRightArrow:"",Longrightarrow:"",longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",Lscr:"",lscr:"",Lsh:"",lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",Lt:"",LT:"<",lt:"<",ltcc:"",ltcir:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",mid:"",midast:"*",midcir:"",middot:"",minus:"",minusb:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",Mscr:"",mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natur:"",natural:"",naturals:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",ne:"",nearhk:"",neArr:"",nearr:"",nearrow:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:`
`,nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nhArr:"",nharr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlArr:"",nlarr:"",nldr:"",nlE:"",nle:"",nLeftarrow:"",nleftarrow:"",nLeftrightarrow:"",nleftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",Nopf:"",nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangle:"",NotLeftTriangleBar:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangle:"",NotRightTriangleBar:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",npar:"",nparallel:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",npre:"",nprec:"",npreceq:"",nrArr:"",nrarr:"",nrarrc:"",nrarrw:"",nRightarrow:"",nrightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nVDash:"",nVdash:"",nvDash:"",nvdash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwArr:"",nwarr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",ocir:"",Ocirc:"",ocirc:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",Or:"",or:"",orarr:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",Otimes:"",otimes:"",otimesas:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",par:"",para:"",parallel:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plus:"+",plusacir:"",plusb:"",pluscir:"",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",Popf:"",popf:"",pound:"",Pr:"",pr:"",prap:"",prcue:"",prE:"",pre:"",prec:"",precapprox:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",precsim:"",Prime:"",prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportion:"",Proportional:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",Qopf:"",qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",QUOT:'"',quot:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",Rang:"",rang:"",rangd:"",range:"",rangle:"",raquo:"",Rarr:"",rArr:"",rarr:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",rAtail:"",ratail:"",ratio:"",rationals:"",RBarr:"",rBarr:"",rbarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",Re:"",real:"",realine:"",realpart:"",reals:"",rect:"",REG:"",reg:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",Rfr:"",rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrow:"",Rightarrow:"",rightarrow:"",RightArrowBar:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVector:"",RightDownVectorBar:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTee:"",RightTeeArrow:"",RightTeeVector:"",rightthreetimes:"",RightTriangle:"",RightTriangleBar:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVector:"",RightUpVectorBar:"",RightVector:"",RightVectorBar:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoust:"",rmoustache:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",Ropf:"",ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",Rscr:"",rscr:"",Rsh:"",rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",Sc:"",sc:"",scap:"",Scaron:"",scaron:"",sccue:"",scE:"",sce:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdot:"",sdotb:"",sdote:"",searhk:"",seArr:"",searr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",sol:"/",solb:"",solbar:"",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",squ:"",Square:"",square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",Sub:"",sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",Subset:"",subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succ:"",succapprox:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",Sum:"",sum:"",sung:"",Sup:"",sup:"",sup1:"",sup2:"",sup3:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",Supset:"",supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swArr:"",swarr:"",swarrow:"",swnwar:"",szlig:"",Tab:"	",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",Therefore:"",therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",thinsp:"",ThinSpace:"",thkap:"",thksim:"",THORN:"",thorn:"",Tilde:"",tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",times:"",timesb:"",timesbar:"",timesd:"",tint:"",toea:"",top:"",topbot:"",topcir:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",TRADE:"",trade:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",Uarr:"",uArr:"",uarr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrow:"",Uparrow:"",uparrow:"",UpArrowBar:"",UpArrowDownArrow:"",UpDownArrow:"",Updownarrow:"",updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",Upsi:"",upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTee:"",UpTeeArrow:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",vArr:"",varr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",Vbar:"",vBar:"",vBarv:"",Vcy:"",vcy:"",VDash:"",Vdash:"",vDash:"",vdash:"",Vdashl:"",Vee:"",vee:"",veebar:"",veeeq:"",vellip:"",Verbar:"",verbar:"|",Vert:"",vert:"|",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",Wedge:"",wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xhArr:"",xharr:"",Xi:"",xi:"",xlArr:"",xlarr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrArr:"",xrarr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",Yuml:"",yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",Zfr:"",zfr:"",ZHcy:"",zhcy:"",zigrarr:"",Zopf:"",zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}),w.entityMap=w.HTML_ENTITIES}($m)),$m}var hp={},t_;function Rv(){if(t_)return hp;t_=1;var w=fd(),S=I_(),M=xm(),D=w.isHTMLEscapableRawTextElement,B=w.isHTMLMimeType,U=w.isHTMLRawTextElement,I=w.hasOwn,c=w.NAMESPACE,J=M.ParseError,K=M.DOMException,oe=0,X=1,_e=2,se=3,Me=4,qe=5,at=6,ft=7;function pt(){}pt.prototype={parse:function(tt,Re,st){var ot=this.domBuilder;ot.startDocument(),Yt(Re,Re=Object.create(null)),Rt(tt,Re,st,ot,this.errorHandler),ot.endDocument()}};var zt=/&#?\w+;?/g;function Rt(tt,Re,st,ot,jt){var ue=B(ot.mimeType);tt.indexOf(S.UNICODE_REPLACEMENT_CHARACTER)>=0&&jt.warning("Unicode replacement character detected, source encoding issues?");function Ye(yr){if(yr>65535){yr-=65536;var Ar=55296+(yr>>10),Zr=56320+(yr&1023);return String.fromCharCode(Ar,Zr)}else return String.fromCharCode(yr)}function Mt(yr){var Ar=yr[yr.length-1]===";"?yr:yr+";";if(!ue&&Ar!==yr)return jt.error("EntityRef: expecting ;"),yr;var Zr=S.Reference.exec(Ar);if(!Zr||Zr[0].length!==Ar.length)return jt.error("entity not matching Reference production: "+yr),yr;var Ur=Ar.slice(1,-1);return I(st,Ur)?st[Ur]:Ur.charAt(0)==="#"?Ye(parseInt(Ur.substring(1).replace("x","0x"))):(jt.error("entity not found:"+yr),yr)}function yt(yr){if(yr>jr){var Ar=tt.substring(jr,yr).replace(zt,Mt);Xt&&mr(jr),ot.characters(Ar,0,yr-jr),jr=yr}}var vt=0,It=0,Ot=/\r\n?|\n|$/g,Xt=ot.locator;function mr(yr,Ar){for(;yr>=It&&(Ar=Ot.exec(tt));)vt=It,It=Ar.index+Ar[0].length,Xt.lineNumber++;Xt.columnNumber=yr-vt+1}for(var hi=[{currentNSMap:Re}],Si=[],jr=0;;){try{var rr=tt.indexOf("<",jr);if(rr<0){if(!ue&&Si.length>0)return jt.fatalError("unclosed xml tag(s): "+Si.join(", "));if(!tt.substring(jr).match(/^\s*$/)){var mi=ot.doc,Dr=mi.createTextNode(tt.substring(jr));if(mi.documentElement)return jt.error("Extra content at the end of the document");mi.appendChild(Dr),ot.currentElement=Dr}return}if(rr>jr){var kr=tt.substring(jr,rr);!ue&&Si.length===0&&(kr=kr.replace(new RegExp(S.S_OPT.source,"g"),""),kr&&jt.error("Unexpected content outside root element: '"+kr+"'")),yt(rr)}switch(tt.charAt(rr+1)){case"/":var _i=tt.indexOf(">",rr+2),Ui=tt.substring(rr+2,_i>0?_i:void 0);if(!Ui)return jt.fatalError("end tag name missing");var _r=_i>0&&S.reg("^",S.QName_group,S.S_OPT,"$").exec(Ui);if(!_r)return jt.fatalError('end tag name contains invalid characters: "'+Ui+'"');if(!ot.currentElement&&!ot.doc.documentElement)return;var xi=Si[Si.length-1]||ot.currentElement.tagName||ot.doc.documentElement.tagName||"";if(xi!==_r[1]){var sn=_r[1].toLowerCase();if(!ue||xi.toLowerCase()!==sn)return jt.fatalError('Opening and ending tag mismatch: "'+xi+'" != "'+Ui+'"')}var gi=hi.pop();Si.pop();var oi=gi.localNSMap;if(ot.endElement(gi.uri,gi.localName,xi),oi)for(var Ai in oi)I(oi,Ai)&&ot.endPrefixMapping(Ai);_i++;break;case"?":Xt&&mr(rr),_i=Kt(tt,rr,ot,jt);break;case"!":Xt&&mr(rr),_i=dr(tt,rr,ot,jt,ue);break;default:Xt&&mr(rr);var Nr=new xr,Yi=hi[hi.length-1].currentNSMap,_i=Pe(tt,rr,Nr,Yi,Mt,jt,ue),Vi=Nr.length;if(Nr.closed||(ue&&w.isHTMLVoidElement(Nr.tagName)?Nr.closed=!0:Si.push(Nr.tagName)),Xt&&Vi){for(var ri=Ge(Xt,{}),ei=0;ei<Vi;ei++){var ii=Nr[ei];mr(ii.offset),ii.locator=Ge(Xt,{})}ot.locator=ri,gt(Nr,ot,Yi)&&hi.push(Nr),ot.locator=Xt}else gt(Nr,ot,Yi)&&hi.push(Nr);ue&&!Nr.closed?_i=bt(tt,_i,Nr.tagName,Mt,ot):_i++}}catch(yr){if(yr instanceof J)throw yr;if(yr instanceof K)throw new J(yr.name+": "+yr.message,ot.locator,yr);jt.error("element parse error: "+yr),_i=-1}_i>jr?jr=_i:yt(Math.max(rr,jr)+1)}}function Ge(tt,Re){return Re.lineNumber=tt.lineNumber,Re.columnNumber=tt.columnNumber,Re}function Pe(tt,Re,st,ot,jt,ue,Ye){function Mt(mr,hi,Si){if(I(st.attributeNames,mr))return ue.fatalError("Attribute "+mr+" redefined");if(!Ye&&hi.indexOf("<")>=0)return ue.fatalError("Unescaped '<' not allowed in attributes values");st.addValue(mr,hi.replace(/[\t\n\r]/g," ").replace(zt,jt),Si)}for(var yt,vt,It=++Re,Ot=oe;;){var Xt=tt.charAt(It);switch(Xt){case"=":if(Ot===X)yt=tt.slice(Re,It),Ot=se;else if(Ot===_e)Ot=se;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(Ot===se||Ot===X)if(Ot===X&&(ue.warning('attribute value must after "="'),yt=tt.slice(Re,It)),Re=It+1,It=tt.indexOf(Xt,Re),It>0)vt=tt.slice(Re,It),Mt(yt,vt,Re-1),Ot=qe;else throw new Error("attribute value no end '"+Xt+"' match");else if(Ot==Me)vt=tt.slice(Re,It),Mt(yt,vt,Re),ue.warning('attribute "'+yt+'" missed start quot('+Xt+")!!"),Re=It+1,Ot=qe;else throw new Error('attribute value must after "="');break;case"/":switch(Ot){case oe:st.setTagName(tt.slice(Re,It));case qe:case at:case ft:Ot=ft,st.closed=!0;case Me:case X:break;case _e:st.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return ue.error("unexpected end of input"),Ot==oe&&st.setTagName(tt.slice(Re,It)),It;case">":switch(Ot){case oe:st.setTagName(tt.slice(Re,It));case qe:case at:case ft:break;case Me:case X:vt=tt.slice(Re,It),vt.slice(-1)==="/"&&(st.closed=!0,vt=vt.slice(0,-1));case _e:Ot===_e&&(vt=yt),Ot==Me?(ue.warning('attribute "'+vt+'" missed quot(")!'),Mt(yt,vt,Re)):(Ye||ue.warning('attribute "'+vt+'" missed value!! "'+vt+'" instead!!'),Mt(vt,vt,Re));break;case se:if(!Ye)return ue.fatalError(`AttValue: ' or " expected`)}return It;case"":Xt=" ";default:if(Xt<=" ")switch(Ot){case oe:st.setTagName(tt.slice(Re,It)),Ot=at;break;case X:yt=tt.slice(Re,It),Ot=_e;break;case Me:var vt=tt.slice(Re,It);ue.warning('attribute "'+vt+'" missed quot(")!!'),Mt(yt,vt,Re);case qe:Ot=at;break}else switch(Ot){case _e:Ye||ue.warning('attribute "'+yt+'" missed value!! "'+yt+'" instead2!!'),Mt(yt,yt,Re),Re=It,Ot=X;break;case qe:ue.warning('attribute space is required"'+yt+'"!!');case at:Ot=X,Re=It;break;case se:Ot=Me,Re=It;break;case ft:throw new Error("elements closed character '/' and '>' must be connected to")}}It++}}function gt(tt,Re,st){for(var ot=tt.tagName,jt=null,Ot=tt.length;Ot--;){var ue=tt[Ot],Ye=ue.qName,Mt=ue.value,Xt=Ye.indexOf(":");if(Xt>0)var yt=ue.prefix=Ye.slice(0,Xt),vt=Ye.slice(Xt+1),It=yt==="xmlns"&&vt;else vt=Ye,yt=null,It=Ye==="xmlns"&&"";ue.localName=vt,It!==!1&&(jt==null&&(jt=Object.create(null),Yt(st,st=Object.create(null))),st[It]=jt[It]=Mt,ue.uri=c.XMLNS,Re.startPrefixMapping(It,Mt))}for(var Ot=tt.length;Ot--;)ue=tt[Ot],ue.prefix&&(ue.prefix==="xml"&&(ue.uri=c.XML),ue.prefix!=="xmlns"&&(ue.uri=st[ue.prefix]));var Xt=ot.indexOf(":");Xt>0?(yt=tt.prefix=ot.slice(0,Xt),vt=tt.localName=ot.slice(Xt+1)):(yt=null,vt=tt.localName=ot);var mr=tt.uri=st[yt||""];if(Re.startElement(mr,vt,ot,tt),tt.closed){if(Re.endElement(mr,vt,ot),jt)for(yt in jt)I(jt,yt)&&Re.endPrefixMapping(yt)}else return tt.currentNSMap=st,tt.localNSMap=jt,!0}function bt(tt,Re,st,ot,jt){var ue=D(st);if(ue||U(st)){var Ye=tt.indexOf("</"+st+">",Re),Mt=tt.substring(Re+1,Ye);return ue&&(Mt=Mt.replace(zt,ot)),jt.characters(Mt,0,Mt.length),Ye}return Re+1}function Yt(tt,Re){for(var st in tt)I(tt,st)&&(Re[st]=tt[st])}function nr(tt,Re){var st=Re;function ot(It){return It=It||0,tt.charAt(st+It)}function jt(It){It=It||1,st+=It}function ue(){for(var It=0;st<tt.length;){var Ot=ot();if(Ot!==" "&&Ot!==`
`&&Ot!=="	"&&Ot!=="\r")return It;It++,jt()}return-1}function Ye(){return tt.substring(st)}function Mt(It){return tt.substring(st,st+It.length)===It}function yt(It){return tt.substring(st,st+It.length).toUpperCase()===It.toUpperCase()}function vt(It){var Ot=S.reg("^",It),Xt=Ot.exec(Ye());return Xt?(jt(Xt[0].length),Xt[0]):null}return{char:ot,getIndex:function(){return st},getMatch:vt,getSource:function(){return tt},skip:jt,skipBlanks:ue,substringFromIndex:Ye,substringStartsWith:Mt,substringStartsWithCaseInsensitive:yt}}function lr(tt,Re){function st(Mt,yt){var vt=S.PI.exec(Mt.substringFromIndex());return vt?vt[1].toLowerCase()==="xml"?yt.fatalError("xml declaration is only allowed at the start of the document, but found at position "+Mt.getIndex()):(Mt.skip(vt[0].length),vt[0]):yt.fatalError("processing instruction is not well-formed at position "+Mt.getIndex())}var ot=tt.getSource();if(tt.char()==="["){tt.skip(1);for(var jt=tt.getIndex();tt.getIndex()<ot.length;){if(tt.skipBlanks(),tt.char()==="]"){var ue=ot.substring(jt,tt.getIndex());return tt.skip(1),ue}var Ye=null;if(tt.char()==="<"&&tt.char(1)==="!")switch(tt.char(2)){case"E":tt.char(3)==="L"?Ye=tt.getMatch(S.elementdecl):tt.char(3)==="N"&&(Ye=tt.getMatch(S.EntityDecl));break;case"A":Ye=tt.getMatch(S.AttlistDecl);break;case"N":Ye=tt.getMatch(S.NotationDecl);break;case"-":Ye=tt.getMatch(S.Comment);break}else if(tt.char()==="<"&&tt.char(1)==="?")Ye=st(tt,Re);else if(tt.char()==="%")Ye=tt.getMatch(S.PEReference);else return Re.fatalError("Error detected in Markup declaration");if(!Ye)return Re.fatalError("Error in internal subset at position "+tt.getIndex())}return Re.fatalError("doctype internal subset is not well-formed, missing ]")}}function dr(tt,Re,st,ot,jt){var ue=nr(tt,Re);switch(jt?ue.char(2).toUpperCase():ue.char(2)){case"-":var Ye=ue.getMatch(S.Comment);return Ye?(st.comment(Ye,S.COMMENT_START.length,Ye.length-S.COMMENT_START.length-S.COMMENT_END.length),ue.getIndex()):ot.fatalError("comment is not well-formed at position "+ue.getIndex());case"[":var Mt=ue.getMatch(S.CDSect);return Mt?!jt&&!st.currentElement?ot.fatalError("CDATA outside of element"):(st.startCDATA(),st.characters(Mt,S.CDATA_START.length,Mt.length-S.CDATA_START.length-S.CDATA_END.length),st.endCDATA(),ue.getIndex()):ot.fatalError("Invalid CDATA starting at position "+Re);case"D":{if(st.doc&&st.doc.documentElement)return ot.fatalError("Doctype not allowed inside or after documentElement at position "+ue.getIndex());if(jt?!ue.substringStartsWithCaseInsensitive(S.DOCTYPE_DECL_START):!ue.substringStartsWith(S.DOCTYPE_DECL_START))return ot.fatalError("Expected "+S.DOCTYPE_DECL_START+" at position "+ue.getIndex());if(ue.skip(S.DOCTYPE_DECL_START.length),ue.skipBlanks()<1)return ot.fatalError("Expected whitespace after "+S.DOCTYPE_DECL_START+" at position "+ue.getIndex());var yt={name:void 0,publicId:void 0,systemId:void 0,internalSubset:void 0};if(yt.name=ue.getMatch(S.Name),!yt.name)return ot.fatalError("doctype name missing or contains unexpected characters at position "+ue.getIndex());if(jt&&yt.name.toLowerCase()!=="html"&&ot.warning("Unexpected DOCTYPE in HTML document at position "+ue.getIndex()),ue.skipBlanks(),ue.substringStartsWith(S.PUBLIC)||ue.substringStartsWith(S.SYSTEM)){var vt=S.ExternalID_match.exec(ue.substringFromIndex());if(!vt)return ot.fatalError("doctype external id is not well-formed at position "+ue.getIndex());vt.groups.SystemLiteralOnly!==void 0?yt.systemId=vt.groups.SystemLiteralOnly:(yt.systemId=vt.groups.SystemLiteral,yt.publicId=vt.groups.PubidLiteral),ue.skip(vt[0].length)}else if(jt&&ue.substringStartsWithCaseInsensitive(S.SYSTEM)){if(ue.skip(S.SYSTEM.length),ue.skipBlanks()<1)return ot.fatalError("Expected whitespace after "+S.SYSTEM+" at position "+ue.getIndex());if(yt.systemId=ue.getMatch(S.ABOUT_LEGACY_COMPAT_SystemLiteral),!yt.systemId)return ot.fatalError("Expected "+S.ABOUT_LEGACY_COMPAT+" in single or double quotes after "+S.SYSTEM+" at position "+ue.getIndex())}return jt&&yt.systemId&&!S.ABOUT_LEGACY_COMPAT_SystemLiteral.test(yt.systemId)&&ot.warning("Unexpected doctype.systemId in HTML document at position "+ue.getIndex()),jt||(ue.skipBlanks(),yt.internalSubset=lr(ue,ot)),ue.skipBlanks(),ue.char()!==">"?ot.fatalError("doctype not terminated with > at position "+ue.getIndex()):(ue.skip(1),st.startDTD(yt.name,yt.publicId,yt.systemId,yt.internalSubset),st.endDTD(),ue.getIndex())}default:return ot.fatalError('Not well-formed XML starting with "<!" at position '+Re)}}function Kt(tt,Re,st,ot){var jt=tt.substring(Re).match(S.PI);if(!jt)return ot.fatalError("Invalid processing instruction starting at position "+Re);if(jt[1].toLowerCase()==="xml"){if(Re>0)return ot.fatalError("processing instruction at position "+Re+" is an xml declaration which is only at the start of the document");if(!S.XMLDecl.test(tt.substring(Re)))return ot.fatalError("xml declaration is not well-formed")}return st.processingInstruction(jt[1],jt[2]),Re+jt[0].length}function xr(){this.attributeNames=Object.create(null)}return xr.prototype={setTagName:function(tt){if(!S.QName_exact.test(tt))throw new Error("invalid tagName:"+tt);this.tagName=tt},addValue:function(tt,Re,st){if(!S.QName_exact.test(tt))throw new Error("invalid attribute:"+tt);this.attributeNames[tt]=this.length,this[this.length++]={qName:tt,value:Re,offset:st}},length:0,getLocalName:function(tt){return this[tt].localName},getLocator:function(tt){return this[tt].locator},getQName:function(tt){return this[tt].qName},getURI:function(tt){return this[tt].uri},getValue:function(tt){return this[tt].value}},hp.XMLReader=pt,hp.parseUtils=nr,hp.parseDoctypeCommentOrCData=dr,hp}var r_;function zv(){if(r_)return Vh;r_=1;var w=fd(),S=P_(),M=xm(),D=Pv(),B=Rv(),U=S.DOMImplementation,I=w.hasDefaultHTMLNamespace,c=w.isHTMLMimeType,J=w.isValidMimeType,K=w.MIME_TYPE,oe=w.NAMESPACE,X=M.ParseError,_e=B.XMLReader;function se(Pe){return Pe.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028\u2029]/g,`
`)}function Me(Pe){if(Pe=Pe||{},Pe.locator===void 0&&(Pe.locator=!0),this.assign=Pe.assign||w.assign,this.domHandler=Pe.domHandler||qe,this.onError=Pe.onError||Pe.errorHandler,Pe.errorHandler&&typeof Pe.errorHandler!="function")throw new TypeError("errorHandler object is no longer supported, switch to onError!");Pe.errorHandler&&Pe.errorHandler("warning","The `errorHandler` option has been deprecated, use `onError` instead!",this),this.normalizeLineEndings=Pe.normalizeLineEndings||se,this.locator=!!Pe.locator,this.xmlns=this.assign(Object.create(null),Pe.xmlns)}Me.prototype.parseFromString=function(Pe,gt){if(!J(gt))throw new TypeError('DOMParser.parseFromString: the provided mimeType "'+gt+'" is not valid.');var bt=this.assign(Object.create(null),this.xmlns),Yt=D.XML_ENTITIES,nr=bt[""]||null;I(gt)?(Yt=D.HTML_ENTITIES,nr=oe.HTML):gt===K.XML_SVG_IMAGE&&(nr=oe.SVG),bt[""]=nr,bt.xml=bt.xml||oe.XML;var lr=new this.domHandler({mimeType:gt,defaultNamespace:nr,onError:this.onError}),dr=this.locator?{}:void 0;this.locator&&lr.setDocumentLocator(dr);var Kt=new _e;Kt.errorHandler=lr,Kt.domBuilder=lr;var xr=!w.isHTMLMimeType(gt);return xr&&typeof Pe!="string"&&Kt.errorHandler.fatalError("source is not a string"),Kt.parse(this.normalizeLineEndings(String(Pe)),bt,Yt),lr.doc.documentElement||Kt.errorHandler.fatalError("missing root element"),lr.doc};function qe(Pe){var gt=Pe||{};this.mimeType=gt.mimeType||K.XML_APPLICATION,this.defaultNamespace=gt.defaultNamespace||null,this.cdata=!1,this.currentElement=void 0,this.doc=void 0,this.locator=void 0,this.onError=gt.onError}function at(Pe,gt){gt.lineNumber=Pe.lineNumber,gt.columnNumber=Pe.columnNumber}qe.prototype={startDocument:function(){var Pe=new U;this.doc=c(this.mimeType)?Pe.createHTMLDocument(!1):Pe.createDocument(this.defaultNamespace,"")},startElement:function(Pe,gt,bt,Yt){var nr=this.doc,lr=nr.createElementNS(Pe,bt||gt),dr=Yt.length;zt(this,lr),this.currentElement=lr,this.locator&&at(this.locator,lr);for(var Kt=0;Kt<dr;Kt++){var Pe=Yt.getURI(Kt),xr=Yt.getValue(Kt),bt=Yt.getQName(Kt),tt=nr.createAttributeNS(Pe,bt);this.locator&&at(Yt.getLocator(Kt),tt),tt.value=tt.nodeValue=xr,lr.setAttributeNode(tt)}},endElement:function(Pe,gt,bt){this.currentElement=this.currentElement.parentNode},startPrefixMapping:function(Pe,gt){},endPrefixMapping:function(Pe){},processingInstruction:function(Pe,gt){var bt=this.doc.createProcessingInstruction(Pe,gt);this.locator&&at(this.locator,bt),zt(this,bt)},ignorableWhitespace:function(Pe,gt,bt){},characters:function(Pe,gt,bt){if(Pe=pt.apply(this,arguments),Pe){if(this.cdata)var Yt=this.doc.createCDATASection(Pe);else var Yt=this.doc.createTextNode(Pe);this.currentElement?this.currentElement.appendChild(Yt):/^\s*$/.test(Pe)&&this.doc.appendChild(Yt),this.locator&&at(this.locator,Yt)}},skippedEntity:function(Pe){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(Pe){Pe&&(Pe.lineNumber=0),this.locator=Pe},comment:function(Pe,gt,bt){Pe=pt.apply(this,arguments);var Yt=this.doc.createComment(Pe);this.locator&&at(this.locator,Yt),zt(this,Yt)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(Pe,gt,bt,Yt){var nr=this.doc.implementation;if(nr&&nr.createDocumentType){var lr=nr.createDocumentType(Pe,gt,bt,Yt);this.locator&&at(this.locator,lr),zt(this,lr),this.doc.doctype=lr}},reportError:function(Pe,gt){if(typeof this.onError=="function")try{this.onError(Pe,gt,this)}catch(bt){throw new X("Reporting "+Pe+' "'+gt+'" caused '+bt,this.locator)}else console.error("[xmldom "+Pe+"]	"+gt,ft(this.locator))},warning:function(Pe){this.reportError("warning",Pe)},error:function(Pe){this.reportError("error",Pe)},fatalError:function(Pe){throw this.reportError("fatalError",Pe),new X(Pe,this.locator)}};function ft(Pe){if(Pe)return`
@#[line:`+Pe.lineNumber+",col:"+Pe.columnNumber+"]"}function pt(Pe,gt,bt){return typeof Pe=="string"?Pe.substr(gt,bt):Pe.length>=gt+bt||gt?new java.lang.String(Pe,gt,bt)+"":Pe}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(Pe){qe.prototype[Pe]=function(){return null}});function zt(Pe,gt){Pe.currentElement?Pe.currentElement.appendChild(gt):Pe.doc.appendChild(gt)}function Rt(Pe){if(Pe==="error")throw"onErrorStopParsing"}function Ge(){throw"onWarningStopParsing"}return Vh.__DOMHandler=qe,Vh.DOMParser=Me,Vh.normalizeLineEndings=se,Vh.onErrorStopParsing=Rt,Vh.onWarningStopParsing=Ge,Vh}var i_;function Lv(){if(i_)return pi;i_=1;var w=fd();pi.assign=w.assign,pi.hasDefaultHTMLNamespace=w.hasDefaultHTMLNamespace,pi.isHTMLMimeType=w.isHTMLMimeType,pi.isValidMimeType=w.isValidMimeType,pi.MIME_TYPE=w.MIME_TYPE,pi.NAMESPACE=w.NAMESPACE;var S=xm();pi.DOMException=S.DOMException,pi.DOMExceptionName=S.DOMExceptionName,pi.ExceptionCode=S.ExceptionCode,pi.ParseError=S.ParseError;var M=P_();pi.Attr=M.Attr,pi.CDATASection=M.CDATASection,pi.CharacterData=M.CharacterData,pi.Comment=M.Comment,pi.Document=M.Document,pi.DocumentFragment=M.DocumentFragment,pi.DocumentType=M.DocumentType,pi.DOMImplementation=M.DOMImplementation,pi.Element=M.Element,pi.Entity=M.Entity,pi.EntityReference=M.EntityReference,pi.LiveNodeList=M.LiveNodeList,pi.NamedNodeMap=M.NamedNodeMap,pi.Node=M.Node,pi.NodeList=M.NodeList,pi.Notation=M.Notation,pi.ProcessingInstruction=M.ProcessingInstruction,pi.Text=M.Text,pi.XMLSerializer=M.XMLSerializer;var D=zv();return pi.DOMParser=D.DOMParser,pi.normalizeLineEndings=D.normalizeLineEndings,pi.onErrorStopParsing=D.onErrorStopParsing,pi.onWarningStopParsing=D.onWarningStopParsing,pi}var kv=Lv();od.config({name:"MyTrailMaps",storeName:"trail_data"});const Bv={tilejson:"2.2.0",name:"Track Tiles",tiles:[`https://mytrailmaps.brocksville.com/tiles/trackdata/{z}/{x}/{y}.pbf?nocache=${Date.now()}`],minzoom:5,maxzoom:15};async function Ov(){try{const w=await fetch("/api/delete-account",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(!w.ok){const S=await w.json();alert(" Failed to delete account: "+(S.error||w.statusText));return}localStorage.removeItem("authToken"),onLogout(),navigate("/signup")}catch(w){console.error("Error deleting account:",w),alert(" An error occurred while deleting your account.")}}function Nv({onLogout:w}){var k,O,me;const[S,M]=xt.useState(null),[D,B]=xt.useState(0),[U,I]=xt.useState(0),[c,J]=xt.useState(!1),[K,oe]=xt.useState(0),[X,_e]=xt.useState(null),[se,Me]=xt.useState(null),[qe,at]=xt.useState(null),[ft,pt]=xt.useState(null),[zt,Rt]=xt.useState(""),[Ge,Pe]=xt.useState("map"),[gt,bt]=xt.useState(!0),[Yt,nr]=xt.useState(!0),[lr,dr]=xt.useState(!0),[Kt,xr]=xt.useState(!0),[tt,Re]=xt.useState(!0),[st,ot]=xt.useState(!1),[jt,ue]=xt.useState("main"),[Ye,Mt]=xt.useState(null),[yt,vt]=xt.useState(!1),[It,Ot]=xt.useState([]),[Xt,mr]=xt.useState([]),[hi,Si]=xt.useState(!1),[jr,rr]=xt.useState([]),[mi,Dr]=xt.useState(null),[kr,Ui]=xt.useState(""),[_r,xi]=xt.useState(null),[sn,gi]=xt.useState(!1),[oi,Ai]=xt.useState([]),[Nr,Yi]=xt.useState(null),[_i,Vi]=xt.useState(!1),[ri,ei]=xt.useState([]),[ii,yr]=xt.useState(!1),Ar=xt.useRef(null),Zr=xt.useRef(null),Ur=xt.useRef(null);cd();function li(de){return(de||"Ungrouped").trim().toLowerCase()}function Ne(de){const ze=li(de),We=Xt.filter(Le=>{var wt;return li((wt=Le.properties)==null?void 0:wt.folderName)!==ze});mr(We),ei(Le=>Le.filter(wt=>li(wt)!==ze)),at(null)}function W(de,ze){const We=li(de),Le=ze.trim();if(!Le)return;const wt=Xt.map(Nt=>{var Jt;return li((Jt=Nt.properties)==null?void 0:Jt.folderName)===We?{...Nt,properties:{...Nt.properties,folderName:Le}}:Nt});mr(wt),ei(Nt=>Nt.map(Jt=>li(Jt)===We?Le:Jt)),pt(null),Rt("")}function Q(de,ze){const We=[...Xt];We[de].properties.name=ze.trim(),mr(We),Dr(null)}function ae(de){const ze=[...Xt];ze.splice(de,1),mr(ze)}function ye(de){var wt;const ze=new Blob([JSON.stringify(de,null,2)],{type:"application/json"}),We=URL.createObjectURL(ze),Le=document.createElement("a");Le.href=We,Le.download=`${((wt=de.properties)==null?void 0:wt.name)||"trip"}.geojson`,Le.click(),URL.revokeObjectURL(We)}function Ee(de){const ze=Xt.filter(Jt=>{var ar;return((ar=Jt.properties)==null?void 0:ar.folderName)===de});if(!ze.length){alert(`No tracks found in folder "${de}".`);return}const We={type:"FeatureCollection",features:ze},Le=new Blob([JSON.stringify(We,null,2)],{type:"application/json"}),wt=URL.createObjectURL(Le),Nt=document.createElement("a");Nt.href=wt,Nt.download=`${de.replace(/\s+/g,"_")||"folder"}.geojson`,Nt.click(),URL.revokeObjectURL(wt)}function re(de){const ze=de.target.files[0];if(!ze)return;const We=new FileReader;We.onload=async Le=>{const wt=Le.target.result,Nt=ze.name.split(".").pop().toLowerCase(),Jt=ze.name.replace(/\.[^/.]+$/,"");let ar=null;try{if(Nt==="gpx"||Nt==="kml"){const ti=new kv.DOMParser().parseFromString(wt,"application/xml");ar=Nt==="gpx"?nv(ti):Iv(ti)}else ar=JSON.parse(wt);if(!ar||!ar.features)throw new Error("Invalid format");const Hr=ar.features.filter(ti=>{var bi;return((bi=ti.geometry)==null?void 0:bi.type)==="LineString"}),Qt=ar.features.filter(ti=>{var bi;return((bi=ti.geometry)==null?void 0:bi.type)==="Point"}),Pi=Jt,_n=Yy(),ui=Hr.map((ti,bi)=>{var Ln,Sr;return{...ti,properties:{...ti.properties,name:((Ln=ti.properties)==null?void 0:Ln.name)||`${Jt} Track ${bi+1}`,stroke:((Sr=ti.properties)==null?void 0:Sr.stroke)||"#FF0000",createdAt:Date.now(),folderName:Pi,folderId:_n}}});xi({folderName:Pi,folderId:_n,tracks:ui,waypoints:Qt,selectedTrackIndexes:ui.map((ti,bi)=>bi)}),gi(!0)}catch(Hr){alert(" Failed to parse file: "+Hr.message)}},We.readAsText(ze)}function Ze(de){const ze=Math.floor(de/3600),We=Math.floor(de%3600/60),Le=de%60;return[ze,We,Le].map(wt=>String(wt).padStart(2,"0")).join(":")}function Be(de,ze){const We=bi=>bi*Math.PI/180,[Le,wt]=de,[Nt,Jt]=ze,ar=6371e3,Hr=We(wt),Qt=We(Jt),Pi=We(Jt-wt),_n=We(Nt-Le),ui=Math.sin(Pi/2)**2+Math.cos(Hr)*Math.cos(Qt)*Math.sin(_n/2)**2,ti=2*Math.atan2(Math.sqrt(ui),Math.sqrt(1-ui));return ar*ti/1609.34}function Oe(){if(!navigator.geolocation){console.error("Geolocation is not supported by this browser.");return}Ar.current!==null&&(navigator.geolocation.clearWatch(Ar.current),Ar.current=null);const de=()=>{Ar.current=navigator.geolocation.watchPosition(ze=>{const We=ze.coords.altitude,Le=We!=null?We*3.28084:null;_e(Le);const wt=ze.coords.speed,Nt=wt!=null?wt*2.23694:0;oe(Nt),Ot(Jt=>{const ar=[...Jt,[ze.coords.longitude,ze.coords.latitude]];if(ar.length>1){const Hr=Be(ar[ar.length-2],ar[ar.length-1]);I(Qt=>Qt+Hr)}return ar})},ze=>{if(ze.code===ze.TIMEOUT){console.warn("Geolocation timeout: retrying in 1s..."),Ar.current!==null&&(navigator.geolocation.clearWatch(Ar.current),Ar.current=null),setTimeout(()=>de(),1e3);return}ze.code===ze.PERMISSION_DENIED?console.error("Geolocation permission denied."):ze.code===ze.POSITION_UNAVAILABLE?console.error("Position unavailable."):console.error("Geolocation error:",ze.message)},{enableHighAccuracy:!0,maximumAge:0,timeout:3e4})};de()}function He(){vt(!0),J(!1),Ot([]),oe(0),_e(null);const de=Date.now();M(de),B(0),I(0),Zr.current=setInterval(()=>{B(Math.floor((Date.now()-de)/1e3))},1e3),Oe()}function je(){J(!0),Ar.current&&navigator.geolocation.clearWatch(Ar.current),Zr.current&&clearInterval(Zr.current)}function _t(){J(!1);const de=Date.now()-D*1e3;Zr.current=setInterval(()=>{B(Math.floor((Date.now()-de)/1e3))},1e3),Oe()}function Ut(){Ar.current!==null&&(navigator.geolocation.clearWatch(Ar.current),Ar.current=null),Zr.current&&(clearInterval(Zr.current),Zr.current=null),J(!1),vt(!1),It.length>1&&(rr(It),Si(!0),Ui(""))}function Gt(de){if(!de.trim()||jr.length<2)return;const ze={type:"Feature",geometry:{type:"LineString",coordinates:jr},properties:{name:de.trim(),stroke:"#FF0000",createdAt:Date.now(),distance:U.toFixed(2),duration:D,speed:K.toFixed(2),elevation:X!=null?X.toFixed(0):null,folderName:"Ungrouped",folderId:null}},We=[...Xt,ze];mr(We),ri.includes("Ungrouped")||ei(Le=>[...Le,"Ungrouped"]),rr([]),Si(!1),Pe("tracks")}function tr(de){var We;const ze=(We=de.geometry)==null?void 0:We.coordinates;if(ze&&ze.length){const Le=ze.reduce((wt,Nt)=>wt.extend(Nt),new dp.LngLatBounds(ze[0],ze[0]));Pe("map"),setTimeout(()=>{var Nt,Jt;const wt=window.innerWidth<768;(Nt=Ur.current)==null||Nt.resize(),(Jt=Ur.current)==null||Jt.fitBounds(Le,{padding:wt?{top:40,bottom:40,left:40,right:40}:{top:40,bottom:40,left:100,right:100},maxZoom:15})},250)}}const ir=localStorage.getItem("authToken")||"";return xt.useEffect(()=>{async function de(){const ze=await od.getItem("userAccount");if(ze&&(mr(ze.tracks||[]),ei(ze.folderOrder||[]),ze.preferences&&(bt(ze.preferences.showTracks??!0),nr(ze.preferences.showNames??!0),dr(ze.preferences.showWaypoints??!0),xr(ze.preferences.showWaypointLabels??!0),Re(ze.preferences.showPublicTracks??!0))),!ir){w();return}if(navigator.onLine)try{const We=await fetch("/api/get-account",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ir}`}}),Le=await We.json();if(!We.ok){We.status===401&&w();return}const{account:wt}=Le;mr(wt.tracks||[]),ei(wt.folderOrder||[]),wt.preferences&&(bt(wt.preferences.showTracks??!0),nr(wt.preferences.showNames??!0),dr(wt.preferences.showWaypoints??!0),xr(wt.preferences.showWaypointLabels??!0),Re(wt.preferences.showPublicTracks??!0)),await od.setItem("userAccount",wt)}catch(We){console.warn("Failed to fetch from server:",We)}}de()},[ir,w]),xt.useEffect(()=>{async function de(){if(!ir)return;const ze={tracks:Xt,folderOrder:ri,preferences:{showTracks:gt,showNames:Yt,showWaypoints:lr,showWaypointLabels:Kt,showPublicTracks:tt}};if(await od.setItem("userAccount",ze),navigator.onLine)try{await fetch("/api/save-account",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ir}`},body:JSON.stringify({account:ze})})}catch(We){console.error("Error saving account remotely:",We)}}de()},[ir,Xt,ri,gt,Yt,lr,Kt,tt]),xt.useEffect(()=>{const de=()=>{document.body.style.height=`${window.innerHeight}px`};return de(),window.addEventListener("orientationchange",de),window.addEventListener("resize",de),()=>{window.removeEventListener("orientationchange",de),window.removeEventListener("resize",de)}},[]),ge.jsxs("div",{className:"relative w-full h-full overflow-hidden flex flex-col",children:[ge.jsx("div",{className:`flex justify-between items-center p-4 border-b border-gray-300 bg-white shadow ${Ge==="map"?"hidden":""}`,children:ge.jsx("h2",{className:"text-xl font-semibold capitalize",children:Ge})}),ge.jsxs("div",{className:"flex-1 relative overflow-hidden",children:[ge.jsxs("div",{className:Ge==="map"?"block":"hidden",children:[ge.jsx(N0,{showNames:Yt,showWaypoints:lr,showWaypointLabels:Kt,showTracks:gt,showPublicTracks:tt,onGeolocateControlReady:Mt,liveTrack:yt?It:null,userTracks:Xt,tileJson:Bv,mapRef:Ur}),ge.jsxs("div",{className:"absolute top-4 left-4 z-40 bg-white rounded-xl shadow-md p-3 space-y-2 text-sm text-gray-800",children:[ge.jsxs("div",{className:"flex items-center space-x-2",children:[ge.jsx("span",{className:"inline-block w-6 h-1 rounded-full bg-green-600"}),ge.jsx("span",{children:"Easy"})]}),ge.jsxs("div",{className:"flex items-center space-x-2",children:[ge.jsx("span",{className:"inline-block w-6 h-1 rounded-full bg-blue-600"}),ge.jsx("span",{children:"Moderate"})]}),ge.jsxs("div",{className:"flex items-center space-x-2",children:[ge.jsx("span",{className:"inline-block w-6 h-1 rounded-full bg-red-600"}),ge.jsx("span",{children:"Hard"})]})]})]}),Ge==="trip"&&ge.jsxs("div",{className:"p-4 space-y-4 flex flex-col items-center",children:[ge.jsx("button",{onClick:He,disabled:yt,className:`w-64 p-3 rounded-lg font-semibold text-center ${yt?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-gray-100 text-green-700"}`,children:"Start Trip"}),ge.jsx("button",{onClick:Ut,className:"w-64 p-3 bg-red-100 rounded-lg font-semibold text-center text-red-700",children:"Stop Trip"}),yt&&ge.jsxs("div",{className:"text-center mt-2 text-sm text-gray-700 space-y-2",children:[ge.jsxs("p",{children:["Tracking for: ",ge.jsx("span",{className:"font-semibold",children:Ze(D)})]}),ge.jsxs("p",{children:["Distance: ",ge.jsxs("span",{className:"font-semibold",children:[U.toFixed(2)," mi"]})]}),ge.jsxs("p",{children:["Speed: ",ge.jsxs("span",{className:"font-semibold",children:[K.toFixed(2)," mph"]})]}),ge.jsxs("p",{children:["Elevation:"," ",ge.jsx("span",{className:"font-semibold",children:X!=null?`${X.toFixed(0)} ft`:"N/A"})]}),c?ge.jsx("button",{onClick:_t,className:"px-4 py-2 bg-green-100 text-green-700 rounded-lg font-semibold",children:"Resume"}):ge.jsx("button",{onClick:je,className:"px-4 py-2 bg-yellow-100 text-yellow-700 rounded-lg font-semibold",children:"Pause"})]})]}),Ge==="tracks"&&ge.jsxs("div",{className:"p-4 space-y-4 flex flex-col items-center pb-24",style:{maxHeight:"calc(100vh - 3.5rem)",overflowY:"auto"},children:[ge.jsx("div",{className:"w-full max-w-md flex justify-center mb-4",children:ge.jsxs("label",{className:"w-64 p-3 bg-gray-100 rounded-lg font-semibold text-center text-green-700 cursor-pointer",children:["Import Track",ge.jsx("input",{type:"file",accept:".gpx,.kml,.geojson,.topojson,.json",onChange:re,className:"hidden"})]})}),Xt.length>0&&ge.jsxs("div",{className:"w-full max-w-md flex justify-between items-center mb-2 text-sm",children:[ge.jsxs("label",{className:"flex items-center space-x-2",children:[ge.jsx("input",{type:"checkbox",checked:oi.length===Xt.length,onChange:de=>{Ai(de.target.checked?Xt.map((ze,We)=>We):[])}}),ge.jsx("span",{children:"Select All"})]}),oi.length>0&&ge.jsxs("button",{onClick:()=>Vi(!0),className:"text-red-600 font-semibold",children:["Delete Selected (",oi.length,")"]})]}),Xt.length===0?ge.jsx("p",{className:"text-gray-600",children:"No saved trips yet."}):(()=>{const de=Xt.reduce((Le,wt,Nt)=>{var ar;const Jt=((ar=wt.properties)==null?void 0:ar.folderName)||"Ungrouped";return Le[Jt]||(Le[Jt]=[]),Le[Jt].push({track:wt,idx:Nt}),Le},{}),We=Object.keys(de).filter(Le=>!ri.includes(Le));return We.length&&ei(Le=>[...Le,...We]),ri.map(Le=>de[Le]?ge.jsx(Fv,{folderName:Le,items:de[Le],selectedTracks:oi,setSelectedTracks:Ai,editingIndex:mi,setEditingIndex:Dr,editedName:kr,setEditedName:Ui,updateTrackName:Q,exportTrack:ye,setConfirmDeleteIndex:Me,setConfirmDeleteFolder:at,zoomToTrack:tr,formatTime:Ze,setFolderRenameTarget:pt,setNewFolderName:Rt,exportFolder:Ee},Le):null)})()]}),Ge==="settings"&&ge.jsxs("div",{className:"p-4 flex flex-col items-center justify-center h-full",children:[ge.jsx("button",{onClick:w,className:"w-64 p-3 bg-gray-100 text-red-700 rounded-lg font-semibold text-center",children:"Log Out"}),ge.jsx("button",{onClick:()=>yr(!0),className:"w-64 p-3 bg-gray-100 text-red-700 rounded-lg font-semibold text-center mt-4",children:"Delete Account"})]}),_i&&ge.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:ge.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-80 p-6 space-y-4 text-center",children:[ge.jsx("h2",{className:"text-lg font-semibold text-red-600",children:"Delete Tracks"}),ge.jsxs("p",{className:"text-gray-700",children:["Are you sure you want to delete ",ge.jsx("strong",{children:oi.length})," tracks?"]}),ge.jsxs("div",{className:"flex justify-center gap-4 mt-4",children:[ge.jsx("button",{onClick:()=>Vi(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancel"}),ge.jsx("button",{onClick:()=>{const de=Xt.filter((ze,We)=>!oi.includes(We));mr(de),Ai([]),Vi(!1)},className:"px-4 py-2 bg-red-600 text-white rounded-lg font-semibold",children:"Delete"})]})]})}),Ge==="map"&&ge.jsx("button",{onClick:()=>{ot(!0),ue("main")},className:"absolute z-50 bottom-20 left-4 p-3 bg-white text-black rounded-full shadow-lg",children:ge.jsx(W0,{className:"text-xl"})}),st&&ge.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t z-50 rounded-t-2xl shadow-xl max-h-[70%]",children:[ge.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[jt!=="main"&&ge.jsx("button",{onClick:()=>ue("main"),className:"text-green-700 text-3xl leading-none px-2","aria-label":"Back",children:""}),ge.jsx("h3",{className:"text-lg font-semibold",children:jt==="main"?"Maps":"Map Overlays"}),ge.jsx("button",{onClick:()=>ot(!1),className:"text-gray-600 text-3xl leading-none px-2","aria-label":"Close",children:""})]}),jt==="main"&&ge.jsx("div",{className:"p-4",children:ge.jsxs("div",{className:"space-y-4 flex flex-col items-center",children:[ge.jsx("button",{onClick:()=>ue("overlays"),className:"w-64 p-3 bg-gray-100 rounded-lg font-semibold text-center text-green-700",children:"Map Overlays"}),ge.jsx("button",{className:"w-64 p-3 bg-gray-100 rounded-lg font-semibold text-center text-green-700",children:"Save Offline Maps"})]})}),jt==="overlays"&&ge.jsxs("div",{className:"p-4 space-y-4",children:[ge.jsxs("div",{className:"flex justify-between items-center",children:[ge.jsx("span",{children:"Tracks"}),ge.jsx(cp,{checked:gt,onChange:de=>bt(de.target.checked)})]}),ge.jsxs("div",{className:"flex justify-between items-center",children:[ge.jsx("span",{children:"Track Names"}),ge.jsx(cp,{checked:Yt,onChange:de=>nr(de.target.checked)})]}),ge.jsxs("div",{className:"flex justify-between items-center",children:[ge.jsx("span",{children:"Waypoints"}),ge.jsx(cp,{checked:lr,onChange:de=>dr(de.target.checked)})]}),ge.jsxs("div",{className:"flex justify-between items-center",children:[ge.jsx("span",{children:"Waypoint Labels"}),ge.jsx(cp,{checked:Kt,onChange:de=>xr(de.target.checked)})]}),ge.jsxs("div",{className:"flex justify-between items-center",children:[ge.jsx("span",{children:"Public Tracks"}),ge.jsx(cp,{checked:tt,onChange:de=>Re(de.target.checked)})]})]})]}),hi&&ge.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:ge.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-80 p-6 space-y-4",children:[ge.jsx("h2",{className:"text-lg font-semibold text-green-700",children:"Name Your Trip"}),ge.jsx("input",{type:"text",value:kr,onChange:de=>Ui(de.target.value),placeholder:"e.g. Weekend Ride",className:"w-full p-2 border border-gray-300 rounded-lg",autoFocus:!0}),ge.jsxs("div",{className:"flex justify-end space-x-2",children:[ge.jsx("button",{onClick:()=>{Ui(""),Si(!1)},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancel"}),ge.jsx("button",{onClick:()=>{kr.trim()&&(Gt(kr),Ui(""))},className:"px-4 py-2 bg-green-600 text-white rounded-lg font-semibold",children:"Save"})]})]})}),se!==null&&ge.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:ge.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-80 p-6 space-y-4 text-center",children:[ge.jsx("h2",{className:"text-lg font-semibold text-red-600",children:"Delete Trip"}),ge.jsxs("p",{className:"text-gray-700",children:["Are you sure you want to delete"," ",ge.jsx("strong",{children:Xt[se].properties.name}),"?"]}),ge.jsxs("div",{className:"flex justify-center gap-4 mt-4",children:[ge.jsx("button",{onClick:()=>Me(null),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancel"}),ge.jsx("button",{onClick:()=>{ae(se),Me(null)},className:"px-4 py-2 bg-red-600 text-white rounded-lg font-semibold",children:"Delete"})]})]})}),qe!==null&&ge.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:ge.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-80 p-6 space-y-4 text-center",children:[ge.jsx("h2",{className:"text-lg font-semibold text-red-600",children:"Delete Folder"}),ge.jsxs("p",{className:"text-gray-700",children:["Are you sure you want to delete ",ge.jsx("strong",{children:qe})," and all its tracks?"]}),ge.jsxs("div",{className:"flex justify-center gap-4 mt-4",children:[ge.jsx("button",{onClick:()=>at(null),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancel"}),ge.jsx("button",{onClick:()=>Ne(qe),className:"px-4 py-2 bg-red-600 text-white rounded-lg font-semibold",children:"Delete"})]})]})}),ft&&ge.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:ge.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-80 p-6 space-y-4 text-center",children:[ge.jsx("h2",{className:"text-lg font-semibold text-blue-700",children:"Rename Folder"}),ge.jsx("input",{type:"text",value:zt,onChange:de=>Rt(de.target.value),placeholder:"New folder name",className:"w-full p-2 border border-gray-300 rounded-lg",autoFocus:!0}),ge.jsxs("div",{className:"flex justify-center gap-4 mt-4",children:[ge.jsx("button",{onClick:()=>{pt(null),Rt("")},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancel"}),ge.jsx("button",{onClick:()=>W(ft,zt),className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold",children:"Rename"})]})]})})]}),ii&&ge.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:ge.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-80 p-6 space-y-4 text-center",children:[ge.jsx("h2",{className:"text-lg font-semibold text-red-600",children:"Delete Account"}),ge.jsxs("p",{className:"text-gray-700",children:["Are you sure you want to permanently delete your account?",ge.jsx("br",{}),"This cannot be undone."]}),ge.jsxs("div",{className:"flex justify-center gap-4 mt-4",children:[ge.jsx("button",{onClick:()=>yr(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancel"}),ge.jsx("button",{onClick:Ov,className:"px-4 py-2 bg-red-600 text-white rounded-lg font-semibold",children:"Delete"})]})]})}),sn&&_r&&ge.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:ge.jsxs("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-xl p-6 space-y-4",children:[ge.jsx("h2",{className:"text-lg font-semibold text-green-700",children:"Import Preview"}),ge.jsx("input",{type:"text",value:_r.folderName||"",onChange:de=>xi(ze=>({...ze,folderName:de.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg",placeholder:"Folder name (optional)"}),_r.tracks.length>0&&ge.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[ge.jsxs("span",{children:[_r.tracks.length," tracks found"]}),ge.jsx("button",{onClick:()=>{var We;const de=_r.tracks.map((Le,wt)=>wt),ze=((We=_r.selectedTrackIndexes)==null?void 0:We.length)===de.length?[]:de;xi(Le=>({...Le,selectedTrackIndexes:ze}))},className:"text-blue-600 hover:underline",children:((k=_r.selectedTrackIndexes)==null?void 0:k.length)===_r.tracks.length?"Clear All":"Select All"})]}),ge.jsxs("div",{className:"max-h-64 overflow-y-auto border rounded p-3 bg-gray-50 text-sm space-y-2",children:[_r.tracks.map((de,ze)=>{var We,Le;return ge.jsxs("label",{className:"flex items-center space-x-2",children:[ge.jsx("input",{type:"checkbox",checked:(We=_r.selectedTrackIndexes)==null?void 0:We.includes(ze),onChange:wt=>{const Nt=new Set(_r.selectedTrackIndexes||[]);wt.target.checked?Nt.add(ze):Nt.delete(ze),xi(Jt=>({...Jt,selectedTrackIndexes:[...Nt]}))}}),ge.jsx("span",{children:((Le=de.properties)==null?void 0:Le.name)||`Unnamed Track ${ze+1}`})]},ze)}),_r.waypoints.length>0&&ge.jsxs("p",{className:"mt-2 text-xs text-gray-600",children:["(",_r.waypoints.length," waypoints also included)"]})]}),ge.jsxs("div",{className:"flex justify-end space-x-2",children:[ge.jsx("button",{onClick:()=>gi(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancel"}),ge.jsx("button",{onClick:()=>{var Nt;const de=((Nt=_r.folderName)==null?void 0:Nt.trim())||_r.folderName,ze=_r.folderId,We=new Set(_r.selectedTrackIndexes||[]),Le=_r.tracks.map((Jt,ar)=>({...Jt,properties:{...Jt.properties,folderName:de,folderId:ze}})).filter((Jt,ar)=>We.has(ar));de&&!ri.includes(de)&&ei(Jt=>[...Jt,de]);const wt=[...Xt,...Le];mr(wt),gi(!1),xi(null),Yi(" Import successful."),setTimeout(()=>Yi(null),3e3)},disabled:!((O=_r.selectedTrackIndexes)!=null&&O.length),className:`px-4 py-2 rounded-lg font-semibold ${(me=_r.selectedTrackIndexes)!=null&&me.length?"bg-green-600 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Confirm Import"})]})]})}),ge.jsxs("div",{className:"fixed bottom-0 left-0 right-0 z-40 flex justify-around items-center border-t border-gray-300 bg-white h-14",children:[ge.jsxs("button",{onClick:()=>Pe("map"),className:`flex flex-col items-center text-xs ${Ge==="map"?"text-green-700 font-semibold":"text-gray-600"}`,children:[ge.jsx($0,{className:"text-lg"}),ge.jsx("span",{children:"Map"})]}),ge.jsxs("button",{onClick:()=>Pe("trip"),className:`flex flex-col items-center text-xs ${Ge==="trip"?"text-green-700 font-semibold":"text-gray-600"}`,children:[ge.jsx(Y0,{className:"text-lg"}),ge.jsx("span",{children:"Trip"})]}),ge.jsxs("button",{onClick:()=>Pe("tracks"),className:`flex flex-col items-center text-xs ${Ge==="tracks"?"text-green-700 font-semibold":"text-gray-600"}`,children:[ge.jsx(X0,{className:"text-lg"}),ge.jsx("span",{children:"My Tracks"})]}),ge.jsxs("button",{onClick:()=>Pe("settings"),className:`flex flex-col items-center text-xs ${Ge==="settings"?"text-green-700 font-semibold":"text-gray-600"}`,children:[ge.jsx(H0,{className:"text-lg"}),ge.jsx("span",{children:"Settings"})]})]}),Nr&&ge.jsx("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg z-50",children:Nr})]})}function Fv({folderName:w,items:S,selectedTracks:M,setSelectedTracks:D,editingIndex:B,setEditingIndex:U,editedName:I,setEditedName:c,updateTrackName:J,exportTrack:K,setConfirmDeleteIndex:oe,setConfirmDeleteFolder:X,zoomToTrack:_e,formatTime:se,setFolderRenameTarget:Me,setNewFolderName:qe,exportFolder:at}){const[ft,pt]=xt.useState(!0);return ge.jsxs("div",{className:"w-full max-w-md",children:[ge.jsxs("div",{className:"w-full bg-gray-200 rounded-t flex items-center justify-between px-2 py-2",children:[ge.jsxs("div",{className:"flex items-center gap-2",children:[ge.jsx("input",{type:"checkbox",checked:S.every(({idx:zt})=>M.includes(zt)),onChange:zt=>{const Rt=S.map(({idx:Ge})=>Ge);D(Ge=>zt.target.checked?[...new Set([...Ge,...Rt])]:Ge.filter(Pe=>!Rt.includes(Pe)))}}),ge.jsx("button",{onClick:()=>pt(!ft),className:"text-left font-bold text-green-700",children:w})]}),ge.jsxs("div",{className:"flex items-center gap-2",children:[w!=="Ungrouped"&&ge.jsxs(ge.Fragment,{children:[ge.jsx("button",{onClick:()=>{Me(w),qe(w)},className:"text-blue-600 font-bold text-lg",title:"Rename Folder",children:""}),ge.jsx("button",{onClick:()=>at(w),className:"text-green-700 font-bold text-lg",title:"Export Folder",children:ge.jsx(Xg,{})}),ge.jsx("button",{onClick:()=>X(w),className:"text-red-600 font-bold text-lg",title:"Delete Folder",children:""})]}),ge.jsx("button",{onClick:()=>pt(!ft),className:"text-green-700 text-xl px-1","aria-label":"Toggle Folder",children:ft?"":"+"})]})]}),ft&&ge.jsx("div",{className:"space-y-2 p-2 bg-gray-50 rounded-b",children:S.map(({track:zt,idx:Rt})=>ge.jsxs("div",{className:"bg-white p-3 rounded-lg flex items-start justify-between gap-2",children:[ge.jsx("input",{type:"checkbox",className:"mt-2",checked:M.includes(Rt),onChange:Ge=>{D(Pe=>Ge.target.checked?[...Pe,Rt]:Pe.filter(gt=>gt!==Rt))}}),B===Rt?ge.jsxs(ge.Fragment,{children:[ge.jsx("input",{value:I,onChange:Ge=>c(Ge.target.value),className:"flex-1 mr-3 p-2 border border-gray-300 rounded"}),ge.jsxs("div",{className:"flex gap-2",children:[ge.jsx("button",{onClick:()=>J(Rt,I),className:"text-green-600 font-semibold",children:"Save"}),ge.jsx("button",{onClick:()=>U(null),className:"text-gray-600",children:"Cancel"})]})]}):ge.jsxs(ge.Fragment,{children:[ge.jsxs("div",{className:"flex-1",children:[ge.jsxs("h4",{className:"font-bold text-green-700 cursor-pointer hover:underline flex items-center",onClick:()=>_e(zt),children:[ge.jsx("span",{className:"inline-block w-3 h-3 mr-2 rounded-full",style:{backgroundColor:zt.properties.stroke||"#FF0000"}}),zt.properties.name]}),ge.jsxs("p",{className:"text-sm text-gray-600",children:[zt.properties.distance?`${zt.properties.distance} mi`:""," ",zt.properties.duration?` ${se(zt.properties.duration)}`:""," ",zt.properties.speed?` ${zt.properties.speed} mph`:""," ",zt.properties.elevation?` ${zt.properties.elevation} ft`:""]}),ge.jsx("p",{className:"text-xs text-gray-400",children:new Date(zt.properties.createdAt||0).toLocaleString()})]}),ge.jsxs("div",{className:"flex items-center gap-4 pl-4",children:[ge.jsx("button",{onClick:()=>{U(Rt),c(zt.properties.name)},className:"text-blue-600 font-bold text-lg",title:"Rename Track",children:""}),ge.jsx("button",{onClick:()=>K(zt),className:"text-green-700",title:"Export Track",children:ge.jsx(Xg,{className:"text-xl"})}),ge.jsx("button",{onClick:()=>oe(Rt),className:"text-red-600 font-bold text-lg",title:"Delete Track",children:""})]})]})]},Rt))})]})}function jv({isAuthenticated:w,children:S}){return w?S:ge.jsx(fp,{to:"/login",replace:!0})}function Uv(){const[w,S]=xt.useState("signup"),[M,D]=xt.useState({email:"",password:""}),[B,U]=xt.useState(null),[I,c]=xt.useState(!1),J=X=>{S(X),D({email:"",password:""}),U(null)},K=X=>{D(_e=>({..._e,[X.target.name]:X.target.value}))},oe=async X=>{X.preventDefault(),c(!0),U(null);const _e=w==="signup"?"/api/signup":"/api/login",se=w==="signup"?{email:M.email.trim(),password:M.password}:{email:M.email.trim(),password:M.password};try{const Me=await fetch(_e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(se)}),qe=await Me.json();if(!Me.ok)throw new Error(qe.error||"Request failed");w==="signin"?(localStorage.setItem("authToken",qe.token),localStorage.setItem("userEmail",M.email.trim()),U({type:"success",text:"Successfully signed in! Redirecting"}),setTimeout(()=>{window.location.href="/dashboard"},1200)):(U({type:"success",text:"Account created! Redirecting to login"}),setTimeout(()=>J("signin"),1500))}catch(Me){U({type:"error",text:Me.message})}finally{c(!1)}};return ge.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[ge.jsx("header",{className:"bg-white shadow",children:ge.jsxs("div",{className:"max-w-4xl mx-auto py-8 px-4 text-center",children:[ge.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[ge.jsx("img",{src:"/pwa-512x512.png",alt:"Logo",className:"w-10 h-10 rounded-md"}),ge.jsx("h1",{className:"text-3xl font-bold text-green-700",children:"My Trail Maps"})]}),ge.jsx("p",{className:"mt-2 text-gray-600",children:"Build, track, and save your tripsview live speed, elevation, and distance."}),ge.jsxs("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[ge.jsx("img",{src:"/screenshots/mapview.png",alt:"Map view",className:"rounded-lg shadow-lg object-contain w-full max-w-xs mx-auto"}),ge.jsx("img",{src:"/screenshots/triptracking.png",alt:"Trip tracking",className:"rounded-lg shadow-lg object-contain w-full max-w-xs mx-auto"}),ge.jsx("img",{src:"/screenshots/mytracks.png",alt:"My Tracks",className:"rounded-lg shadow-lg object-contain w-full max-w-xs mx-auto"}),ge.jsx("img",{src:"/screenshots/settings.png",alt:"Settings",className:"rounded-lg shadow-lg object-contain w-full max-w-xs mx-auto"})]})]})}),ge.jsx("main",{className:"flex-1 flex flex-col justify-center items-center px-4 mt-16",children:ge.jsxs("div",{className:"w-full max-w-md bg-white rounded-xl shadow-md overflow-hidden",children:[ge.jsxs("div",{className:"flex",children:[ge.jsx("button",{onClick:()=>J("signup"),className:`flex-1 py-3 text-center font-semibold border-b-2 ${w==="signup"?"border-green-600 text-green-700":"border-transparent text-gray-600 hover:text-green-700"}`,children:"Sign Up"}),ge.jsx("button",{onClick:()=>J("signin"),className:`flex-1 py-3 text-center font-semibold border-b-2 ${w==="signin"?"border-green-600 text-green-700":"border-transparent text-gray-600 hover:text-green-700"}`,children:"Sign In"})]}),ge.jsxs("form",{onSubmit:oe,className:"p-6 space-y-4",noValidate:!0,children:[ge.jsxs("div",{children:[ge.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),ge.jsx("input",{id:"email",name:"email",type:"email",required:!0,value:M.email,onChange:K,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500"})]}),ge.jsxs("div",{children:[ge.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),ge.jsx("input",{id:"password",name:"password",type:"password",required:!0,minLength:6,value:M.password,onChange:K,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500"})]}),B&&ge.jsx("div",{className:`p-3 rounded ${B.type==="error"?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:B.text}),ge.jsx("button",{type:"submit",disabled:I,className:`w-full py-3 rounded-lg font-semibold text-white ${I?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:I?w==="signup"?"Creating":"Signing in":w==="signup"?"Create Account":"Sign In"})]})]})}),ge.jsxs("footer",{className:"text-center py-4 text-xs text-gray-500",children:[" ",new Date().getFullYear()," MyTrailMaps. All rights reserved."]})]})}function Vv(){const[w,S]=xt.useState(!1);xt.useEffect(()=>{localStorage.getItem("authToken")&&S(!0)},[]);function M(){S(!0)}function D(){localStorage.removeItem("authToken"),S(!1)}return ge.jsx(Uy,{children:ge.jsxs(Ly,{children:[ge.jsx(qh,{path:"/",element:w?ge.jsx(fp,{to:"/dashboard",replace:!0}):ge.jsx(Uv,{})}),ge.jsx(qh,{path:"/login",element:w?ge.jsx(fp,{to:"/dashboard",replace:!0}):ge.jsx(Zy,{onLogin:M})}),ge.jsx(qh,{path:"/signup",element:w?ge.jsx(fp,{to:"/dashboard",replace:!0}):ge.jsx(Hy,{onSignUp:M})}),ge.jsx(qh,{path:"/reset-password",element:ge.jsx($y,{})}),ge.jsx(qh,{path:"/dashboard",element:ge.jsx(jv,{isAuthenticated:w,children:ge.jsx(Nv,{onLogout:D})})}),ge.jsx(qh,{path:"*",element:ge.jsx(fp,{to:"/",replace:!0})})]})})}const qv="modulepreload",Gv=function(w){return"/"+w},n_={},Zv=function(S,M,D){let B=Promise.resolve();if(M&&M.length>0){let I=function(K){return Promise.all(K.map(oe=>Promise.resolve(oe).then(X=>({status:"fulfilled",value:X}),X=>({status:"rejected",reason:X}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),J=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));B=I(M.map(K=>{if(K=Gv(K),K in n_)return;n_[K]=!0;const oe=K.endsWith(".css"),X=oe?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${K}"]${X}`))return;const _e=document.createElement("link");if(_e.rel=oe?"stylesheet":qv,oe||(_e.as="script"),_e.crossOrigin="",_e.href=K,J&&_e.setAttribute("nonce",J),document.head.appendChild(_e),oe)return new Promise((se,Me)=>{_e.addEventListener("load",se),_e.addEventListener("error",()=>Me(new Error(`Unable to preload CSS for ${K}`)))})}))}function U(I){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=I,window.dispatchEvent(c),!c.defaultPrevented)throw I}return B.then(I=>{for(const c of I||[])c.status==="rejected"&&U(c.reason);return S().catch(U)})};function Hv(w={}){const{immediate:S=!1,onNeedRefresh:M,onOfflineReady:D,onRegistered:B,onRegisteredSW:U,onRegisterError:I}=w;let c,J;const K=async(X=!0)=>{await J};async function oe(){if("serviceWorker"in navigator){if(c=await Zv(async()=>{const{Workbox:X}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:X}},[]).then(({Workbox:X})=>new X("/sw.js",{scope:"/",type:"classic"})).catch(X=>{I==null||I(X)}),!c)return;c.addEventListener("activated",X=>{(X.isUpdate||X.isExternal)&&window.location.reload()}),c.addEventListener("installed",X=>{X.isUpdate||D==null||D()}),c.register({immediate:S}).then(X=>{U?U("/sw.js",X):B==null||B(X)}).catch(X=>{I==null||I(X)})}}return J=oe(),K}q_.createRoot(document.getElementById("root")).render(ge.jsx(Xu.StrictMode,{children:ge.jsx(Vv,{})}));Hv({immediate:!0});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()});
